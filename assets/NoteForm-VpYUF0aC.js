import{p as K,W as p,u as Q,h as e,d as v,i,f as W,m as P,q as z,a7 as R,c as g,s as f,j as N,x as F,b as S,k as V,l as ee,H as X,a8 as B,a1 as te,n as Y,e as M,o as ae,a4 as ne,a9 as J,t as re,r as ie}from"./index-P_lgbILb.js";import{I as Z}from"./Input-BCHndn3x.js";var le=(_,l,o)=>{l(!1),i(o,"")},se=W('<form class="formNewTag svelte-597q6t"><!> <button type="button" class="buttonCancel svelte-597q6t">Cancel</button></form>'),oe=W('<div class="tags svelte-597q6t"><!> <!> <!> <!></div> <!>',1);function ue(_,l){K(l,!0);let o=v(null),n=v(""),s=p(l,"selectedTags",15),u=p(l,"shownTagInput",15);const w=t=>{s().includes(t)||(i(n,""),s([...s(),t]),e(o)?.focus())},x=t=>{const r=s().filter(d=>d!==t);r.length===0?s([]):s(r)};let b=F(()=>B()?[...(te()()||[]).reduce((t,r)=>(r?.tags.forEach(d=>{t.has(d)||t.add(d)}),t),new Set)]:[]),T=F(()=>B()?e(b).filter(t=>!s().some(r=>t===r)&&t!=="inbox"):[]),k=F(()=>e(T).find(t=>t.toLowerCase()===e(n).toLowerCase())||s().includes(e(n))),E=F(()=>e(T).filter(t=>e(n)===""?!0:t.toLowerCase().indexOf(e(n).toLowerCase())===0).slice(0,e(k)||e(n)===""?3:2));const c=t=>{t.preventDefault(),e(n)!==""&&(w(e(n)),i(n,""))};Q(()=>{e(o)&&u()&&e(o).focus(),u()||i(n,"")});var m=oe(),j=P(m),y=g(j);z(y,16,s,t=>t,(t,r)=>{R(t,{get title(){return r},onClick:()=>x(r),type:"button",style:"selected"})});var D=f(y,2);{var U=t=>{var r=ee(),d=P(r);z(d,16,()=>e(E),h=>h,(h,a)=>{R(h,{get title(){return a},onClick:()=>w(a)})}),S(t,r)};N(D,t=>{e(n)!==""&&t(U)})}var C=f(D,2);{var q=t=>{R(t,{get title(){return e(n)},onClick:()=>{w(e(n)),i(n,"")}})};N(C,t=>{!e(k)&&e(n)!==""&&t(q)})}var H=f(C,2);{var I=t=>{R(t,{title:"add tag",onClick:()=>u(!0)})};N(H,t=>{u()||t(I)})}var A=f(j,2);{var L=t=>{var r=se(),d=g(r);Z(d,{placeholder:"tag",get ref(){return e(o)},set ref(a){i(o,a,!0)},get value(){return e(n)},set value(a){i(n,a,!0)}});var h=f(d,2);h.__click=[le,u,n],X("submit",r,c),S(t,r)};N(A,t=>{u()&&t(L)})}S(_,m),V()}Y(["click"]);const ce=(_,l,o,n,s,u)=>{_.preventDefault(),l.onSubmit({title:e(o).trim().slice(0,256)||"unkwown",url:e(n).trim().slice(0,2048),description:e(s).trim().slice(0,2048),tags:e(u).length>0?e(u):["inbox"]})};var de=W('<div class="submitWrapper svelte-j7t5d5"><button class="buttonSubmit svelte-j7t5d5" type="submit"> </button></div>'),ve=W('<div class="form svelte-j7t5d5"><div class="formFields"><!> <form><input class="inputName svelte-j7t5d5" placeholder="Name"/></form> <textarea placeholder="Note" class="svelte-j7t5d5"></textarea></div> <div class="formTagsWrapper svelte-j7t5d5"><!></div> <!></div>');function ge(_,l){K(l,!0);let o=p(l,"initialTitle",3,""),n=p(l,"initialUrl",3,""),s=p(l,"initialDescription",3,""),u=p(l,"initialTags",19,()=>[]),w=p(l,"mode",3,"add"),x=v(M(o())),b=v(M(n())),T=v(""),k=v(M(s())),E=v(M(u().filter(a=>a!=="inbox"))),c=v(null),m=v(!1);const j=a=>{i(T,""),i(b,a.target.value||"",!0);try{new URL(e(b))}catch{i(T,"Invalid URL")}},y=()=>{e(c)&&(e(c).style.height="auto",e(c).style.height=e(c).scrollHeight+"px")};Q(()=>{e(c),y()});const D=a=>{a.preventDefault(),e(c)&&e(c).focus()},U=a=>{a.key==="Escape"&&(document.activeElement instanceof HTMLInputElement&&document.activeElement.type==="text"||document.activeElement instanceof HTMLTextAreaElement)&&(e(m)&&i(m,!1),document.activeElement.blur(),a.preventDefault(),a.stopPropagation())};ae(()=>(document.addEventListener("keydown",U),()=>document.removeEventListener("keydown",U)));var C=ve(),q=g(C),H=g(q);Z(H,{get value(){return e(b)},get error(){return e(T)},onInput:j,placeholder:"url"});var I=f(H,2),A=g(I),L=f(I,2);L.__input=y,ne(L,a=>i(c,a),()=>e(c));var t=f(q,2),r=g(t);ue(r,{get shownTagInput(){return e(m)},set shownTagInput(a){i(m,a,!0)},get selectedTags(){return e(E)},set selectedTags(a){i(E,a,!0)}});var d=f(t,2);{var h=a=>{var G=de(),O=g(G);O.__click=[ce,l,x,b,k,E];var $=g(O);re(()=>ie($,w()==="add"?"add":"edit")),S(a,G)};N(d,a=>{e(m)||a(h)})}X("submit",I,D),J(A,()=>e(x),a=>i(x,a)),J(L,()=>e(k),a=>i(k,a)),S(_,C),V()}Y(["input","click"]);export{ge as N};
