import{p as ve,h as de,i as ge,j as J,k as me,u as M,g as e,o as fe,l as i,f as l,m as v,c as n,d as t,n as _e,L as U,q as O,r as u,v as pe,s as d,e as ye,a as ue,I as Y,t as he,w as we,V as Ae,x as B,B as G,y as Q,P as R}from"./index-BTs3mYz0.js";import{g as Ke}from"./api-9q_jSmK4.js";import{g as ke}from"./webauthn-BEGDcNQV.js";var Ce=l('<p class="message svelte-ga1mwc">Loading access keys</p>'),be=l('<p class="message svelte-ga1mwc">Confirming</p>'),xe=(F,h,$)=>h(e($).id),Pe=l('<button class="buttonDelete svelte-ga1mwc"><!> <!></button>'),De=l('<li class="svelte-ga1mwc"><div class="keyInfo svelte-ga1mwc"><div><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper></div> <div class="keyName svelte-ga1mwc"> </div></div> <div class="keyActions svelte-ga1mwc"><!></div></li>'),$e=l('<p class="message error svelte-ga1mwc">Error deleting access key</p>'),Se=l('<div class="buttonContainer svelte-ga1mwc"><!></div>'),Te=l('<p class="message svelte-ga1mwc">You have reached the maximum number of access keys.</p>'),je=l('<p class="message svelte-ga1mwc">Access Keys</p> <ul class="svelte-ga1mwc"></ul> <!> <!>',1),Ee=l('<p class="message error svelte-ga1mwc">Something went wrong</p> <div class="buttonContainer svelte-ga1mwc"><!></div>',1),Ie=l('<div class="content svelte-ga1mwc"><!></div>');function He(F,h){ve(h,!0);const{createHandlePage:$,getPageUrl:W}=de(),{blockDialog:H}=ge();let s=J("loadingAccessKeys"),w=J(me([]));M(()=>{H(e(s)==="loadingAccessKeys"||e(s)==="confirmingDeleteAccessKey")}),fe(()=>()=>{H(!1)}),M(()=>{if(!h.hidden&&e(s)==="successAccessKeys"||e(s)==="loadingAccessKeys"){const r=new AbortController;return(async()=>{try{const c=await fetch("/api/credentials",{method:"POST",signal:r.signal});if(!c.ok)throw new Error("Failed to fetch access keys");const g=await c.json();i(w,g.credentials||[],!0),i(s,"successAccessKeys")}catch{i(s,"errorAccessKeys")}})(),()=>{r.abort()}}});const X=async r=>{i(s,"confirmingDeleteAccessKey");try{const c=await Ke(),g=await ke({challenge:c});if(!(await fetch("/api/deleteCredential",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({challenge:c,id:r,confirmCredential:g.credentialData})})).ok)throw new Error("Failed to add access key");i(s,"loadingAccessKeys")}catch{i(s,"errorDeleteAccessKey");return}};var N=Ie(),Z=n(N);{var ee=r=>{U(r,{children:(c,g)=>{var A=Ce();t(c,A)},$$slots:{default:!0}})},se=r=>{var c=O(),g=u(c);{var A=m=>{U(m,{children:(K,V)=>{var S=be();t(K,S)},$$slots:{default:!0}})},ae=m=>{var K=O(),V=u(K);{var S=f=>{var p=je(),k=d(u(p),2);ye(k,21,()=>e(w),a=>a.id,(a,o)=>{var _=De(),x=n(_),P=n(x),D=n(P);ue(D,()=>({"--size":"20px"})),Y(D.lastChild,{name:"key"});var q=d(P,2),E=n(q),re=d(x,2),ce=n(re);{var oe=I=>{var L=Pe();L.__click=[xe,X,o];var z=n(L);Y(z,{name:"close"});var le=d(z,2);Ae(le,{children:(ne,Le)=>{var ie=B("delete access key");t(ne,ie)}}),t(I,L)};v(ce,I=>{e(w).length>1&&I(oe)})}he(()=>we(E,e(o).name)),t(a,_)});var C=d(k,2);{var y=a=>{var o=$e();t(a,o)};v(C,a=>{e(s)==="errorDeleteAccessKey"&&a(y)})}var b=d(C,2);{var T=a=>{var o=Se(),_=n(o);{let x=Q(()=>W(R.ConfirmAccessKey)),P=Q(()=>$(R.ConfirmAccessKey));G(_,{element:"a",get href(){return e(x)},get onClick(){return e(P)},children:(D,q)=>{var E=B("Add access key");t(D,E)},$$slots:{default:!0}})}t(a,o)},j=a=>{var o=Te();t(a,o)};v(b,a=>{e(w).length<5?a(T):a(j,!1)})}t(f,p)},te=f=>{var p=O(),k=u(p);{var C=y=>{var b=Ee(),T=d(u(b),2),j=n(T);G(j,{onClick:()=>{i(s,"loadingAccessKeys")},children:(a,o)=>{var _=B("Try Again");t(a,_)},$$slots:{default:!0}}),t(y,b)};v(k,y=>{e(s)==="errorAccessKeys"&&y(C)},!0)}t(f,p)};v(V,f=>{e(s)==="successAccessKeys"||e(s)==="errorDeleteAccessKey"?f(S):f(te,!1)},!0)}t(m,K)};v(g,m=>{e(s)==="confirmingDeleteAccessKey"?m(A):m(ae,!1)},!0)}t(r,c)};v(Z,r=>{e(s)==="loadingAccessKeys"?r(ee):r(se,!1)})}t(F,N),_e()}pe(["click"]);export{He as default};
