import{p as W,Z as O,u as q,o as ee,e as G,a8 as p,a9 as ce,a as o,b as Y,f as te,j as z,i as F,c as A,h as X,aa as ne,m as K,n as j,Q as de,q as ue,r as Q,v as Z,w as ge,d as x,ab as fe,ac as he,M as me,N as ve,V as Se,t as ye,x as we,E as be,l as J}from"./index-CKRZdUcv.js";function pe(d,e){W(e,!0);let n=O(e,"dialog",7),t=null;const T=()=>{e.dialogState==="swiping"&&e.onClose()};q(()=>(e.dialogState==="swiping"&&(t=setTimeout(T,3e3)),()=>{t&&(clearTimeout(t),t=null)}));let S=null,r=null;const h=3,f=50,C=5,m=.6,y=.3,_=.35,P=.95;let w=0,E=0,L=0,u=!1,b=!1,i=0,a=0,v=0;const M=()=>{w=0,E=0,u=!1,b=!1,i=0,a=0,v=0,L=0,S=null,r!==null&&(cancelAnimationFrame(r),r=null),t&&(clearTimeout(t),t=null)},D=s=>{if(!n()){console.warn("Touch start: No dialog element");return}if(e.dialogState!=="opened"){console.warn(`Touch start: Invalid sidebar state: ${e.dialogState}`);return}w=s.touches[0].clientX,E=s.touches[0].clientY,L=performance.now(),u=!0,b=!1},H=s=>e.dialogState==="opened"&&s>0||e.dialogState==="swiping"&&s>0,N=s=>{if(n()){n().style.setProperty("--transition-timing","0s"),e.onSwipe(),navigator.vibrate&&navigator.vibrate(10);try{const l=window.getComputedStyle(n()),c=l.transform||l.webkitTransform||"";if(a=n().offsetWidth,(e.dialogState==="swiping"||e.dialogState==="opened")&&(i=0),c&&c!=="none")try{i=new DOMMatrix(c).m41}catch{console.warn("Could not parse transform matrix, using default position")}b=!0}catch(l){console.error("Error during swipe initialization:",l),M()}}},ie=()=>{if(!n())return;const l=Math.abs(i+v*a/100)/a;n().style.setProperty("--backdrop-bg",`rgba(0, 0, 0, ${.1*(1-l)})`)},oe=()=>{if(r=null,!S||!u||!n()||ce()){M();return}const s=S.touches[0].clientX,l=S.touches[0].clientY,c=s-w,g=l-E,V=Math.abs(c)>Math.abs(g),B=Math.abs(c)>h;if(!b)if(V&&B&&H(c))try{N(c)}catch(re){console.error("Error initializing swipe:",re),M();return}else return;if(!H(c))return;n().style.setProperty("--transition-timing","0s");let k=i+c*P;k=Math.max(0,Math.min(a,k)),n().style.transform=`translate3d(${k}px, 0, 0)`,p.swipingRatio=Math.abs(1-k/a),v=(k-i)/a*100,e.dialogState==="swiping"&&(t&&clearTimeout(t),t=setTimeout(T,3e3)),ie()},U=s=>{if(!u)return;S=s,r===null&&(r=requestAnimationFrame(oe));const l=s.touches[0].clientX-w,c=s.touches[0].clientY-E,g=Math.abs(l)>Math.abs(c);b&&g&&s.preventDefault()},ae=s=>{const l=Math.abs(s);if(l>=m)return C;if(l>=y){const c=(l-y)/(m-y);return f-c*(f-C)}else return f},se=(s,l)=>{if(Math.abs(s)>=m)return _*.5;const g=Math.abs(v)/100;return l?_*Math.max(.5,1-g):_*Math.max(.5,g)},I=s=>{if(r!==null&&(cancelAnimationFrame(r),r=null),!u||!n()){M();return}if(!b){M();return}let l=0;if(s?.changedTouches?.[0]){const k=s.changedTouches[0].clientX,R=performance.now()-L;R>0&&(l=(k-w)/R)}const c=ae(l);let g=null;e.dialogState==="swiping"&&(g=Math.abs(v)>c||l<-y?"close":"open");const V=e.dialogState==="swiping"&&g==="close",B=se(l,V);p.duration=B-.02,n().style.setProperty("--transition-timing",`${B}s`),n().offsetWidth,n().style.transform="",g==="open"?e.onOpen():g==="close"&&e.onClose(),n()?.style.removeProperty("--backdrop-bg"),M()};ee(()=>(n().addEventListener("touchstart",D,{passive:!0}),n().addEventListener("touchmove",U,{passive:!1}),n().addEventListener("touchend",I,{passive:!0}),n().addEventListener("touchcancel",I,{passive:!0}),()=>{n().removeEventListener("touchstart",D),n().removeEventListener("touchmove",U),n().removeEventListener("touchend",I),n().removeEventListener("touchcancel",I),r!==null&&cancelAnimationFrame(r)})),G()}var Te=(d,e)=>{e.onStartClose()},Ce=te('<button><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper> <!></button>'),_e=te('<dialog><div class="dialogInner svelte-68rj1a"><div class="header svelte-68rj1a"><div><!></div></div> <!></div></dialog> <!>',1);function Ee(d,e){W(e,!0);let n=350,t=Y(null),T=Y(null);const S=i=>{i.preventDefault(),e.onStartClose()};ee(()=>(o(t)?.addEventListener("close",e.onClosed),o(t)?.addEventListener("cancel",S),()=>{o(t)?.removeEventListener("close",e.onClosed),o(t)?.removeEventListener("cancel",S)}));const r=()=>{o(t)?.style.removeProperty("--transition-timing"),o(t)?.style.removeProperty("transform"),o(t)?.style.removeProperty("--backdrop-bg")},h=()=>{fe()},f=de(he);q(()=>{if(e.dialogState,!!o(t))switch(e.dialogState){case"opening":{o(t).open||o(t).showModal(),o(t).getBoundingClientRect();const i=setTimeout(()=>{r()},n+1),a=()=>{clearTimeout(i),r()};return o(t)?.addEventListener("transitionend",a,{once:!0}),e.onOpened(),()=>{o(t)?.removeEventListener("transitionend",a)}}case"closing":{const i=setTimeout(()=>{e.dialogState==="closing"&&e.onClosed()},n+1),a=()=>{clearTimeout(i),e.onClosed()};return o(t)?.addEventListener("transitionend",a,{once:!0}),()=>{o(t)?.removeEventListener("transitionend",a)}}case"opened":r()}});var C=_e(),m=z(C),y=A(m),_=A(y),P=A(_),w=A(P);{var E=i=>{var a=Ce();Q(a,1,Z(["navigateButton","buttonBack"]),"svelte-68rj1a"),a.__click=[Te,e];var v=A(a);me(v,()=>({"--size":"20px"})),ve(v.lastChild,{name:"back"});var M=X(v,2);Se(M,{children:(D,H)=>{var N=ye("back");x(D,N)}}),x(i,a)};F(w,i=>{(!(e.blocked||e.hidden)||e.blocked&&e.unBlockedBack)&&i(E)})}var L=X(_,2);ne(L,()=>e.children),K(y,i=>j(T,i),()=>o(T)),K(m,i=>j(t,i),()=>o(t));var u=X(m,2);{var b=i=>{pe(i,{get onClose(){return e.onStartClose},get onOpen(){return e.onStartOpen},get onSwipe(){return e.onSwipe},get dialogState(){return e.dialogState},get dialog(){return o(t)}})};F(u,i=>{(!o(f)&&e.dialogState==="opened"||e.dialogState==="swiping")&&(!e.blocked||e.unBlockedBack)&&i(b)})}ue(()=>Q(m,1,Z([{open:e.dialogState==="opened",hidden:e.hidden,isAnimationOn:p.working&&(!p.isSwiping||!e.hidden)},{hidden:e.hidden}]),"svelte-68rj1a")),ge("scroll",y,h),x(d,C),G()}we(["click"]);const $=(d,e)=>{if(!e)return d;if(e.type==="closed")return{type:"closed"};switch(d.type){case"opened":return e.type==="close"?{type:"closing"}:e.type==="swipe"?{type:"swiping"}:d;case"closed":return e.type==="open"?{type:"opening"}:d;case"swiping":return e.type==="open"?{type:"opening"}:e.type==="close"?{type:"closing"}:d;case"opening":return e.type==="opened"?{type:"opened"}:d;default:return d}};function ke(d,e){W(e,!0);let n=O(e,"blocked",3,!1),t=O(e,"hiddenDialog",3,!1),T=O(e,"unBlockedBack",3,!1),S=O(e,"onStartClose",3,()=>{}),r=O(e,"onClose",3,()=>{}),h=Y(be($({type:"closed"})));const f=u=>{j(h,$(o(h),u),!0)},C=()=>{n()&&!T()||(S()(),f({type:"close"}))},m=()=>{f({type:"open"})},y=()=>{f({type:"opened"}),p.duration=.2},_=()=>{r()(),f({type:"closed"}),p.swipingRatio=1,p.duration=.2},P=()=>{f({type:"swipe"})};q(()=>{o(h).type==="swiping"?p.isSwiping=!0:p.isSwiping=!1,o(h).type==="closed"&&e.shownDialog?m():o(h).type==="opened"&&!e.shownDialog&&C()});var w=J(),E=z(w);{var L=u=>{Ee(u,{onSwipe:P,onOpened:y,onClosed:_,onStartClose:C,onStartOpen:m,get dialogState(){return o(h).type},get hidden(){return t()},get blocked(){return n()},get unBlockedBack(){return T()},children:(b,i)=>{var a=J(),v=z(a);ne(v,()=>e.children),x(b,a)},$$slots:{default:!0}})};F(E,u=>{o(h).type!=="closed"&&u(L)})}return x(d,w),G({handleComputeState:f})}export{ke as default};
