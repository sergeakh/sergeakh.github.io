import{p as $,C as be,M as L,u as oe,i as e,e as g,j as l,o as ce,f as y,r as le,Y as Z,c as u,s as m,k as U,y as F,X as ee,b as h,l as te,m as ke,n as ue,D as ve,q as ae,h as H,H as we,N as Te,O as xe,Z as re,B as se,w as ie,t as Ce,v as pe}from"./index-D3sDlWLV.js";import{I as de}from"./Input-Cv9ybiUC.js";var ye=(w,t,i,f)=>{e(t)!==""&&i(e(t)),f(!1),l(t,"")},De=y('<form class="formNewTag svelte-16azfa5"><div class="inputWrapper svelte-16azfa5"><!></div> <button class="buttonDone svelte-16azfa5">Done</button></form>'),Ie=y('<div class="block"><div class="tags svelte-16azfa5"><!> <!> <!> <!></div> <!></div>');function Ne(w,t){$(t,!0);const{isReadyStore:i,getGetNotes:f}=be();let _=g(null),r=g(""),b=g(null);const S=F(i);let v=L(t,"shownTagInput",15);const E=a=>{t.selectedTags.includes(a)||(l(r,""),t.onChangeTags([...t.selectedTags,a]),e(_)?.focus())},I=a=>{const s=t.selectedTags.filter(C=>C!==a);s.length===0?t.onChangeTags([]):t.onChangeTags(s)};let D=F(()=>e(S)?[...(f()()||[]).reduce((a,s)=>(s?.tags.forEach(C=>{a.has(C)||a.add(C)}),a),new Set)]:[]),o=F(()=>e(S)?e(D).filter(a=>!t.selectedTags.some(s=>a===s)&&a!=="inbox"):[]),d=F(()=>e(o).find(a=>a.toLowerCase()===e(r).toLowerCase())||t.selectedTags.includes(e(r))),T=F(()=>e(o).filter(a=>e(r)===""?!0:a.toLowerCase().indexOf(e(r).toLowerCase())===0).slice(0,e(d)||e(r)===""?3:2));const p=a=>{a.preventDefault(),e(r)!==""?(E(e(r)),l(r,"")):v(!1)};oe(()=>{e(_)&&v()&&e(_).focus(),v()||l(r,"")});const k=a=>{a.target&&e(b)&&!e(b).contains(a.target)&&(v(!1),l(r,""))};ce(()=>(document.addEventListener("click",k,{capture:!0}),()=>{document.removeEventListener("click",k,{capture:!0})}));var c=Ie(),x=u(c),j=u(x);le(j,16,()=>t.selectedTags,a=>a,(a,s)=>{Z(a,{get title(){return s},onClick:()=>I(s),type:"button",style:"selected"})});var q=m(j,2);{var z=a=>{var s=ke(),C=ue(s);le(C,16,()=>e(T),N=>N,(N,B)=>{Z(N,{get title(){return B},onClick:()=>E(B)})}),h(a,s)};U(q,a=>{e(r)!==""&&a(z)})}var O=m(q,2);{var J=a=>{Z(a,{get title(){return e(r)},onClick:()=>{E(e(r)),l(r,"")}})};U(O,a=>{!e(d)&&e(r)!==""&&a(J)})}var K=m(O,2);{var P=a=>{Z(a,{title:"add tag",onClick:()=>v(!0)})};U(K,a=>{v()||a(P)})}var G=m(x,2);{var Q=a=>{var s=De(),C=u(s),N=u(C);de(N,{placeholder:"tag",get ref(){return e(_)},set ref(M){l(_,M,!0)},get value(){return e(r)},set value(M){l(r,M,!0)}});var B=m(C,2);B.__click=[ye,r,E,v],ve("submit",s,p),h(a,s)};U(G,a=>{v()&&a(Q)})}ee(c,a=>l(b,a),()=>e(b)),h(w,c),te()}ae(["click"]);var Ue=(w,t,i,f)=>{l(t,i.url,!0),f(!1)},Ee=(w,t,i,f,_)=>{if(e(t)&&e(i)){l(t,"");return}f.onChangeUrl(e(t)),_(!1)},Le=y('<div class="wrapper svelte-1gjqck4"><!> <div class="containerButtons svelte-1gjqck4"><button class="svelte-1gjqck4">Cancel</button> <button class="svelte-1gjqck4">Done</button></div></div>'),Se=(w,t)=>{t(!0)},je=y('<button class="button svelte-1gjqck4">Edit link</button> <button class="button svelte-1gjqck4">Delete link</button>',1),qe=(w,t)=>{t(!0)},Be=y('<button class="button svelte-1gjqck4">Add link</button>'),Re=y('<div class="wrapperButtons svelte-1gjqck4"><!></div>'),We=y("<div><!></div>");function Me(w,t){$(t,!0);let i=L(t,"shownUrlInput",15),f=g(""),_=g(null),r=g(null),b=g(H(t.url));const S=o=>{l(f,""),l(b,o.target.value||"",!0);try{new URL(e(b))}catch{l(f,"Invalid URL")}};oe(()=>{i()&&e(_)?.focus()});var v=We(),E=u(v);{var I=o=>{var d=Le(),T=u(d);de(T,{get value(){return e(b)},get error(){return e(f)},onInput:S,placeholder:"url",get ref(){return e(_)},set ref(x){l(_,x,!0)}});var p=m(T,2),k=u(p);k.__click=[Ue,b,t,i];var c=m(k,2);c.__click=[Ee,b,f,t,i],h(o,d)},D=o=>{var d=Re(),T=u(d);{var p=c=>{var x=je(),j=ue(x);j.__click=[Se,i];var q=m(j,2);q.__click=function(...z){t.onDeleteUrl?.apply(this,z)},h(c,x)},k=c=>{var x=Be();x.__click=[qe,i],h(c,x)};U(T,c=>{t.url?c(p):c(k,!1)})}h(o,d)};U(E,o=>{i()?o(I):o(D,!1)})}ee(v,o=>l(r,o),()=>e(r)),h(w,v),te()}ae(["click"]);const ze=(w,t,i)=>{e(t)&&(e(t).style.height="auto",e(t).style.height=e(t).scrollHeight+"px"),i()},Ae=(w,t)=>{t()};var Fe=y("<span> </span>"),He=y('<div class="dateInfo svelte-1cn2xww"><!></div>'),Oe=y('<div class="submitButtons svelte-1cn2xww"><!> <!></div>'),Pe=y('<div class="form svelte-1cn2xww"><div class="scrollWrapper"><div class="formFields"><!> <form><input class="inputName svelte-1cn2xww" placeholder="Name"/></form> <textarea placeholder="Note" class="svelte-1cn2xww"></textarea></div></div> <div><!> <div class="formTagsWrapper svelte-1cn2xww"><!></div> <!></div></div>');function Ye(w,t){$(t,!0);const{deleteDraft:i,putDraft:f}=we();let _=L(t,"initialName",3,""),r=L(t,"initialUrl",3,""),b=L(t,"initialText",3,""),S=L(t,"initialTags",19,()=>[]),v=L(t,"noteId",3,""),E=L(t,"mode",3,"add"),I=g(H(t.draft?.name||_())),D=g(H(t.draft?.url||r())),o=g(H(t.draft?.text||b())),d=g(H((t.draft?.tags||S()).filter(n=>n!=="inbox"))),T=g(null),p=g(!1),k=g(!1);const c=()=>{const n={id:v(),name:e(I),url:e(D),text:e(o),tags:e(d).map(R=>R.trim())};f(n)},x=n=>{n.preventDefault(),i(v()),t.onSubmit({name:e(I).trim().slice(0,256)||"unkwown",url:e(D).trim().slice(0,2048),text:e(o).trim().slice(0,2048),tags:e(d).length>0?e(d):["inbox"]})},j=n=>{n.preventDefault(),e(T)&&e(T).focus()},q=n=>{n.key==="Escape"&&(document.activeElement instanceof HTMLInputElement&&document.activeElement.type==="text"||document.activeElement instanceof HTMLTextAreaElement)&&(e(p)&&l(p,!1),e(k)&&l(k,!1),document.activeElement.blur(),n.preventDefault(),n.stopPropagation())};ce(()=>(document.addEventListener("keydown",q),()=>document.removeEventListener("keydown",q)));const z=n=>{l(D,n,!0),c()},O=()=>{l(D,""),c()},J=n=>{l(d,n,!0),c()},K=()=>{i(v()),l(I,_()),l(D,r()),l(o,b()),l(d,S(),!0)};var P=Pe(),G=u(P),Q=u(G),a=u(Q);Me(a,{get url(){return e(D)},onChangeUrl:z,onDeleteUrl:O,get shownUrlInput(){return e(k)},set shownUrlInput(n){l(k,n,!0)}});var s=m(a,2),C=u(s);C.__input=[Ae,c];var N=m(s,2);N.__input=[ze,T,c],ee(N,n=>l(T,n),()=>e(T));var B=m(G,2);Te(B,1,xe(["bottom","bottomSpace"]),"svelte-1cn2xww");var M=u(B);{var fe=n=>{var R=He(),X=u(R);{var V=W=>{var Y=Fe(),A=u(Y);Ce(he=>pe(A,`updated: ${he??""}`),[()=>new Date(t.updatedAt).toLocaleString()]),h(W,Y)};U(X,W=>{t.updatedAt&&W(V)})}h(n,R)};U(M,n=>{E()==="edit"&&n(fe)})}var ne=m(M,2),_e=u(ne);Ne(_e,{get selectedTags(){return e(d)},onChangeTags:J,get shownTagInput(){return e(p)},set shownTagInput(n){l(p,n,!0)}});var ge=m(ne,2);{var me=n=>{var R=Oe(),X=u(R);se(X,{fullWidth:!0,withoutMinWidth:!0,onClick:K,type:"secondary",typeButton:"button",children:(W,Y)=>{var A=ie("cancel");h(W,A)},$$slots:{default:!0}});var V=m(X,2);se(V,{fullWidth:!0,withoutMinWidth:!0,onClick:x,typeButton:"submit",children:(W,Y)=>{var A=ie("save");h(W,A)},$$slots:{default:!0}}),h(n,R)};U(ge,n=>{!e(p)&&!e(k)&&t.draft&&n(me)})}ve("submit",s,j),re(C,()=>e(I),n=>l(I,n)),re(N,()=>e(o),n=>l(o,n)),h(w,P),te()}ae(["input"]);export{Ye as N};
