import{p as K,z as M,g as N,A as Q,d as R,u as U,i as p,e as V,f as _,k as b,c as l,b as t,l as X,s as m,n as f,y as Z,m as D,B as x,w as C,P as tt,j as h,t as st,v as et}from"./index-D3sDlWLV.js";var at=_('<p class="message svelte-uikrak">You need to connect to the cloud account to get an access to a subscription</p> <div class="buttonContainer svelte-uikrak"><!></div>',1),rt=_('<div class="buttonContainer svelte-uikrak"><!></div>'),ot=_('<p class="message svelte-uikrak"> </p>'),it=_('<h3 class="title svelte-uikrak">Subscription</h3> <!>',1),nt=_('<p class="message svelte-uikrak">error signin</p> <div class="buttonContainer svelte-uikrak"><div class="buttonContainerItem"><!></div></div>',1),ct=_('<p class="message svelte-uikrak">Subscription updated successfully</p> <div class="buttonContainer svelte-uikrak"><div class="buttonContainerItem"><!></div></div>',1),lt=_('<div class="content svelte-uikrak"><!></div>');function ut(I,j){K(j,!0);const{addSearchParam:B,closeDialogStack:G}=M(),{pushStackPages:W}=N(),{getAccount:Y,updateSubscription:z}=Q();let o=V("idle"),S=Z(Y);const{blockDialog:F}=R(),H=()=>{B("retPath","subscription"),W(tt.Auth)},L=()=>{G()},y=async()=>{h(o,"loading");try{const i=await fetch("/api/getSubscription",{method:"POST"});if(i.status!==200){h(o,"error");return}const c=await i.json();if(!c.subscriptionExpires){h(o,"error");return}const g=c.subscriptionExpires;z(g),h(o,"success")}catch{h(o,"error")}};U(()=>{F(p(o)==="loading")});var w=lt(),O=l(w);{var T=i=>{var c=it(),g=m(f(c),2);{var P=s=>{var a=at(),v=m(f(a),2),u=l(v);x(u,{onClick:H,children:(n,e)=>{var r=C("Connect");t(n,r)},$$slots:{default:!0}}),t(s,a)},$=s=>{var a=D(),v=f(a);{var u=e=>{var r=rt(),d=l(r);x(d,{onClick:y,children:(k,A)=>{var E=C("Get subscription");t(k,E)},$$slots:{default:!0}}),t(e,r)},n=e=>{var r=ot(),d=l(r);st(k=>et(d,`Your subscription is active until ${k??""}`),[()=>new Date(p(S).subscriptionExpires).toLocaleDateString()]),t(e,r)};b(v,e=>{p(S).subscriptionExpires<Date.now()?e(u):e(n,!1)},!0)}t(s,a)};b(g,s=>{p(S)?s($,!1):s(P)})}t(i,c)},q=i=>{var c=D(),g=f(c);{var P=s=>{var a=nt(),v=m(f(a),2),u=l(v),n=l(u);x(n,{onClick:y,fullWidth:!0,children:(e,r)=>{var d=C("try again");t(e,d)},$$slots:{default:!0}}),t(s,a)},$=s=>{var a=D(),v=f(a);{var u=n=>{var e=ct(),r=m(f(e),2),d=l(r),k=l(d);x(k,{onClick:L,fullWidth:!0,children:(A,E)=>{var J=C("Close");t(A,J)},$$slots:{default:!0}}),t(n,e)};b(v,n=>{p(o)==="success"&&n(u)},!0)}t(s,a)};b(g,s=>{p(o)==="error"?s(P):s($,!1)},!0)}t(i,c)};b(O,i=>{p(o)==="idle"?i(T):i(q,!1)})}t(I,w),X()}export{ut as default};
