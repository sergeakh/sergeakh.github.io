import{p as Q,Z as ne,o as Z,e as J,a9 as oe,u as R,af as ie,ag as P,a as e,b as W,Q as X,f as ae,j as B,i as V,c as z,m as U,n as q,h as G,q as se,r as re,v as le,a8 as j,d as K,ah as ce,ac as de,l as ue,aa as me,ad as fe}from"./index-CKRZdUcv.js";function he(Y,t){Q(t,!0);let s=ne(t,"dialog",7);const r=3,y=50,c=5,p=.6,b=.3,k=.35,L=.95;let w=0,T=0,v=0,M=!1,h=!1,u=0,m=0,E=0;const _=()=>{w=0,T=0,M=!1,h=!1,u=0,m=0,E=0,v=0,d!==null&&(cancelAnimationFrame(d),d=null),S=null};let d=null,S=null;const C=i=>{if(!s()){console.warn("Touch start: No dialog element");return}if(t.sidebarState!=="opened"&&t.sidebarState!=="closed"){console.warn(`Touch start: Invalid sidebar state: ${t.sidebarState}`);return}w=i.touches[0].clientX,T=i.touches[0].clientY,v=performance.now(),M=!0,h=!1},A=i=>t.sidebarState==="closed"&&i>0||t.sidebarState==="closeSwiping"&&i>0||t.sidebarState==="opened"&&i<0||t.sidebarState==="openSwiping"&&i<0,n=i=>{if(s()){if(s().style.setProperty("--transition-timing","0s"),!s().open&&t.sidebarState==="closed")try{s().showModal(),s().offsetWidth}catch(o){console.error("Error opening dialog:",o);return}t.onSwipe();try{const o=window.getComputedStyle(s()),a=o.transform||o.webkitTransform||"";if(m=s().offsetWidth,t.sidebarState==="closeSwiping"||t.sidebarState==="closed"?u=-m:(t.sidebarState==="openSwiping"||t.sidebarState==="opened")&&(u=0),a&&a!=="none")try{u=new DOMMatrix(a).m41}catch{console.warn("Could not parse transform matrix, using default position")}h=!0}catch(o){console.error("Error during swipe initialization:",o),_()}}},f=()=>{if(!s())return;const i=-(m*.27),o=-m;let a=0;const l=window.getComputedStyle(s()),x=l.transform||l.webkitTransform||"";if(x&&x!=="none")try{a=new DOMMatrix(x).m41}catch{a=0}const H=.25*Math.min(1,Math.max(0,(a-o)/(i-o)));s().style.setProperty("--backdrop-bg",`rgba(0, 0, 0, ${H})`)},N=()=>{if(d=null,!S||!M||!s()||oe())return;const{x:i,y:o}=S;S=null;const a=i-w,l=o-T,x=Math.abs(a)>Math.abs(l),D=Math.abs(a)>r;if(!h)if(x&&D&&A(a))try{n(a)}catch(te){console.error("Error initializing swipe:",te),_();return}else return;if(!A(a))return;s().style.setProperty("--transition-timing","0s");let g=u+a*L;const H=-m,O=-(m*.27);g=Math.max(H,Math.min(O,g)),s().style.transform=`translate3d(${g}px, 0, 0)`,E=(g-u)/m*100,f()},F=i=>{if(!M)return;const o=i.touches[0].clientX,a=i.touches[0].clientY;S={x:o,y:a},d===null&&(d=requestAnimationFrame(N)),h&&Math.abs(o-w)>Math.abs(a-T)&&i.preventDefault()},$=i=>{const o=Math.abs(i);if(o>=p)return c;if(o>=b){const a=(o-b)/(p-b);return y-a*(y-c)}else return y},ee=(i,o)=>{if(Math.abs(i)>=p)return k*.5;const l=Math.abs(E)/100;return o?k*Math.max(.5,1-l):k*Math.max(.5,l)},I=i=>{if(d!==null&&(cancelAnimationFrame(d),d=null),S=null,!M||!s()){_();return}if(!h){_();return}let o=0;if(i?.changedTouches?.[0]){const g=i.changedTouches[0].clientX,O=performance.now()-v;O>0&&(o=(g-w)/O)}const a=$(o);let l=null;t.sidebarState==="closeSwiping"?l=Math.abs(E)>a||o>b?"open":"close":t.sidebarState==="openSwiping"&&(l=Math.abs(E)>a||o<-b?"close":"open");const x=t.sidebarState==="closeSwiping"&&l==="open"||t.sidebarState==="openSwiping"&&l==="close",D=ee(o,x);s().style.setProperty("--transition-timing",`${D}s`),s().offsetWidth,s().style.transform="",l==="open"?t.onOpen():l==="close"&&t.onClose(),s()?.style.removeProperty("--backdrop-bg"),_()};Z(()=>(document.addEventListener("touchstart",C,{passive:!0}),document.addEventListener("touchmove",F,{passive:!1}),document.addEventListener("touchend",I,{passive:!0}),document.addEventListener("touchcancel",I,{passive:!0}),()=>{document.removeEventListener("touchstart",C),document.removeEventListener("touchmove",F),document.removeEventListener("touchend",I),document.removeEventListener("touchcancel",I),d!==null&&cancelAnimationFrame(d)})),J()}var ge=ae('<dialog><div class="dialogInner svelte-1vgewgb"><!></div></dialog> <!> <!>',1);function be(Y,t){Q(t,!0);let s=350,r=W(null),y=W(null),c=X(ce);R(()=>{ie().length>0&&P({type:"close"})});const p=()=>{t.blocked||P({type:"close"})},b=()=>{t.blocked||P({type:"open"})},k=()=>{P({type:"opened"})},L=()=>{P({type:"closed"})},w=()=>{P({type:"swipe"})},T=n=>{n.preventDefault(),p()};Z(()=>(e(r)?.addEventListener("close",L),e(r)?.addEventListener("cancel",T),()=>{e(r)?.removeEventListener("close",L),e(r)?.removeEventListener("cancel",T)}));const v=()=>{e(r)?.style.removeProperty("--transition-timing"),e(r)?.style.removeProperty("transform"),e(r)?.style.removeProperty("--backdrop-bg")},M=X(de);R(()=>{if(e(c),!!e(r))switch(e(c).type){case"closeSwiping":{const n=setTimeout(()=>{p()},3e3);return()=>{clearTimeout(n)}}case"openSwiping":{const n=setTimeout(()=>{b()},3e3);return()=>{clearTimeout(n)}}case"opening":{e(r).open||e(r).showModal(),e(r).getBoundingClientRect();const n=setTimeout(()=>{v()},s+1),f=()=>{clearTimeout(n),v()};return e(r)?.addEventListener("transitionend",f,{once:!0}),k(),()=>{e(r)?.removeEventListener("transitionend",f)}}case"closing":{const n=setTimeout(()=>{e(c).type==="closing"&&L()},s+1),f=()=>{clearTimeout(n),L()};return e(r)?.addEventListener("transitionend",f,{once:!0}),()=>{e(r)?.removeEventListener("transitionend",f)}}case"closed":e(r)?.close(),v();break;case"opened":v();break}});var h=ge(),u=B(h),m=z(u),E=z(m);{var _=n=>{var f=ue(),N=B(f);me(N,()=>t.children),K(n,f)};V(E,n=>{e(c).type!=="closed"&&n(_)})}U(m,n=>q(y,n),()=>e(y)),U(u,n=>q(r,n),()=>e(r));var d=G(u,2);{var S=n=>{fe(n,{get dialog(){return e(r)},get dialogInner(){return e(y)},onClose:p})};V(d,n=>{e(c).type==="opened"&&!t.blocked&&n(S)})}var C=G(d,2);{var A=n=>{he(n,{onClose:p,onOpen:b,onSwipe:w,get sidebarState(){return e(c).type},get dialog(){return e(r)}})};V(C,n=>{(!e(M)&&e(c).type==="closed"||e(c).type==="opened"||e(c).type==="openSwiping"||e(c).type==="closeSwiping")&&!t.blocked&&n(A)})}se(()=>re(u,1,le([{open:e(c).type==="opened",hidden:t.blocked,isAnimationOn:j.working&&(!j.isSwiping||!t.blocked)}]),"svelte-1vgewgb")),K(Y,h),J()}export{be as default};
