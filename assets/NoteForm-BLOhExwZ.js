import{p as K,X as S,u as oe,h as e,d as _,i as r,o as ce,f as I,q as ae,a8 as Y,c,s as g,j as E,x as Z,a5 as Q,b as m,k as V,l as be,m as ue,H as ve,a9 as ne,a2 as ke,n as $,e as M,Y as we,Z as Te,aa as le,ab as xe,B as re,v as se,ac as ie,t as Ce,r as pe}from"./index-BJjYAf-G.js";import{I as de}from"./Input-BbqesVd4.js";var Ie=(w,t,s,n)=>{e(t)!==""&&s(e(t)),n(!1),r(t,"")},ye=I('<form class="formNewTag svelte-or2lfi"><div class="inputWrapper svelte-or2lfi"><!></div> <button class="buttonDone svelte-or2lfi">Done</button></form>'),De=I('<div class="block"><div class="tags svelte-or2lfi"><!> <!> <!> <!></div> <!></div>');function Ue(w,t){K(t,!0);let s=_(null),n=_(""),h=_(null),u=S(t,"shownTagInput",15);const v=a=>{t.selectedTags.includes(a)||(r(n,""),t.onChangeTags([...t.selectedTags,a]),e(s)?.focus())},W=a=>{const i=t.selectedTags.filter(k=>k!==a);i.length===0?t.onChangeTags([]):t.onChangeTags(i)};let C=Z(()=>ne()?[...(ke()()||[]).reduce((a,i)=>(i?.tags.forEach(k=>{a.has(k)||a.add(k)}),a),new Set)]:[]),p=Z(()=>ne()?e(C).filter(a=>!t.selectedTags.some(i=>a===i)&&a!=="inbox"):[]),y=Z(()=>e(p).find(a=>a.toLowerCase()===e(n).toLowerCase())||t.selectedTags.includes(e(n))),D=Z(()=>e(p).filter(a=>e(n)===""?!0:a.toLowerCase().indexOf(e(n).toLowerCase())===0).slice(0,e(y)||e(n)===""?3:2));const o=a=>{a.preventDefault(),e(n)!==""?(v(e(n)),r(n,"")):u(!1)};oe(()=>{e(s)&&u()&&e(s).focus(),u()||r(n,"")});const d=a=>{a.target&&e(h)&&!e(h).contains(a.target)&&(u(!1),r(n,""))};ce(()=>(document.addEventListener("click",d,{capture:!0}),()=>{document.removeEventListener("click",d,{capture:!0})}));var f=De(),T=c(f),U=c(T);ae(U,16,()=>t.selectedTags,a=>a,(a,i)=>{Y(a,{get title(){return i},onClick:()=>W(i),type:"button",style:"selected"})});var b=g(U,2);{var x=a=>{var i=be(),k=ue(i);ae(k,16,()=>e(D),N=>N,(N,L)=>{Y(N,{get title(){return L},onClick:()=>v(L)})}),m(a,i)};E(b,a=>{e(n)!==""&&a(x)})}var j=g(b,2);{var A=a=>{Y(a,{get title(){return e(n)},onClick:()=>{v(e(n)),r(n,"")}})};E(j,a=>{!e(y)&&e(n)!==""&&a(A)})}var F=g(j,2);{var z=a=>{Y(a,{title:"add tag",onClick:()=>u(!0)})};E(F,a=>{u()||a(z)})}var P=g(T,2);{var O=a=>{var i=ye(),k=c(i),N=c(k);de(N,{placeholder:"tag",get ref(){return e(s)},set ref(R){r(s,R,!0)},get value(){return e(n)},set value(R){r(n,R,!0)}});var L=g(k,2);L.__click=[Ie,n,v,u],ve("submit",i,o),m(a,i)};E(P,a=>{u()&&a(O)})}Q(f,a=>r(h,a),()=>e(h)),m(w,f),V()}$(["click"]);var Ee=(w,t,s,n)=>{r(t,s.url,!0),n(!1)},Ne=(w,t,s,n,h)=>{if(e(t)&&e(s)){r(t,"");return}n.onChangeUrl(e(t)),h(!1)},Le=I('<div class="wrapper svelte-1gjqck4"><!> <div class="containerButtons svelte-1gjqck4"><button class="svelte-1gjqck4">Cancel</button> <button class="svelte-1gjqck4">Done</button></div></div>'),Se=(w,t)=>{t(!0)},je=I('<button class="button svelte-1gjqck4">Edit link</button> <button class="button svelte-1gjqck4">Delete link</button>',1),qe=(w,t)=>{t(!0)},Be=I('<button class="button svelte-1gjqck4">Add link</button>'),Re=I('<div class="wrapperButtons svelte-1gjqck4"><!></div>'),We=I("<div><!></div>");function Ae(w,t){K(t,!0);let s=S(t,"shownUrlInput",15),n=_(""),h=_(null),u=_(null),v=_(M(t.url));const W=o=>{r(n,""),r(v,o.target.value||"",!0);try{new URL(e(v))}catch{r(n,"Invalid URL")}};oe(()=>{s()&&e(h)?.focus()});var C=We(),p=c(C);{var y=o=>{var d=Le(),f=c(d);de(f,{get value(){return e(v)},get error(){return e(n)},onInput:W,placeholder:"url",get ref(){return e(h)},set ref(x){r(h,x,!0)}});var T=g(f,2),U=c(T);U.__click=[Ee,v,t,s];var b=g(U,2);b.__click=[Ne,v,n,t,s],m(o,d)},D=o=>{var d=Re(),f=c(d);{var T=b=>{var x=je(),j=ue(x);j.__click=[Se,s];var A=g(j,2);A.__click=function(...F){t.onDeleteUrl?.apply(this,F)},m(b,x)},U=b=>{var x=Be();x.__click=[qe,s],m(b,x)};E(f,b=>{t.url?b(T):b(U,!1)})}m(o,d)};E(p,o=>{s()?o(y):o(D,!1)})}Q(C,o=>r(u,o),()=>e(u)),m(w,C),V()}$(["click"]);const Fe=(w,t,s)=>{e(t)&&(e(t).style.height="auto",e(t).style.height=e(t).scrollHeight+"px"),s()},He=(w,t)=>{t()};var Me=I("<span> </span>"),Pe=I('<div class="dateInfo svelte-1cn2xww"><!></div>'),Oe=I('<div class="submitButtons svelte-1cn2xww"><!> <!></div>'),Ge=I('<div class="form svelte-1cn2xww"><div class="scrollWrapper"><div class="formFields"><!> <form><input class="inputName svelte-1cn2xww" placeholder="Name"/></form> <textarea placeholder="Note" class="svelte-1cn2xww"></textarea></div></div> <div><!> <div class="formTagsWrapper svelte-1cn2xww"><!></div> <!></div></div>');function Ze(w,t){K(t,!0);let s=S(t,"initialName",3,""),n=S(t,"initialUrl",3,""),h=S(t,"initialText",3,""),u=S(t,"initialTags",19,()=>[]),v=S(t,"noteId",3,""),W=S(t,"mode",3,"add"),C=_(M(t.draft?.name||s())),p=_(M(t.draft?.url||n())),y=_(M(t.draft?.text||h())),D=_(M((t.draft?.tags||u()).filter(l=>l!=="inbox"))),o=_(null),d=_(!1),f=_(!1);const T=()=>{const l={id:v(),name:e(C),url:e(p),text:e(y),tags:e(D).map(q=>q.trim())};xe(l)},U=l=>{l.preventDefault(),ie(v()),t.onSubmit({name:e(C).trim().slice(0,256)||"unkwown",url:e(p).trim().slice(0,2048),text:e(y).trim().slice(0,2048),tags:e(D).length>0?e(D):["inbox"]})},b=l=>{l.preventDefault(),e(o)&&e(o).focus()},x=l=>{l.key==="Escape"&&(document.activeElement instanceof HTMLInputElement&&document.activeElement.type==="text"||document.activeElement instanceof HTMLTextAreaElement)&&(e(d)&&r(d,!1),e(f)&&r(f,!1),document.activeElement.blur(),l.preventDefault(),l.stopPropagation())};ce(()=>(document.addEventListener("keydown",x),()=>document.removeEventListener("keydown",x)));const j=l=>{r(p,l,!0),T()},A=()=>{r(p,""),T()},F=l=>{r(D,l,!0),T()},z=()=>{ie(v()),r(C,s()),r(p,n()),r(y,h()),r(D,u(),!0)};var P=Ge(),O=c(P),a=c(O),i=c(a);Ae(i,{get url(){return e(p)},onChangeUrl:j,onDeleteUrl:A,get shownUrlInput(){return e(f)},set shownUrlInput(l){r(f,l,!0)}});var k=g(i,2),N=c(k);N.__input=[He,T];var L=g(k,2);L.__input=[Fe,o,T],Q(L,l=>r(o,l),()=>e(o));var R=g(O,2);we(R,1,Te(["bottom","bottomSpace"]),"svelte-1cn2xww");var ee=c(R);{var fe=l=>{var q=Pe(),G=c(q);{var J=B=>{var X=Me(),H=c(X);Ce(he=>pe(H,`updated: ${he??""}`),[()=>new Date(t.updatedAt).toLocaleString()]),m(B,X)};E(G,B=>{t.updatedAt&&B(J)})}m(l,q)};E(ee,l=>{W()==="edit"&&l(fe)})}var te=g(ee,2),_e=c(te);Ue(_e,{get selectedTags(){return e(D)},onChangeTags:F,get shownTagInput(){return e(d)},set shownTagInput(l){r(d,l,!0)}});var ge=g(te,2);{var me=l=>{var q=Oe(),G=c(q);re(G,{fullWidth:!0,onClick:z,type:"secondary",typeButton:"button",children:(B,X)=>{var H=se("cancel");m(B,H)},$$slots:{default:!0}});var J=g(G,2);re(J,{fullWidth:!0,onClick:U,typeButton:"submit",children:(B,X)=>{var H=se("save");m(B,H)},$$slots:{default:!0}}),m(l,q)};E(ge,l=>{!e(d)&&!e(f)&&t.draft&&l(me)})}ve("submit",k,b),le(N,()=>e(C),l=>r(C,l)),le(L,()=>e(y),l=>r(y,l)),m(w,P),V()}$(["input"]);export{Ze as N};
