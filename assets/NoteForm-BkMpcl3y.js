import{p as Q,W as I,u as V,h as e,d as g,i as s,o as le,f as y,q as ee,a7 as P,c,s as p,j,x as G,a4 as se,b as f,k as Z,l as ie,m as K,H as oe,a8 as te,a1 as fe,n as $,e as X,X as _e,Y as me,a9 as ae,B as ge,v as pe,t as re,r as ne}from"./index-B-1UdW6w.js";import{I as ue}from"./Input-BGk0A763.js";var be=(k,n,i)=>{n(!1),s(i,"")},he=y('<form class="formNewTag svelte-17ucbme"><!> <button type="button" class="buttonDone svelte-17ucbme">Done</button></form>'),ke=y('<div class="block"><div class="tags svelte-17ucbme"><!> <!> <!> <!></div> <!></div>');function Te(k,n){Q(n,!0);let i=g(null),r=g(""),b=g(null),u=I(n,"selectedTags",15),_=I(n,"shownTagInput",15);const T=t=>{u().includes(t)||(s(r,""),u([...u(),t]),e(i)?.focus())},N=t=>{const o=u().filter(m=>m!==t);o.length===0?u([]):u(o)};let U=G(()=>te()?[...(fe()()||[]).reduce((t,o)=>(o?.tags.forEach(m=>{t.has(m)||t.add(m)}),t),new Set)]:[]),E=G(()=>te()?e(U).filter(t=>!u().some(o=>t===o)&&t!=="inbox"):[]),l=G(()=>e(E).find(t=>t.toLowerCase()===e(r).toLowerCase())||u().includes(e(r))),v=G(()=>e(E).filter(t=>e(r)===""?!0:t.toLowerCase().indexOf(e(r).toLowerCase())===0).slice(0,e(l)||e(r)===""?3:2));const x=t=>{t.preventDefault(),e(r)!==""&&(T(e(r)),s(r,""))};V(()=>{e(i)&&_()&&e(i).focus(),_()||s(r,"")});const C=t=>{t.target&&e(b)&&!e(b).contains(t.target)&&(_(!1),s(r,""))};le(()=>(document.addEventListener("click",C,{capture:!0}),()=>{document.removeEventListener("click",C,{capture:!0})}));var w=ke(),d=c(w),h=c(d);ee(h,16,u,t=>t,(t,o)=>{P(t,{get title(){return o},onClick:()=>N(o),type:"button",style:"selected"})});var L=p(h,2);{var q=t=>{var o=ie(),m=K(o);ee(m,16,()=>e(v),S=>S,(S,D)=>{P(S,{get title(){return D},onClick:()=>T(D)})}),f(t,o)};j(L,t=>{e(r)!==""&&t(q)})}var H=p(L,2);{var W=t=>{P(t,{get title(){return e(r)},onClick:()=>{T(e(r)),s(r,"")}})};j(H,t=>{!e(l)&&e(r)!==""&&t(W)})}var B=p(H,2);{var Y=t=>{P(t,{title:"add tag",onClick:()=>_(!0)})};j(B,t=>{_()||t(Y)})}var R=p(d,2);{var M=t=>{var o=he(),m=c(o);ue(m,{placeholder:"tag",get ref(){return e(i)},set ref(D){s(i,D,!0)},get value(){return e(r)},set value(D){s(r,D,!0)}});var S=p(m,2);S.__click=[be,_,r],oe("submit",o,x),f(t,o)};j(R,t=>{_()&&t(M)})}se(w,t=>s(b,t),()=>e(b)),f(k,w),Z()}$(["click"]);var xe=(k,n,i,r)=>{if(n()&&e(i)){n("");return}r(!1)},we=y('<div class="wrapper svelte-1gjqck4"><!> <div class="containerButtons svelte-1gjqck4"><button class="svelte-1gjqck4">Done</button></div></div>'),ye=(k,n)=>{n(!0)},Ee=(k,n)=>{n("")},Ie=y('<button class="button svelte-1gjqck4">Edit link</button> <button class="button svelte-1gjqck4">Delete link</button>',1),je=(k,n)=>{n(!0)},Ce=y('<button class="button svelte-1gjqck4">Add link</button>'),Le=y('<div class="wrapperButtons svelte-1gjqck4"><!></div>');function De(k,n){Q(n,!0);let i=I(n,"url",15),r=I(n,"shownUrlInput",15),b=g(""),u=g(null);const _=l=>{s(b,""),i(l.target.value||"");try{new URL(i())}catch{s(b,"Invalid URL")}};V(()=>{r()&&setTimeout(()=>{e(u)?.focus()},0)});var T=ie(),N=K(T);{var U=l=>{var v=we(),x=c(v);ue(x,{get value(){return i()},get error(){return e(b)},onInput:_,placeholder:"url",get ref(){return e(u)},set ref(d){s(u,d,!0)}});var C=p(x,2),w=c(C);w.__click=[xe,i,b,r],f(l,v)},E=l=>{var v=Le(),x=c(v);{var C=d=>{var h=Ie(),L=K(h);L.__click=[ye,r];var q=p(L,2);q.__click=[Ee,i],f(d,h)},w=d=>{var h=Ce();h.__click=[je,r],f(d,h)};j(x,d=>{i()?d(C):d(w,!1)})}f(l,v)};j(N,l=>{r()?l(U):l(E,!1)})}f(k,T),Z()}$(["click"]);var Ne=y("<span> </span>"),Ue=y('<div class="dateInfo svelte-sym2jx"><!></div>'),Se=y('<div class="submitButton svelte-sym2jx"><!></div>'),qe=y('<div class="form svelte-sym2jx"><div class="scrollWrapper"><div class="formFields"><!> <form><input class="inputName svelte-sym2jx" placeholder="Name"/></form> <textarea placeholder="Note" class="svelte-sym2jx"></textarea></div></div> <div><!> <div class="formTagsWrapper svelte-sym2jx"><!></div> <!></div></div>');function Ae(k,n){Q(n,!0);let i=I(n,"initialTitle",3,""),r=I(n,"initialUrl",3,""),b=I(n,"initialDescription",3,""),u=I(n,"initialTags",19,()=>[]),_=I(n,"mode",3,"add"),T=g(X(i())),N=g(X(r())),U=g(X(b())),E=g(X(u().filter(a=>a!=="inbox"))),l=g(null),v=g(!1),x=g(!1);const C=a=>{a.preventDefault(),n.onSubmit({title:e(T).trim().slice(0,256)||"unkwown",url:e(N).trim().slice(0,2048),description:e(U).trim().slice(0,2048),tags:e(E).length>0?e(E):["inbox"]})},w=()=>{e(l)&&(e(l).style.height="auto",e(l).style.height=e(l).scrollHeight+"px")};V(()=>{e(l),w()});const d=a=>{a.preventDefault(),e(l)&&e(l).focus()},h=a=>{a.key==="Escape"&&(document.activeElement instanceof HTMLInputElement&&document.activeElement.type==="text"||document.activeElement instanceof HTMLTextAreaElement)&&(e(v)&&s(v,!1),document.activeElement.blur(),a.preventDefault(),a.stopPropagation())};le(()=>(document.addEventListener("keydown",h),()=>document.removeEventListener("keydown",h)));var L=qe(),q=c(L),H=c(q),W=c(H);De(W,{get shownUrlInput(){return e(x)},set shownUrlInput(a){s(x,a,!0)},get url(){return e(N)},set url(a){s(N,a,!0)}});var B=p(W,2),Y=c(B),R=p(B,2);R.__input=w,se(R,a=>s(l,a),()=>e(l));var M=p(q,2);_e(M,1,me(["bottom","bottomSpace"]),"svelte-sym2jx");var t=c(M);{var o=a=>{var A=Ue(),z=c(A);{var J=O=>{var F=Ne(),ve=c(F);re(de=>ne(ve,`updated: ${de??""}`),[()=>new Date(n.updatedAt).toLocaleString()]),f(O,F)};j(z,O=>{n.updatedAt&&O(J)})}f(a,A)};j(t,a=>{_()==="edit"&&a(o)})}var m=p(t,2),S=c(m);Te(S,{get shownTagInput(){return e(v)},set shownTagInput(a){s(v,a,!0)},get selectedTags(){return e(E)},set selectedTags(a){s(E,a,!0)}});var D=p(m,2);{var ce=a=>{var A=Se(),z=c(A);ge(z,{fullWidth:!0,onClick:C,typeButton:"submit",children:(J,O)=>{var F=pe();re(()=>ne(F,_()==="add"?"add":"edit")),f(J,F)},$$slots:{default:!0}}),f(a,A)};j(D,a=>{!e(v)&&!e(x)&&a(ce)})}oe("submit",B,d),ae(Y,()=>e(T),a=>s(T,a)),ae(R,()=>e(U),a=>s(U,a)),f(k,L),Z()}$(["input"]);export{Ae as N};
