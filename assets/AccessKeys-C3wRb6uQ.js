import{p as ne,g as ie,d as z,e as ve,u as J,h as e,o as de,i,f as l,j as v,c as n,b as t,k as ge,L as M,l as O,m,n as fe,s as d,q as _e,a as pe,I as U,t as ye,r as ue,V as me,v as B,B as Y,w as G,x as he,P as Q,y as Ae}from"./index-OATHxcgi.js";import{g as Ke,a as ke}from"./webauthn-CIYiTW38.js";var Ce=l('<p class="message svelte-1aog49v">Loading access keys</p>'),be=l('<p class="message svelte-1aog49v">Confirming</p>'),we=(F,h,A)=>h(e(A).id),xe=l('<button class="buttonDelete svelte-1aog49v"><!> <!></button>'),Pe=l('<li class="svelte-1aog49v"><div class="keyInfo svelte-1aog49v"><div><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper></div> <div class="keyName svelte-1aog49v"> </div></div> <div class="keyActions svelte-1aog49v"><!></div></li>'),De=l('<p class="message error svelte-1aog49v">Error deleting access key</p>'),$e=l('<div class="buttonContainer svelte-1aog49v"><!></div>'),Se=l('<p class="message svelte-1aog49v">You have reached the maximum number of access keys.</p>'),Te=l('<p class="message svelte-1aog49v">Access Keys</p> <ul class="svelte-1aog49v"></ul> <!> <!>',1),je=l('<p class="message error svelte-1aog49v">Something went wrong</p> <div class="buttonContainer svelte-1aog49v"><!></div>',1),Ee=l('<div class="content svelte-1aog49v"><!></div>');function Be(F,h){ne(h,!0);const{blockDialog:A}=ie();let s=z("loadingAccessKeys"),K=z(ve([]));J(()=>{A(e(s)==="loadingAccessKeys"||e(s)==="confirmingDeleteAccessKey")}),de(()=>()=>{A(!1)}),J(()=>{if(!h.hidden&&e(s)==="successAccessKeys"||e(s)==="loadingAccessKeys"){const r=new AbortController;return(async()=>{try{const o=await fetch("/api/credentials",{method:"POST",signal:r.signal});if(!o.ok)throw new Error("Failed to fetch access keys");const g=await o.json();i(K,g.credentials||[],!0),i(s,"successAccessKeys")}catch{i(s,"errorAccessKeys")}})(),()=>{r.abort()}}});const R=async r=>{i(s,"confirmingDeleteAccessKey");try{const o=await Ke(),g=await ke({challenge:o});if(!(await fetch("/api/deleteCredential",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({challenge:o,id:r,confirmCredential:g.credentialData})})).ok)throw new Error("Failed to add access key");i(s,"loadingAccessKeys")}catch{i(s,"errorDeleteAccessKey");return}};var H=Ee(),W=n(H);{var X=r=>{M(r,{children:(o,g)=>{var k=Ce();t(o,k)},$$slots:{default:!0}})},Z=r=>{var o=O(),g=m(o);{var k=f=>{M(f,{children:(C,N)=>{var S=be();t(C,S)},$$slots:{default:!0}})},ee=f=>{var C=O(),N=m(C);{var S=_=>{var y=Te(),b=d(m(y),2);_e(b,21,()=>e(K),a=>a.id,(a,c)=>{var p=Pe(),P=n(p),D=n(P),$=n(D);pe($,()=>({"--size":"20px"})),U($.lastChild,{name:"key"});var V=d(D,2),E=n(V),ae=d(P,2),te=n(ae);{var re=I=>{var L=xe();L.__click=[we,R,c];var q=n(L);U(q,{name:"close"});var oe=d(q,2);me(oe,{children:(ce,Ie)=>{var le=B("delete access key");t(ce,le)}}),t(I,L)};v(te,I=>{e(K).length>1&&I(re)})}ye(()=>ue(E,e(c).name)),t(a,p)});var w=d(b,2);{var u=a=>{var c=De();t(a,c)};v(w,a=>{e(s)==="errorDeleteAccessKey"&&a(u)})}var x=d(w,2);{var T=a=>{var c=$e(),p=n(c);{let P=G(()=>Ae(Q.ConfirmAccessKey)),D=G(()=>he(Q.ConfirmAccessKey));Y(p,{element:"a",get href(){return e(P)},get onClick(){return e(D)},children:($,V)=>{var E=B("Add access key");t($,E)},$$slots:{default:!0}})}t(a,c)},j=a=>{var c=Se();t(a,c)};v(x,a=>{e(K).length<5?a(T):a(j,!1)})}t(_,y)},se=_=>{var y=O(),b=m(y);{var w=u=>{var x=je(),T=d(m(x),2),j=n(T);Y(j,{onClick:()=>{i(s,"loadingAccessKeys")},children:(a,c)=>{var p=B("Try Again");t(a,p)},$$slots:{default:!0}}),t(u,x)};v(b,u=>{e(s)==="errorAccessKeys"&&u(w)},!0)}t(_,y)};v(N,_=>{e(s)==="successAccessKeys"||e(s)==="errorDeleteAccessKey"?_(S):_(se,!1)},!0)}t(f,C)};v(g,f=>{e(s)==="confirmingDeleteAccessKey"?f(k):f(ee,!1)},!0)}t(r,o)};v(W,r=>{e(s)==="loadingAccessKeys"?r(X):r(Z,!1)})}t(F,H),ge()}fe(["click"]);export{Be as default};
