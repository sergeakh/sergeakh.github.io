import{p as ve,g as de,d as ge,e as J,h as fe,u as M,i as e,o as _e,j as i,f as l,k as v,c as n,b as t,l as pe,L as U,m as O,n as m,q as ye,s as d,r as ue,a as me,I as Y,t as he,v as Ae,V as Ke,w as B,x as ke,B as G,y as Q,P as R}from"./index-CZzB_zyz.js";import{g as Ce}from"./api-C5JaEwh0.js";var be=l('<p class="message svelte-1aog49v">Loading access keys</p>'),we=l('<p class="message svelte-1aog49v">Confirming</p>'),xe=(F,h,$)=>h(e($).id),Pe=l('<button class="buttonDelete svelte-1aog49v"><!> <!></button>'),De=l('<li class="svelte-1aog49v"><div class="keyInfo svelte-1aog49v"><div><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper></div> <div class="keyName svelte-1aog49v"> </div></div> <div class="keyActions svelte-1aog49v"><!></div></li>'),$e=l('<p class="message error svelte-1aog49v">Error deleting access key</p>'),Se=l('<div class="buttonContainer svelte-1aog49v"><!></div>'),Te=l('<p class="message svelte-1aog49v">You have reached the maximum number of access keys.</p>'),je=l('<p class="message svelte-1aog49v">Access Keys</p> <ul class="svelte-1aog49v"></ul> <!> <!>',1),Ee=l('<p class="message error svelte-1aog49v">Something went wrong</p> <div class="buttonContainer svelte-1aog49v"><!></div>',1),Ie=l('<div class="content svelte-1aog49v"><!></div>');function Fe(F,h){ve(h,!0);const{createHandlePage:$,getPageUrl:W}=de(),{blockDialog:H}=ge();let s=J("loadingAccessKeys"),A=J(fe([]));M(()=>{H(e(s)==="loadingAccessKeys"||e(s)==="confirmingDeleteAccessKey")}),_e(()=>()=>{H(!1)}),M(()=>{if(!h.hidden&&e(s)==="successAccessKeys"||e(s)==="loadingAccessKeys"){const r=new AbortController;return(async()=>{try{const o=await fetch("/api/credentials",{method:"POST",signal:r.signal});if(!o.ok)throw new Error("Failed to fetch access keys");const g=await o.json();i(A,g.credentials||[],!0),i(s,"successAccessKeys")}catch{i(s,"errorAccessKeys")}})(),()=>{r.abort()}}});const X=async r=>{i(s,"confirmingDeleteAccessKey");try{const o=await Ce(),g=await ke({challenge:o});if(!(await fetch("/api/deleteCredential",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({challenge:o,id:r,confirmCredential:g.credentialData})})).ok)throw new Error("Failed to add access key");i(s,"loadingAccessKeys")}catch{i(s,"errorDeleteAccessKey");return}};var N=Ie(),Z=n(N);{var ee=r=>{U(r,{children:(o,g)=>{var K=be();t(o,K)},$$slots:{default:!0}})},se=r=>{var o=O(),g=m(o);{var K=f=>{U(f,{children:(k,V)=>{var S=we();t(k,S)},$$slots:{default:!0}})},ae=f=>{var k=O(),V=m(k);{var S=_=>{var y=je(),C=d(m(y),2);ue(C,21,()=>e(A),a=>a.id,(a,c)=>{var p=De(),x=n(p),P=n(x),D=n(P);me(D,()=>({"--size":"20px"})),Y(D.lastChild,{name:"key"});var q=d(P,2),E=n(q),re=d(x,2),oe=n(re);{var ce=I=>{var L=Pe();L.__click=[xe,X,c];var z=n(L);Y(z,{name:"close"});var le=d(z,2);Ke(le,{children:(ne,Le)=>{var ie=B("delete access key");t(ne,ie)}}),t(I,L)};v(oe,I=>{e(A).length>1&&I(ce)})}he(()=>Ae(E,e(c).name)),t(a,p)});var b=d(C,2);{var u=a=>{var c=$e();t(a,c)};v(b,a=>{e(s)==="errorDeleteAccessKey"&&a(u)})}var w=d(b,2);{var T=a=>{var c=Se(),p=n(c);{let x=Q(()=>W(R.ConfirmAccessKey)),P=Q(()=>$(R.ConfirmAccessKey));G(p,{element:"a",get href(){return e(x)},get onClick(){return e(P)},children:(D,q)=>{var E=B("Add access key");t(D,E)},$$slots:{default:!0}})}t(a,c)},j=a=>{var c=Te();t(a,c)};v(w,a=>{e(A).length<5?a(T):a(j,!1)})}t(_,y)},te=_=>{var y=O(),C=m(y);{var b=u=>{var w=Ee(),T=d(m(w),2),j=n(T);G(j,{onClick:()=>{i(s,"loadingAccessKeys")},children:(a,c)=>{var p=B("Try Again");t(a,p)},$$slots:{default:!0}}),t(u,w)};v(C,u=>{e(s)==="errorAccessKeys"&&u(b)},!0)}t(_,y)};v(V,_=>{e(s)==="successAccessKeys"||e(s)==="errorDeleteAccessKey"?_(S):_(te,!1)},!0)}t(f,k)};v(g,f=>{e(s)==="confirmingDeleteAccessKey"?f(K):f(ae,!1)},!0)}t(r,o)};v(Z,r=>{e(s)==="loadingAccessKeys"?r(ee):r(se,!1)})}t(F,N),pe()}ye(["click"]);export{Fe as default};
