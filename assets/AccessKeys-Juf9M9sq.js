import{p as ie,a as M,G as ve,u as R,s as V,g as t,o as de,m as i,f as l,i as v,c as n,b as a,d as ge,L as z,k as B,h,w as fe,e as d,N as pe,O as ue,P as G,n as ye,Q as _e,V as me,t as E,R as he,M as Ae,B as J,T as Ke,U as ke,W as we,X as Q}from"./index-lujWDghi.js";import{g as Pe}from"./api-7nXQQ8YG.js";var be=l('<p class="message svelte-1aog49v">Loading access keys</p>'),Ce=l('<p class="message svelte-1aog49v">Confirming</p>'),De=(F,A,e)=>A(t(e).id),$e=l('<button class="buttonDelete svelte-1aog49v"><!> <!></button>'),xe=l('<li class="svelte-1aog49v"><div class="keyInfo svelte-1aog49v"><div><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper></div> <div class="keyName svelte-1aog49v"> </div></div> <div class="keyActions svelte-1aog49v"><!></div></li>'),Se=l('<p class="message error svelte-1aog49v">Error deleting access key</p>'),Te=l('<div class="buttonContainer svelte-1aog49v"><!></div>'),je=l('<p class="message svelte-1aog49v">You have reached the maximum number of access keys.</p>'),Le=l('<p class="message svelte-1aog49v">Access Keys</p> <ul class="svelte-1aog49v"></ul> <!> <!>',1),Oe=l('<p class="message error svelte-1aog49v">Something went wrong</p> <div class="buttonContainer svelte-1aog49v"><!></div>',1),Be=l('<div class="content svelte-1aog49v"><!></div>');function Ne(F,A){ie(A,!0);let e=M("loadingAccessKeys"),K=M(ve([]));R(()=>{V(t(e)==="loadingAccessKeys"||t(e)==="confirmingDeleteAccessKey")}),de(()=>()=>{V(!1)}),R(()=>{if(!A.hidden&&t(e)==="successAccessKeys"||t(e)==="loadingAccessKeys"){const s=new AbortController;return(async()=>{try{const c=await fetch("/api/auth/accessKeys",{method:"POST",signal:s.signal});if(!c.ok)throw new Error("Failed to fetch access keys");const g=await c.json();i(K,g.credentials||[],!0),i(e,"successAccessKeys")}catch{i(e,"errorAccessKeys")}})(),()=>{s.abort()}}});const W=()=>{const s=we();s.includes("confirmAccessKey")||s.push("confirmAccessKey");const c=new URLSearchParams(Q.search);return c.set("stackPages",s.join(",")),`${Q.pathname}?${c}`},X=s=>{s.preventDefault(),ke("confirmAccessKey")},Y=async s=>{i(e,"confirmingDeleteAccessKey");try{const c=await Pe(),g=await Ae({challenge:c}),f=await fetch("/api/auth/deleteCredential",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({challenge:c,id:s,confirmCredential:g.credentialData})});if(!f.ok)throw new Error("Failed to add access key");if(!(await f.json()).success){i(e,"errorDeleteAccessKey");return}i(e,"loadingAccessKeys")}catch{i(e,"errorDeleteAccessKey");return}};var H=Be(),q=n(H);{var Z=s=>{z(s,{children:(c,g)=>{var f=be();a(c,f)},$$slots:{default:!0}})},ee=s=>{var c=B(),g=h(c);{var f=p=>{z(p,{children:(k,U)=>{var $=Ce();a(k,$)},$$slots:{default:!0}})},N=p=>{var k=B(),U=h(k);{var $=u=>{var _=Le(),w=d(h(_),2);pe(w,21,()=>t(K),he,(r,o)=>{var y=xe(),C=n(y),D=n(C),T=n(D);ue(T,()=>({"--size":"20px"})),G(T.lastChild,{name:"key"});var j=d(D,2),ae=n(j),te=d(C,2),re=n(te);{var ce=L=>{var O=$e();O.__click=[De,Y,o];var I=n(O);G(I,{name:"close"});var oe=d(I,2);me(oe,{children:(le,Ee)=>{var ne=E("delete access key");a(le,ne)}}),a(L,O)};v(re,L=>{t(K).length>1&&L(ce)})}ye(()=>_e(ae,t(o).name)),a(r,y)});var P=d(w,2);{var m=r=>{var o=Se();a(r,o)};v(P,r=>{t(e)==="errorDeleteAccessKey"&&r(m)})}var b=d(P,2);{var x=r=>{var o=Te(),y=n(o);{let C=Ke(W);J(y,{element:"a",get href(){return t(C)},onClick:X,children:(D,T)=>{var j=E("Add access key");a(D,j)},$$slots:{default:!0}})}a(r,o)},S=r=>{var o=je();a(r,o)};v(b,r=>{t(K).length<5?r(x):r(S,!1)})}a(u,_)},se=u=>{var _=B(),w=h(_);{var P=m=>{var b=Oe(),x=d(h(b),2),S=n(x);J(S,{onClick:()=>{i(e,"loadingAccessKeys")},children:(r,o)=>{var y=E("Try Again");a(r,y)},$$slots:{default:!0}}),a(m,b)};v(w,m=>{t(e)==="errorAccessKeys"&&m(P)},!0)}a(u,_)};v(U,u=>{t(e)==="successAccessKeys"||t(e)==="errorDeleteAccessKey"?u($):u(se,!1)},!0)}a(p,k)};v(g,p=>{t(e)==="confirmingDeleteAccessKey"?p(f):p(N,!1)},!0)}a(s,c)};v(q,s=>{t(e)==="loadingAccessKeys"?s(Z):s(ee,!1)})}a(F,H),ge()}fe(["click"]);export{Ne as default};
