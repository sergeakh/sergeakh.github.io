import{p as Z,z as be,K as S,u as oe,i as e,e as g,j as l,o as ce,f as D,r as le,X as K,c as u,s as m,k as N,y as X,W as $,b as h,l as ee,m as ke,n as ue,D as ve,q as te,h as F,C as we,M as Te,N as xe,Y as re,B as se,w as ie,t as Ce,v as pe}from"./index-CZzB_zyz.js";import{I as de}from"./Input-BmQCHwHc.js";var Ie=(T,t,s,v)=>{e(t)!==""&&s(e(t)),v(!1),l(t,"")},ye=D('<form class="formNewTag svelte-16azfa5"><div class="inputWrapper svelte-16azfa5"><!></div> <button class="buttonDone svelte-16azfa5">Done</button></form>'),De=D('<div class="block"><div class="tags svelte-16azfa5"><!> <!> <!> <!></div> <!></div>');function Ue(T,t){Z(t,!0);const{isReadyStore:s,getGetNotes:v}=be();let d=g(null),r=g(""),b=g(null),k=S(t,"shownTagInput",15);const x=a=>{t.selectedTags.includes(a)||(l(r,""),t.onChangeTags([...t.selectedTags,a]),e(d)?.focus())},z=a=>{const o=t.selectedTags.filter(w=>w!==a);o.length===0?t.onChangeTags([]):t.onChangeTags(o)};let U=X(()=>s()?[...(v()()||[]).reduce((a,o)=>(o?.tags.forEach(w=>{a.has(w)||a.add(w)}),a),new Set)]:[]),y=X(()=>s()?e(U).filter(a=>!t.selectedTags.some(o=>a===o)&&a!=="inbox"):[]),i=X(()=>e(y).find(a=>a.toLowerCase()===e(r).toLowerCase())||t.selectedTags.includes(e(r))),f=X(()=>e(y).filter(a=>e(r)===""?!0:a.toLowerCase().indexOf(e(r).toLowerCase())===0).slice(0,e(i)||e(r)===""?3:2));const C=a=>{a.preventDefault(),e(r)!==""?(x(e(r)),l(r,"")):k(!1)};oe(()=>{e(d)&&k()&&e(d).focus(),k()||l(r,"")});const p=a=>{a.target&&e(b)&&!e(b).contains(a.target)&&(k(!1),l(r,""))};ce(()=>(document.addEventListener("click",p,{capture:!0}),()=>{document.removeEventListener("click",p,{capture:!0})}));var _=De(),c=u(_),I=u(c);le(I,16,()=>t.selectedTags,a=>a,(a,o)=>{K(a,{get title(){return o},onClick:()=>z(o),type:"button",style:"selected"})});var j=m(I,2);{var B=a=>{var o=ke(),w=ue(o);le(w,16,()=>e(f),E=>E,(E,L)=>{K(E,{get title(){return L},onClick:()=>x(L)})}),h(a,o)};N(j,a=>{e(r)!==""&&a(B)})}var R=m(j,2);{var Y=a=>{K(a,{get title(){return e(r)},onClick:()=>{x(e(r)),l(r,"")}})};N(R,a=>{!e(i)&&e(r)!==""&&a(Y)})}var J=m(R,2);{var Q=a=>{K(a,{title:"add tag",onClick:()=>k(!0)})};N(J,a=>{k()||a(Q)})}var H=m(c,2);{var P=a=>{var o=ye(),w=u(o),E=u(w);de(E,{placeholder:"tag",get ref(){return e(d)},set ref(M){l(d,M,!0)},get value(){return e(r)},set value(M){l(r,M,!0)}});var L=m(w,2);L.__click=[Ie,r,x,k],ve("submit",o,C),h(a,o)};N(H,a=>{k()&&a(P)})}$(_,a=>l(b,a),()=>e(b)),h(T,_),ee()}te(["click"]);var Ne=(T,t,s,v)=>{l(t,s.url,!0),v(!1)},Ee=(T,t,s,v,d)=>{if(e(t)&&e(s)){l(t,"");return}v.onChangeUrl(e(t)),d(!1)},Le=D('<div class="wrapper svelte-1gjqck4"><!> <div class="containerButtons svelte-1gjqck4"><button class="svelte-1gjqck4">Cancel</button> <button class="svelte-1gjqck4">Done</button></div></div>'),Se=(T,t)=>{t(!0)},je=D('<button class="button svelte-1gjqck4">Edit link</button> <button class="button svelte-1gjqck4">Delete link</button>',1),qe=(T,t)=>{t(!0)},We=D('<button class="button svelte-1gjqck4">Add link</button>'),Be=D('<div class="wrapperButtons svelte-1gjqck4"><!></div>'),Re=D("<div><!></div>");function Me(T,t){Z(t,!0);let s=S(t,"shownUrlInput",15),v=g(""),d=g(null),r=g(null),b=g(F(t.url));const k=i=>{l(v,""),l(b,i.target.value||"",!0);try{new URL(e(b))}catch{l(v,"Invalid URL")}};oe(()=>{s()&&e(d)?.focus()});var x=Re(),z=u(x);{var U=i=>{var f=Le(),C=u(f);de(C,{get value(){return e(b)},get error(){return e(v)},onInput:k,placeholder:"url",get ref(){return e(d)},set ref(I){l(d,I,!0)}});var p=m(C,2),_=u(p);_.__click=[Ne,b,t,s];var c=m(_,2);c.__click=[Ee,b,v,t,s],h(i,f)},y=i=>{var f=Be(),C=u(f);{var p=c=>{var I=je(),j=ue(I);j.__click=[Se,s];var B=m(j,2);B.__click=function(...R){t.onDeleteUrl?.apply(this,R)},h(c,I)},_=c=>{var I=We();I.__click=[qe,s],h(c,I)};N(C,c=>{t.url?c(p):c(_,!1)})}h(i,f)};N(z,i=>{s()?i(U):i(y,!1)})}$(x,i=>l(r,i),()=>e(r)),h(T,x),ee()}te(["click"]);const ze=(T,t,s)=>{e(t)&&(e(t).style.height="auto",e(t).style.height=e(t).scrollHeight+"px"),s()},Ae=(T,t)=>{t()};var Fe=D("<span> </span>"),He=D('<div class="dateInfo svelte-1cn2xww"><!></div>'),Pe=D('<div class="submitButtons svelte-1cn2xww"><!> <!></div>'),Oe=D('<div class="form svelte-1cn2xww"><div class="scrollWrapper"><div class="formFields"><!> <form><input class="inputName svelte-1cn2xww" placeholder="Name"/></form> <textarea placeholder="Note" class="svelte-1cn2xww"></textarea></div></div> <div><!> <div class="formTagsWrapper svelte-1cn2xww"><!></div> <!></div></div>');function Xe(T,t){Z(t,!0);const{deleteDraft:s,putDraft:v}=we();let d=S(t,"initialName",3,""),r=S(t,"initialUrl",3,""),b=S(t,"initialText",3,""),k=S(t,"initialTags",19,()=>[]),x=S(t,"noteId",3,""),z=S(t,"mode",3,"add"),U=g(F(t.draft?.name||d())),y=g(F(t.draft?.url||r())),i=g(F(t.draft?.text||b())),f=g(F((t.draft?.tags||k()).filter(n=>n!=="inbox"))),C=g(null),p=g(!1),_=g(!1);const c=()=>{const n={id:x(),name:e(U),url:e(y),text:e(i),tags:e(f).map(q=>q.trim())};v(n)},I=n=>{n.preventDefault(),s(x()),t.onSubmit({name:e(U).trim().slice(0,256)||"unkwown",url:e(y).trim().slice(0,2048),text:e(i).trim().slice(0,2048),tags:e(f).length>0?e(f):["inbox"]})},j=n=>{n.preventDefault(),e(C)&&e(C).focus()},B=n=>{n.key==="Escape"&&(document.activeElement instanceof HTMLInputElement&&document.activeElement.type==="text"||document.activeElement instanceof HTMLTextAreaElement)&&(e(p)&&l(p,!1),e(_)&&l(_,!1),document.activeElement.blur(),n.preventDefault(),n.stopPropagation())};ce(()=>(document.addEventListener("keydown",B),()=>document.removeEventListener("keydown",B)));const R=n=>{l(y,n,!0),c()},Y=()=>{l(y,""),c()},J=n=>{l(f,n,!0),c()},Q=()=>{s(x()),l(U,d()),l(y,r()),l(i,b()),l(f,k(),!0)};var H=Oe(),P=u(H),a=u(P),o=u(a);Me(o,{get url(){return e(y)},onChangeUrl:R,onDeleteUrl:Y,get shownUrlInput(){return e(_)},set shownUrlInput(n){l(_,n,!0)}});var w=m(o,2),E=u(w);E.__input=[Ae,c];var L=m(w,2);L.__input=[ze,C,c],$(L,n=>l(C,n),()=>e(C));var M=m(P,2);Te(M,1,xe(["bottom","bottomSpace"]),"svelte-1cn2xww");var ae=u(M);{var fe=n=>{var q=He(),O=u(q);{var V=W=>{var G=Fe(),A=u(G);Ce(he=>pe(A,`updated: ${he??""}`),[()=>new Date(t.updatedAt).toLocaleString()]),h(W,G)};N(O,W=>{t.updatedAt&&W(V)})}h(n,q)};N(ae,n=>{z()==="edit"&&n(fe)})}var ne=m(ae,2),_e=u(ne);Ue(_e,{get selectedTags(){return e(f)},onChangeTags:J,get shownTagInput(){return e(p)},set shownTagInput(n){l(p,n,!0)}});var ge=m(ne,2);{var me=n=>{var q=Pe(),O=u(q);se(O,{fullWidth:!0,withoutMinWidth:!0,onClick:Q,type:"secondary",typeButton:"button",children:(W,G)=>{var A=ie("cancel");h(W,A)},$$slots:{default:!0}});var V=m(O,2);se(V,{fullWidth:!0,withoutMinWidth:!0,onClick:I,typeButton:"submit",children:(W,G)=>{var A=ie("save");h(W,A)},$$slots:{default:!0}}),h(n,q)};N(ge,n=>{!e(p)&&!e(_)&&t.draft&&n(me)})}ve("submit",w,j),re(E,()=>e(U),n=>l(U,n)),re(L,()=>e(i),n=>l(i,n)),h(T,H),ee()}te(["input"]);export{Xe as N};
