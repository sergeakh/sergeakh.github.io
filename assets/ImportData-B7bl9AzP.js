import{U as re,p as oe,d as ne,C as le,z as ie,W as ce,u as de,i as c,e as z,o as ve,f as k,k as I,c as y,b as s,l as pe,s as j,n as D,m as B,B as A,w as N,X as J,j as d,t as fe,N as ge,O as ue,D as O,L as me,q as _e}from"./index-DGGsS_Lk.js";const W=(x,u,r,m=new Set,v={})=>{for(const t of x.children)if(t.tagName==="DT"){const p=t.querySelector(":scope > A"),_=t.querySelector(":scope > H3");if(p){const f=p.getAttribute("href"),S=p.textContent||"unknown";if(!f)return r;const b=u.find(h=>h.toLowerCase()==="bookmarks bar")?u.filter(h=>h.toLowerCase()!=="bookmarks bar"):["other"];if(v[f])v[f].tags=[...new Set([...v[f].tags,...b])];else{const h={id:re(),url:f,name:S,text:"",tags:b.length>0?b:[],updatedAt:Date.now(),createdAt:Date.now()};v[h.url]=h,r.push(h)}}else if(_){const f=_.textContent?.trim();if(f&&_.nextElementSibling?.tagName==="DL"){const S=[...u];S.push(f);const b=_.nextElementSibling;m.has(b)||(m.add(b),W(b,S,r,m,v))}}}else t.tagName!=="DL"&&t.children.length>0&&(m.has(t)||(m.add(t),W(t,[...u],r,m,v)));return r},be=async x=>{const u=await x.text(),v=new DOMParser().parseFromString(u,"text/html").querySelector("DL");return v?W(v,[],[]):[]},X=async(x,u)=>{const r=x.target;!r.files||r.files.length===0||await u(r.files[0])};var he=k('<div class="mobileContainer svelte-1gjle5b"><!></div> <input type="file" accept=".json, .html" style="display: none;"/>',1),we=k('<div class="desktopContainer svelte-1gjle5b"><div class="desktopButtonContainer svelte-1gjle5b"><!></div> <div role="button" tabindex="-1"><div tabindex="-1" class="dropzone-content svelte-1gjle5b"><p class="svelte-1gjle5b">Drag and drop your file here</p> <p class="svelte-1gjle5b">or</p></div> <input type="file" accept=".json, .html" style="display: none;"/></div></div>'),De=k('<p class="message svelte-1gjle5b">Select a file to import your data</p> <!>',1),xe=k('<p class="message svelte-1gjle5b">Importing data...</p> <!>',1),ye=k('<p class="message success svelte-1gjle5b">Data imported successfully!</p> <div class="buttonContainer svelte-1gjle5b"><!></div>',1),je=k('<p class="message error svelte-1gjle5b">Something went wrong</p> <div class="buttonContainer svelte-1gjle5b"><!></div>',1),ke=k('<div class="content svelte-1gjle5b"><!></div>');function Pe(x,u){oe(u,!0);const{blockDialog:r}=ne(),{importNotes:m}=le(),{closeDialogStack:v}=ie();let t=z("idle"),p=z(null),_=z(!1),f=z(null);const{checkMobileSize:S}=ce(),b=()=>{v()};de(()=>{r(c(t)==="loading")}),ve(()=>(c(p)&&c(p).addEventListener("cancel",e=>{e.preventDefault(),e.stopImmediatePropagation(),e.stopPropagation()}),()=>{r(!1)}));const h=async e=>{const a=await e.text(),C=JSON.parse(a),P=[];if(!C.notes)throw new Error("Invalid import file format");for(const L of Object.values(C.notes))L&&P.push(L);await m(P)},M=async e=>{d(t,"loading");try{if(e.name.endsWith(".json"))await h(e);else if(e.name.endsWith(".html"))await m(await be(e));else throw new Error("Unsupported file format. Please upload a JSON or HTML file.");await new Promise(a=>setTimeout(a,500)),d(t,"success")}catch{d(t,"error")}},U=()=>{c(p)?.click()},G=e=>{e.preventDefault(),e.stopPropagation(),d(_,!0)},K=e=>{e.preventDefault(),e.stopPropagation(),d(_,!1)},Q=e=>{e.preventDefault(),e.stopPropagation(),d(_,!0)},V=async e=>{if(e.preventDefault(),e.stopPropagation(),d(_,!1),!e.dataTransfer?.files||e.dataTransfer.files.length===0)return;const a=e.dataTransfer.files[0];if(a.type!=="application/json"&&a.type!=="text/html"){d(t,"error");return}await M(a)};var R=ke(),Y=y(R);{var Z=e=>{var a=De(),C=j(D(a),2);{var P=o=>{var g=he(),w=D(g),F=y(w);A(F,{onClick:U,children:(n,i)=>{var T=N("Select File");s(n,T)},$$slots:{default:!0}});var l=j(w,2);l.__change=[X,M],J(l,n=>d(p,n),()=>c(p)),s(o,g)},L=o=>{var g=we(),w=y(g),F=y(w);A(F,{onClick:U,children:(i,T)=>{var $=N("Select File");s(i,$)},$$slots:{default:!0}});var l=j(w,2),n=j(y(l),2);n.__change=[X,M],J(n,i=>d(p,i),()=>c(p)),J(l,i=>d(f,i),()=>c(f)),fe(()=>ge(l,1,ue(["dropzone",{active:c(_)}]),"svelte-1gjle5b")),O("dragenter",l,G),O("dragover",l,Q),O("dragleave",l,K),O("drop",l,V),s(o,g)};I(C,o=>{S()?o(P):o(L,!1)})}s(e,a)},ee=e=>{var a=B(),C=D(a);{var P=o=>{var g=xe(),w=j(D(g),2);me(w,{}),s(o,g)},L=o=>{var g=B(),w=D(g);{var F=n=>{var i=ye(),T=j(D(i),2),$=y(T);A($,{onClick:b,children:(E,q)=>{var H=N("close");s(E,H)},$$slots:{default:!0}}),s(n,i)},l=n=>{var i=B(),T=D(i);{var $=E=>{var q=je(),H=j(D(q),2),te=y(H);A(te,{onClick:()=>{d(t,"idle")},children:(ae,Se)=>{var se=N("Try Again");s(ae,se)},$$slots:{default:!0}}),s(E,q)};I(T,E=>{c(t)==="error"&&E($)},!0)}s(n,i)};I(w,n=>{c(t)==="success"?n(F):n(l,!1)},!0)}s(o,g)};I(C,o=>{c(t)==="loading"?o(P):o(L,!1)},!0)}s(e,a)};I(Y,e=>{c(t)==="idle"?e(Z):e(ee,!1)})}s(x,R),pe()}_e(["change"]);export{Pe as default};
