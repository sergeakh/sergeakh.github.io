import{U as rt,p as ot,d as nt,C as lt,z as it,W as ct,u as dt,i as c,e as z,o as vt,f as S,k as j,c as b,b as s,l as pt,s as k,n as x,m as B,B as A,w as N,X as J,j as d,t as ft,N as ut,O as gt,D as O,L as mt,q as _t}from"./index-D3sDlWLV.js";const W=(y,g,r,m=new Set,v={})=>{for(const e of y.children)if(e.tagName==="DT"){const p=e.querySelector(":scope > A"),_=e.querySelector(":scope > H3");if(p){const f=p.getAttribute("href"),C=p.textContent||"unknown";if(!f)return r;const h=g.find(w=>w.toLowerCase()==="bookmarks bar")?g.filter(w=>w.toLowerCase()!=="bookmarks bar"):["other"];if(v[f])v[f].tags=[...new Set([...v[f].tags,...h])];else{const w={id:rt(),url:f,name:C,text:"",tags:h.length>0?h:[],updatedAt:Date.now(),createdAt:Date.now()};v[w.url]=w,r.push(w)}}else if(_){const f=_.textContent?.trim();if(f&&_.nextElementSibling?.tagName==="DL"){const C=[...g];C.push(f);const h=_.nextElementSibling;m.has(h)||(m.add(h),W(h,C,r,m,v))}}}else e.tagName!=="DL"&&e.children.length>0&&(m.has(e)||(m.add(e),W(e,[...g],r,m,v)));return r},ht=async y=>{const g=await y.text(),v=new DOMParser().parseFromString(g,"text/html").querySelector("DL");return v?W(v,[],[]):[]},X=async(y,g)=>{const r=y.target;!r.files||r.files.length===0||await g(r.files[0])};var wt=S('<div class="mobileContainer svelte-1n1lt8i"><!></div> <input type="file" accept=".json, .html" style="display: none;"/>',1),Dt=S('<div class="desktopContainer svelte-1n1lt8i"><div class="desktopButtonContainer svelte-1n1lt8i"><!></div> <div role="button" tabindex="-1"><div tabindex="-1" class="dropzone-content svelte-1n1lt8i"><p class="svelte-1n1lt8i">Drag and drop your file here</p> <p class="svelte-1n1lt8i">or</p></div> <input type="file" accept=".json, .html" style="display: none;"/></div></div>'),xt=S('<p class="message svelte-1n1lt8i">Select a file to import your data</p> <!>',1),yt=S('<p class="message svelte-1n1lt8i">Importing data...</p> <!>',1),bt=S('<p class="message success svelte-1n1lt8i">Data imported successfully!</p> <div class="buttonContainer svelte-1n1lt8i"><!></div>',1),kt=S('<p class="message error svelte-1n1lt8i">Something went wrong</p> <div class="buttonContainer svelte-1n1lt8i"><!></div>',1),St=S('<div class="content svelte-1n1lt8i"><!></div>');function Lt(y,g){ot(g,!0);const{blockDialog:r}=nt(),{importNotes:m}=lt(),{closeDialogStack:v}=it();let e=z("idle"),p=z(null),_=z(!1),f=z(null);const{checkMobileSize:C}=ct(),h=()=>{v()};dt(()=>{r(c(e)==="loading")}),vt(()=>(c(p)&&c(p).addEventListener("cancel",t=>{t.preventDefault(),t.stopImmediatePropagation(),t.stopPropagation()}),()=>{r(!1)}));const w=async t=>{const a=await t.text(),P=JSON.parse(a),L=[];if(!P.notes)throw new Error("Invalid import file format");for(const T of Object.values(P.notes))T&&L.push(T);await m(L)},M=async t=>{d(e,"loading");try{if(t.name.endsWith(".json"))await w(t);else if(t.name.endsWith(".html"))await m(await ht(t));else throw new Error("Unsupported file format. Please upload a JSON or HTML file.");await new Promise(a=>setTimeout(a,500)),d(e,"success")}catch{d(e,"error")}},U=()=>{c(p)?.click()},G=t=>{t.preventDefault(),t.stopPropagation(),d(_,!0)},K=t=>{t.preventDefault(),t.stopPropagation(),d(_,!1)},Q=t=>{t.preventDefault(),t.stopPropagation(),d(_,!0)},V=async t=>{if(t.preventDefault(),t.stopPropagation(),d(_,!1),!t.dataTransfer?.files||t.dataTransfer.files.length===0)return;const a=t.dataTransfer.files[0];if(a.type!=="application/json"&&a.type!=="text/html"){d(e,"error");return}await M(a)};var R=St(),Y=b(R);{var Z=t=>{var a=xt(),P=k(x(a),2);{var L=o=>{var u=wt(),D=x(u),$=b(D);A($,{onClick:U,children:(n,i)=>{var F=N("Select File");s(n,F)},$$slots:{default:!0}});var l=k(D,2);l.__change=[X,M],J(l,n=>d(p,n),()=>c(p)),s(o,u)},T=o=>{var u=Dt(),D=b(u),$=b(D);A($,{onClick:U,children:(i,F)=>{var E=N("Select File");s(i,E)},$$slots:{default:!0}});var l=k(D,2),n=k(b(l),2);n.__change=[X,M],J(n,i=>d(p,i),()=>c(p)),J(l,i=>d(f,i),()=>c(f)),ft(()=>ut(l,1,gt(["dropzone",{active:c(_)}]),"svelte-1n1lt8i")),O("dragenter",l,G),O("dragover",l,Q),O("dragleave",l,K),O("drop",l,V),s(o,u)};j(P,o=>{C()?o(L):o(T,!1)})}s(t,a)},tt=t=>{var a=B(),P=x(a);{var L=o=>{var u=yt(),D=k(x(u),2);mt(D,{}),s(o,u)},T=o=>{var u=B(),D=x(u);{var $=n=>{var i=bt(),F=k(x(i),2),E=b(F);A(E,{onClick:h,children:(I,q)=>{var H=N("close");s(I,H)},$$slots:{default:!0}}),s(n,i)},l=n=>{var i=B(),F=x(i);{var E=I=>{var q=kt(),H=k(x(q),2),et=b(H);A(et,{onClick:()=>{d(e,"idle")},children:(at,Ct)=>{var st=N("Try Again");s(at,st)},$$slots:{default:!0}}),s(I,q)};j(F,I=>{c(e)==="error"&&I(E)},!0)}s(n,i)};j(D,n=>{c(e)==="success"?n($):n(l,!1)},!0)}s(o,u)};j(P,o=>{c(e)==="loading"?o(L):o(T,!1)},!0)}s(t,a)};j(Y,t=>{c(e)==="idle"?t(Z):t(tt,!1)})}s(y,R),pt()}_t(["change"]);export{Lt as default};
