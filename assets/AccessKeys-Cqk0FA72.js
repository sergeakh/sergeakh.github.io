import{p as ne,s as V,a as ie,u as q,b as J,g as s,o as ve,c as v,f as l,i as d,d as n,e as t,h as de,L as M,j as I,k as m,l as ge,m as g,n as fe,q as _e,I as U,t as pe,r as ye,V as ue,v as L,w as me,B as Y,x as G,y as he,P as Q,z as Ae}from"./index-DFePYI8l.js";import{g as Ke}from"./api-C5JaEwh0.js";var ke=l('<p class="message svelte-1aog49v">Loading access keys</p>'),Ce=l('<p class="message svelte-1aog49v">Confirming</p>'),we=(O,h,e)=>h(s(e).id),be=l('<button class="buttonDelete svelte-1aog49v"><!> <!></button>'),Pe=l('<li class="svelte-1aog49v"><div class="keyInfo svelte-1aog49v"><div><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper></div> <div class="keyName svelte-1aog49v"> </div></div> <div class="keyActions svelte-1aog49v"><!></div></li>'),xe=l('<p class="message error svelte-1aog49v">Error deleting access key</p>'),$e=l('<div class="buttonContainer svelte-1aog49v"><!></div>'),De=l('<p class="message svelte-1aog49v">You have reached the maximum number of access keys.</p>'),Se=l('<p class="message svelte-1aog49v">Access Keys</p> <ul class="svelte-1aog49v"></ul> <!> <!>',1),Te=l('<p class="message error svelte-1aog49v">Something went wrong</p> <div class="buttonContainer svelte-1aog49v"><!></div>',1),je=l('<div class="content svelte-1aog49v"><!></div>');function Le(O,h){ne(h,!0);let e=V("loadingAccessKeys"),A=V(ie([]));q(()=>{J(s(e)==="loadingAccessKeys"||s(e)==="confirmingDeleteAccessKey")}),ve(()=>()=>{J(!1)}),q(()=>{if(!h.hidden&&s(e)==="successAccessKeys"||s(e)==="loadingAccessKeys"){const r=new AbortController;return(async()=>{try{const o=await fetch("/api/credentials",{method:"POST",signal:r.signal});if(!o.ok)throw new Error("Failed to fetch access keys");const i=await o.json();v(A,i.credentials||[],!0),console.log("Access Keys: ",i.credentials),v(e,"successAccessKeys")}catch{v(e,"errorAccessKeys")}})(),()=>{r.abort()}}});const R=async r=>{v(e,"confirmingDeleteAccessKey");try{const o=await Ke(),i=await me({challenge:o});if(!(await fetch("/api/deleteCredential",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({challenge:o,id:r,confirmCredential:i.credentialData})})).ok)throw new Error("Failed to add access key");v(e,"loadingAccessKeys")}catch{v(e,"errorDeleteAccessKey");return}};var z=je(),W=n(z);{var X=r=>{M(r,{children:(o,i)=>{var K=ke();t(o,K)},$$slots:{default:!0}})},Z=r=>{var o=I(),i=m(o);{var K=f=>{M(f,{children:(k,F)=>{var D=Ce();t(k,D)},$$slots:{default:!0}})},ee=f=>{var k=I(),F=m(k);{var D=_=>{var y=Se(),C=g(m(y),2);fe(C,21,()=>s(A),a=>a.id,(a,c)=>{var p=Pe(),P=n(p),x=n(P),$=n(x);_e($,()=>({"--size":"20px"})),U($.lastChild,{name:"key"});var H=g(x,2),j=n(H),ae=g(P,2),te=n(ae);{var re=B=>{var E=be();E.__click=[we,R,c];var N=n(E);U(N,{name:"close"});var oe=g(N,2);ue(oe,{children:(ce,Be)=>{var le=L("delete access key");t(ce,le)}}),t(B,E)};d(te,B=>{s(A).length>1&&B(re)})}pe(()=>ye(j,s(c).name)),t(a,p)});var w=g(C,2);{var u=a=>{var c=xe();t(a,c)};d(w,a=>{s(e)==="errorDeleteAccessKey"&&a(u)})}var b=g(w,2);{var S=a=>{var c=$e(),p=n(c);{let P=G(()=>Ae(Q.ConfirmAccessKey)),x=G(()=>he(Q.ConfirmAccessKey));Y(p,{element:"a",get href(){return s(P)},get onClick(){return s(x)},children:($,H)=>{var j=L("Add access key");t($,j)},$$slots:{default:!0}})}t(a,c)},T=a=>{var c=De();t(a,c)};d(b,a=>{s(A).length<5?a(S):a(T,!1)})}t(_,y)},se=_=>{var y=I(),C=m(y);{var w=u=>{var b=Te(),S=g(m(b),2),T=n(S);Y(T,{onClick:()=>{v(e,"loadingAccessKeys")},children:(a,c)=>{var p=L("Try Again");t(a,p)},$$slots:{default:!0}}),t(u,b)};d(C,u=>{s(e)==="errorAccessKeys"&&u(w)},!0)}t(_,y)};d(F,_=>{s(e)==="successAccessKeys"||s(e)==="errorDeleteAccessKey"?_(D):_(se,!1)},!0)}t(f,k)};d(i,f=>{s(e)==="confirmingDeleteAccessKey"?f(K):f(ee,!1)},!0)}t(r,o)};d(W,r=>{s(e)==="loadingAccessKeys"?r(X):r(Z,!1)})}t(O,z),de()}ge(["click"]);export{Le as default};
