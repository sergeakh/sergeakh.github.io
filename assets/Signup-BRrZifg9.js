import{p as G,C as I,g as J,z as M,A as N,e as A,h as V,d as W,u as q,i as t,y as k,o as Q,f as m,k as w,c as h,b as l,l as X,j as d,G as Y,F as Z,s as b,n as S,L as tt,m as et,B as at,w as rt}from"./index-CZzB_zyz.js";import{g as nt}from"./api-C5JaEwh0.js";var e=(n=>(n[n.Signup=0]="Signup",n[n.SignupError=1]="SignupError",n))(e||{}),st=m('<p class="message svelte-9hh95f">signup</p> <!>',1),ot=m('<p class="message svelte-9hh95f">error signup</p> <div class="buttonContainer svelte-9hh95f"><div class="buttonContainerItem svelte-9hh95f"><!></div></div>',1),it=m('<div class="content svelte-9hh95f"><!></div>');function pt(n,x){G(x,!0);const{initAccount:P}=I(),{updateStackPages:U}=J(),{getAccount:B}=M(),{getAppHistory:D,back:E,closeDialogStack:j,deleteSearchParam:H}=N();let K=k(D),f=k(B),y=A(""),s=A(V(e.Signup));const{blockDialog:c,unBlockBackDialog:v}=W(),_=async()=>{d(s,e.Signup,!0);try{const a=await nt(),r=crypto.getRandomValues(new Uint8Array(32)),o=await Y({challenge:a,clientKey:r}),u=await fetch("/api/signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(u.status!==200){d(s,e.SignupError,!0);return}const i=await u.json(),p=t(f)===void 0;if(await P({clientKey:r,serverKey:new Uint8Array(Z(i.serverKey))}),p)c(!1),j();else{c(!1);let g=new URLSearchParams(t(K).search).get("retPath")||"";g&&(d(y,g,!0),H("retPath")),E({to:t(y)}),U()}}catch{d(s,e.SignupError,!0)}};q(()=>{t(f)===null&&c(t(s)===e.Signup),v(t(s)!==e.Signup)}),Q(()=>(t(f)===void 0&&(c(!0),v(!1)),_(),()=>{v(!1)}));var C=it(),L=h(C);{var R=a=>{var r=st(),o=b(S(r),2);tt(o,{}),l(a,r)},T=a=>{var r=et(),o=S(r);{var u=i=>{var p=ot(),g=b(S(p),2),$=h(g),O=h($);at(O,{onClick:()=>_(),fullWidth:!0,children:(z,lt)=>{var F=rt("try again");l(z,F)},$$slots:{default:!0}}),l(i,p)};w(o,i=>{t(s)===e.SignupError&&i(u)},!0)}l(a,r)};w(L,a=>{t(s)===e.Signup?a(R):a(T,!1)})}l(n,C),X()}export{pt as default};
