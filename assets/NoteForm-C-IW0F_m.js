import{p as q,W as x,u as X,h as t,d as k,i,f as I,m as A,q as K,a7 as R,c as T,s as f,j as D,x as W,b as g,k as G,l as Y,H as Z,a8 as Q,a1 as at,n as O,e as M,o as rt,a4 as lt,a9 as V,B as nt,v as st,t as it,r as ot}from"./index-4wCSJ_Me.js";import{I as $}from"./Input-skZKVE9H.js";var ut=(_,l,n)=>{l(!1),i(n,"")},vt=I('<form class="formNewTag svelte-1y1o0pj"><!> <button type="button" class="buttonDone svelte-1y1o0pj">Done</button></form>'),ct=I('<div class="tags svelte-1y1o0pj"><!> <!> <!> <!></div> <!>',1);function dt(_,l){q(l,!0);let n=k(null),r=k(""),o=x(l,"selectedTags",15),h=x(l,"shownTagInput",15);const y=e=>{o().includes(e)||(i(r,""),o([...o(),e]),t(n)?.focus())},C=e=>{const s=o().filter(m=>m!==e);s.length===0?o([]):o(s)};let N=W(()=>Q()?[...(at()()||[]).reduce((e,s)=>(s?.tags.forEach(m=>{e.has(m)||e.add(m)}),e),new Set)]:[]),E=W(()=>Q()?t(N).filter(e=>!o().some(s=>e===s)&&e!=="inbox"):[]),v=W(()=>t(E).find(e=>e.toLowerCase()===t(r).toLowerCase())||o().includes(t(r))),u=W(()=>t(E).filter(e=>t(r)===""?!0:e.toLowerCase().indexOf(t(r).toLowerCase())===0).slice(0,t(v)||t(r)===""?3:2));const d=e=>{e.preventDefault(),t(r)!==""&&(y(t(r)),i(r,""))};X(()=>{t(n)&&h()&&t(n).focus(),h()||i(r,"")});var p=ct(),w=A(p),c=T(w);K(c,16,o,e=>e,(e,s)=>{R(e,{get title(){return s},onClick:()=>C(s),type:"button",style:"selected"})});var b=f(c,2);{var U=e=>{var s=Y(),m=A(s);K(m,16,()=>t(u),j=>j,(j,a)=>{R(j,{get title(){return a},onClick:()=>y(a)})}),g(e,s)};D(b,e=>{t(r)!==""&&e(U)})}var L=f(b,2);{var F=e=>{R(e,{get title(){return t(r)},onClick:()=>{y(t(r)),i(r,"")}})};D(L,e=>{!t(v)&&t(r)!==""&&e(F)})}var H=f(L,2);{var S=e=>{R(e,{title:"add tag",onClick:()=>h(!0)})};D(H,e=>{h()||e(S)})}var P=f(w,2);{var B=e=>{var s=vt(),m=T(s);$(m,{placeholder:"tag",get ref(){return t(n)},set ref(a){i(n,a,!0)},get value(){return t(r)},set value(a){i(r,a,!0)}});var j=f(m,2);j.__click=[ut,h,r],Z("submit",s,d),g(e,s)};D(P,e=>{h()&&e(B)})}g(_,p),G()}O(["click"]);var ft=(_,l,n)=>{l(!1),i(n,"")},_t=(_,l,n,r)=>{l()&&t(n)||r(!1)},mt=I('<div class="wrapper svelte-1a7l55t"><!> <div class="containerButtons svelte-1a7l55t"><button class="svelte-1a7l55t">Cancel</button> <button class="svelte-1a7l55t">Save</button></div></div>'),gt=(_,l)=>{l(!0)},ht=(_,l)=>{l("")},pt=I('<button class="button svelte-1a7l55t">Edit url</button> <button class="button svelte-1a7l55t">Delete url</button>',1),bt=(_,l)=>{l(!0)},kt=I('<button class="button svelte-1a7l55t">Add url</button>'),Tt=I('<div class="wrapperButtons svelte-1a7l55t"><!></div>');function wt(_,l){q(l,!0);let n=x(l,"url",15),r=x(l,"shownUrlInput",15),o=k("");const h=v=>{i(o,""),n(v.target.value||"");try{new URL(n())}catch{i(o,"Invalid URL")}};var y=Y(),C=A(y);{var N=v=>{var u=mt(),d=T(u);$(d,{get value(){return n()},get error(){return t(o)},onInput:h,placeholder:"url"});var p=f(d,2),w=T(p);w.__click=[ft,r,o];var c=f(w,2);c.__click=[_t,n,o,r],g(v,u)},E=v=>{var u=Tt(),d=T(u);{var p=c=>{var b=pt(),U=A(b);U.__click=[gt,r];var L=f(U,2);L.__click=[ht,n],g(c,b)},w=c=>{var b=kt();b.__click=[bt,r],g(c,b)};D(d,c=>{n()?c(p):c(w,!1)})}g(v,u)};D(C,v=>{r()?v(N):v(E,!1)})}g(_,y),G()}O(["click"]);var xt=I('<div class="submitWrapper svelte-1jfgfhk"><!></div>'),yt=I('<div class="form svelte-1jfgfhk"><div class="formFields"><!> <form><input class="inputName svelte-1jfgfhk" placeholder="Name"/></form> <textarea placeholder="Note" class="svelte-1jfgfhk"></textarea></div> <div class="formTagsWrapper svelte-1jfgfhk"><!></div> <!></div>');function Nt(_,l){q(l,!0);let n=x(l,"initialTitle",3,""),r=x(l,"initialUrl",3,""),o=x(l,"initialDescription",3,""),h=x(l,"initialTags",19,()=>[]),y=x(l,"mode",3,"add"),C=k(M(n())),N=k(M(r())),E=k(M(o())),v=k(M(h().filter(a=>a!=="inbox"))),u=k(null),d=k(!1),p=k(!1);const w=a=>{a.preventDefault(),l.onSubmit({title:t(C).trim().slice(0,256)||"unkwown",url:t(N).trim().slice(0,2048),description:t(E).trim().slice(0,2048),tags:t(v).length>0?t(v):["inbox"]})},c=()=>{t(u)&&(t(u).style.height="auto",t(u).style.height=t(u).scrollHeight+"px")};X(()=>{t(u),c()});const b=a=>{a.preventDefault(),t(u)&&t(u).focus()},U=a=>{a.key==="Escape"&&(document.activeElement instanceof HTMLInputElement&&document.activeElement.type==="text"||document.activeElement instanceof HTMLTextAreaElement)&&(t(d)&&i(d,!1),document.activeElement.blur(),a.preventDefault(),a.stopPropagation())};rt(()=>(document.addEventListener("keydown",U),()=>document.removeEventListener("keydown",U)));var L=yt(),F=T(L),H=T(F);wt(H,{get shownUrlInput(){return t(p)},set shownUrlInput(a){i(p,a,!0)},get url(){return t(N)},set url(a){i(N,a,!0)}});var S=f(H,2),P=T(S),B=f(S,2);B.__input=c,lt(B,a=>i(u,a),()=>t(u));var e=f(F,2),s=T(e);dt(s,{get shownTagInput(){return t(d)},set shownTagInput(a){i(d,a,!0)},get selectedTags(){return t(v)},set selectedTags(a){i(v,a,!0)}});var m=f(e,2);{var j=a=>{var z=xt(),tt=T(z);nt(tt,{fullWidth:!0,onClick:w,typeButton:"submit",children:(et,Et)=>{var J=st();it(()=>ot(J,y()==="add"?"add":"edit")),g(et,J)},$$slots:{default:!0}}),g(a,z)};D(m,a=>{!t(d)&&!t(p)&&a(j)})}Z("submit",S,b),V(P,()=>t(C),a=>i(C,a)),V(B,()=>t(E),a=>i(E,a)),g(_,L),G()}O(["input"]);export{Nt as N};
