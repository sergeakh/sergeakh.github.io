import{p as Y,u as Z,g as O,h as s,d as j,o as ee,f as p,j as h,c as v,b as a,k as ae,s as K,i as l,B,v as D,H as te,l as A,m as f,A as re,J as se,K as I,M as oe,L as J,w as ne,N as ie,O as le}from"./index-BZKyeLya.js";import{g as ce,a as de}from"./api-C5JaEwh0.js";import{I as ve}from"./Input-lAG53kpe.js";var fe=p('<form><p class="message error svelte-ey4qps">Enter a name for a key</p> <div class="inputContainer svelte-ey4qps"><!></div> <div class="buttonContainer svelte-ey4qps"><!></div></form>'),pe=p('<p class="message svelte-ey4qps">Adding the access key</p>'),ye=p('<p class="message svelte-ey4qps">Confirming</p>'),me=p('<p class="message error svelte-ey4qps">Something went wrong</p> <div class="buttonContainer svelte-ey4qps"><!></div>',1),ue=p('<p class="message svelte-ey4qps">Confirm this operation with another key</p> <div class="buttonContainer svelte-ey4qps"><!></div>',1),ge=p('<div class="content svelte-ey4qps"><!></div>');function Ae(L,F){Y(F,!0);let e=j("idle"),_="",w=null,k=j("");Z(()=>{O(s(e)==="confirmingAccessKey"||s(e)==="addingAccessKey")}),ee(()=>()=>{O(!1)});const E=async t=>{t.preventDefault(),l(e,"addingAccessKey");try{_=await ce();const r=await de(),o=re();if(!o||!o.encryptedClientKey)throw new Error("No account found");const y=await se({encryptedClientKey:I(o.encryptedClientKey),serverKey:I(r)});w=await oe({challenge:_,clientKey:y}),l(e,"confirmAccessKey")}catch{l(e,"error");return}},H=async()=>{l(e,"confirmingAccessKey");try{const t=await ne({challenge:_});if(!w)throw new Error("No credential data found");if(!(await fetch("/api/addCredential",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({challenge:_,name:s(k)||`key ${Math.floor(Math.random()*1e3)}`,newCredential:w,confirmCredential:t.credentialData})})).ok)throw new Error("Failed to add access key");ie(),le()}catch{l(e,"error");return}};var M=ge(),U=v(M);{var z=t=>{var r=fe(),o=K(v(r),2),y=v(o);ve(y,{placeholder:"key name",get value(){return s(k)},set value(i){l(k,i,!0)}});var $=K(o,2),n=v($);B(n,{onClick:E,children:(i,b)=>{var m=D("Add key");a(i,m)},$$slots:{default:!0}}),te("submit",r,E),a(t,r)},G=t=>{var r=A(),o=f(r);{var y=n=>{J(n,{children:(i,b)=>{var m=pe();a(i,m)},$$slots:{default:!0}})},$=n=>{var i=A(),b=f(i);{var m=c=>{J(c,{children:(C,T)=>{var q=ye();a(C,q)},$$slots:{default:!0}})},Q=c=>{var C=A(),T=f(C);{var q=d=>{var u=me(),P=K(f(u),2),x=v(P);B(x,{onClick:()=>{l(e,"idle")},children:(g,N)=>{var S=D("Try Again");a(g,S)},$$slots:{default:!0}}),a(d,u)},R=d=>{var u=A(),P=f(u);{var x=g=>{var N=ue(),S=K(f(N),2),V=v(S);B(V,{onClick:H,children:(W,he)=>{var X=D("Confirm");a(W,X)},$$slots:{default:!0}}),a(g,N)};h(P,g=>{s(e)==="confirmAccessKey"&&g(x)},!0)}a(d,u)};h(T,d=>{s(e)==="error"?d(q):d(R,!1)},!0)}a(c,C)};h(b,c=>{s(e)==="confirmingAccessKey"?c(m):c(Q,!1)},!0)}a(n,i)};h(o,n=>{s(e)==="addingAccessKey"?n(y):n($,!1)},!0)}a(t,r)};h(U,t=>{s(e)==="idle"?t(z):t(G,!1)})}a(L,M),ae()}export{Ae as default};
