import{p as V,u as Z,s as I,a as n,b as M,o as ee,f as p,i as h,c as v,d as a,e as ae,h as K,n as c,B as D,t as E,w as te,l as w,j as f,U as re,W as se,I as J,G as ne,L,J as oe,X as ie,Y as ce}from"./index-CKRZdUcv.js";import{g as le,a as de}from"./api-7nXQQ8YG.js";import{I as ve}from"./Input-DFCFdcK5.js";var fe=p('<form><p class="message error svelte-ey4qps">Enter a name for a key</p> <div class="inputContainer svelte-ey4qps"><!></div> <div class="buttonContainer svelte-ey4qps"><!></div></form>'),pe=p('<p class="message svelte-ey4qps">Adding the access key</p>'),ye=p('<p class="message svelte-ey4qps">Confirming</p>'),ue=p('<p class="message error svelte-ey4qps">Something went wrong</p> <div class="buttonContainer svelte-ey4qps"><!></div>',1),me=p('<p class="message svelte-ey4qps">Confirm this operation with another key</p> <div class="buttonContainer svelte-ey4qps"><!></div>',1),ge=p('<div class="content svelte-ey4qps"><!></div>');function we(O,U){V(U,!0);let e=M("idle"),_="",A=null,k=M("");Z(()=>{I(n(e)==="confirmingAccessKey"||n(e)==="addingAccessKey")}),ee(()=>()=>{I(!1)});const N=async r=>{r.preventDefault(),c(e,"addingAccessKey");try{_=await le();const t=await de(),s=re();if(!s||!s.encryptedClientKey)throw new Error("No account found");const y=await se({encryptedClientKey:J(s.encryptedClientKey),serverKey:J(t)});A=await ne({challenge:_,clientKey:y}),c(e,"confirmAccessKey")}catch{c(e,"error");return}},F=async()=>{c(e,"confirmingAccessKey");try{const r=await oe({challenge:_});if(!A)throw new Error("No credential data found");const t=await fetch("/api/auth/addCredential",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({challenge:_,name:n(k)||`key ${Math.floor(Math.random()*1e3)}`,newCredential:A,confirmCredential:r.credentialData})});if(!t.ok)throw new Error("Failed to add access key");if(!(await t.json()).success){c(e,"error");return}ie(),ce()}catch{c(e,"error");return}};var T=ge(),G=v(T);{var W=r=>{var t=fe(),s=K(v(t),2),y=v(s);ve(y,{placeholder:"key name",get value(){return n(k)},set value(i){c(k,i,!0)}});var $=K(s,2),o=v($);D(o,{onClick:N,children:(i,b)=>{var u=E("Add key");a(i,u)},$$slots:{default:!0}}),te("submit",t,N),a(r,t)},X=r=>{var t=w(),s=f(t);{var y=o=>{L(o,{children:(i,b)=>{var u=pe();a(i,u)},$$slots:{default:!0}})},$=o=>{var i=w(),b=f(i);{var u=l=>{L(l,{children:(C,j)=>{var q=ye();a(C,q)},$$slots:{default:!0}})},Y=l=>{var C=w(),j=f(C);{var q=d=>{var m=ue(),P=K(f(m),2),x=v(P);D(x,{onClick:()=>{c(e,"idle")},children:(g,S)=>{var B=E("Try Again");a(g,B)},$$slots:{default:!0}}),a(d,m)},z=d=>{var m=w(),P=f(m);{var x=g=>{var S=me(),B=K(f(S),2),H=v(B);D(H,{onClick:F,children:(Q,he)=>{var R=E("Confirm");a(Q,R)},$$slots:{default:!0}}),a(g,S)};h(P,g=>{n(e)==="confirmAccessKey"&&g(x)},!0)}a(d,m)};h(j,d=>{n(e)==="error"?d(q):d(z,!1)},!0)}a(l,C)};h(b,l=>{n(e)==="confirmingAccessKey"?l(u):l(Y,!1)},!0)}a(o,i)};h(s,o=>{n(e)==="addingAccessKey"?o(y):o($,!1)},!0)}a(r,t)};h(G,r=>{n(e)==="idle"?r(W):r(X,!1)})}a(O,T),ae()}export{we as default};
