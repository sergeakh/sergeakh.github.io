import{p as Y,g as Z,u as ee,h as s,d as j,o as ae,f as p,j as h,c as v,b as a,k as te,s as K,i as l,B as S,v as E,H as re,l as A,m as f,A as se,J as oe,K as I,M as ne,L as J,w as ie,N as le,O as ce}from"./index-Bt3jdqU-.js";import{g as de,a as ve}from"./api-C5JaEwh0.js";import{I as fe}from"./Input-D9LR3nej.js";var pe=p('<form><p class="message error svelte-ey4qps">Enter a name for a key</p> <div class="inputContainer svelte-ey4qps"><!></div> <div class="buttonContainer svelte-ey4qps"><!></div></form>'),ye=p('<p class="message svelte-ey4qps">Adding the access key</p>'),me=p('<p class="message svelte-ey4qps">Confirming</p>'),ue=p('<p class="message error svelte-ey4qps">Something went wrong</p> <div class="buttonContainer svelte-ey4qps"><!></div>',1),ge=p('<p class="message svelte-ey4qps">Confirm this operation with another key</p> <div class="buttonContainer svelte-ey4qps"><!></div>',1),he=p('<div class="content svelte-ey4qps"><!></div>');function we(L,F){Y(F,!0);const{blockDialog:M}=Z();let e=j("idle"),_="",w=null,k=j("");ee(()=>{M(s(e)==="confirmingAccessKey"||s(e)==="addingAccessKey")}),ae(()=>()=>{M(!1)});const T=async t=>{t.preventDefault(),l(e,"addingAccessKey");try{_=await de();const r=await ve(),o=se();if(!o||!o.encryptedClientKey)throw new Error("No account found");const y=await oe({encryptedClientKey:I(o.encryptedClientKey),serverKey:I(r)});w=await ne({challenge:_,clientKey:y}),l(e,"confirmAccessKey")}catch{l(e,"error");return}},H=async()=>{l(e,"confirmingAccessKey");try{const t=await ie({challenge:_});if(!w)throw new Error("No credential data found");if(!(await fetch("/api/addCredential",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({challenge:_,name:s(k)||`key ${Math.floor(Math.random()*1e3)}`,newCredential:w,confirmCredential:t.credentialData})})).ok)throw new Error("Failed to add access key");le(),ce()}catch{l(e,"error");return}};var B=he(),U=v(B);{var z=t=>{var r=pe(),o=K(v(r),2),y=v(o);fe(y,{placeholder:"key name",get value(){return s(k)},set value(i){l(k,i,!0)}});var $=K(o,2),n=v($);S(n,{onClick:T,children:(i,b)=>{var m=E("Add key");a(i,m)},$$slots:{default:!0}}),re("submit",r,T),a(t,r)},G=t=>{var r=A(),o=f(r);{var y=n=>{J(n,{children:(i,b)=>{var m=ye();a(i,m)},$$slots:{default:!0}})},$=n=>{var i=A(),b=f(i);{var m=c=>{J(c,{children:(C,O)=>{var q=me();a(C,q)},$$slots:{default:!0}})},Q=c=>{var C=A(),O=f(C);{var q=d=>{var u=ue(),P=K(f(u),2),x=v(P);S(x,{onClick:()=>{l(e,"idle")},children:(g,D)=>{var N=E("Try Again");a(g,N)},$$slots:{default:!0}}),a(d,u)},R=d=>{var u=A(),P=f(u);{var x=g=>{var D=ge(),N=K(f(D),2),V=v(N);S(V,{onClick:H,children:(W,_e)=>{var X=E("Confirm");a(W,X)},$$slots:{default:!0}}),a(g,D)};h(P,g=>{s(e)==="confirmAccessKey"&&g(x)},!0)}a(d,u)};h(O,d=>{s(e)==="error"?d(q):d(R,!1)},!0)}a(c,C)};h(b,c=>{s(e)==="confirmingAccessKey"?c(m):c(Q,!1)},!0)}a(n,i)};h(o,n=>{s(e)==="addingAccessKey"?n(y):n($,!1)},!0)}a(t,r)};h(U,t=>{s(e)==="idle"?t(z):t(G,!1)})}a(L,B),te()}export{we as default};
