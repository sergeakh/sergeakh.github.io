import{p as G,g as I,A as J,z as M,e as _,h as N,d as V,u as W,i as t,y as A,o as q,f as m,k as C,c as h,b as u,l as Q,j as d,G as X,F as Y,s as w,n as S,L as Z,m as tt,B as et,w as at}from"./index-DGGsS_Lk.js";import{g as rt}from"./api-C5JaEwh0.js";var e=(n=>(n[n.Signup=0]="Signup",n[n.SignupError=1]="SignupError",n))(e||{}),nt=m('<p class="message svelte-apkzbu">signup</p> <!>',1),st=m('<p class="message svelte-apkzbu">error signup</p> <div class="buttonContainer svelte-apkzbu"><div class="buttonContainerItem svelte-apkzbu"><!></div></div>',1),ot=m('<div class="content svelte-apkzbu"><!></div>');function ct(n,x){G(x,!0);const{updateStackPages:P}=I(),{getAccount:U,initCloudAccount:z}=J(),{getAppHistory:B,back:D,closeDialogStack:E,deleteSearchParam:j}=M();let H=A(B),v=A(U),y=_(""),s=_(N(e.Signup));const{blockDialog:l,unBlockBackDialog:f}=V(),k=async()=>{d(s,e.Signup,!0);try{const a=await rt(),r=crypto.getRandomValues(new Uint8Array(32)),o=await X({challenge:a,clientKey:r}),c=await fetch("/api/signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(c.status!==200){d(s,e.SignupError,!0);return}const i=await c.json(),p=t(v)===void 0;if(await z({clientKey:r,serverKey:new Uint8Array(Y(i.serverKey))}),p)l(!1),E();else{l(!1);let g=new URLSearchParams(t(H).search).get("retPath")||"";g&&(d(y,g,!0),j("retPath")),D({to:t(y)}),P()}}catch{d(s,e.SignupError,!0)}};W(()=>{t(v)===null&&l(t(s)===e.Signup),f(t(s)!==e.Signup)}),q(()=>(t(v)===void 0&&(l(!0),f(!1)),k(),()=>{f(!1)}));var b=ot(),K=h(b);{var L=a=>{var r=nt(),o=w(S(r),2);Z(o,{}),u(a,r)},R=a=>{var r=tt(),o=S(r);{var c=i=>{var p=st(),g=w(S(p),2),T=h(g),$=h(T);et($,{onClick:()=>k(),fullWidth:!0,children:(O,it)=>{var F=at("try again");u(O,F)},$$slots:{default:!0}}),u(i,p)};C(o,i=>{t(s)===e.SignupError&&i(c)},!0)}u(a,r)};C(K,a=>{t(s)===e.Signup?a(L):a(R,!1)})}u(n,b),Q()}export{ct as default};
