import{p as k,a as O,N as A,o as C,s as b,O as v,u as x,g as p,f as S,i as _,c as y,b as g,d as N,l,P as j,Q as J,R as u,S as R,T as $,y as q,e as B,h as D,L as H,B as L,t as M}from"./index-BMmQJNiY.js";var r=(s=>(s[s.Signin=0]="Signin",s[s.SigninError=1]="SigninError",s))(r||{}),P=S('<p class="message svelte-9hh95f">signin</p> <!>',1),Q=S('<p class="message svelte-9hh95f">error signin</p> <div class="buttonContainer svelte-9hh95f"><div class="buttonContainerItem svelte-9hh95f"><!></div></div>',1),V=S('<div class="content svelte-9hh95f"><!></div>');function F(s,E){k(E,!0);let n=O(A(r.Signin));const w=async()=>{l(n,r.Signin,!0);try{const a=await fetch("/api/signin/start",{method:"post"}).then(e=>e.json()),o={challenge:j(J(a.challenge)),timeout:6e4,rpId:"localhost",userVerification:"required"};try{const e=await navigator.credentials.get({publicKey:o}),t=e.response;if(e){const c={challenge:a.challenge,id:e.id,rawId:u(e.rawId),type:e.type,response:{authenticatorData:u(t.authenticatorData),clientDataJSON:u(t.clientDataJSON),signature:u(t.signature)}},d=await fetch("/api/signin/finish",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)});if(d.status!==200){l(n,r.SigninError,!0);return}const i=await d.json();if(console.log("responseData: ",i),!i.success||!i.serverKey){console.error("Signin failed: ",i),l(n,r.SigninError,!0);return}if(!t.userHandle){l(n,r.SigninError,!0);return}const f=i.serverKey,h=t.userHandle;await R({credentialId:new Uint8Array(e.rawId),clientKey:new Uint8Array(h),serverKey:new Uint8Array($(f))}),b(!1),q()}else throw new Error}catch(e){l(n,r.SigninError,!0),console.log(e)}}catch(a){l(n,r.SigninError,!0),console.log(a)}};C(()=>(b(!0),v(!1),w(),()=>{v(!1)})),x(()=>{v(p(n)!==r.Signin)});var m=V(),K=y(m);{var I=a=>{var o=P(),e=B(D(o),2);H(e),g(a,o)},T=(a,o)=>{{var e=t=>{var c=Q(),d=B(D(c),2),i=y(d),f=y(i);L(f,{onClick:()=>w(),fullWidth:!0,children:(h,W)=>{var U=M("try again");g(h,U)},$$slots:{default:!0}}),g(t,c)};_(a,t=>{p(n)===r.SigninError&&t(e)},o)}};_(K,a=>{p(n)===r.Signin?a(I):a(T,!1)})}g(s,m),N()}export{F as default};
