import{p as $,A as wt,G as L,u as ot,i as t,e as m,j as r,o as dt,f as y,r as rt,T as K,c as u,s as h,k as U,x as P,S as tt,b as w,l as et,m as bt,n as ut,C as vt,q as at,h as G,D as kt,H as Tt,J as xt,U as lt,B as st,w as it,t as Ct,v as pt}from"./index-BcoJaDVQ.js";import{I as ct}from"./Input-BimZkEGw.js";var yt=(b,e,s,f)=>{t(e)!==""&&s(t(e)),f(!1),r(e,"")},Dt=y('<form class="formNewTag svelte-1dwadiy"><div class="inputWrapper svelte-1dwadiy"><!></div> <button type="button" class="buttonDone svelte-1dwadiy">Done</button></form>'),It=y('<div class="block"><div class="tags svelte-1dwadiy"><!> <!> <!> <!></div> <!></div>');function Nt(b,e){$(e,!0);const{isReadyNotes:s,getGetNotes:f}=wt();let _=m(null),l=m(""),g=m(null);const S=P(s);let v=L(e,"shownTagInput",15);const E=a=>{e.selectedTags.includes(a)||(r(l,""),e.onChangeTags([...e.selectedTags,a]),t(_)?.focus())},I=a=>{const i=e.selectedTags.filter(C=>C!==a);i.length===0?e.onChangeTags([]):e.onChangeTags(i)};let D=P(()=>t(S)?[...(f()()||[]).reduce((a,i)=>(i?.data.tags.forEach(C=>{a.has(C)||a.add(C)}),a),new Set)]:[]),o=P(()=>t(S)?t(D).filter(a=>!e.selectedTags.some(i=>a===i)&&a!=="inbox"):[]),c=P(()=>t(o).find(a=>a.toLowerCase()===t(l).toLowerCase())||e.selectedTags.includes(t(l))),T=P(()=>t(o).filter(a=>t(l)===""?!0:a.toLowerCase().indexOf(t(l).toLowerCase())===0).slice(0,t(c)||t(l)===""?3:2));const p=a=>{a.preventDefault(),t(l)!==""?(E(t(l)),r(l,"")):v(!1)};ot(()=>{t(_)&&v()&&t(_).focus(),v()||r(l,"")});const k=a=>{a.target&&t(g)&&!t(g).contains(a.target)&&(v(!1),r(l,""))};dt(()=>(document.addEventListener("click",k,{capture:!0}),()=>{document.removeEventListener("click",k,{capture:!0})}));var d=It(),x=u(d),B=u(x);rt(B,16,()=>e.selectedTags,a=>a,(a,i)=>{K(a,{get title(){return i},onClick:()=>I(i),type:"button",style:"selected"})});var R=h(B,2);{var Q=a=>{var i=bt(),C=ut(i);rt(C,16,()=>t(T),N=>N,(N,W)=>{K(N,{get title(){return W},onClick:()=>E(W)})}),w(a,i)};U(R,a=>{t(l)!==""&&a(Q)})}var O=h(R,2);{var V=a=>{K(a,{get title(){return t(l)},onClick:()=>{E(t(l)),r(l,"")}})};U(O,a=>{!t(c)&&t(l)!==""&&a(V)})}var X=h(O,2);{var j=a=>{K(a,{title:"add tag",onClick:()=>v(!0)})};U(X,a=>{v()||a(j)})}var q=h(x,2);{var Y=a=>{var i=Dt(),C=u(i),N=u(C);ct(N,{placeholder:"tag",get ref(){return t(_)},set ref(F){r(_,F,!0)},get value(){return t(l)},set value(F){r(l,F,!0)}});var W=h(C,2);W.__click=[yt,l,E,v],vt("submit",i,p),w(a,i)};U(q,a=>{v()&&a(Y)})}tt(d,a=>r(g,a),()=>t(g)),w(b,d),et()}at(["click"]);var Ut=(b,e,s,f)=>{r(e,s.url,!0),f(!1)},Et=(b,e,s,f,_)=>{if(t(e)&&t(s)){r(e,"");return}f.onChangeUrl(t(e)),_(!1)},Lt=y('<div class="wrapper svelte-w8w68w"><!> <div class="containerButtons svelte-w8w68w"><button class="svelte-w8w68w">Cancel</button> <button class="svelte-w8w68w">Done</button></div></div>'),St=(b,e)=>{e(!0)},Bt=(b,e,s)=>{r(e,""),s.onDeleteUrl()},Rt=y('<button class="button svelte-w8w68w">Edit link</button> <button class="button svelte-w8w68w">Delete link</button>',1),Wt=(b,e)=>{e(!0)},At=y('<button class="button svelte-w8w68w">Add link</button>'),Mt=y('<div class="wrapperButtons svelte-w8w68w"><!></div>'),Ft=y("<div><!></div>");function Ht(b,e){$(e,!0);let s=L(e,"shownUrlInput",15),f=m(""),_=m(null),l=m(null),g=m(G(e.url));const S=o=>{r(f,""),r(g,o.target.value||"",!0);try{new URL(t(g))}catch{r(f,"Invalid URL")}};ot(()=>{s()&&t(_)?.focus()});var v=Ft(),E=u(v);{var I=o=>{var c=Lt(),T=u(c);ct(T,{get value(){return t(g)},get error(){return t(f)},onInput:S,placeholder:"url",get ref(){return t(_)},set ref(x){r(_,x,!0)}});var p=h(T,2),k=u(p);k.__click=[Ut,g,e,s];var d=h(k,2);d.__click=[Et,g,f,e,s],w(o,c)},D=o=>{var c=Mt(),T=u(c);{var p=d=>{var x=Rt(),B=ut(x);B.__click=[St,s];var R=h(B,2);R.__click=[Bt,g,e],w(d,x)},k=d=>{var x=At();x.__click=[Wt,s],w(d,x)};U(T,d=>{e.url?d(p):d(k,!1)})}w(o,c)};U(E,o=>{s()?o(I):o(D,!1)})}tt(v,o=>r(l,o),()=>t(l)),w(b,v),et()}at(["click"]);const Pt=(b,e,s)=>{t(e)&&(t(e).style.height="auto",t(e).style.height=t(e).scrollHeight+"px"),s()},Gt=(b,e)=>{e()};var Ot=y("<span> </span>"),jt=y('<div class="dateInfo svelte-t8fgpr"><!></div>'),qt=y('<div class="submitButtons svelte-t8fgpr"><!> <!></div>'),Jt=y('<div class="form svelte-t8fgpr"><div class="scrollWrapper"><div class="formFields"><!> <form><input class="inputName svelte-t8fgpr" placeholder="Name"/></form> <textarea placeholder="Note" class="svelte-t8fgpr"></textarea></div></div> <div><!> <div class="formTagsWrapper svelte-t8fgpr"><!></div> <!></div></div>');function Qt(b,e){$(e,!0);const{deleteDraft:s,putDraft:f}=kt();let _=L(e,"initialName",3,""),l=L(e,"initialUrl",3,""),g=L(e,"initialText",3,""),S=L(e,"initialTags",19,()=>[]),v=L(e,"noteId",3,""),E=L(e,"mode",3,"add"),I=m(G(e.draft?.data.name||_())),D=m(G(e.draft?.data.url||l())),o=m(G(e.draft?.data.text||g())),c=m(G((e.draft?.data.tags||S()).filter(n=>n!=="inbox"))),T=m(null),p=m(!1),k=m(!1);const d=()=>{const n={id:v(),data:{name:t(I),url:t(D),text:t(o),tags:t(c).map(A=>A.trim())}};f(n)},x=n=>{n.preventDefault(),s(v()),e.onSubmit({name:t(I).trim().slice(0,256)||"unkwown",url:t(D).trim().slice(0,2048),text:t(o).trim().slice(0,2048),tags:t(c).length>0?t(c):["inbox"]})},B=n=>{n.preventDefault(),t(T)&&t(T).focus()},R=n=>{n.key==="Escape"&&(document.activeElement instanceof HTMLInputElement&&document.activeElement.type==="text"||document.activeElement instanceof HTMLTextAreaElement)&&(t(p)&&r(p,!1),t(k)&&r(k,!1),document.activeElement.blur(),n.preventDefault(),n.stopPropagation())};dt(()=>(document.addEventListener("keydown",R),()=>document.removeEventListener("keydown",R)));const Q=n=>{r(D,n,!0),d()},O=()=>{r(D,""),d()},V=n=>{r(c,n,!0),d()},X=()=>{s(v()),r(I,_()),r(D,l()),r(o,g()),r(c,S(),!0)};var j=Jt(),q=u(j),Y=u(q),a=u(Y);Ht(a,{get url(){return t(D)},onChangeUrl:Q,onDeleteUrl:O,get shownUrlInput(){return t(k)},set shownUrlInput(n){r(k,n,!0)}});var i=h(a,2),C=u(i);C.__input=[Gt,d];var N=h(i,2);N.__input=[Pt,T,d],tt(N,n=>r(T,n),()=>t(T));var W=h(q,2);Tt(W,1,xt(["bottom","bottomSpace"]),"svelte-t8fgpr");var F=u(W);{var ft=n=>{var A=jt(),J=u(A);{var Z=M=>{var z=Ot(),H=u(z);Ct(ht=>pt(H,`updated: ${ht??""}`),[()=>new Date(e.updatedAt).toLocaleString()]),w(M,z)};U(J,M=>{e.updatedAt&&M(Z)})}w(n,A)};U(F,n=>{E()==="edit"&&n(ft)})}var nt=h(F,2),_t=u(nt);Nt(_t,{get selectedTags(){return t(c)},onChangeTags:V,get shownTagInput(){return t(p)},set shownTagInput(n){r(p,n,!0)}});var gt=h(nt,2);{var mt=n=>{var A=qt(),J=u(A);st(J,{fullWidth:!0,withoutMinWidth:!0,onClick:X,type:"secondary",typeButton:"button",children:(M,z)=>{var H=it("cancel");w(M,H)},$$slots:{default:!0}});var Z=h(J,2);st(Z,{fullWidth:!0,withoutMinWidth:!0,onClick:x,typeButton:"submit",children:(M,z)=>{var H=it("save");w(M,H)},$$slots:{default:!0}}),w(n,A)};U(gt,n=>{!t(p)&&!t(k)&&e.draft&&n(mt)})}vt("submit",i,B),lt(C,()=>t(I),n=>r(I,n)),lt(N,()=>t(o),n=>r(o,n)),w(b,j),et()}at(["input"]);export{Qt as N};
