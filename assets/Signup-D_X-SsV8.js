import{p as J,g as M,z as N,y as V,e as _,h as W,d as q,u as F,i as e,x as w,o as G,f as S,k as A,c as h,b as l,l as Q,j as d,s as x,n as m,L as X,m as Y,B as Z,w as ee}from"./index-CtgUzf3X.js";import{g as te,d as ae,c as re,e as ne}from"./webauthn-Dy13XHj8.js";import{e as se}from"./crypto-Cpa8lgv9.js";var t=(n=>(n[n.Signup=0]="Signup",n[n.SignupError=1]="SignupError",n))(t||{}),oe=S('<p class="message svelte-apkzbu">signup</p> <!>',1),ie=S('<p class="message svelte-apkzbu">error signup</p> <div class="buttonContainer svelte-apkzbu"><div class="buttonContainerItem svelte-apkzbu"><!></div></div>',1),le=S('<div class="content svelte-apkzbu"><!></div>');function de(n,U){J(U,!0);const{updateStackPages:B}=M(),{getAccount:P,initCloudAccount:z}=N(),{getAppHistory:K,back:D,closeDialogStack:E,deleteSearchParam:T}=V();let j=w(K),f=w(P),k=_(""),s=_(W(t.Signup));const{blockDialog:u,unBlockBackDialog:v}=q(),b=async()=>{d(s,t.Signup,!0);try{const a=await te(),r=crypto.getRandomValues(new Uint8Array(32)),o=await ae({challenge:a,clientKey:r}),c=await fetch("/api/signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(c.status!==200){d(s,t.SignupError,!0);return}const i=await c.json(),p=e(f)===void 0,{encryptedClientKey:y}=await se({clientKey:r,serverKey:new Uint8Array(re(i.serverKey))});if(await z({encryptedClientKey:ne(y)}),p)u(!1),E();else{u(!1);let g=new URLSearchParams(e(j).search).get("retPath")||"";g&&(d(k,g,!0),T("retPath")),D({to:e(k)}),B()}}catch{d(s,t.SignupError,!0)}};F(()=>{e(f)===null&&u(e(s)===t.Signup),v(e(s)!==t.Signup)}),G(()=>(e(f)===void 0&&(u(!0),v(!1)),b(),()=>{v(!1)}));var C=le(),H=h(C);{var L=a=>{var r=oe(),o=x(m(r),2);X(o,{}),l(a,r)},R=a=>{var r=Y(),o=m(r);{var c=i=>{var p=ie(),y=x(m(p),2),g=h(y),$=h(g);Z($,{onClick:()=>b(),fullWidth:!0,children:(O,ue)=>{var I=ee("try again");l(O,I)},$$slots:{default:!0}}),l(i,p)};A(o,i=>{e(s)===t.SignupError&&i(c)},!0)}l(a,r)};A(H,a=>{e(s)===t.Signup?a(L):a(R,!1)})}l(n,C),Q()}export{de as default};
