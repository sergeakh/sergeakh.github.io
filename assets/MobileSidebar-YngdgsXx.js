import{p as J,W as te,o as Q,k as Z,aj as ne,ak as oe,al as ie,u as W,am as ae,an as x,h as e,d as X,x as B,f as se,m as j,j as F,c as z,a4 as U,i as q,s as G,t as re,X as le,Y as ce,b as K,ao as de,l as ue,ap as me,aq as fe}from"./index-CUvVM58n.js";function he(R,t){J(t,!0);let s=te(t,"dialog",7);const O=3,_=50,i=5,T=.6,l=.3,S=.35,P=.95;let M=0,g=0,k=0,b=!1,u=!1,v=0,m=0,h=0;const y=()=>{M=0,g=0,b=!1,u=!1,v=0,m=0,h=0,k=0,d!==null&&(cancelAnimationFrame(d),d=null),w=null};let d=null,w=null;const C=n=>{if(!s()){console.warn("Touch start: No dialog element");return}if(t.sidebarState!=="opened"&&t.sidebarState!=="closed"){console.warn(`Touch start: Invalid sidebar state: ${t.sidebarState}`);return}M=n.touches[0].clientX,g=n.touches[0].clientY,k=performance.now(),b=!0,u=!1},A=n=>t.sidebarState==="closed"&&n>0||t.sidebarState==="closeSwiping"&&n>0||t.sidebarState==="opened"&&n<0||t.sidebarState==="openSwiping"&&n<0,N=()=>{if(s()){if(s().style.setProperty("--transition-timing","0s"),!s().open&&t.sidebarState==="closed")try{s().showModal(),s().offsetWidth}catch(n){console.error("Error opening dialog:",n);return}t.onSwipe();try{const n=window.getComputedStyle(s()),a=n.transform||n.webkitTransform||"";if(m=s().offsetWidth,t.sidebarState==="closeSwiping"||t.sidebarState==="closed"?v=-m:(t.sidebarState==="openSwiping"||t.sidebarState==="opened")&&(v=0),a&&a!=="none")try{v=new DOMMatrix(a).m41}catch{console.warn("Could not parse transform matrix, using default position")}u=!0}catch(n){console.error("Error during swipe initialization:",n),y()}}},Y=()=>{if(!s())return;const n=-(m*.27),a=-m;let r=0;const c=window.getComputedStyle(s()),E=c.transform||c.webkitTransform||"";if(E&&E!=="none")try{r=new DOMMatrix(E).m41}catch{r=0}const H=.25*Math.min(1,Math.max(0,(r-a)/(n-a)));s().style.setProperty("--backdrop-bg",`rgba(0, 0, 0, ${H})`)},o=()=>{if(d=null,!w||!b||!s()||ne())return;const{x:n,y:a}=w;w=null;const r=n-M,c=a-g,E=Math.abs(r)>Math.abs(c),D=Math.abs(r)>O;if(!u)if(E&&D&&A(r))try{N()}catch(ee){console.error("Error initializing swipe:",ee),y();return}else return;if(!A(r))return;s().style.setProperty("--transition-timing","0s");let p=v+r*P;const H=-m,L=-(m*.27);p=Math.max(H,Math.min(L,p)),s().style.transform=`translate3d(${p}px, 0, 0)`,h=(p-v)/m*100,Y()},f=n=>{if(!b)return;const a=n.touches[0].clientX,r=n.touches[0].clientY;w={x:a,y:r},d===null&&(d=requestAnimationFrame(o)),u&&Math.abs(a-M)>Math.abs(r-g)&&n.preventDefault()},V=n=>{const a=Math.abs(n);if(a>=T)return i;if(a>=l){const r=(a-l)/(T-l);return _-r*(_-i)}else return _},$=(n,a)=>{if(Math.abs(n)>=T)return S*.5;const c=Math.abs(h)/100;return a?S*Math.max(.5,1-c):S*Math.max(.5,c)},I=n=>{if(d!==null&&(cancelAnimationFrame(d),d=null),w=null,!b||!s()){y();return}if(!u){y();return}let a=0;if(n?.changedTouches?.[0]){const p=n.changedTouches[0].clientX,L=performance.now()-k;L>0&&(a=(p-M)/L)}const r=V(a);let c=null;t.sidebarState==="closeSwiping"?c=Math.abs(h)>r||a>l?"open":"close":t.sidebarState==="openSwiping"&&(c=Math.abs(h)>r||a<-l?"close":"open");const E=t.sidebarState==="closeSwiping"&&c==="open"||t.sidebarState==="openSwiping"&&c==="close",D=$(a,E);s().style.setProperty("--transition-timing",`${D}s`),s().offsetWidth,s().style.transform="",c==="open"?t.onOpen():c==="close"&&t.onClose(),s()?.style.removeProperty("--backdrop-bg"),y()};Q(()=>(document.addEventListener("touchstart",C,{passive:!0}),document.addEventListener("touchmove",f,{passive:!1}),document.addEventListener("touchend",I,{passive:!0}),document.addEventListener("touchcancel",I,{passive:!0}),()=>{document.removeEventListener("touchstart",C),document.removeEventListener("touchmove",f),document.removeEventListener("touchend",I),document.removeEventListener("touchcancel",I),d!==null&&cancelAnimationFrame(d)})),Z()}var ge=se('<dialog><div class="dialogInner svelte-jwdaua"><!></div></dialog> <!> <!>',1);function Se(R,t){J(t,!0);let s=350;const O=oe(),{isScrolling:_}=ie();let i=X(null),T=X(null),l=B(de);W(()=>{ae().length>0&&x({type:"close"})});const S=()=>{t.blocked||x({type:"close"})},P=()=>{t.blocked||x({type:"open"})},M=()=>{x({type:"opened"})},g=()=>{x({type:"closed"})},k=()=>{x({type:"swipe"})},b=o=>{o.preventDefault(),S()};Q(()=>(e(i)?.addEventListener("close",g),e(i)?.addEventListener("cancel",b),()=>{e(i)?.removeEventListener("close",g),e(i)?.removeEventListener("cancel",b)}));const u=()=>{e(i)?.style.removeProperty("--transition-timing"),e(i)?.style.removeProperty("transform"),e(i)?.style.removeProperty("--backdrop-bg")},v=B(_);W(()=>{if(e(l),!!e(i))switch(e(l).type){case"closeSwiping":{const o=setTimeout(()=>{S()},3e3);return()=>{clearTimeout(o)}}case"openSwiping":{const o=setTimeout(()=>{P()},3e3);return()=>{clearTimeout(o)}}case"opening":{e(i).open||e(i).showModal(),e(i).getBoundingClientRect();const o=setTimeout(()=>{u()},s+1),f=()=>{clearTimeout(o),u()};return e(i)?.addEventListener("transitionend",f,{once:!0}),M(),()=>{e(i)?.removeEventListener("transitionend",f)}}case"closing":{const o=setTimeout(()=>{e(l).type==="closing"&&g()},s+1),f=()=>{clearTimeout(o),g()};return e(i)?.addEventListener("transitionend",f,{once:!0}),()=>{e(i)?.removeEventListener("transitionend",f)}}case"closed":e(i)?.close(),u();break;case"opened":u();break}});var m=ge(),h=j(m),y=z(h),d=z(y);{var w=o=>{var f=ue(),V=j(f);me(V,()=>t.children),K(o,f)};F(d,o=>{e(l).type!=="closed"&&o(w)})}U(y,o=>q(T,o),()=>e(T)),U(h,o=>q(i,o),()=>e(i));var C=G(h,2);{var A=o=>{fe(o,{get dialog(){return e(i)},get dialogInner(){return e(T)},onClose:S})};F(C,o=>{e(l).type==="opened"&&!t.blocked&&o(A)})}var N=G(C,2);{var Y=o=>{he(o,{onClose:S,onOpen:P,onSwipe:k,get sidebarState(){return e(l).type},get dialog(){return e(i)}})};F(N,o=>{(!e(v)&&e(l).type==="closed"||e(l).type==="opened"||e(l).type==="openSwiping"||e(l).type==="closeSwiping")&&!t.blocked&&o(Y)})}re(()=>le(h,1,ce([{open:e(l).type==="opened",hidden:t.blocked,isAnimationOn:O.working&&(!O.isSwiping||!t.blocked)}]),"svelte-jwdaua")),K(R,m),Z()}export{Se as default};
