import{p as j,g as I,d as w,e as L,u as O,h as n,x as T,o as $,f as y,j as A,c as S,b as l,k as R,A as F,i as c,w as G,af as H,K as J,G as M,ag as N,ah as W,O as q,ai as z,s as C,m,L as Q,l as V,B as X,v as Y}from"./index-Bt3jdqU-.js";import{g as Z}from"./api-C5JaEwh0.js";var e=(r=>(r[r.Signin=0]="Signin",r[r.SigninError=1]="SigninError",r))(e||{}),ee=y('<p class="message svelte-9hh95f">signin</p> <!>',1),ae=y('<p class="message svelte-9hh95f">error signin</p> <div class="buttonContainer svelte-9hh95f"><div class="buttonContainerItem svelte-9hh95f"><!></div></div>',1),te=y('<div class="content svelte-9hh95f"><!></div>');function ie(r,E){j(E,!0);const{blockDialog:g,unBlockBackDialog:v}=I();let h=T(F),_=w(""),t=w(L(e.Signin));const b=async()=>{c(t,e.Signin,!0);try{const a=await Z(),{credentialData:s,clientKey:o}=await G({challenge:a}),f=await fetch("/api/signin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(f.status!==200){c(t,e.SigninError,!0);return}const i=await f.json();if(!i.serverKey){c(t,e.SigninError,!0);return}const u=i.serverKey,p=n(h)===void 0;if(await H({clientKey:o,serverKey:new Uint8Array(J(u))}),p)g(!1),M();else{g(!1);let d=new URLSearchParams(N.search).get("retPath")||"";d&&(c(_,d,!0),W("retPath")),q({to:n(_)}),z()}}catch{c(t,e.SigninError,!0)}};O(()=>{n(h)===null&&g(n(t)===e.Signin),v(n(t)!==e.Signin)}),$(()=>(n(h)===void 0&&(g(!0),v(!1)),b(),()=>{v(!1)}));var k=te(),P=S(k);{var x=a=>{var s=ee(),o=C(m(s),2);Q(o,{}),l(a,s)},B=a=>{var s=V(),o=m(s);{var f=i=>{var u=ae(),p=C(m(u),2),d=S(p),D=S(d);X(D,{onClick:()=>b(),fullWidth:!0,children:(K,ne)=>{var U=Y("try again");l(K,U)},$$slots:{default:!0}}),l(i,u)};A(o,i=>{n(t)===e.SigninError&&i(f)},!0)}l(a,s)};A(P,a=>{n(t)===e.Signin?a(x):a(B,!1)})}l(r,k),R()}export{ie as default};
