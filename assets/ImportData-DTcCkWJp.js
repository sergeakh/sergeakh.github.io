import{Q as re,p as oe,d as ne,A as le,y as ie,R as ce,u as de,i as c,e as I,o as ve,f as k,k as E,c as y,b as s,l as pe,s as j,n as x,m as J,B as z,w as H,S as B,j as d,t as fe,H as ge,J as ue,C as M,L as me,q as _e}from"./index-BcoJaDVQ.js";const R=(D,u,r,m=new Set,v={})=>{for(const t of D.children)if(t.tagName==="DT"){const p=t.querySelector(":scope > A"),_=t.querySelector(":scope > H3");if(p){const f=p.getAttribute("href"),S=p.textContent||"unknown";if(!f)return r;const b=u.find(h=>h.toLowerCase()==="bookmarks bar")?u.filter(h=>h.toLowerCase()!=="bookmarks bar"):["other"];if(v[f])v[f].data.tags=[...new Set([...v[f].data.tags,...b])];else{const h={id:re(),data:{url:f,name:S,text:"",tags:b.length>0?b:[],updatedAt:Date.now(),createdAt:Date.now()}};v[h.data.url]=h,r.push(h)}}else if(_){const f=_.textContent?.trim();if(f&&_.nextElementSibling?.tagName==="DL"){const S=[...u];S.push(f);const b=_.nextElementSibling;m.has(b)||(m.add(b),R(b,S,r,m,v))}}}else t.tagName!=="DL"&&t.children.length>0&&(m.has(t)||(m.add(t),R(t,[...u],r,m,v)));return r},be=async D=>{const u=await D.text(),v=new DOMParser().parseFromString(u,"text/html").querySelector("DL");return v?R(v,[],[]):[]},U=async(D,u)=>{const r=D.target;!r.files||r.files.length===0||await u(r.files[0])};var he=k('<div class="mobileContainer svelte-1gjle5b"><!></div> <input type="file" accept=".json, .html" style="display: none;"/>',1),we=k('<div class="desktopContainer svelte-1gjle5b"><div class="desktopButtonContainer svelte-1gjle5b"><!></div> <div role="button" tabindex="-1"><div tabindex="-1" class="dropzone-content svelte-1gjle5b"><p class="svelte-1gjle5b">Drag and drop your file here</p> <p class="svelte-1gjle5b">or</p></div> <input type="file" accept=".json, .html" style="display: none;"/></div></div>'),xe=k('<p class="message svelte-1gjle5b">Select a file to import your data</p> <!>',1),De=k('<p class="message svelte-1gjle5b">Importing data...</p> <!>',1),ye=k('<p class="message success svelte-1gjle5b">Data imported successfully!</p> <div class="buttonContainer svelte-1gjle5b"><!></div>',1),je=k('<p class="message error svelte-1gjle5b">Something went wrong</p> <div class="buttonContainer svelte-1gjle5b"><!></div>',1),ke=k('<div class="content svelte-1gjle5b"><!></div>');function Pe(D,u){oe(u,!0);const{blockDialog:r}=ne(),{importNotes:m}=le(),{closeDialogStack:v}=ie();let t=I("idle"),p=I(null),_=I(!1),f=I(null);const{checkMobileSize:S}=ce(),b=()=>{v()};de(()=>{r(c(t)==="loading")}),ve(()=>(c(p)&&c(p).addEventListener("cancel",e=>{e.preventDefault(),e.stopImmediatePropagation(),e.stopPropagation()}),()=>{r(!1)}));const h=async e=>{const a=await e.text(),C=JSON.parse(a),P=[];if(!C.notes)throw new Error("Invalid import file format");for(const L of Object.values(C.notes))L&&P.push(L);await m(P)},N=async e=>{d(t,"loading");try{if(e.name.endsWith(".json"))await h(e);else if(e.name.endsWith(".html"))await m(await be(e));else throw new Error("Unsupported file format. Please upload a JSON or HTML file.");await new Promise(a=>setTimeout(a,500)),d(t,"success")}catch{d(t,"error")}},W=()=>{c(p)?.click()},G=e=>{e.preventDefault(),e.stopPropagation(),d(_,!0)},K=e=>{e.preventDefault(),e.stopPropagation(),d(_,!1)},V=e=>{e.preventDefault(),e.stopPropagation(),d(_,!0)},X=async e=>{if(e.preventDefault(),e.stopPropagation(),d(_,!1),!e.dataTransfer?.files||e.dataTransfer.files.length===0)return;const a=e.dataTransfer.files[0];if(a.type!=="application/json"&&a.type!=="text/html"){d(t,"error");return}await N(a)};var Q=ke(),Y=y(Q);{var Z=e=>{var a=xe(),C=j(x(a),2);{var P=o=>{var g=he(),w=x(g),F=y(w);z(F,{onClick:W,children:(n,i)=>{var T=H("Select File");s(n,T)},$$slots:{default:!0}});var l=j(w,2);l.__change=[U,N],B(l,n=>d(p,n),()=>c(p)),s(o,g)},L=o=>{var g=we(),w=y(g),F=y(w);z(F,{onClick:W,children:(i,T)=>{var $=H("Select File");s(i,$)},$$slots:{default:!0}});var l=j(w,2),n=j(y(l),2);n.__change=[U,N],B(n,i=>d(p,i),()=>c(p)),B(l,i=>d(f,i),()=>c(f)),fe(()=>ge(l,1,ue(["dropzone",{active:c(_)}]),"svelte-1gjle5b")),M("dragenter",l,G),M("dragover",l,V),M("dragleave",l,K),M("drop",l,X),s(o,g)};E(C,o=>{S()?o(P):o(L,!1)})}s(e,a)},ee=e=>{var a=J(),C=x(a);{var P=o=>{var g=De(),w=j(x(g),2);me(w,{}),s(o,g)},L=o=>{var g=J(),w=x(g);{var F=n=>{var i=ye(),T=j(x(i),2),$=y(T);z($,{onClick:b,children:(A,O)=>{var q=H("close");s(A,q)},$$slots:{default:!0}}),s(n,i)},l=n=>{var i=J(),T=x(i);{var $=A=>{var O=je(),q=j(x(O),2),te=y(q);z(te,{onClick:()=>{d(t,"idle")},children:(ae,Se)=>{var se=H("Try Again");s(ae,se)},$$slots:{default:!0}}),s(A,O)};E(T,A=>{c(t)==="error"&&A($)},!0)}s(n,i)};E(w,n=>{c(t)==="success"?n(F):n(l,!1)},!0)}s(o,g)};E(C,o=>{c(t)==="loading"?o(P):o(L,!1)},!0)}s(e,a)};E(Y,e=>{c(t)==="idle"?e(Z):e(ee,!1)})}s(D,Q),pe()}_e(["change"]);export{Pe as default};
