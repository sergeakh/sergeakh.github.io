import{p as j,g as I,d as w,e as L,u as T,h as n,w as $,o as F,f as y,j as C,c as S,b as l,k as J,z as O,i as c,ab as R,F as z,ac as H,ad as M,J as N,ae as W,s as E,m,L as q,l as G,B as Q,v as V}from"./index-BmNZNyoD.js";import{g as X,a as Y,c as Z}from"./webauthn-CIYiTW38.js";var e=(r=>(r[r.Signin=0]="Signin",r[r.SigninError=1]="SigninError",r))(e||{}),ee=y('<p class="message svelte-9hh95f">signin</p> <!>',1),ae=y('<p class="message svelte-9hh95f">error signin</p> <div class="buttonContainer svelte-9hh95f"><div class="buttonContainerItem svelte-9hh95f"><!></div></div>',1),te=y('<div class="content svelte-9hh95f"><!></div>');function ie(r,P){j(P,!0);const{blockDialog:g,unBlockBackDialog:v}=I();let h=$(O),_=w(""),t=w(L(e.Signin));const b=async()=>{c(t,e.Signin,!0);try{const a=await X(),{credentialData:s,clientKey:o}=await Y({challenge:a}),f=await fetch("/api/signin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(f.status!==200){c(t,e.SigninError,!0);return}const i=await f.json();if(!i.serverKey){c(t,e.SigninError,!0);return}const d=i.serverKey,p=n(h)===void 0;if(await R({clientKey:o,serverKey:new Uint8Array(Z(d))}),p)g(!1),z();else{g(!1);let u=new URLSearchParams(H.search).get("retPath")||"";u&&(c(_,u,!0),M("retPath")),N({to:n(_)}),W()}}catch{c(t,e.SigninError,!0)}};T(()=>{n(h)===null&&g(n(t)===e.Signin),v(n(t)!==e.Signin)}),F(()=>(n(h)===void 0&&(g(!0),v(!1)),b(),()=>{v(!1)}));var k=te(),A=S(k);{var B=a=>{var s=ee(),o=E(m(s),2);q(o,{}),l(a,s)},D=a=>{var s=G(),o=m(s);{var f=i=>{var d=ae(),p=E(m(d),2),u=S(p),x=S(u);Q(x,{onClick:()=>b(),fullWidth:!0,children:(K,ne)=>{var U=V("try again");l(K,U)},$$slots:{default:!0}}),l(i,d)};C(o,i=>{n(t)===e.SigninError&&i(f)},!0)}l(a,s)};C(A,a=>{n(t)===e.Signin?a(B):a(D,!1)})}l(r,k),J()}export{ie as default};
