import{p as K,d as w,e as L,g as R,u as T,h as r,w as $,o as J,f as S,j as k,c as h,b as l,k as O,z,i as d,ab as F,F as H,ac as I,ad as M,J as N,ae as V,s as U,m,L as W,l as q,B as G,v as Q}from"./index-DpPWH1K4.js";import{g as X,d as Y,c as Z}from"./webauthn-CIYiTW38.js";var a=(s=>(s[s.Signup=0]="Signup",s[s.SignupError=1]="SignupError",s))(a||{}),aa=S('<p class="message svelte-9hh95f">signup</p> <!>',1),ea=S('<p class="message svelte-9hh95f">error signup</p> <div class="buttonContainer svelte-9hh95f"><div class="buttonContainerItem svelte-9hh95f"><!></div></div>',1),ta=S('<div class="content svelte-9hh95f"><!></div>');function ia(s,A){K(A,!0);let f=$(z),y=w(""),n=w(L(a.Signup));const{blockDialog:u,unBlockBackDialog:v}=R(),_=async()=>{d(n,a.Signup,!0);try{const e=await X(),t=crypto.getRandomValues(new Uint8Array(32)),i=await Y({challenge:e,clientKey:t}),c=await fetch("/api/signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(c.status!==200){d(n,a.SignupError,!0);return}const o=await c.json(),p=r(f)===void 0;if(await F({clientKey:t,serverKey:new Uint8Array(Z(o.serverKey))}),p)u(!1),H();else{u(!1);let g=new URLSearchParams(I.search).get("retPath")||"";g&&(d(y,g,!0),M("retPath")),N({to:r(y)}),V()}}catch{d(n,a.SignupError,!0)}};T(()=>{r(f)===null&&u(r(n)===a.Signup),v(r(n)!==a.Signup)}),J(()=>(r(f)===void 0&&(u(!0),v(!1)),_(),()=>{v(!1)}));var b=ta(),C=h(b);{var P=e=>{var t=aa(),i=U(m(t),2);W(i,{}),l(e,t)},B=e=>{var t=q(),i=m(t);{var c=o=>{var p=ea(),g=U(m(p),2),x=h(g),D=h(x);G(D,{onClick:()=>_(),fullWidth:!0,children:(E,ra)=>{var j=Q("try again");l(E,j)},$$slots:{default:!0}}),l(o,p)};k(i,o=>{r(n)===a.SignupError&&o(c)},!0)}l(e,t)};k(C,e=>{r(n)===a.Signup?e(P):e(B,!1)})}l(s,b),O()}export{ia as default};
