import{p as j,d as w,e as I,o as L,h as s,x as O,g as v,aa as h,u as T,f as m,j as A,c as p,b as l,k as $,A as R,i as c,w as F,ab as G,K as H,G as J,ac as M,ad as N,O as W,ae as q,s as B,m as S,L as z,l as Q,B as V,v as X}from"./index-WhMV9zYE.js";import{g as Y}from"./api-C5JaEwh0.js";var e=(t=>(t[t.Signin=0]="Signin",t[t.SigninError=1]="SigninError",t))(e||{}),Z=m('<p class="message svelte-9hh95f">signin</p> <!>',1),ee=m('<p class="message svelte-9hh95f">error signin</p> <div class="buttonContainer svelte-9hh95f"><div class="buttonContainerItem svelte-9hh95f"><!></div></div>',1),ae=m('<div class="content svelte-9hh95f"><!></div>');function se(t,E){j(E,!0);let y=O(R),_=w(""),r=w(I(e.Signin));const b=async()=>{c(r,e.Signin,!0);try{const a=await Y(),{credentialData:n,clientKey:o}=await F({challenge:a}),g=await fetch("/api/signin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(g.status!==200){c(r,e.SigninError,!0);return}const i=await g.json();if(!i.serverKey){c(r,e.SigninError,!0);return}const d=i.serverKey,u=s(y)===void 0;if(await G({clientKey:o,serverKey:new Uint8Array(H(d))}),u)v(!1),J();else{v(!1);let f=new URLSearchParams(M.search).get("retPath")||"";f&&(c(_,f,!0),N("retPath")),W({to:s(_)}),q()}}catch{c(r,e.SigninError,!0)}};L(()=>(s(y)===void 0&&(v(!0),h(!1)),b(),()=>{h(!1)})),T(()=>{v(s(r)===e.Signin),h(s(r)!==e.Signin)});var k=ae(),P=p(k);{var C=a=>{var n=Z(),o=B(S(n),2);z(o,{}),l(a,n)},K=a=>{var n=Q(),o=S(n);{var g=i=>{var d=ee(),u=B(S(d),2),f=p(u),x=p(f);V(x,{onClick:()=>b(),fullWidth:!0,children:(D,re)=>{var U=X("try again");l(D,U)},$$slots:{default:!0}}),l(i,d)};A(o,i=>{s(r)===e.SigninError&&i(g)},!0)}l(a,n)};A(P,a=>{s(r)===e.Signin?a(C):a(K,!1)})}l(t,k),$()}export{se as default};
