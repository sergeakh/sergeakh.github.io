import{p as ie,a as M,G as ve,u as R,s as V,g as t,o as de,m as i,f as l,i as v,c as n,b as a,d as pe,L as z,k as B,h,w as me,e as d,N as fe,O as ue,P as G,n as ye,Q as _e,V as ge,t as E,R as he,M as we,B as J,T as Ae,U as Ke,W as ke,X as Q}from"./index-BaTAiCAr.js";import{g as Pe}from"./api-7nXQQ8YG.js";var be=l('<p class="message svelte-ws3cpm">Loading access keys</p>'),Ce=l('<p class="message svelte-ws3cpm">Confirming</p>'),De=(F,w,e)=>w(t(e).id),$e=l('<button class="buttonDelete svelte-ws3cpm"><!> <!></button>'),xe=l('<li class="svelte-ws3cpm"><div class="keyInfo svelte-ws3cpm"><div><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper></div> <div class="keyName svelte-ws3cpm"> </div></div> <div class="keyActions svelte-ws3cpm"><!></div></li>'),Se=l('<p class="message error svelte-ws3cpm">Error deleting access key</p>'),Te=l('<div class="buttonContainer svelte-ws3cpm"><!></div>'),je=l('<p class="message svelte-ws3cpm">You have reached the maximum number of access keys.</p>'),Le=l('<p class="message svelte-ws3cpm">Access Keys</p> <ul class="svelte-ws3cpm"></ul> <!> <!>',1),Oe=l('<p class="message error svelte-ws3cpm">Something went wrong</p> <div class="buttonContainer svelte-ws3cpm"><!></div>',1),Be=l('<div class="content svelte-ws3cpm"><!></div>');function Ne(F,w){ie(w,!0);let e=M("loadingAccessKeys"),A=M(ve([]));R(()=>{V(t(e)==="loadingAccessKeys"||t(e)==="confirmingDeleteAccessKey")}),de(()=>()=>{V(!1)}),R(()=>{if(!w.hidden&&t(e)==="successAccessKeys"||t(e)==="loadingAccessKeys"){const s=new AbortController;return(async()=>{try{const c=await fetch("/api/auth/accessKeys",{method:"POST",signal:s.signal});if(!c.ok)throw new Error("Failed to fetch access keys");const p=await c.json();i(A,p.credentials||[],!0),i(e,"successAccessKeys")}catch{i(e,"errorAccessKeys")}})(),()=>{s.abort()}}});const W=()=>{const s=ke();s.includes("confirmAccessKey")||s.push("confirmAccessKey");const c=new URLSearchParams(Q.search);return c.set("stackPages",s.join(",")),`${Q.pathname}?${c}`},X=s=>{s.preventDefault(),Ke("confirmAccessKey")},Y=async s=>{i(e,"confirmingDeleteAccessKey");try{const c=await Pe(),p=await we({challenge:c}),m=await fetch("/api/auth/deleteCredential",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({challenge:c,id:s,confirmCredential:p.credentialData})});if(!m.ok)throw new Error("Failed to add access key");if(!(await m.json()).success){i(e,"errorDeleteAccessKey");return}i(e,"loadingAccessKeys")}catch{i(e,"errorDeleteAccessKey");return}};var H=Be(),q=n(H);{var Z=s=>{z(s,{children:(c,p)=>{var m=be();a(c,m)},$$slots:{default:!0}})},ee=s=>{var c=B(),p=h(c);{var m=f=>{z(f,{children:(K,U)=>{var $=Ce();a(K,$)},$$slots:{default:!0}})},N=f=>{var K=B(),U=h(K);{var $=u=>{var _=Le(),k=d(h(_),2);fe(k,21,()=>t(A),he,(r,o)=>{var y=xe(),C=n(y),D=n(C),T=n(D);ue(T,()=>({"--size":"20px"})),G(T.lastChild,{name:"key"});var j=d(D,2),ae=n(j),te=d(C,2),re=n(te);{var ce=L=>{var O=$e();O.__click=[De,Y,o];var I=n(O);G(I,{name:"close"});var oe=d(I,2);ge(oe,{children:(le,Ee)=>{var ne=E("delete access key");a(le,ne)}}),a(L,O)};v(re,L=>{t(A).length>1&&L(ce)})}ye(()=>_e(ae,t(o).name)),a(r,y)});var P=d(k,2);{var g=r=>{var o=Se();a(r,o)};v(P,r=>{t(e)==="errorDeleteAccessKey"&&r(g)})}var b=d(P,2);{var x=r=>{var o=Te(),y=n(o);{let C=Ae(W);J(y,{element:"a",get href(){return t(C)},onClick:X,children:(D,T)=>{var j=E("Add access key");a(D,j)},$$slots:{default:!0}})}a(r,o)},S=r=>{var o=je();a(r,o)};v(b,r=>{t(A).length<5?r(x):r(S,!1)})}a(u,_)},se=u=>{var _=B(),k=h(_);{var P=g=>{var b=Oe(),x=d(h(b),2),S=n(x);J(S,{onClick:()=>{i(e,"loadingAccessKeys")},children:(r,o)=>{var y=E("Try Again");a(r,y)},$$slots:{default:!0}}),a(g,b)};v(k,g=>{t(e)==="errorAccessKeys"&&g(P)},!0)}a(u,_)};v(U,u=>{t(e)==="successAccessKeys"||t(e)==="errorDeleteAccessKey"?u($):u(se,!1)},!0)}a(f,K)};v(p,f=>{t(e)==="confirmingDeleteAccessKey"?f(m):f(N,!1)},!0)}a(s,c)};v(q,s=>{t(e)==="loadingAccessKeys"?s(Z):s(ee,!1)})}a(F,H),pe()}me(["click"]);export{Ne as default};
