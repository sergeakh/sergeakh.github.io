import{p as j,d as k,e as L,g as O,u as R,h as r,x as T,o as $,f as S,j as w,c as h,b as l,k as M,A as G,i as f,M as H,af as I,K as J,G as N,ag as V,ah as W,O as q,ai as z,s as A,m,L as F,l as Q,B as X,v as Y}from"./index-Bt3jdqU-.js";import{g as Z}from"./api-C5JaEwh0.js";var a=(s=>(s[s.Signup=0]="Signup",s[s.SignupError=1]="SignupError",s))(a||{}),aa=S('<p class="message svelte-9hh95f">signup</p> <!>',1),ea=S('<p class="message svelte-9hh95f">error signup</p> <div class="buttonContainer svelte-9hh95f"><div class="buttonContainerItem svelte-9hh95f"><!></div></div>',1),ta=S('<div class="content svelte-9hh95f"><!></div>');function ia(s,U){j(U,!0);let d=T(G),y=k(""),n=k(L(a.Signup));const{blockDialog:u,unBlockBackDialog:v}=O(),_=async()=>{f(n,a.Signup,!0);try{const e=await Z(),t=crypto.getRandomValues(new Uint8Array(32)),i=await H({challenge:e,clientKey:t}),c=await fetch("/api/signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(c.status!==200){f(n,a.SignupError,!0);return}const o=await c.json(),g=r(d)===void 0;if(await I({clientKey:t,serverKey:new Uint8Array(J(o.serverKey))}),g)u(!1),N();else{u(!1);let p=new URLSearchParams(V.search).get("retPath")||"";p&&(f(y,p,!0),W("retPath")),q({to:r(y)}),z()}}catch{f(n,a.SignupError,!0)}};R(()=>{r(d)===null&&u(r(n)===a.Signup),v(r(n)!==a.Signup)}),$(()=>(r(d)===void 0&&(u(!0),v(!1)),_(),()=>{v(!1)}));var b=ta(),C=h(b);{var P=e=>{var t=aa(),i=A(m(t),2);F(i,{}),l(e,t)},x=e=>{var t=Q(),i=m(t);{var c=o=>{var g=ea(),p=A(m(g),2),B=h(p),D=h(B);X(D,{onClick:()=>_(),fullWidth:!0,children:(E,ra)=>{var K=Y("try again");l(E,K)},$$slots:{default:!0}}),l(o,g)};w(i,o=>{r(n)===a.SignupError&&o(c)},!0)}l(e,t)};w(C,e=>{r(n)===a.Signup?e(P):e(x,!1)})}l(s,b),M()}export{ia as default};
