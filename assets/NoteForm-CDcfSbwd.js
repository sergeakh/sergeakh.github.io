import{p as ee,W as j,u as ce,h as e,d as f,i as r,o as ue,f as y,q as re,a7 as Y,c as u,s as h,j as E,x as z,a4 as te,b as _,k as ae,l as we,m as ve,B as Z,v as $,H as de,a8 as se,a1 as Te,e as P,n as fe,a9 as xe,X as pe,Y as Ce,aa as ie,ab as ye,ac as oe,O as Ie,t as De,r as Ue}from"./index-ConxtjSJ.js";import{I as _e}from"./Input-D4uvp8Yq.js";var Ee=y('<form class="formNewTag svelte-1y5m8nf"><div class="inputWrapper svelte-1y5m8nf"><!></div> <!></form>'),Ne=y('<div class="block"><div class="tags svelte-1y5m8nf"><!> <!> <!> <!></div> <!></div>');function Le(T,t){ee(t,!0);let s=f(null),n=f(""),b=f(null),g=j(t,"shownTagInput",15);const v=a=>{t.selectedTags.includes(a)||(r(n,""),t.onChangeTags([...t.selectedTags,a]),e(s)?.focus())},W=a=>{const i=t.selectedTags.filter(C=>C!==a);i.length===0?t.onChangeTags([]):t.onChangeTags(i)};let x=z(()=>se()?[...(Te()()||[]).reduce((a,i)=>(i?.tags.forEach(C=>{a.has(C)||a.add(C)}),a),new Set)]:[]),U=z(()=>se()?e(x).filter(a=>!t.selectedTags.some(i=>a===i)&&a!=="inbox"):[]),I=z(()=>e(U).find(a=>a.toLowerCase()===e(n).toLowerCase())||t.selectedTags.includes(e(n))),D=z(()=>e(U).filter(a=>e(n)===""?!0:a.toLowerCase().indexOf(e(n).toLowerCase())===0).slice(0,e(I)||e(n)===""?3:2));const o=a=>{a.preventDefault(),e(n)!==""?(v(e(n)),r(n,"")):g(!1)};ce(()=>{e(s)&&g()&&e(s).focus(),g()||r(n,"")});const d=a=>{a.target&&e(b)&&!e(b).contains(a.target)&&(g(!1),r(n,""))};ue(()=>(document.addEventListener("click",d,{capture:!0}),()=>{document.removeEventListener("click",d,{capture:!0})}));var m=Ne(),w=u(m),k=u(w);re(k,16,()=>t.selectedTags,a=>a,(a,i)=>{Y(a,{get title(){return i},onClick:()=>W(i),type:"button",style:"selected"})});var c=h(k,2);{var p=a=>{var i=we(),C=ve(i);re(C,16,()=>e(D),N=>N,(N,L)=>{Y(N,{get title(){return L},onClick:()=>v(L)})}),_(a,i)};E(c,a=>{e(n)!==""&&a(p)})}var q=h(c,2);{var A=a=>{Y(a,{get title(){return e(n)},onClick:()=>{v(e(n)),r(n,"")}})};E(q,a=>{!e(I)&&e(n)!==""&&a(A)})}var F=h(q,2);{var J=a=>{Y(a,{title:"add tag",onClick:()=>g(!0)})};E(F,a=>{g()||a(J)})}var K=h(w,2);{var Q=a=>{var i=Ee(),C=u(i),N=u(C);_e(N,{placeholder:"tag",get ref(){return e(s)},set ref(S){r(s,S,!0)},get value(){return e(n)},set value(S){r(n,S,!0)}});var L=h(C,2);Z(L,{onClick:()=>{e(n)!==""&&v(e(n)),g(!1),r(n,"")},children:(S,M)=>{var O=$("Done");_(S,O)},$$slots:{default:!0}}),de("submit",i,o),_(a,i)};E(K,a=>{g()&&a(Q)})}te(m,a=>r(b,a),()=>e(b)),_(T,m),ae()}var Se=(T,t,s,n)=>{r(t,s.url,!0),n(!1)},je=(T,t,s,n,b)=>{if(e(t)&&e(s)){r(t,"");return}n.onChangeUrl(e(t)),b(!1)},qe=y('<div class="wrapper svelte-1gjqck4"><!> <div class="containerButtons svelte-1gjqck4"><button class="svelte-1gjqck4">Cancel</button> <button class="svelte-1gjqck4">Done</button></div></div>'),Be=(T,t)=>{t(!0)},Re=y('<button class="button svelte-1gjqck4">Edit link</button> <button class="button svelte-1gjqck4">Delete link</button>',1),We=(T,t)=>{t(!0)},Ae=y('<button class="button svelte-1gjqck4">Add link</button>'),Fe=y('<div class="wrapperButtons svelte-1gjqck4"><!></div>'),He=y("<div><!></div>");function Pe(T,t){ee(t,!0);let s=j(t,"shownUrlInput",15),n=f(""),b=f(null),g=f(null),v=f(P(t.url));const W=o=>{r(n,""),r(v,o.target.value||"",!0);try{new URL(e(v))}catch{r(n,"Invalid URL")}};ce(()=>{s()&&setTimeout(()=>{e(b)?.focus()},16)});var x=He(),U=u(x);{var I=o=>{var d=qe(),m=u(d);_e(m,{get value(){return e(v)},get error(){return e(n)},onInput:W,placeholder:"url",get ref(){return e(b)},set ref(p){r(b,p,!0)}});var w=h(m,2),k=u(w);k.__click=[Se,v,t,s];var c=h(k,2);c.__click=[je,v,n,t,s],_(o,d)},D=o=>{var d=Fe(),m=u(d);{var w=c=>{var p=Re(),q=ve(p);q.__click=[Be,s];var A=h(q,2);A.__click=function(...F){t.onDeleteUrl?.apply(this,F)},_(c,p)},k=c=>{var p=Ae();p.__click=[We,s],_(c,p)};E(m,c=>{t.url?c(w):c(k,!1)})}_(o,d)};E(U,o=>{s()?o(I):o(D,!1)})}te(x,o=>r(g,o),()=>e(g)),_(T,x),ae()}fe(["click"]);const Me=(T,t,s)=>{e(t)&&(e(t).style.height="auto",e(t).style.height=e(t).scrollHeight+"px"),s()},Oe=(T,t)=>{t()};var Ge=y("<span> </span>"),Xe=y('<div class="dateInfo svelte-1cn2xww"><!></div>'),Ye=y('<div class="submitButtons svelte-1cn2xww"><!> <!></div>'),ze=y('<div class="form svelte-1cn2xww"><div class="scrollWrapper"><div class="formFields"><!> <form><input class="inputName svelte-1cn2xww" placeholder="Name"/></form> <textarea placeholder="Note" class="svelte-1cn2xww"></textarea></div></div> <div><!> <div class="formTagsWrapper svelte-1cn2xww"><!></div> <!></div></div>');function Qe(T,t){ee(t,!0);let s=j(t,"initialName",3,""),n=j(t,"initialUrl",3,""),b=j(t,"initialText",3,""),g=j(t,"initialTags",19,()=>[]),v=j(t,"noteId",3,""),W=j(t,"mode",3,"add"),x=xe(v()),U=f(!!x),I=f(P(x?.name||s())),D=f(P(x?.url||n())),o=f(P(x?.text||b())),d=f(P((x?.tags||g()).filter(l=>l!=="inbox"))),m=f(null),w=f(!1),k=f(!1);const c=()=>{e(U)||r(U,!0);const l={id:v(),name:e(I),url:e(D),text:e(o),tags:e(d).map(B=>B.trim())};ye(l)},p=l=>{l.preventDefault(),oe(v()),t.onSubmit({name:e(I).trim().slice(0,256)||"unkwown",url:e(D).trim().slice(0,2048),text:e(o).trim().slice(0,2048),tags:e(d).length>0?e(d):["inbox"]})},q=l=>{l.preventDefault(),e(m)&&e(m).focus()},A=l=>{l.key==="Escape"&&(document.activeElement instanceof HTMLInputElement&&document.activeElement.type==="text"||document.activeElement instanceof HTMLTextAreaElement)&&(e(w)&&r(w,!1),e(k)&&r(k,!1),document.activeElement.blur(),l.preventDefault(),l.stopPropagation())};ue(()=>(document.addEventListener("keydown",A),()=>document.removeEventListener("keydown",A)));const F=l=>{r(D,l,!0),c()},J=()=>{r(D,""),c()},K=l=>{r(d,l,!0),c()},Q=()=>{oe(v()),r(U,!1),r(I,s()),r(D,n()),r(o,b()),r(d,g(),!0),W()==="add"&&Ie()};var a=ze(),i=u(a),C=u(i),N=u(C);Pe(N,{get url(){return e(D)},onChangeUrl:F,onDeleteUrl:J,get shownUrlInput(){return e(k)},set shownUrlInput(l){r(k,l,!0)}});var L=h(N,2),S=u(L);S.__input=[Oe,c];var M=h(L,2);M.__input=[Me,m,c],te(M,l=>r(m,l),()=>e(m));var O=h(i,2);pe(O,1,Ce(["bottom","bottomSpace"]),"svelte-1cn2xww");var ne=u(O);{var ge=l=>{var B=Xe(),G=u(B);{var V=R=>{var X=Ge(),H=u(X);De(ke=>Ue(H,`updated: ${ke??""}`),[()=>new Date(t.updatedAt).toLocaleString()]),_(R,X)};E(G,R=>{t.updatedAt&&R(V)})}_(l,B)};E(ne,l=>{W()==="edit"&&l(ge)})}var le=h(ne,2),me=u(le);Le(me,{get selectedTags(){return e(d)},onChangeTags:K,get shownTagInput(){return e(w)},set shownTagInput(l){r(w,l,!0)}});var he=h(le,2);{var be=l=>{var B=Ye(),G=u(B);Z(G,{fullWidth:!0,onClick:Q,type:"secondary",typeButton:"button",children:(R,X)=>{var H=$("cancel");_(R,H)},$$slots:{default:!0}});var V=h(G,2);Z(V,{fullWidth:!0,onClick:p,typeButton:"submit",children:(R,X)=>{var H=$("save");_(R,H)},$$slots:{default:!0}}),_(l,B)};E(he,l=>{!e(w)&&!e(k)&&e(U)&&l(be)})}de("submit",L,q),ie(S,()=>e(I),l=>r(I,l)),ie(M,()=>e(o),l=>r(o,l)),_(T,a),ae()}fe(["input"]);export{Qe as N};
