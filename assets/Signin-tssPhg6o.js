import{p as O,a as T,M as A,o as C,s as b,N as v,u as x,g as p,f as S,i as _,c as y,b as g,d as N,l,O as j,P as J,Q as u,R,S as $,y as q,e as B,h as D,B as H,t as L}from"./index-ZQdMVi-b.js";import{L as M}from"./Loader-DZMjsMV4.js";var r=(s=>(s[s.Signin=0]="Signin",s[s.SigninError=1]="SigninError",s))(r||{}),P=S('<p class="message svelte-9hh95f">signin</p> <!>',1),Q=S('<p class="message svelte-9hh95f">error signin</p> <div class="buttonContainer svelte-9hh95f"><div class="buttonContainerItem svelte-9hh95f"><!></div></div>',1),V=S('<div class="content svelte-9hh95f"><!></div>');function G(s,E){O(E,!0);let t=T(A(r.Signin));const m=async()=>{l(t,r.Signin,!0);try{const a=await fetch("/api/signin/start",{method:"post"}).then(e=>e.json()),o={challenge:j(J(a.challenge)),timeout:6e4,rpId:"localhost",userVerification:"required"};try{const e=await navigator.credentials.get({publicKey:o}),n=e.response;if(e){const c={challenge:a.challenge,id:e.id,rawId:u(e.rawId),type:e.type,response:{authenticatorData:u(n.authenticatorData),clientDataJSON:u(n.clientDataJSON),signature:u(n.signature)}},d=await fetch("/api/signin/finish",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)});if(d.status!==200){l(t,r.SigninError,!0);return}const i=await d.json();if(console.log("responseData: ",i),!i.success||!i.serverKey){console.error("Signin failed: ",i),l(t,r.SigninError,!0);return}if(!n.userHandle){l(t,r.SigninError,!0);return}const f=i.serverKey,h=n.userHandle;await R({credentialId:new Uint8Array(e.rawId),clientKey:new Uint8Array(h),serverKey:new Uint8Array($(f))}),b(!1),q()}else throw new Error}catch(e){l(t,r.SigninError,!0),console.log(e)}}catch(a){l(t,r.SigninError,!0),console.log(a)}};C(()=>(b(!0),v(!1),m(),()=>{v(!1)})),x(()=>{v(p(t)!==r.Signin)});var w=V(),K=y(w);{var I=a=>{var o=P(),e=B(D(o),2);M(e),g(a,o)},U=(a,o)=>{{var e=n=>{var c=Q(),d=B(D(c),2),i=y(d),f=y(i);H(f,{onClick:()=>m(),fullWidth:!0,children:(h,W)=>{var k=L("try again");g(h,k)},$$slots:{default:!0}}),g(n,c)};_(a,n=>{p(t)===r.SigninError&&n(e)},o)}};_(K,a=>{p(t)===r.Signin?a(I):a(U,!1)})}g(s,w),N()}export{G as default};
