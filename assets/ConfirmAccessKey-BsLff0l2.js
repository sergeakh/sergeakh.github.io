import{p as Y,u as Z,s as M,g as n,a as j,o as ee,f as p,i as h,c as d,b as a,d as ae,e as y,h as o,a2 as te,m as c,B as E,t as N,k as A,a3 as re,a4 as se,T as L,R as ne,L as O,U as oe,a5 as ie,a6 as ce}from"./index-C1vnfXtA.js";import{g as le,a as de}from"./api-7nXQQ8YG.js";var ve=p('<p class="message error svelte-ey4qps">Enter a name for a key</p> <div class="inputContainer svelte-ey4qps"><!></div> <div class="buttonContainer svelte-ey4qps"><!></div>',1),fe=p('<p class="message svelte-ey4qps">Adding the access key</p> <div class="buttonContainer svelte-ey4qps"><!></div>',1),ye=p('<p class="message svelte-ey4qps">Confirming</p> <div class="buttonContainer svelte-ey4qps"><!></div>',1),pe=p('<p class="message error svelte-ey4qps">Something went wrong</p> <div class="buttonContainer svelte-ey4qps"><!></div>',1),ue=p('<p class="message svelte-ey4qps">Confirm this operation with another key</p> <div class="buttonContainer svelte-ey4qps"><!></div>',1),me=p('<div class="content svelte-ey4qps"><!></div>');function Ce(U,F){Y(F,!0);let e=j("idle"),C="",w=null,k=j("");Z(()=>{M(n(e)==="confirmingAccessKey"||n(e)==="addingAccessKey")}),ee(()=>()=>{M(!1)});const I=async()=>{c(e,"addingAccessKey");try{C=await le();const r=await de(),t=re();if(!t||!t.encryptedClientKey)throw new Error("No account found");const l=await se({encryptedClientKey:L(t.encryptedClientKey),serverKey:L(r)});w=await ne({challenge:C,clientKey:l}),c(e,"confirmAccessKey")}catch{c(e,"error");return}},J=async()=>{c(e,"confirmingAccessKey");try{const r=await oe({challenge:C});if(!w)throw new Error("No credential data found");const t=await fetch("/api/auth/addCredential",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({challenge:C,name:n(k)||`key ${Math.floor(Math.random()*1e3)}`,newCredential:w,confirmCredential:r.credentialData})});if(!t.ok)throw new Error("Failed to add access key");if(!(await t.json()).success){c(e,"error");return}ie(),ce()}catch{c(e,"error");return}};var D=me(),R=d(D);{var z=r=>{var t=ve(),l=y(o(t),2),q=d(l);te(q,{placeholder:"key name",get value(){return n(k)},set value(s){c(k,s,!0)}});var b=y(l,2),i=d(b);E(i,{onClick:I,children:(s,K)=>{var u=N("Add key");a(s,u)},$$slots:{default:!0}}),a(r,t)},G=r=>{var t=A(),l=o(t);{var q=i=>{var s=fe(),K=y(o(s),2),u=d(K);O(u),a(i,s)},b=i=>{var s=A(),K=o(s);{var u=v=>{var m=ye(),P=y(o(m),2),$=d(P);O($),a(v,m)},H=v=>{var m=A(),P=o(m);{var $=f=>{var g=pe(),x=y(o(g),2),S=d(x);E(S,{onClick:()=>{c(e,"idle")},children:(_,T)=>{var B=N("Try Again");a(_,B)},$$slots:{default:!0}}),a(f,g)},Q=f=>{var g=A(),x=o(g);{var S=_=>{var T=ue(),B=y(o(T),2),V=d(B);E(V,{onClick:J,children:(W,ge)=>{var X=N("Confirm");a(W,X)},$$slots:{default:!0}}),a(_,T)};h(x,_=>{n(e)==="confirmAccessKey"&&_(S)},!0)}a(f,g)};h(P,f=>{n(e)==="error"?f($):f(Q,!1)},!0)}a(v,m)};h(K,v=>{n(e)==="confirmingAccessKey"?v(u):v(H,!1)},!0)}a(i,s)};h(l,i=>{n(e)==="addingAccessKey"?i(q):i(b,!1)},!0)}a(r,t)};h(R,r=>{n(e)==="idle"?r(z):r(G,!1)})}a(U,D),ae()}export{Ce as default};
