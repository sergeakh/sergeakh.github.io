import{p as M,W as _,u as P,h as e,d as f,f as q,m as A,q as B,a7 as W,c as m,s as g,j as S,x as H,b as L,k as Q,l as $,i as s,H as V,a8 as J,a1 as ee,n as X,e as j,a4 as te,a9 as K,t as ae,r as re}from"./index-DsliZToH.js";import{I as Y}from"./Input-J5R-YU1b.js";var ie=(p,l,u)=>{l(!1),s(u,"")},le=q('<form class="formNewTag svelte-8u22z9"><!> <button type="button" class="buttonCancel svelte-8u22z9">Cancel</button></form>'),se=q('<div class="tags svelte-8u22z9"><!> <!> <!> <!></div> <!>',1);function ne(p,l){M(l,!0);let u=f(null),r=f(""),n=_(l,"selectedTags",15),v=_(l,"shownTagInput",15);const T=t=>{n().includes(t)||(s(r,""),n([...n(),t]),e(u)?.focus())},w=t=>{const i=n().filter(c=>c!==t);i.length===0?n([]):n(i)};let k=H(()=>J()?[...(ee()()||[]).reduce((t,i)=>(i?.tags.forEach(c=>{t.has(c)||t.add(c)}),t),new Set)]:[]),h=H(()=>J()?e(k).filter(t=>!n().some(i=>t===i)&&t!=="inbox"):[]),b=H(()=>e(h).find(t=>t.toLowerCase()===e(r).toLowerCase())||n().includes(e(r))),x=H(()=>e(h).filter(t=>e(r)===""?!0:t.toLowerCase().indexOf(e(r).toLowerCase())===0).slice(0,e(b)||e(r)===""?3:2));const C=t=>{t.preventDefault(),e(r)!==""&&!e(b)&&(T(e(r)),s(r,""))};P(()=>{e(u)&&v()&&e(u).focus()});var o=se(),D=A(o),N=m(D);B(N,16,n,t=>t,(t,i)=>{W(t,{get title(){return i},onClick:()=>w(i),type:"button",style:"selected"})});var U=g(N,2);{var E=t=>{var i=$(),c=A(i);B(c,16,()=>e(x),a=>a,(a,d)=>{W(a,{get title(){return d},onClick:()=>T(d)})}),L(t,i)};S(U,t=>{e(r)!==""&&t(E)})}var y=g(U,2);{var R=t=>{W(t,{get title(){return e(r)},onClick:()=>{T(e(r)),s(r,"")}})};S(y,t=>{!e(b)&&e(r)!==""&&t(R)})}var z=g(y,2);{var G=t=>{W(t,{title:"add tag",onClick:()=>v(!0)})};S(z,t=>{v()||t(G)})}var I=g(D,2);{var F=t=>{var i=le(),c=m(i);Y(c,{placeholder:"tag",get ref(){return e(u)},set ref(d){s(u,d,!0)},get value(){return e(r)},set value(d){s(r,d,!0)}});var a=g(c,2);a.__click=[ie,v,r],V("submit",i,C),L(t,i)};S(I,t=>{v()&&t(F)})}L(p,o),Q()}X(["click"]);const oe=(p,l,u,r,n,v)=>{p.preventDefault(),l.onSubmit({title:e(u).trim().slice(0,256)||"unkwown",url:e(r).trim().slice(0,2048),description:e(n).trim().slice(0,2048),tags:e(v).length>0?e(v):["inbox"]})};var ue=q('<div class="submitWrapper svelte-z2gvbh"><button class="buttonSubmit svelte-z2gvbh" type="submit"> </button></div>'),ce=q('<div class="form svelte-z2gvbh"><div class="formFields"><!> <form><input class="inputName svelte-z2gvbh" placeholder="Name"/></form> <textarea placeholder="Note" class="svelte-z2gvbh"></textarea></div> <div class="formTagsWrapper svelte-z2gvbh"><!></div> <!></div>');function fe(p,l){M(l,!0);let u=_(l,"initialTitle",3,""),r=_(l,"initialUrl",3,""),n=_(l,"initialDescription",3,""),v=_(l,"initialTags",19,()=>[]),T=_(l,"mode",3,"add"),w=f(!1),k=f(j(u())),h=f(j(r())),b=f(""),x=f(j(n())),C=f(j(v().filter(a=>a!=="inbox"))),o=f(null);const D=a=>{s(b,""),s(h,a.target.value||"",!0);try{new URL(e(h))}catch{s(b,"Invalid URL")}},N=()=>{e(o)&&(e(o).style.height="auto",e(o).style.height=e(o).scrollHeight+"px")};P(()=>{e(o),N()});const U=a=>{a.preventDefault(),e(o)&&e(o).focus()};var E=ce(),y=m(E),R=m(y);Y(R,{get value(){return e(h)},get error(){return e(b)},onInput:D,placeholder:"url"});var z=g(R,2),G=m(z),I=g(z,2);I.__input=N,te(I,a=>s(o,a),()=>e(o));var F=g(y,2),t=m(F);ne(t,{get shownTagInput(){return e(w)},set shownTagInput(a){s(w,a,!0)},get selectedTags(){return e(C)},set selectedTags(a){s(C,a,!0)}});var i=g(F,2);{var c=a=>{var d=ue(),O=m(d);O.__click=[oe,l,k,h,x,C];var Z=m(O);ae(()=>re(Z,T()==="add"?"add":"edit")),L(a,d)};S(i,a=>{e(w)||a(c)})}V("submit",z,U),K(G,()=>e(k),a=>s(k,a)),K(I,()=>e(x),a=>s(x,a)),L(p,E),Q()}X(["input","click"]);export{fe as N};
