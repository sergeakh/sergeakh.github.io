import{p as K,X as S,u as oe,h as e,d as _,i as r,o as ue,f as I,q as ae,a8 as X,c as u,s as g,j as E,x as Y,a5 as Q,b as m,k as V,l as be,m as ce,H as ve,a9 as ne,a2 as ke,n as $,e as F,Y as we,Z as Te,aa as le,ab as xe,B as re,v as se,ac as ie,t as Ce,r as pe}from"./index-0Z-mCJUL.js";import{I as de}from"./Input-BnOyJZfe.js";var Ie=(w,t,s,n)=>{e(t)!==""&&s(e(t)),n(!1),r(t,"")},ye=I('<form class="formNewTag svelte-16azfa5"><div class="inputWrapper svelte-16azfa5"><!></div> <button class="buttonDone svelte-16azfa5">Done</button></form>'),De=I('<div class="block"><div class="tags svelte-16azfa5"><!> <!> <!> <!></div> <!></div>');function Ue(w,t){K(t,!0);let s=_(null),n=_(""),h=_(null),c=S(t,"shownTagInput",15);const v=a=>{t.selectedTags.includes(a)||(r(n,""),t.onChangeTags([...t.selectedTags,a]),e(s)?.focus())},W=a=>{const i=t.selectedTags.filter(k=>k!==a);i.length===0?t.onChangeTags([]):t.onChangeTags(i)};let C=Y(()=>ne()?[...(ke()()||[]).reduce((a,i)=>(i?.tags.forEach(k=>{a.has(k)||a.add(k)}),a),new Set)]:[]),p=Y(()=>ne()?e(C).filter(a=>!t.selectedTags.some(i=>a===i)&&a!=="inbox"):[]),y=Y(()=>e(p).find(a=>a.toLowerCase()===e(n).toLowerCase())||t.selectedTags.includes(e(n))),D=Y(()=>e(p).filter(a=>e(n)===""?!0:a.toLowerCase().indexOf(e(n).toLowerCase())===0).slice(0,e(y)||e(n)===""?3:2));const o=a=>{a.preventDefault(),e(n)!==""?(v(e(n)),r(n,"")):c(!1)};oe(()=>{e(s)&&c()&&e(s).focus(),c()||r(n,"")});const d=a=>{a.target&&e(h)&&!e(h).contains(a.target)&&(c(!1),r(n,""))};ue(()=>(document.addEventListener("click",d,{capture:!0}),()=>{document.removeEventListener("click",d,{capture:!0})}));var f=De(),T=u(f),U=u(T);ae(U,16,()=>t.selectedTags,a=>a,(a,i)=>{X(a,{get title(){return i},onClick:()=>W(i),type:"button",style:"selected"})});var b=g(U,2);{var x=a=>{var i=be(),k=ce(i);ae(k,16,()=>e(D),N=>N,(N,L)=>{X(N,{get title(){return L},onClick:()=>v(L)})}),m(a,i)};E(b,a=>{e(n)!==""&&a(x)})}var j=g(b,2);{var M=a=>{X(a,{get title(){return e(n)},onClick:()=>{v(e(n)),r(n,"")}})};E(j,a=>{!e(y)&&e(n)!==""&&a(M)})}var z=g(j,2);{var Z=a=>{X(a,{title:"add tag",onClick:()=>c(!0)})};E(z,a=>{c()||a(Z)})}var H=g(T,2);{var P=a=>{var i=ye(),k=u(i),N=u(k);de(N,{placeholder:"tag",get ref(){return e(s)},set ref(R){r(s,R,!0)},get value(){return e(n)},set value(R){r(n,R,!0)}});var L=g(k,2);L.__click=[Ie,n,v,c],ve("submit",i,o),m(a,i)};E(H,a=>{c()&&a(P)})}Q(f,a=>r(h,a),()=>e(h)),m(w,f),V()}$(["click"]);var Ee=(w,t,s,n)=>{r(t,s.url,!0),n(!1)},Ne=(w,t,s,n,h)=>{if(e(t)&&e(s)){r(t,"");return}n.onChangeUrl(e(t)),h(!1)},Le=I('<div class="wrapper svelte-1gjqck4"><!> <div class="containerButtons svelte-1gjqck4"><button class="svelte-1gjqck4">Cancel</button> <button class="svelte-1gjqck4">Done</button></div></div>'),Se=(w,t)=>{t(!0)},je=I('<button class="button svelte-1gjqck4">Edit link</button> <button class="button svelte-1gjqck4">Delete link</button>',1),qe=(w,t)=>{t(!0)},Be=I('<button class="button svelte-1gjqck4">Add link</button>'),Re=I('<div class="wrapperButtons svelte-1gjqck4"><!></div>'),We=I("<div><!></div>");function Me(w,t){K(t,!0);let s=S(t,"shownUrlInput",15),n=_(""),h=_(null),c=_(null),v=_(F(t.url));const W=o=>{r(n,""),r(v,o.target.value||"",!0);try{new URL(e(v))}catch{r(n,"Invalid URL")}};oe(()=>{s()&&e(h)?.focus()});var C=We(),p=u(C);{var y=o=>{var d=Le(),f=u(d);de(f,{get value(){return e(v)},get error(){return e(n)},onInput:W,placeholder:"url",get ref(){return e(h)},set ref(x){r(h,x,!0)}});var T=g(f,2),U=u(T);U.__click=[Ee,v,t,s];var b=g(U,2);b.__click=[Ne,v,n,t,s],m(o,d)},D=o=>{var d=Re(),f=u(d);{var T=b=>{var x=je(),j=ce(x);j.__click=[Se,s];var M=g(j,2);M.__click=function(...z){t.onDeleteUrl?.apply(this,z)},m(b,x)},U=b=>{var x=Be();x.__click=[qe,s],m(b,x)};E(f,b=>{t.url?b(T):b(U,!1)})}m(o,d)};E(p,o=>{s()?o(y):o(D,!1)})}Q(C,o=>r(c,o),()=>e(c)),m(w,C),V()}$(["click"]);const ze=(w,t,s)=>{e(t)&&(e(t).style.height="auto",e(t).style.height=e(t).scrollHeight+"px"),s()},Ae=(w,t)=>{t()};var Fe=I("<span> </span>"),He=I('<div class="dateInfo svelte-1cn2xww"><!></div>'),Pe=I('<div class="submitButtons svelte-1cn2xww"><!> <!></div>'),Oe=I('<div class="form svelte-1cn2xww"><div class="scrollWrapper"><div class="formFields"><!> <form><input class="inputName svelte-1cn2xww" placeholder="Name"/></form> <textarea placeholder="Note" class="svelte-1cn2xww"></textarea></div></div> <div><!> <div class="formTagsWrapper svelte-1cn2xww"><!></div> <!></div></div>');function Ye(w,t){K(t,!0);let s=S(t,"initialName",3,""),n=S(t,"initialUrl",3,""),h=S(t,"initialText",3,""),c=S(t,"initialTags",19,()=>[]),v=S(t,"noteId",3,""),W=S(t,"mode",3,"add"),C=_(F(t.draft?.name||s())),p=_(F(t.draft?.url||n())),y=_(F(t.draft?.text||h())),D=_(F((t.draft?.tags||c()).filter(l=>l!=="inbox"))),o=_(null),d=_(!1),f=_(!1);const T=()=>{const l={id:v(),name:e(C),url:e(p),text:e(y),tags:e(D).map(q=>q.trim())};xe(l)},U=l=>{l.preventDefault(),ie(v()),t.onSubmit({name:e(C).trim().slice(0,256)||"unkwown",url:e(p).trim().slice(0,2048),text:e(y).trim().slice(0,2048),tags:e(D).length>0?e(D):["inbox"]})},b=l=>{l.preventDefault(),e(o)&&e(o).focus()},x=l=>{l.key==="Escape"&&(document.activeElement instanceof HTMLInputElement&&document.activeElement.type==="text"||document.activeElement instanceof HTMLTextAreaElement)&&(e(d)&&r(d,!1),e(f)&&r(f,!1),document.activeElement.blur(),l.preventDefault(),l.stopPropagation())};ue(()=>(document.addEventListener("keydown",x),()=>document.removeEventListener("keydown",x)));const j=l=>{r(p,l,!0),T()},M=()=>{r(p,""),T()},z=l=>{r(D,l,!0),T()},Z=()=>{ie(v()),r(C,s()),r(p,n()),r(y,h()),r(D,c(),!0)};var H=Oe(),P=u(H),a=u(P),i=u(a);Me(i,{get url(){return e(p)},onChangeUrl:j,onDeleteUrl:M,get shownUrlInput(){return e(f)},set shownUrlInput(l){r(f,l,!0)}});var k=g(i,2),N=u(k);N.__input=[Ae,T];var L=g(k,2);L.__input=[ze,o,T],Q(L,l=>r(o,l),()=>e(o));var R=g(P,2);we(R,1,Te(["bottom","bottomSpace"]),"svelte-1cn2xww");var ee=u(R);{var fe=l=>{var q=He(),O=u(q);{var J=B=>{var G=Fe(),A=u(G);Ce(he=>pe(A,`updated: ${he??""}`),[()=>new Date(t.updatedAt).toLocaleString()]),m(B,G)};E(O,B=>{t.updatedAt&&B(J)})}m(l,q)};E(ee,l=>{W()==="edit"&&l(fe)})}var te=g(ee,2),_e=u(te);Ue(_e,{get selectedTags(){return e(D)},onChangeTags:z,get shownTagInput(){return e(d)},set shownTagInput(l){r(d,l,!0)}});var ge=g(te,2);{var me=l=>{var q=Pe(),O=u(q);re(O,{fullWidth:!0,withoutMinWidth:!0,onClick:Z,type:"secondary",typeButton:"button",children:(B,G)=>{var A=se("cancel");m(B,A)},$$slots:{default:!0}});var J=g(O,2);re(J,{fullWidth:!0,withoutMinWidth:!0,onClick:U,typeButton:"submit",children:(B,G)=>{var A=se("save");m(B,A)},$$slots:{default:!0}}),m(l,q)};E(ge,l=>{!e(d)&&!e(f)&&t.draft&&l(me)})}ve("submit",k,b),le(N,()=>e(C),l=>r(C,l)),le(L,()=>e(y),l=>r(y,l)),m(w,H),V()}$(["input"]);export{Ye as N};
