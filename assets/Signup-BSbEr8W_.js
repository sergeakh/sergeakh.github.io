import{p as K,a as T,M as j,o as A,s as b,N as g,u as I,g as f,f as y,i as w,c as h,b as c,d as N,l as p,O as x,P as J,Q as v,R,S as $,y as L,e as _,h as B,B as M,t as P}from"./index-ZQdMVi-b.js";import{L as V}from"./Loader-DZMjsMV4.js";var t=(s=>(s[s.Signup=0]="Signup",s[s.SignupError=1]="SignupError",s))(t||{}),q=y('<p class="message svelte-9hh95f">signup</p> <!>',1),Q=y('<p class="message svelte-9hh95f">error signup</p> <div class="buttonContainer svelte-9hh95f"><div class="buttonContainerItem svelte-9hh95f"><!></div></div>',1),W=y('<div class="content svelte-9hh95f"><!></div>');function H(s,k){K(k,!0);let n=T(j(t.Signup));const m=async()=>{p(n,t.Signup,!0);try{const a=await fetch("/api/signup/start",{method:"post"}).then(e=>e.json()),r=crypto.getRandomValues(new Uint8Array(32)),o={challenge:x(J(a.challenge)),rp:{id:"localhost",name:"notes"},user:{id:r,name:"notes_account",displayName:"notes_account"},pubKeyCredParams:[{type:"public-key",alg:-7},{type:"public-key",alg:-257}],authenticatorSelection:{userVerification:"required"},timeout:6e4,attestation:"none"};try{const e=await navigator.credentials.create({publicKey:o}),i=e.response;if(console.log(e),e){const u={clientKey:r,challenge:a.challenge,id:e.id,rawId:v(e.rawId),type:e.type,response:{clientDataJSON:v(i.clientDataJSON),attestationObject:v(i.attestationObject)}},l=await fetch("/api/signup/finish",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)});if(l.status!==200){p(n,t.SignupError,!0);return}const d=await l.json();await R({credentialId:new Uint8Array(e.rawId),clientKey:r,serverKey:new Uint8Array($(d.serverKey))}),b(!1),L()}else throw new Error}catch(e){p(n,t.SignupError,!0),console.log(e)}}catch(a){p(n,t.SignupError,!0),console.log(a)}};A(()=>(b(!0),g(!1),m(),()=>{g(!1)})),I(()=>{g(f(n)!==t.Signup)});var S=W(),O=h(S);{var U=a=>{var r=q(),o=_(B(r),2);V(o),c(a,r)},C=(a,r)=>{{var o=e=>{var i=Q(),u=_(B(i),2),l=h(u),d=h(l);M(d,{onClick:()=>m(),fullWidth:!0,children:(D,z)=>{var E=P("try again");c(D,E)},$$slots:{default:!0}}),c(e,i)};w(a,e=>{f(n)===t.SignupError&&e(o)},r)}};w(O,a=>{f(n)===t.Signup?a(U):a(C,!1)})}c(s,S),N()}export{H as default};
