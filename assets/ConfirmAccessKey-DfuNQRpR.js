import{p as e,u as s,b as a,g as r,s as t,o as n,f as i,i as o,d as c,e as l,h as d,m as v,c as y,B as p,v as f,H as m,j as h,k as g,A as u,J as w,K as C,M as A,L as K,w as k,N as $,O as q}from"./index-D_lOxY7D.js";import{g as b,a as j}from"./api-DvDg-7CF.js";import{I as E}from"./Input-BckqXweK.js";var N=i('<form><p class="message error svelte-ey4qps">Enter a name for a key</p> <div class="inputContainer svelte-ey4qps"><!></div> <div class="buttonContainer svelte-ey4qps"><!></div></form>'),M=i('<p class="message svelte-ey4qps">Adding the access key</p>'),O=i('<p class="message svelte-ey4qps">Confirming</p>'),S=i('<p class="message error svelte-ey4qps">Something went wrong</p> <div class="buttonContainer svelte-ey4qps"><!></div>',1),T=i('<p class="message svelte-ey4qps">Confirm this operation with another key</p> <div class="buttonContainer svelte-ey4qps"><!></div>',1),x=i('<div class="content svelte-ey4qps"><!></div>');function I(i,I){e(I,!0);let J=t("idle"),B="",F=null,H=t("");s(()=>{a("confirmingAccessKey"===r(J)||"addingAccessKey"===r(J))}),n(()=>()=>{a(!1)});const L=async e=>{e.preventDefault(),y(J,"addingAccessKey");try{B=await b();const e=await j(),s=u();if(!s||!s.t)throw new Error("No account found");const a=await w({t:C(s.t),i:C(e)});F=await A({challenge:B,o:a}),y(J,"confirmAccessKey")}catch{return void y(J,"error")}},P=async()=>{y(J,"confirmingAccessKey");try{const e=await k({challenge:B});if(!F)throw new Error("No credential data found");if(!(await fetch("/api/addCredential",{method:"POST",headers:{l:"application/json"},body:JSON.stringify({challenge:B,name:r(H)||`key ${Math.floor(1e3*Math.random())}`,v:F,p:e.m})})).ok)throw new Error("Failed to add access key");$(),q()}catch{return void y(J,"error")}};var z=x(),D=c(z),G=e=>{var s=N(),a=v(c(s),2),t=c(a);E(t,{placeholder:"key name",get value(){return r(H)},set value(e){y(H,e,!0)}});var n=v(a,2),i=c(n);p(i,{h:L,children:(e,s)=>{var a=f("Add key");l(e,a)},u:{default:!0}}),m("submit",s,L),l(e,s)},Q=e=>{var s=h(),a=g(s),t=e=>{K(e,{children:(e,s)=>{var a=M();l(e,a)},u:{default:!0}})},n=e=>{var s=h(),a=g(s),t=e=>{K(e,{children:(e,s)=>{var a=O();l(e,a)},u:{default:!0}})},n=e=>{var s=h(),a=g(s),t=e=>{var s=S(),a=v(g(s),2),r=c(a);p(r,{h:()=>{y(J,"idle")},children:(e,s)=>{var a=f("Try Again");l(e,a)},u:{default:!0}}),l(e,s)},n=e=>{var s=h(),a=g(s),t=e=>{var s=T(),a=v(g(s),2),r=c(a);p(r,{h:P,children:(e,s)=>{var a=f("Confirm");l(e,a)},u:{default:!0}}),l(e,s)};o(a,e=>{"confirmAccessKey"===r(J)&&e(t)},!0),l(e,s)};o(a,e=>{"error"===r(J)?e(t):e(n,!1)},!0),l(e,s)};o(a,e=>{"confirmingAccessKey"===r(J)?e(t):e(n,!1)},!0),l(e,s)};o(a,e=>{"addingAccessKey"===r(J)?e(t):e(n,!1)},!0),l(e,s)};o(D,e=>{"idle"===r(J)?e(G):e(Q,!1)}),l(i,z),d()}export{I as default};
