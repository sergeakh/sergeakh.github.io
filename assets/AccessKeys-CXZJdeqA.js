import{p as fe,a as V,P as ge,u as Y,s as z,g as t,o as _e,m as v,f as n,i as f,c as o,n as J,I as pe,V as M,b as a,d as ye,W as me,e as i,h as g,L as R,k as F,w as ue,D as he,X as Ae,Y as W,H as Ke,Z as ke,t as I,_ as je,U as we,B as X,$ as be,a0 as Ce,a1 as Z}from"./index-C1vnfXtA.js";import{g as De}from"./api-7nXQQ8YG.js";var Pe=n('<p class="message svelte-1jrsfal">Loading access keys</p> <div class="buttonContainer svelte-1jrsfal"><!></div>',1),xe=n('<p class="message svelte-1jrsfal">Confirming</p> <div class="buttonContainer svelte-1jrsfal"><!></div>',1),Se=(O,D,e)=>D(t(e).id),$e=n('<button class="buttonDelete svelte-1jrsfal"><!> <!></button>'),He=n('<li class="svelte-1jrsfal"><div class="keyInfo svelte-1jrsfal"><div><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper></div> <div class="keyName svelte-1jrsfal"> </div></div> <div class="keyActions svelte-1jrsfal"><!></div></li>'),Le=n('<p class="message error svelte-1jrsfal">Error deleting access key</p>'),Te=n('<div class="buttonContainer svelte-1jrsfal"><!></div>'),Be=n('<p class="message svelte-1jrsfal">You have reached the maximum number of access keys.</p>'),Ee=n('<p class="message svelte-1jrsfal">Access Keys</p> <ul class="svelte-1jrsfal"></ul> <!> <!>',1),Fe=n('<p class="message error svelte-1jrsfal">Something went wrong</p> <div class="buttonContainer svelte-1jrsfal"><!></div>',1),Ie=n('<div class="content svelte-1jrsfal"><!></div>');function Ve(O,D){fe(D,!0);let e=V("loadingAccessKeys"),K=V(ge([]));Y(()=>{z(t(e)==="loadingAccessKeys"||t(e)==="confirmingDeleteAccessKey")}),_e(()=>()=>{z(!1)}),Y(()=>{if(t(e)==="loadingAccessKeys"){const s=new AbortController;return(async()=>{try{const r=await fetch("/api/auth/accessKeys",{method:"POST",signal:s.signal});if(!r.ok)throw new Error("Failed to fetch access keys");const d=await r.json();v(K,d.credentials||[],!0),v(e,"successAccessKeys")}catch{v(e,"errorAccessKeys")}})(),()=>{s.abort()}}});const q=()=>{const s=Ce();s.includes("confirmAccessKey")||s.push("confirmAccessKey");const r=new URLSearchParams(Z.search);return r.set("stackPages",s.join(",")),`${Z.pathname}?${r}`},G=s=>{s.preventDefault(),be("confirmAccessKey")},Q=async s=>{v(e,"confirmingDeleteAccessKey");try{const r=await De(),d=await we({challenge:r}),_=await fetch("/api/auth/deleteCredential",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({challenge:r,id:s,confirmCredential:d.credentialData})});if(!_.ok)throw new Error("Failed to add access key");if(!(await _.json()).success){v(e,"errorDeleteAccessKey");return}v(e,"loadingAccessKeys")}catch{v(e,"errorDeleteAccessKey");return}},ee=M(me);var P=Ie(),se=o(P);{var ae=s=>{var r=Pe(),d=i(g(r),2),_=o(d);R(_),a(s,r)},te=s=>{var r=F(),d=g(r);{var _=p=>{var u=xe(),x=i(g(u),2),S=o(x);R(S),a(p,u)},U=p=>{var u=F(),x=g(u);{var S=y=>{var h=Ee(),k=i(g(h),2);he(k,21,()=>t(K),je,(c,l)=>{var m=He(),b=o(m),C=o(b),L=o(C);Ae(L,()=>({"--size":"20px"})),W(L.lastChild,{name:"key"});var T=i(C,2),ce=o(T),oe=i(b,2),le=o(oe);{var ne=B=>{var E=$e();E.__click=[Se,Q,l];var N=o(E);W(N,{name:"close"});var ie=i(N,2);ke(ie,{children:(ve,Oe)=>{var de=I("delete access key");a(ve,de)}}),a(B,E)};f(le,B=>{t(K).length>1&&B(ne)})}J(()=>Ke(ce,t(l).name)),a(c,m)});var j=i(k,2);{var A=c=>{var l=Le();a(c,l)};f(j,c=>{t(e)==="errorDeleteAccessKey"&&c(A)})}var w=i(j,2);{var $=c=>{var l=Te(),m=o(l);{let b=M(q);X(m,{element:"a",get href(){return t(b)},onClick:G,children:(C,L)=>{var T=I("Add access key");a(C,T)},$$slots:{default:!0}})}a(c,l)},H=c=>{var l=Be();a(c,l)};f(w,c=>{t(K).length<5?c($):c(H,!1)})}a(y,h)},re=y=>{var h=F(),k=g(h);{var j=A=>{var w=Fe(),$=i(g(w),2),H=o($);X(H,{onClick:()=>{v(e,"loadingAccessKeys")},children:(c,l)=>{var m=I("Try Again");a(c,m)},$$slots:{default:!0}}),a(A,w)};f(k,A=>{t(e)==="errorAccessKeys"&&A(j)},!0)}a(y,h)};f(x,y=>{t(e)==="successAccessKeys"||t(e)==="errorDeleteAccessKey"?y(S):y(re,!1)},!0)}a(p,u)};f(d,p=>{t(e)==="confirmingDeleteAccessKey"?p(_):p(U,!1)},!0)}a(s,r)};f(se,s=>{t(e)==="loadingAccessKeys"?s(ae):s(te,!1)})}J(()=>pe(P,`--height: ${t(ee)}px`)),a(O,P),ye()}ue(["click"]);export{Ve as default};
