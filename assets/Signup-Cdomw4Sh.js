import{p as G,g as I,A as J,z as M,e as C,h as N,d as V,u as W,i as t,y as k,o as q,f as m,k as w,c as h,b as l,l as Q,j as d,G as X,F as Y,s as b,n as S,L as Z,m as tt,B as et,w as at}from"./index-D3sDlWLV.js";import{g as rt}from"./api-C5JaEwh0.js";var e=(n=>(n[n.Signup=0]="Signup",n[n.SignupError=1]="SignupError",n))(e||{}),nt=m('<p class="message svelte-9hh95f">signup</p> <!>',1),st=m('<p class="message svelte-9hh95f">error signup</p> <div class="buttonContainer svelte-9hh95f"><div class="buttonContainerItem svelte-9hh95f"><!></div></div>',1),ot=m('<div class="content svelte-9hh95f"><!></div>');function ut(n,x){G(x,!0);const{updateStackPages:P}=I(),{getAccount:U,initCloudAccount:B}=J(),{getAppHistory:D,back:E,closeDialogStack:j,deleteSearchParam:H}=M();let K=k(D),f=k(U),y=C(""),s=C(N(e.Signup));const{blockDialog:c,unBlockBackDialog:v}=V(),_=async()=>{d(s,e.Signup,!0);try{const a=await rt(),r=crypto.getRandomValues(new Uint8Array(32)),o=await X({challenge:a,clientKey:r}),u=await fetch("/api/signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(u.status!==200){d(s,e.SignupError,!0);return}const i=await u.json(),g=t(f)===void 0;if(await B({clientKey:r,serverKey:new Uint8Array(Y(i.serverKey))}),g)c(!1),j();else{c(!1);let p=new URLSearchParams(t(K).search).get("retPath")||"";p&&(d(y,p,!0),H("retPath")),E({to:t(y)}),P()}}catch{d(s,e.SignupError,!0)}};W(()=>{t(f)===null&&c(t(s)===e.Signup),v(t(s)!==e.Signup)}),q(()=>(t(f)===void 0&&(c(!0),v(!1)),_(),()=>{v(!1)}));var A=ot(),L=h(A);{var R=a=>{var r=nt(),o=b(S(r),2);Z(o,{}),l(a,r)},T=a=>{var r=tt(),o=S(r);{var u=i=>{var g=st(),p=b(S(g),2),$=h(p),O=h($);et(O,{onClick:()=>_(),fullWidth:!0,children:(z,it)=>{var F=at("try again");l(z,F)},$$slots:{default:!0}}),l(i,g)};w(o,i=>{t(s)===e.SignupError&&i(u)},!0)}l(a,r)};w(L,a=>{t(s)===e.Signup?a(R):a(T,!1)})}l(n,A),Q()}export{ut as default};
