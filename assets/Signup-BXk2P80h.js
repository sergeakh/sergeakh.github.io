import{p as T,a as K,N as j,o as A,s as b,O as g,u as I,g as f,f as y,i as w,c as h,b as c,d as N,l as u,P as x,Q as J,R as v,S as R,T as $,y as L,e as _,h as B,L as P,B as V,t as q}from"./index-BMmQJNiY.js";var t=(s=>(s[s.Signup=0]="Signup",s[s.SignupError=1]="SignupError",s))(t||{}),M=y('<p class="message svelte-9hh95f">signup</p> <!>',1),Q=y('<p class="message svelte-9hh95f">error signup</p> <div class="buttonContainer svelte-9hh95f"><div class="buttonContainerItem svelte-9hh95f"><!></div></div>',1),W=y('<div class="content svelte-9hh95f"><!></div>');function G(s,k){T(k,!0);let n=K(j(t.Signup));const S=async()=>{u(n,t.Signup,!0);try{const a=await fetch("/api/signup/start",{method:"post"}).then(e=>e.json()),r=crypto.getRandomValues(new Uint8Array(32)),o={challenge:x(J(a.challenge)),rp:{id:"localhost",name:"notes"},user:{id:r,name:"notes_account",displayName:"notes_account"},pubKeyCredParams:[{type:"public-key",alg:-7},{type:"public-key",alg:-257}],authenticatorSelection:{userVerification:"required"},timeout:6e4,attestation:"none"};try{const e=await navigator.credentials.create({publicKey:o}),i=e.response;if(console.log(e),e){const p={clientKey:r,challenge:a.challenge,id:e.id,rawId:v(e.rawId),type:e.type,response:{clientDataJSON:v(i.clientDataJSON),attestationObject:v(i.attestationObject)}},l=await fetch("/api/signup/finish",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)});if(l.status!==200){u(n,t.SignupError,!0);return}const d=await l.json();await R({credentialId:new Uint8Array(e.rawId),clientKey:r,serverKey:new Uint8Array($(d.serverKey))}),b(!1),L()}else throw new Error}catch(e){u(n,t.SignupError,!0),console.log(e)}}catch(a){u(n,t.SignupError,!0),console.log(a)}};A(()=>(b(!0),g(!1),S(),()=>{g(!1)})),I(()=>{g(f(n)!==t.Signup)});var m=W(),O=h(m);{var U=a=>{var r=M(),o=_(B(r),2);P(o),c(a,r)},C=(a,r)=>{{var o=e=>{var i=Q(),p=_(B(i),2),l=h(p),d=h(l);V(d,{onClick:()=>S(),fullWidth:!0,children:(D,z)=>{var E=q("try again");c(D,E)},$$slots:{default:!0}}),c(e,i)};w(a,e=>{f(n)===t.SignupError&&e(o)},r)}};w(O,a=>{f(n)===t.Signup?a(U):a(C,!1)})}c(s,m),N()}export{G as default};
