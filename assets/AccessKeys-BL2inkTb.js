import{p as e,s,a,u as c,b as t,g as r,o as l,c as o,f as n,i,d as v,e as d,h as g,L as y,j as p,k as m,l as u,m as f,n as h,q as A,I as K,t as k,r as w,V as b,v as C,w as $,B as D,x,y as j,P as S,z as T}from"./index-D_lOxY7D.js";import{g as E}from"./api-DvDg-7CF.js";var O=n('<p class="message svelte-1aog49v">Loading access keys</p>'),P=n('<p class="message svelte-1aog49v">Confirming</p>'),z=(e,s,a)=>s(r(a).id),F=n('<button class="buttonDelete svelte-1aog49v"><!> <!></button>'),I=n('<li class="svelte-1aog49v"><div class="keyInfo svelte-1aog49v"><div><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper></div> <div class="keyName svelte-1aog49v"> </div></div> <div class="keyActions svelte-1aog49v"><!></div></li>'),L=n('<p class="message error svelte-1aog49v">Error deleting access key</p>'),N=n('<div class="buttonContainer svelte-1aog49v"><!></div>'),q=n('<p class="message svelte-1aog49v">You have reached the maximum number of access keys.</p>'),B=n('<p class="message svelte-1aog49v">Access Keys</p> <ul class="svelte-1aog49v"></ul> <!> <!>',1),J=n('<p class="message error svelte-1aog49v">Something went wrong</p> <div class="buttonContainer svelte-1aog49v"><!></div>',1),V=n('<div class="content svelte-1aog49v"><!></div>');function Y(n,u){e(u,!0);let Y=s("loadingAccessKeys"),G=s(a([]));c(()=>{t("loadingAccessKeys"===r(Y)||"confirmingDeleteAccessKey"===r(Y))}),l(()=>()=>{t(!1)}),c(()=>{if(!u.hidden&&"successAccessKeys"===r(Y)||"loadingAccessKeys"===r(Y)){const e=new AbortController;return(async()=>{try{const s=await fetch("/api/credentials",{method:"POST",signal:e.signal});if(!s.ok)throw new Error("Failed to fetch access keys");const a=await s.json();o(G,a.credentials||[],!0),console.log("Access Keys: ",a.credentials),o(Y,"successAccessKeys")}catch{o(Y,"errorAccessKeys")}})(),()=>{e.abort()}}});const H=async e=>{o(Y,"confirmingDeleteAccessKey");try{const s=await E(),a=await $({challenge:s});if(!(await fetch("/api/deleteCredential",{method:"POST",headers:{t:"application/json"},body:JSON.stringify({challenge:s,id:e,l:a.o})})).ok)throw new Error("Failed to add access key");o(Y,"loadingAccessKeys")}catch{return void o(Y,"errorDeleteAccessKey")}};var M=V(),Q=v(M),R=e=>{y(e,{children:(e,s)=>{var a=O();d(e,a)},i:{default:!0}})},U=e=>{var s=p(),a=m(s),c=e=>{y(e,{children:(e,s)=>{var a=P();d(e,a)},i:{default:!0}})},t=e=>{var s=p(),a=m(s),c=e=>{var s=B(),a=f(m(s),2);h(a,21,()=>r(G),e=>e.id,(e,s)=>{var a=I(),c=v(a),t=v(c),l=v(t);A(l,()=>({v:"20px"})),K(l.lastChild,{name:"key"});var o=f(t,2),n=v(o),g=f(c,2),y=v(g),p=e=>{var a=F();a.p=[z,H,s];var c=v(a);K(c,{name:"close"});var t=f(c,2);b(t,{children:(e,s)=>{var a=C("delete access key");d(e,a)}}),d(e,a)};i(y,e=>{r(G).length>1&&e(p)}),k(()=>w(n,r(s).name)),d(e,a)});var c=f(a,2),t=e=>{var s=L();d(e,s)};i(c,e=>{"errorDeleteAccessKey"===r(Y)&&e(t)});var l=f(c,2),o=e=>{var s=N(),a=v(s);{let e=x(()=>T(S.m)),s=x(()=>j(S.m));D(a,{element:"a",get href(){return r(e)},get u(){return r(s)},children:(e,s)=>{var a=C("Add access key");d(e,a)},i:{default:!0}})}d(e,s)},n=e=>{var s=q();d(e,s)};i(l,e=>{r(G).length<5?e(o):e(n,!1)}),d(e,s)},t=e=>{var s=p(),a=m(s),c=e=>{var s=J(),a=f(m(s),2),c=v(a);D(c,{u:()=>{o(Y,"loadingAccessKeys")},children:(e,s)=>{var a=C("Try Again");d(e,a)},i:{default:!0}}),d(e,s)};i(a,e=>{"errorAccessKeys"===r(Y)&&e(c)},!0),d(e,s)};i(a,e=>{"successAccessKeys"===r(Y)||"errorDeleteAccessKey"===r(Y)?e(c):e(t,!1)},!0),d(e,s)};i(a,e=>{"confirmingDeleteAccessKey"===r(Y)?e(c):e(t,!1)},!0),d(e,s)};i(Q,e=>{"loadingAccessKeys"===r(Y)?e(R):e(U,!1)}),d(n,M),g()}u(["click"]);export{Y as default};
