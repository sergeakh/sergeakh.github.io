import{p as K,z as M,g as N,A as Q,d as R,u as U,i as p,e as V,f as _,k as b,c,b as t,l as X,s as x,n as f,y as Z,m as D,B as C,w as S,P as tt,j as h,t as st,v as et}from"./index-DGGsS_Lk.js";var at=_('<p class="message svelte-1v77ma3">You need to connect to the cloud account to get an access to a subscription</p> <div class="buttonContainer svelte-1v77ma3"><!></div>',1),rt=_('<div class="buttonContainer svelte-1v77ma3"><!></div>'),ot=_('<p class="message svelte-1v77ma3"> </p>'),it=_('<h3 class="title svelte-1v77ma3">Subscription</h3> <!>',1),nt=_('<p class="message svelte-1v77ma3">error signin</p> <div class="buttonContainer svelte-1v77ma3"><div class="buttonContainerItem"><!></div></div>',1),vt=_('<p class="message svelte-1v77ma3">Subscription updated successfully</p> <div class="buttonContainer svelte-1v77ma3"><div class="buttonContainerItem"><!></div></div>',1),ct=_('<div class="content svelte-1v77ma3"><!></div>');function ut(I,j){K(j,!0);const{addSearchParam:B,closeDialogStack:G}=M(),{pushStackPages:W}=N(),{getAccount:Y,updateSubscription:z}=Q();let o=V("idle"),P=Z(Y);const{blockDialog:F}=R(),H=()=>{B("retPath","subscription"),W(tt.Auth)},L=()=>{G()},y=async()=>{h(o,"loading");try{const i=await fetch("/api/getSubscription",{method:"POST"});if(i.status!==200){h(o,"error");return}const v=await i.json();if(!v.subscriptionExpires){h(o,"error");return}const g=v.subscriptionExpires;z(g),h(o,"success")}catch{h(o,"error")}};U(()=>{F(p(o)==="loading")});var w=ct(),O=c(w);{var T=i=>{var v=it(),g=x(f(v),2);{var k=s=>{var a=at(),l=x(f(a),2),u=c(l);C(u,{onClick:H,children:(n,e)=>{var r=S("Connect");t(n,r)},$$slots:{default:!0}}),t(s,a)},$=s=>{var a=D(),l=f(a);{var u=e=>{var r=rt(),d=c(r);C(d,{onClick:y,children:(m,A)=>{var E=S("Get subscription");t(m,E)},$$slots:{default:!0}}),t(e,r)},n=e=>{var r=ot(),d=c(r);st(m=>et(d,`Your subscription is active until ${m??""}`),[()=>new Date(p(P).subscriptionExpires).toLocaleDateString()]),t(e,r)};b(l,e=>{p(P).subscriptionExpires<Date.now()?e(u):e(n,!1)},!0)}t(s,a)};b(g,s=>{p(P)?s($,!1):s(k)})}t(i,v)},q=i=>{var v=D(),g=f(v);{var k=s=>{var a=nt(),l=x(f(a),2),u=c(l),n=c(u);C(n,{onClick:y,fullWidth:!0,children:(e,r)=>{var d=S("try again");t(e,d)},$$slots:{default:!0}}),t(s,a)},$=s=>{var a=D(),l=f(a);{var u=n=>{var e=vt(),r=x(f(e),2),d=c(r),m=c(d);C(m,{onClick:L,fullWidth:!0,children:(A,E)=>{var J=S("Close");t(A,J)},$$slots:{default:!0}}),t(n,e)};b(l,n=>{p(o)==="success"&&n(u)},!0)}t(s,a)};b(g,s=>{p(o)==="error"?s(k):s($,!1)},!0)}t(i,v)};b(O,i=>{p(o)==="idle"?i(T):i(q,!1)})}t(I,w),X()}export{ut as default};
