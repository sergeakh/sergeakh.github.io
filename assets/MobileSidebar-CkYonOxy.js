import{p as Q,Y as te,H as ne,o as $,n as ee,g as e,y as B,h as oe,Z as ie,_ as se,$ as ae,u as z,j as K,f as re,r as U,m as W,c as q,S as G,s as j,t as ce,d as J,q as le,a0 as de,a1 as ue,l as Z,J as me,K as fe}from"./index-CV6Kg8D-.js";function he(X,t){Q(t,!0);const{getIsKeyboardVisible:V}=te();let a=ne(t,"dialog",7);const b=B(V),L=3,x=50,O=5,i=.6,g=.3,c=.35,C=.95;let v=0,_=0,y=0,M=!1,p=!1,u=0,m=0,w=0;const f=()=>{v=0,_=0,M=!1,p=!1,u=0,m=0,w=0,y=0,l!==null&&(cancelAnimationFrame(l),l=null),T=null};let l=null,T=null;const A=o=>{a()&&(t.sidebarState!=="opened"&&t.sidebarState!=="closed"||(v=o.touches[0].clientX,_=o.touches[0].clientY,y=performance.now(),M=!0,p=!1))},P=o=>t.sidebarState==="closed"&&o>0||t.sidebarState==="closeSwiping"&&o>0||t.sidebarState==="opened"&&o<0||t.sidebarState==="openSwiping"&&o<0,N=()=>{if(a()){if(a().style.setProperty("--transition-timing","0s"),!a().open&&t.sidebarState==="closed")try{a().showModal(),a().offsetWidth}catch{return}t.onSwipe();try{const o=window.getComputedStyle(a()),s=o.transform||o.webkitTransform||"";if(m=a().offsetWidth,t.sidebarState==="closeSwiping"||t.sidebarState==="closed"?u=-m:(t.sidebarState==="openSwiping"||t.sidebarState==="opened")&&(u=0),s&&s!=="none")try{u=new DOMMatrix(s).m41}catch{}p=!0}catch{f()}}},Y=()=>{if(!a())return;const o=-(m*.27),s=-m;let r=0;const d=window.getComputedStyle(a()),E=d.transform||d.webkitTransform||"";if(E&&E!=="none")try{r=new DOMMatrix(E).m41}catch{r=0}const H=.25*Math.min(1,Math.max(0,(r-s)/(o-s)));a().style.setProperty("--backdrop-bg",`rgba(0, 0, 0, ${H})`)},F=()=>{if(l=null,!T||!M||!a()||e(b))return;const{x:o,y:s}=T;T=null;const r=o-v,d=s-_,E=Math.abs(r)>Math.abs(d),D=Math.abs(r)>L;if(!p)if(E&&D&&P(r))try{N()}catch{f();return}else return;if(!P(r))return;a().style.setProperty("--transition-timing","0s");let S=u+r*C;const H=-m,k=-(m*.27);S=Math.max(H,Math.min(k,S)),a().style.transform=`translate3d(${S}px, 0, 0)`,w=(S-u)/m*100,Y()},n=o=>{if(!M)return;const s=o.touches[0].clientX,r=o.touches[0].clientY;T={x:s,y:r},l===null&&(l=requestAnimationFrame(F)),p&&Math.abs(s-v)>Math.abs(r-_)&&o.preventDefault()},h=o=>{const s=Math.abs(o);if(s>=i)return O;if(s>=g){const r=(s-g)/(i-g);return x-r*(x-O)}else return x},R=(o,s)=>{if(Math.abs(o)>=i)return c*.5;const d=Math.abs(w)/100;return s?c*Math.max(.5,1-d):c*Math.max(.5,d)},I=o=>{if(l!==null&&(cancelAnimationFrame(l),l=null),T=null,!M||!a()){f();return}if(!p){f();return}let s=0;if(o?.changedTouches?.[0]){const S=o.changedTouches[0].clientX,k=performance.now()-y;k>0&&(s=(S-v)/k)}const r=h(s);let d=null;t.sidebarState==="closeSwiping"?d=Math.abs(w)>r||s>g?"open":"close":t.sidebarState==="openSwiping"&&(d=Math.abs(w)>r||s<-g?"close":"open");const E=t.sidebarState==="closeSwiping"&&d==="open"||t.sidebarState==="openSwiping"&&d==="close",D=R(s,E);a().style.setProperty("--transition-timing",`${D}s`),a().offsetWidth,a().style.transform="",d==="open"?t.onOpen():d==="close"&&t.onClose(),a()?.style.removeProperty("--backdrop-bg"),f()};$(()=>(document.addEventListener("touchstart",A,{passive:!0}),document.addEventListener("touchmove",n,{passive:!1}),document.addEventListener("touchend",I,{passive:!0}),document.addEventListener("touchcancel",I,{passive:!0}),()=>{document.removeEventListener("touchstart",A),document.removeEventListener("touchmove",n),document.removeEventListener("touchend",I),document.removeEventListener("touchcancel",I),l!==null&&cancelAnimationFrame(l)})),ee()}var ge=re('<dialog><div class="dialogInner svelte-1nov8pn"><!></div></dialog> <!> <!>',1);function be(X,t){Q(t,!0);const{getStackPages:V}=oe(),{getSidebarState:a,handleComputeState:b}=ie();let L=350;const x=se(),{isScrolling:O}=ae();let i=K(null),g=K(null),c=B(a);z(()=>{V().length>0&&b({type:"close"})});const C=()=>{t.blocked||b({type:"close"})},v=()=>{t.blocked||b({type:"open"})},_=()=>{b({type:"opened"})},y=()=>{b({type:"closed"})},M=()=>{b({type:"swipe"})},p=n=>{n.preventDefault(),C()};$(()=>(e(i)?.addEventListener("close",y),e(i)?.addEventListener("cancel",p),()=>{e(i)?.removeEventListener("close",y),e(i)?.removeEventListener("cancel",p)}));const u=()=>{e(i)?.style.removeProperty("--transition-timing"),e(i)?.style.removeProperty("transform"),e(i)?.style.removeProperty("--backdrop-bg")},m=B(O);z(()=>{if(e(c),!!e(i))switch(e(c).type){case"closeSwiping":{const n=setTimeout(()=>{C()},3e3);return()=>{clearTimeout(n)}}case"openSwiping":{const n=setTimeout(()=>{v()},3e3);return()=>{clearTimeout(n)}}case"opening":{e(i).open||e(i).showModal(),e(i).getBoundingClientRect();const n=setTimeout(()=>{u()},L+1),h=()=>{clearTimeout(n),u()};return e(i)?.addEventListener("transitionend",h,{once:!0}),_(),()=>{e(i)?.removeEventListener("transitionend",h)}}case"closing":{const n=setTimeout(()=>{e(c).type==="closing"&&y()},L+1),h=()=>{clearTimeout(n),y()};return e(i)?.addEventListener("transitionend",h,{once:!0}),()=>{e(i)?.removeEventListener("transitionend",h)}}case"closed":e(i)?.close(),u();break;case"opened":u();break}});var w=ge(),f=U(w),l=q(f),T=q(l);{var A=n=>{var h=le(),R=U(h);de(R,()=>t.children),J(n,h)};W(T,n=>{e(c).type!=="closed"&&n(A)})}G(l,n=>Z(g,n),()=>e(g)),G(f,n=>Z(i,n),()=>e(i));var P=j(f,2);{var N=n=>{ue(n,{get dialog(){return e(i)},get dialogInner(){return e(g)},onClose:C})};W(P,n=>{e(c).type==="opened"&&!t.blocked&&n(N)})}var Y=j(P,2);{var F=n=>{he(n,{onClose:C,onOpen:v,onSwipe:M,get sidebarState(){return e(c).type},get dialog(){return e(i)}})};W(Y,n=>{(!e(m)&&e(c).type==="closed"||e(c).type==="opened"||e(c).type==="openSwiping"||e(c).type==="closeSwiping")&&!t.blocked&&n(F)})}ce(()=>me(f,1,fe([{open:e(c).type==="opened",hidden:t.blocked,isAnimationOn:x.working&&(!x.isSwiping||!t.blocked)}]),"svelte-1nov8pn")),J(X,w),ee()}export{be as default};
