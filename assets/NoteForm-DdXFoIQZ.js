import{p as $,C as wt,M as L,u as ot,i as t,e as g,j as r,o as ut,f as y,r as rt,Y as z,c as d,s as m,k as U,y as P,X as tt,b as h,l as et,m as bt,n as dt,D as vt,q as at,h as j,H as kt,N as Tt,O as Ct,Z as lt,B as st,w as it,t as xt,v as pt}from"./index-DGGsS_Lk.js";import{I as ct}from"./Input-BwXXhkUc.js";var yt=(k,e,i,f)=>{t(e)!==""&&i(t(e)),f(!1),r(e,"")},Dt=y('<form class="formNewTag svelte-1dwadiy"><div class="inputWrapper svelte-1dwadiy"><!></div> <button class="buttonDone svelte-1dwadiy">Done</button></form>'),It=y('<div class="block"><div class="tags svelte-1dwadiy"><!> <!> <!> <!></div> <!></div>');function Nt(k,e){$(e,!0);const{isReadyStore:i,getGetNotes:f}=wt();let _=g(null),l=g(""),w=g(null);const S=P(i);let v=L(e,"shownTagInput",15);const E=a=>{e.selectedTags.includes(a)||(r(l,""),e.onChangeTags([...e.selectedTags,a]),t(_)?.focus())},I=a=>{const s=e.selectedTags.filter(x=>x!==a);s.length===0?e.onChangeTags([]):e.onChangeTags(s)};let D=P(()=>t(S)?[...(f()()||[]).reduce((a,s)=>(s?.tags.forEach(x=>{a.has(x)||a.add(x)}),a),new Set)]:[]),o=P(()=>t(S)?t(D).filter(a=>!e.selectedTags.some(s=>a===s)&&a!=="inbox"):[]),c=P(()=>t(o).find(a=>a.toLowerCase()===t(l).toLowerCase())||e.selectedTags.includes(t(l))),T=P(()=>t(o).filter(a=>t(l)===""?!0:a.toLowerCase().indexOf(t(l).toLowerCase())===0).slice(0,t(c)||t(l)===""?3:2));const p=a=>{a.preventDefault(),t(l)!==""?(E(t(l)),r(l,"")):v(!1)};ot(()=>{t(_)&&v()&&t(_).focus(),v()||r(l,"")});const b=a=>{a.target&&t(w)&&!t(w).contains(a.target)&&(v(!1),r(l,""))};ut(()=>(document.addEventListener("click",b,{capture:!0}),()=>{document.removeEventListener("click",b,{capture:!0})}));var u=It(),C=d(u),B=d(C);rt(B,16,()=>e.selectedTags,a=>a,(a,s)=>{z(a,{get title(){return s},onClick:()=>I(s),type:"button",style:"selected"})});var R=m(B,2);{var H=a=>{var s=bt(),x=dt(s);rt(x,16,()=>t(T),N=>N,(N,W)=>{z(N,{get title(){return W},onClick:()=>E(W)})}),h(a,s)};U(R,a=>{t(l)!==""&&a(H)})}var q=m(R,2);{var J=a=>{z(a,{get title(){return t(l)},onClick:()=>{E(t(l)),r(l,"")}})};U(q,a=>{!t(c)&&t(l)!==""&&a(J)})}var K=m(q,2);{var G=a=>{z(a,{title:"add tag",onClick:()=>v(!0)})};U(K,a=>{v()||a(G)})}var X=m(C,2);{var Q=a=>{var s=Dt(),x=d(s),N=d(x);ct(N,{placeholder:"tag",get ref(){return t(_)},set ref(F){r(_,F,!0)},get value(){return t(l)},set value(F){r(l,F,!0)}});var W=m(x,2);W.__click=[yt,l,E,v],vt("submit",s,p),h(a,s)};U(X,a=>{v()&&a(Q)})}tt(u,a=>r(w,a),()=>t(w)),h(k,u),et()}at(["click"]);var Ut=(k,e,i,f)=>{r(e,i.url,!0),f(!1)},Et=(k,e,i,f,_)=>{if(t(e)&&t(i)){r(e,"");return}f.onChangeUrl(t(e)),_(!1)},Lt=y('<div class="wrapper svelte-w8w68w"><!> <div class="containerButtons svelte-w8w68w"><button class="svelte-w8w68w">Cancel</button> <button class="svelte-w8w68w">Done</button></div></div>'),St=(k,e)=>{e(!0)},Bt=y('<button class="button svelte-w8w68w">Edit link</button> <button class="button svelte-w8w68w">Delete link</button>',1),Rt=(k,e)=>{e(!0)},Wt=y('<button class="button svelte-w8w68w">Add link</button>'),Mt=y('<div class="wrapperButtons svelte-w8w68w"><!></div>'),At=y("<div><!></div>");function Ft(k,e){$(e,!0);let i=L(e,"shownUrlInput",15),f=g(""),_=g(null),l=g(null),w=g(j(e.url));const S=o=>{r(f,""),r(w,o.target.value||"",!0);try{new URL(t(w))}catch{r(f,"Invalid URL")}};ot(()=>{i()&&t(_)?.focus()});var v=At(),E=d(v);{var I=o=>{var c=Lt(),T=d(c);ct(T,{get value(){return t(w)},get error(){return t(f)},onInput:S,placeholder:"url",get ref(){return t(_)},set ref(C){r(_,C,!0)}});var p=m(T,2),b=d(p);b.__click=[Ut,w,e,i];var u=m(b,2);u.__click=[Et,w,f,e,i],h(o,c)},D=o=>{var c=Mt(),T=d(c);{var p=u=>{var C=Bt(),B=dt(C);B.__click=[St,i];var R=m(B,2);R.__click=function(...H){e.onDeleteUrl?.apply(this,H)},h(u,C)},b=u=>{var C=Wt();C.__click=[Rt,i],h(u,C)};U(T,u=>{e.url?u(p):u(b,!1)})}h(o,c)};U(E,o=>{i()?o(I):o(D,!1)})}tt(v,o=>r(l,o),()=>t(l)),h(k,v),et()}at(["click"]);const Ht=(k,e,i)=>{t(e)&&(t(e).style.height="auto",t(e).style.height=t(e).scrollHeight+"px"),i()},Ot=(k,e)=>{e()};var Pt=y("<span> </span>"),jt=y('<div class="dateInfo svelte-t8fgpr"><!></div>'),qt=y('<div class="submitButtons svelte-t8fgpr"><!> <!></div>'),Gt=y('<div class="form svelte-t8fgpr"><div class="scrollWrapper"><div class="formFields"><!> <form><input class="inputName svelte-t8fgpr" placeholder="Name"/></form> <textarea placeholder="Note" class="svelte-t8fgpr"></textarea></div></div> <div><!> <div class="formTagsWrapper svelte-t8fgpr"><!></div> <!></div></div>');function Zt(k,e){$(e,!0);const{deleteDraft:i,putDraft:f}=kt();let _=L(e,"initialName",3,""),l=L(e,"initialUrl",3,""),w=L(e,"initialText",3,""),S=L(e,"initialTags",19,()=>[]),v=L(e,"noteId",3,""),E=L(e,"mode",3,"add"),I=g(j(e.draft?.name||_())),D=g(j(e.draft?.url||l())),o=g(j(e.draft?.text||w())),c=g(j((e.draft?.tags||S()).filter(n=>n!=="inbox"))),T=g(null),p=g(!1),b=g(!1);const u=()=>{const n={id:v(),name:t(I),url:t(D),text:t(o),tags:t(c).map(M=>M.trim())};f(n)},C=n=>{n.preventDefault(),i(v()),e.onSubmit({name:t(I).trim().slice(0,256)||"unkwown",url:t(D).trim().slice(0,2048),text:t(o).trim().slice(0,2048),tags:t(c).length>0?t(c):["inbox"]})},B=n=>{n.preventDefault(),t(T)&&t(T).focus()},R=n=>{n.key==="Escape"&&(document.activeElement instanceof HTMLInputElement&&document.activeElement.type==="text"||document.activeElement instanceof HTMLTextAreaElement)&&(t(p)&&r(p,!1),t(b)&&r(b,!1),document.activeElement.blur(),n.preventDefault(),n.stopPropagation())};ut(()=>(document.addEventListener("keydown",R),()=>document.removeEventListener("keydown",R)));const H=n=>{r(D,n,!0),u()},q=()=>{r(D,""),u()},J=n=>{r(c,n,!0),u()},K=()=>{i(v()),r(I,_()),r(D,l()),r(o,w()),r(c,S(),!0)};var G=Gt(),X=d(G),Q=d(X),a=d(Q);Ft(a,{get url(){return t(D)},onChangeUrl:H,onDeleteUrl:q,get shownUrlInput(){return t(b)},set shownUrlInput(n){r(b,n,!0)}});var s=m(a,2),x=d(s);x.__input=[Ot,u];var N=m(s,2);N.__input=[Ht,T,u],tt(N,n=>r(T,n),()=>t(T));var W=m(X,2);Tt(W,1,Ct(["bottom","bottomSpace"]),"svelte-t8fgpr");var F=d(W);{var ft=n=>{var M=jt(),Y=d(M);{var V=A=>{var Z=Pt(),O=d(Z);xt(ht=>pt(O,`updated: ${ht??""}`),[()=>new Date(e.updatedAt).toLocaleString()]),h(A,Z)};U(Y,A=>{e.updatedAt&&A(V)})}h(n,M)};U(F,n=>{E()==="edit"&&n(ft)})}var nt=m(F,2),_t=d(nt);Nt(_t,{get selectedTags(){return t(c)},onChangeTags:J,get shownTagInput(){return t(p)},set shownTagInput(n){r(p,n,!0)}});var gt=m(nt,2);{var mt=n=>{var M=qt(),Y=d(M);st(Y,{fullWidth:!0,withoutMinWidth:!0,onClick:K,type:"secondary",typeButton:"button",children:(A,Z)=>{var O=it("cancel");h(A,O)},$$slots:{default:!0}});var V=m(Y,2);st(V,{fullWidth:!0,withoutMinWidth:!0,onClick:C,typeButton:"submit",children:(A,Z)=>{var O=it("save");h(A,O)},$$slots:{default:!0}}),h(n,M)};U(gt,n=>{!t(p)&&!t(b)&&e.draft&&n(mt)})}vt("submit",s,B),lt(x,()=>t(I),n=>r(I,n)),lt(N,()=>t(o),n=>r(o,n)),h(k,G),et()}at(["input"]);export{Zt as N};
