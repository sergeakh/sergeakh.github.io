import{p as Q,W as I,u as V,h as e,d as g,i as s,o as le,f as y,q as ee,a7 as P,c as v,s as b,j,x as G,a4 as se,b as f,k as Z,l as ie,m as K,H as oe,a8 as te,a1 as fe,n as $,e as X,X as me,Y as _e,a9 as ae,B as ge,v as be,t as re,r as ne}from"./index-CIVrfH-e.js";import{I as ue}from"./Input-BRcP0O3z.js";var he=(k,n,i)=>{n(!1),s(i,"")},pe=y('<form class="formNewTag svelte-17ucbme"><!> <button type="button" class="buttonDone svelte-17ucbme">Done</button></form>'),ke=y('<div class="block"><div class="tags svelte-17ucbme"><!> <!> <!> <!></div> <!></div>');function xe(k,n){Q(n,!0);let i=g(null),r=g(""),h=g(null),u=I(n,"selectedTags",15),m=I(n,"shownTagInput",15);const x=t=>{u().includes(t)||(s(r,""),u([...u(),t]),e(i)?.focus())},U=t=>{const o=u().filter(_=>_!==t);o.length===0?u([]):u(o)};let S=G(()=>te()?[...(fe()()||[]).reduce((t,o)=>(o?.tags.forEach(_=>{t.has(_)||t.add(_)}),t),new Set)]:[]),E=G(()=>te()?e(S).filter(t=>!u().some(o=>t===o)&&t!=="inbox"):[]),l=G(()=>e(E).find(t=>t.toLowerCase()===e(r).toLowerCase())||u().includes(e(r))),c=G(()=>e(E).filter(t=>e(r)===""?!0:t.toLowerCase().indexOf(e(r).toLowerCase())===0).slice(0,e(l)||e(r)===""?3:2));const T=t=>{t.preventDefault(),e(r)!==""&&(x(e(r)),s(r,""))};V(()=>{e(i)&&m()&&e(i).focus(),m()||s(r,"")});const C=t=>{t.target&&e(h)&&!e(h).contains(t.target)&&(m(!1),s(r,""))};le(()=>(document.addEventListener("click",C,{capture:!0}),()=>{document.removeEventListener("click",C,{capture:!0})}));var w=ke(),d=v(w),p=v(d);ee(p,16,u,t=>t,(t,o)=>{P(t,{get title(){return o},onClick:()=>U(o),type:"button",style:"selected"})});var L=b(p,2);{var q=t=>{var o=ie(),_=K(o);ee(_,16,()=>e(c),D=>D,(D,N)=>{P(D,{get title(){return N},onClick:()=>x(N)})}),f(t,o)};j(L,t=>{e(r)!==""&&t(q)})}var H=b(L,2);{var W=t=>{P(t,{get title(){return e(r)},onClick:()=>{x(e(r)),s(r,"")}})};j(H,t=>{!e(l)&&e(r)!==""&&t(W)})}var B=b(H,2);{var Y=t=>{P(t,{title:"add tag",onClick:()=>m(!0)})};j(B,t=>{m()||t(Y)})}var R=b(d,2);{var M=t=>{var o=pe(),_=v(o);ue(_,{placeholder:"tag",get ref(){return e(i)},set ref(N){s(i,N,!0)},get value(){return e(r)},set value(N){s(r,N,!0)}});var D=b(_,2);D.__click=[he,m,r],oe("submit",o,T),f(t,o)};j(R,t=>{m()&&t(M)})}se(w,t=>s(h,t),()=>e(h)),f(k,w),Z()}$(["click"]);var Te=(k,n,i,r)=>{if(n()&&e(i)){n("");return}r(!1)},we=y('<div class="wrapper svelte-1gjqck4"><!> <div class="containerButtons svelte-1gjqck4"><button class="svelte-1gjqck4">Done</button></div></div>'),ye=(k,n)=>{n(!0)},Ee=(k,n)=>{n("")},Ie=y('<button class="button svelte-1gjqck4">Edit link</button> <button class="button svelte-1gjqck4">Delete link</button>',1),je=(k,n)=>{n(!0)},Ce=y('<button class="button svelte-1gjqck4">Add link</button>'),Le=y('<div class="wrapperButtons svelte-1gjqck4"><!></div>');function Ne(k,n){Q(n,!0);let i=I(n,"url",15),r=I(n,"shownUrlInput",15),h=g(""),u=g(null);const m=l=>{s(h,""),i(l.target.value||"");try{new URL(i())}catch{s(h,"Invalid URL")}};V(()=>{r()&&setTimeout(()=>{e(u)?.focus()},0)});var x=ie(),U=K(x);{var S=l=>{var c=we(),T=v(c);ue(T,{get value(){return i()},get error(){return e(h)},onInput:m,placeholder:"url",get ref(){return e(u)},set ref(d){s(u,d,!0)}});var C=b(T,2),w=v(C);w.__click=[Te,i,h,r],f(l,c)},E=l=>{var c=Le(),T=v(c);{var C=d=>{var p=Ie(),L=K(p);L.__click=[ye,r];var q=b(L,2);q.__click=[Ee,i],f(d,p)},w=d=>{var p=Ce();p.__click=[je,r],f(d,p)};j(T,d=>{i()?d(C):d(w,!1)})}f(l,c)};j(U,l=>{r()?l(S):l(E,!1)})}f(k,x),Z()}$(["click"]);var Ue=y("<span> </span>"),Se=y('<div class="dateInfo svelte-sym2jx"><!></div>'),De=y('<div class="submitButton svelte-sym2jx"><!></div>'),qe=y('<div class="form svelte-sym2jx"><div class="scrollWrapper"><div class="formFields"><!> <form><input class="inputName svelte-sym2jx" placeholder="Name"/></form> <textarea placeholder="Note" class="svelte-sym2jx"></textarea></div></div> <div><!> <div class="formTagsWrapper svelte-sym2jx"><!></div> <!></div></div>');function Ae(k,n){Q(n,!0);let i=I(n,"initialName",3,""),r=I(n,"initialUrl",3,""),h=I(n,"initialText",3,""),u=I(n,"initialTags",19,()=>[]),m=I(n,"mode",3,"add"),x=g(X(i())),U=g(X(r())),S=g(X(h())),E=g(X(u().filter(a=>a!=="inbox"))),l=g(null),c=g(!1),T=g(!1);const C=a=>{a.preventDefault(),n.onSubmit({name:e(x).trim().slice(0,256)||"unkwown",url:e(U).trim().slice(0,2048),text:e(S).trim().slice(0,2048),tags:e(E).length>0?e(E):["inbox"]})},w=()=>{e(l)&&(e(l).style.height="auto",e(l).style.height=e(l).scrollHeight+"px")};V(()=>{e(l),w()});const d=a=>{a.preventDefault(),e(l)&&e(l).focus()},p=a=>{a.key==="Escape"&&(document.activeElement instanceof HTMLInputElement&&document.activeElement.type==="text"||document.activeElement instanceof HTMLTextAreaElement)&&(e(c)&&s(c,!1),document.activeElement.blur(),a.preventDefault(),a.stopPropagation())};le(()=>(document.addEventListener("keydown",p),()=>document.removeEventListener("keydown",p)));var L=qe(),q=v(L),H=v(q),W=v(H);Ne(W,{get shownUrlInput(){return e(T)},set shownUrlInput(a){s(T,a,!0)},get url(){return e(U)},set url(a){s(U,a,!0)}});var B=b(W,2),Y=v(B),R=b(B,2);R.__input=w,se(R,a=>s(l,a),()=>e(l));var M=b(q,2);me(M,1,_e(["bottom","bottomSpace"]),"svelte-sym2jx");var t=v(M);{var o=a=>{var A=Se(),z=v(A);{var J=O=>{var F=Ue(),ce=v(F);re(de=>ne(ce,`updated: ${de??""}`),[()=>new Date(n.updatedAt).toLocaleString()]),f(O,F)};j(z,O=>{n.updatedAt&&O(J)})}f(a,A)};j(t,a=>{m()==="edit"&&a(o)})}var _=b(t,2),D=v(_);xe(D,{get shownTagInput(){return e(c)},set shownTagInput(a){s(c,a,!0)},get selectedTags(){return e(E)},set selectedTags(a){s(E,a,!0)}});var N=b(_,2);{var ve=a=>{var A=De(),z=v(A);ge(z,{fullWidth:!0,onClick:C,typeButton:"submit",children:(J,O)=>{var F=be();re(()=>ne(F,m()==="add"?"add":"edit")),f(J,F)},$$slots:{default:!0}}),f(a,A)};j(N,a=>{!e(c)&&!e(T)&&a(ve)})}oe("submit",B,d),ae(Y,()=>e(x),a=>s(x,a)),ae(R,()=>e(S),a=>s(S,a)),f(k,L),Z()}$(["input"]);export{Ae as N};
