import{p as J,T as ne,o as Q,h as Z,ah as oe,u as R,ai as ie,aj as L,g as e,s as W,x as B,f as ae,k as X,i as V,d as j,a3 as z,c as U,m as G,t as se,U as re,W as le,ad as q,e as K,ak as ce,al as de,j as ue,ae as me,af as fe}from"./index-HG9Zaxut.js";function he(Y,t){J(t,!0);let a=ne(t,"dialog",7);const s=3,y=50,l=5,p=.6,S=.3,O=.35,x=.95;let w=0,T=0,b=0,M=!1,h=!1,u=0,m=0,E=0;const _=()=>{w=0,T=0,M=!1,h=!1,u=0,m=0,E=0,b=0,c!==null&&(cancelAnimationFrame(c),c=null),v=null};let c=null,v=null;const C=n=>{if(!a()){console.warn("Touch start: No dialog element");return}if(t.sidebarState!=="opened"&&t.sidebarState!=="closed"){console.warn(`Touch start: Invalid sidebar state: ${t.sidebarState}`);return}w=n.touches[0].clientX,T=n.touches[0].clientY,b=performance.now(),M=!0,h=!1},A=n=>t.sidebarState==="closed"&&n>0||t.sidebarState==="closeSwiping"&&n>0||t.sidebarState==="opened"&&n<0||t.sidebarState==="openSwiping"&&n<0,o=()=>{if(a()){if(a().style.setProperty("--transition-timing","0s"),!a().open&&t.sidebarState==="closed")try{a().showModal(),a().offsetWidth}catch(n){console.error("Error opening dialog:",n);return}t.onSwipe();try{const n=window.getComputedStyle(a()),i=n.transform||n.webkitTransform||"";if(m=a().offsetWidth,t.sidebarState==="closeSwiping"||t.sidebarState==="closed"?u=-m:(t.sidebarState==="openSwiping"||t.sidebarState==="opened")&&(u=0),i&&i!=="none")try{u=new DOMMatrix(i).m41}catch{console.warn("Could not parse transform matrix, using default position")}h=!0}catch(n){console.error("Error during swipe initialization:",n),_()}}},f=()=>{if(!a())return;const n=-(m*.27),i=-m;let r=0;const d=window.getComputedStyle(a()),k=d.transform||d.webkitTransform||"";if(k&&k!=="none")try{r=new DOMMatrix(k).m41}catch{r=0}const H=.25*Math.min(1,Math.max(0,(r-i)/(n-i)));a().style.setProperty("--backdrop-bg",`rgba(0, 0, 0, ${H})`)},N=()=>{if(c=null,!v||!M||!a()||oe())return;const{x:n,y:i}=v;v=null;const r=n-w,d=i-T,k=Math.abs(r)>Math.abs(d),D=Math.abs(r)>s;if(!h)if(k&&D&&A(r))try{o()}catch(te){console.error("Error initializing swipe:",te),_();return}else return;if(!A(r))return;a().style.setProperty("--transition-timing","0s");let g=u+r*x;const H=-m,P=-(m*.27);g=Math.max(H,Math.min(P,g)),a().style.transform=`translate3d(${g}px, 0, 0)`,E=(g-u)/m*100,f()},F=n=>{if(!M)return;const i=n.touches[0].clientX,r=n.touches[0].clientY;v={x:i,y:r},c===null&&(c=requestAnimationFrame(N)),h&&Math.abs(i-w)>Math.abs(r-T)&&n.preventDefault()},$=n=>{const i=Math.abs(n);if(i>=p)return l;if(i>=S){const r=(i-S)/(p-S);return y-r*(y-l)}else return y},ee=(n,i)=>{if(Math.abs(n)>=p)return O*.5;const d=Math.abs(E)/100;return i?O*Math.max(.5,1-d):O*Math.max(.5,d)},I=n=>{if(c!==null&&(cancelAnimationFrame(c),c=null),v=null,!M||!a()){_();return}if(!h){_();return}let i=0;if(n?.changedTouches?.[0]){const g=n.changedTouches[0].clientX,P=performance.now()-b;P>0&&(i=(g-w)/P)}const r=$(i);let d=null;t.sidebarState==="closeSwiping"?d=Math.abs(E)>r||i>S?"open":"close":t.sidebarState==="openSwiping"&&(d=Math.abs(E)>r||i<-S?"close":"open");const k=t.sidebarState==="closeSwiping"&&d==="open"||t.sidebarState==="openSwiping"&&d==="close",D=ee(i,k);a().style.setProperty("--transition-timing",`${D}s`),a().offsetWidth,a().style.transform="",d==="open"?t.onOpen():d==="close"&&t.onClose(),a()?.style.removeProperty("--backdrop-bg"),_()};Q(()=>(document.addEventListener("touchstart",C,{passive:!0}),document.addEventListener("touchmove",F,{passive:!1}),document.addEventListener("touchend",I,{passive:!0}),document.addEventListener("touchcancel",I,{passive:!0}),()=>{document.removeEventListener("touchstart",C),document.removeEventListener("touchmove",F),document.removeEventListener("touchend",I),document.removeEventListener("touchcancel",I),c!==null&&cancelAnimationFrame(c)})),Z()}var ge=ae('<dialog><div class="dialogInner svelte-jwdaua"><!></div></dialog> <!> <!>',1);function Se(Y,t){J(t,!0);let a=350,s=W(null),y=W(null),l=B(ce);R(()=>{ie().length>0&&L({type:"close"})});const p=()=>{t.blocked||L({type:"close"})},S=()=>{t.blocked||L({type:"open"})},O=()=>{L({type:"opened"})},x=()=>{L({type:"closed"})},w=()=>{L({type:"swipe"})},T=o=>{o.preventDefault(),p()};Q(()=>(e(s)?.addEventListener("close",x),e(s)?.addEventListener("cancel",T),()=>{e(s)?.removeEventListener("close",x),e(s)?.removeEventListener("cancel",T)}));const b=()=>{e(s)?.style.removeProperty("--transition-timing"),e(s)?.style.removeProperty("transform"),e(s)?.style.removeProperty("--backdrop-bg")},M=B(de);R(()=>{if(e(l),!!e(s))switch(e(l).type){case"closeSwiping":{const o=setTimeout(()=>{p()},3e3);return()=>{clearTimeout(o)}}case"openSwiping":{const o=setTimeout(()=>{S()},3e3);return()=>{clearTimeout(o)}}case"opening":{e(s).open||e(s).showModal(),e(s).getBoundingClientRect();const o=setTimeout(()=>{b()},a+1),f=()=>{clearTimeout(o),b()};return e(s)?.addEventListener("transitionend",f,{once:!0}),O(),()=>{e(s)?.removeEventListener("transitionend",f)}}case"closing":{const o=setTimeout(()=>{e(l).type==="closing"&&x()},a+1),f=()=>{clearTimeout(o),x()};return e(s)?.addEventListener("transitionend",f,{once:!0}),()=>{e(s)?.removeEventListener("transitionend",f)}}case"closed":e(s)?.close(),b();break;case"opened":b();break}});var h=ge(),u=X(h),m=j(u),E=j(m);{var _=o=>{var f=ue(),N=X(f);me(N,()=>t.children),K(o,f)};V(E,o=>{e(l).type!=="closed"&&o(_)})}z(m,o=>U(y,o),()=>e(y)),z(u,o=>U(s,o),()=>e(s));var c=G(u,2);{var v=o=>{fe(o,{get dialog(){return e(s)},get dialogInner(){return e(y)},onClose:p})};V(c,o=>{e(l).type==="opened"&&!t.blocked&&o(v)})}var C=G(c,2);{var A=o=>{he(o,{onClose:p,onOpen:S,onSwipe:w,get sidebarState(){return e(l).type},get dialog(){return e(s)}})};V(C,o=>{(!e(M)&&e(l).type==="closed"||e(l).type==="opened"||e(l).type==="openSwiping"||e(l).type==="closeSwiping")&&!t.blocked&&o(A)})}se(()=>re(u,1,le([{open:e(l).type==="opened",hidden:t.blocked,isAnimationOn:q.working&&(!q.isSwiping||!t.blocked)}]),"svelte-jwdaua")),K(Y,h),Z()}export{Se as default};
