import{p as W,u as X,s as j,g as n,a as I,o as ee,f as p,i as h,c as v,b as a,d as ae,e as K,Y as te,m as c,B as D,t as E,v as re,k as A,h as f,Z as se,_ as ne,K as L,I as oe,L as O,M as ie,$ as ce,a0 as le}from"./index-BaTAiCAr.js";import{g as de,a as ve}from"./api-7nXQQ8YG.js";var fe=p('<form><p class="message error svelte-ey4qps">Enter a name for a key</p> <div class="inputContainer svelte-ey4qps"><!></div> <div class="buttonContainer svelte-ey4qps"><!></div></form>'),pe=p('<p class="message svelte-ey4qps">Adding the access key</p>'),ye=p('<p class="message svelte-ey4qps">Confirming</p>'),ue=p('<p class="message error svelte-ey4qps">Something went wrong</p> <div class="buttonContainer svelte-ey4qps"><!></div>',1),me=p('<p class="message svelte-ey4qps">Confirm this operation with another key</p> <div class="buttonContainer svelte-ey4qps"><!></div>',1),ge=p('<div class="content svelte-ey4qps"><!></div>');function Ke(F,J){W(J,!0);let e=I("idle"),_="",w=null,k=I("");X(()=>{j(n(e)==="confirmingAccessKey"||n(e)==="addingAccessKey")}),ee(()=>()=>{j(!1)});const M=async r=>{r.preventDefault(),c(e,"addingAccessKey");try{_=await de();const t=await ve(),s=se();if(!s||!s.encryptedClientKey)throw new Error("No account found");const y=await ne({encryptedClientKey:L(s.encryptedClientKey),serverKey:L(t)});w=await oe({challenge:_,clientKey:y}),c(e,"confirmAccessKey")}catch{c(e,"error");return}},U=async()=>{c(e,"confirmingAccessKey");try{const r=await ie({challenge:_});if(!w)throw new Error("No credential data found");const t=await fetch("/api/auth/addCredential",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({challenge:_,name:n(k)||`key ${Math.floor(Math.random()*1e3)}`,newCredential:w,confirmCredential:r.credentialData})});if(!t.ok)throw new Error("Failed to add access key");if(!(await t.json()).success){c(e,"error");return}ce(),le()}catch{c(e,"error");return}};var N=ge(),Y=v(N);{var Z=r=>{var t=fe(),s=K(v(t),2),y=v(s);te(y,{placeholder:"key name",get value(){return n(k)},set value(i){c(k,i,!0)}});var $=K(s,2),o=v($);D(o,{onClick:M,children:(i,b)=>{var u=E("Add key");a(i,u)},$$slots:{default:!0}}),re("submit",t,M),a(r,t)},z=r=>{var t=A(),s=f(t);{var y=o=>{O(o,{children:(i,b)=>{var u=pe();a(i,u)},$$slots:{default:!0}})},$=o=>{var i=A(),b=f(i);{var u=l=>{O(l,{children:(C,T)=>{var q=ye();a(C,q)},$$slots:{default:!0}})},G=l=>{var C=A(),T=f(C);{var q=d=>{var m=ue(),P=K(f(m),2),x=v(P);D(x,{onClick:()=>{c(e,"idle")},children:(g,S)=>{var B=E("Try Again");a(g,B)},$$slots:{default:!0}}),a(d,m)},H=d=>{var m=A(),P=f(m);{var x=g=>{var S=me(),B=K(f(S),2),Q=v(B);D(Q,{onClick:U,children:(R,he)=>{var V=E("Confirm");a(R,V)},$$slots:{default:!0}}),a(g,S)};h(P,g=>{n(e)==="confirmAccessKey"&&g(x)},!0)}a(d,m)};h(T,d=>{n(e)==="error"?d(q):d(H,!1)},!0)}a(l,C)};h(b,l=>{n(e)==="confirmingAccessKey"?l(u):l(G,!1)},!0)}a(o,i)};h(s,o=>{n(e)==="addingAccessKey"?o(y):o($,!1)},!0)}a(r,t)};h(Y,r=>{n(e)==="idle"?r(Z):r(z,!1)})}a(F,N),ae()}export{Ke as default};
