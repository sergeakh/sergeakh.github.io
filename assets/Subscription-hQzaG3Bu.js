import{p as K,z as M,h as N,A as Q,i as R,u as U,g as p,j as V,f as _,m as b,c as v,d as t,n as X,s as x,r as f,y as Z,q as D,B as C,x as S,P as tt,l as h,t as st,w as et}from"./index-BTs3mYz0.js";var at=_('<p class="message svelte-1v77ma3">You need to connect to the cloud account to get an access to a subscription</p> <div class="buttonContainer svelte-1v77ma3"><!></div>',1),rt=_('<div class="buttonContainer svelte-1v77ma3"><!></div>'),ot=_('<p class="message svelte-1v77ma3"> </p>'),it=_('<h3 class="title svelte-1v77ma3">Subscription</h3> <!>',1),nt=_('<p class="message svelte-1v77ma3">error signin</p> <div class="buttonContainer svelte-1v77ma3"><div class="buttonContainerItem"><!></div></div>',1),ct=_('<p class="message svelte-1v77ma3">Subscription updated successfully</p> <div class="buttonContainer svelte-1v77ma3"><div class="buttonContainerItem"><!></div></div>',1),vt=_('<div class="content svelte-1v77ma3"><!></div>');function ut(I,j){K(j,!0);const{addSearchParam:B,closeDialogStack:G}=M(),{pushStackPages:W}=N(),{getAccount:Y,updateSubscription:q}=Q();let o=V("idle"),P=Z(Y);const{blockDialog:z}=R(),F=()=>{B("retPath","subscription"),W(tt.Auth)},H=()=>{G()},y=async()=>{h(o,"loading");try{const i=await fetch("/api/getSubscription",{method:"POST"});if(i.status!==200){h(o,"error");return}const c=await i.json();if(!c.subscriptionExpires){h(o,"error");return}const g=c.subscriptionExpires;q(g),h(o,"success")}catch{h(o,"error")}};U(()=>{z(p(o)==="loading")});var w=vt(),L=v(w);{var O=i=>{var c=it(),g=x(f(c),2);{var $=s=>{var a=at(),l=x(f(a),2),u=v(l);C(u,{onClick:F,children:(n,e)=>{var r=S("Connect");t(n,r)},$$slots:{default:!0}}),t(s,a)},k=s=>{var a=D(),l=f(a);{var u=e=>{var r=rt(),d=v(r);C(d,{onClick:y,children:(m,A)=>{var E=S("Get subscription");t(m,E)},$$slots:{default:!0}}),t(e,r)},n=e=>{var r=ot(),d=v(r);st(m=>et(d,`Your subscription is active until ${m??""}`),[()=>new Date(p(P).subscriptionExpires).toLocaleDateString()]),t(e,r)};b(l,e=>{p(P).subscriptionExpires<Date.now()?e(u):e(n,!1)},!0)}t(s,a)};b(g,s=>{p(P)?s(k,!1):s($)})}t(i,c)},T=i=>{var c=D(),g=f(c);{var $=s=>{var a=nt(),l=x(f(a),2),u=v(l),n=v(u);C(n,{onClick:y,fullWidth:!0,children:(e,r)=>{var d=S("try again");t(e,d)},$$slots:{default:!0}}),t(s,a)},k=s=>{var a=D(),l=f(a);{var u=n=>{var e=ct(),r=x(f(e),2),d=v(r),m=v(d);C(m,{onClick:H,fullWidth:!0,children:(A,E)=>{var J=S("Close");t(A,J)},$$slots:{default:!0}}),t(n,e)};b(l,n=>{p(o)==="success"&&n(u)},!0)}t(s,a)};b(g,s=>{p(o)==="error"?s($):s(k,!1)},!0)}t(i,c)};b(L,i=>{p(o)==="idle"?i(O):i(T,!1)})}t(I,w),X()}export{ut as default};
