import{p as te,d as ae,g as re,A as se,z as ne,u as oe,i as s,e as I,o as le,f as y,k as h,c as d,b as t,l as ie,s as w,j as i,B as N,w as T,D as ce,m as A,n as f,E as ve,F as L,G as de,L as O,x as fe}from"./index-DGGsS_Lk.js";import{I as ye}from"./Input-BwXXhkUc.js";import{g as pe,a as me}from"./api-C5JaEwh0.js";var ue=y('<form><p class="message error svelte-1wrlvyn">Enter a name for a key</p> <div class="inputContainer svelte-1wrlvyn"><!></div> <div class="buttonContainer svelte-1wrlvyn"><!></div></form>'),ge=y('<p class="message svelte-1wrlvyn">Adding the access key</p>'),he=y('<p class="message svelte-1wrlvyn">Confirming</p>'),Ce=y('<p class="message error svelte-1wrlvyn">Something went wrong</p> <div class="buttonContainer svelte-1wrlvyn"><!></div>',1),_e=y('<p class="message svelte-1wrlvyn">Confirm this operation with another key</p> <div class="buttonContainer svelte-1wrlvyn"><!></div>',1),we=y('<div class="content svelte-1wrlvyn"><!></div>');function be(z,G){te(G,!0);const{blockDialog:B}=ae(),{popStackPages:H}=re(),{getAccount:J}=se(),{back:U}=ne();let e=I("idle"),C="",K=null,k=I("");oe(()=>{B(s(e)==="confirmingAccessKey"||s(e)==="addingAccessKey")}),le(()=>()=>{B(!1)});const M=async a=>{a.preventDefault(),i(e,"addingAccessKey");try{C=await pe();const r=await me(),n=J();if(!n||!n.encryptedClientKey)throw new Error("No account found");const p=await ve({encryptedClientKey:L(n.encryptedClientKey),serverKey:L(r)});K=await de({challenge:C,clientKey:p}),i(e,"confirmAccessKey")}catch{i(e,"error");return}},q=async()=>{i(e,"confirmingAccessKey");try{const a=await fe({challenge:C});if(!K)throw new Error("No credential data found");if(!(await fetch("/api/addCredential",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({challenge:C,name:s(k)||`key ${Math.floor(Math.random()*1e3)}`,newCredential:K,confirmCredential:a.credentialData})})).ok)throw new Error("Failed to add access key");H(),U()}catch{i(e,"error");return}};var j=we(),Q=d(j);{var R=a=>{var r=ue(),n=w(d(r),2),p=d(n);ye(p,{placeholder:"key name",get value(){return s(k)},set value(l){i(k,l,!0)}});var $=w(n,2),o=d($);N(o,{onClick:M,children:(l,b)=>{var m=T("Add key");t(l,m)},$$slots:{default:!0}}),ce("submit",r,M),t(a,r)},V=a=>{var r=A(),n=f(r);{var p=o=>{O(o,{children:(l,b)=>{var m=ge();t(l,m)},$$slots:{default:!0}})},$=o=>{var l=A(),b=f(l);{var m=c=>{O(c,{children:(_,F)=>{var x=he();t(_,x)},$$slots:{default:!0}})},W=c=>{var _=A(),F=f(_);{var x=v=>{var u=Ce(),P=w(f(u),2),D=d(P);N(D,{onClick:()=>{i(e,"idle")},children:(g,S)=>{var E=T("Try Again");t(g,E)},$$slots:{default:!0}}),t(v,u)},X=v=>{var u=A(),P=f(u);{var D=g=>{var S=_e(),E=w(f(S),2),Y=d(E);N(Y,{onClick:q,children:(Z,Ae)=>{var ee=T("Confirm");t(Z,ee)},$$slots:{default:!0}}),t(g,S)};h(P,g=>{s(e)==="confirmAccessKey"&&g(D)},!0)}t(v,u)};h(F,v=>{s(e)==="error"?v(x):v(X,!1)},!0)}t(c,_)};h(b,c=>{s(e)==="confirmingAccessKey"?c(m):c(W,!1)},!0)}t(o,l)};h(n,o=>{s(e)==="addingAccessKey"?o(p):o($,!1)},!0)}t(a,r)};h(Q,a=>{s(e)==="idle"?a(R):a(V,!1)})}t(z,j),ie()}export{be as default};
