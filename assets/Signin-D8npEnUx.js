import{p as R,A as z,C as J,g as M,z as N,d as W,e as x,h as q,u as G,i as a,y as Q,o as V,f as y,k as A,c as S,b as l,l as X,j as c,x as Y,F as Z,s as b,n as m,L as ee,m as te,B as ne,w as ae}from"./index-CZzB_zyz.js";import{g as re}from"./api-C5JaEwh0.js";var e=(r=>(r[r.Signin=0]="Signin",r[r.SigninError=1]="SigninError",r))(e||{}),se=y('<p class="message svelte-9hh95f">signin</p> <!>',1),ie=y('<p class="message svelte-9hh95f">error signin</p> <div class="buttonContainer svelte-9hh95f"><div class="buttonContainerItem svelte-9hh95f"><!></div></div>',1),oe=y('<div class="content svelte-9hh95f"><!></div>');function fe(r,w){R(w,!0);const{getAppHistory:P,back:E,closeDialogStack:B,deleteSearchParam:D}=z(),{initAccount:K}=J(),{updateStackPages:U}=M(),{getAccount:j}=N(),H=P(),{blockDialog:g,unBlockBackDialog:v}=W();let h=Q(j),_=x(""),n=x(q(e.Signin));const C=async()=>{c(n,e.Signin,!0);try{const t=await re(),{credentialData:s,clientKey:o}=await Y({challenge:t}),f=await fetch("/api/signin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(f.status!==200){c(n,e.SigninError,!0);return}const i=await f.json();if(!i.serverKey){c(n,e.SigninError,!0);return}const u=i.serverKey,p=a(h)===void 0;if(await K({clientKey:o,serverKey:new Uint8Array(Z(u))}),p)g(!1),B();else{g(!1);let d=new URLSearchParams(H.search).get("retPath")||"";d&&(c(_,d,!0),D("retPath")),E({to:a(_)}),U()}}catch{c(n,e.SigninError,!0)}};G(()=>{a(h)===null&&g(a(n)===e.Signin),v(a(n)!==e.Signin)}),V(()=>(a(h)===void 0&&(g(!0),v(!1)),C(),()=>{v(!1)}));var k=oe(),I=S(k);{var L=t=>{var s=se(),o=b(m(s),2);ee(o,{}),l(t,s)},T=t=>{var s=te(),o=m(s);{var f=i=>{var u=ie(),p=b(m(u),2),d=S(p),$=S(d);ne($,{onClick:()=>C(),fullWidth:!0,children:(F,le)=>{var O=ae("try again");l(F,O)},$$slots:{default:!0}}),l(i,u)};A(o,i=>{a(n)===e.SigninError&&i(f)},!0)}l(t,s)};A(I,t=>{a(n)===e.Signin?t(L):t(T,!1)})}l(r,k),X()}export{fe as default};
