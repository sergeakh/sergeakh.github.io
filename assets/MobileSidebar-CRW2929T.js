import{p as Z,$ as te,M as ne,o as $,l as ee,i as e,y as X,g as oe,a0 as ie,a1 as se,a2 as ae,u as z,e as K,f as re,n as U,k as W,c as G,X as j,s as q,t as ce,b as J,m as le,a3 as de,a4 as ue,j as Q,N as me,O as fe}from"./index-DGGsS_Lk.js";function ge(B,t){Z(t,!0);const{getIsKeyboardVisible:V}=te();let a=ne(t,"dialog",7);const S=X(V),P=3,x=50,L=5,i=.6,h=.3,c=.35,C=.95;let v=0,_=0,y=0,M=!1,p=!1,u=0,m=0,w=0;const f=()=>{v=0,_=0,M=!1,p=!1,u=0,m=0,w=0,y=0,l!==null&&(cancelAnimationFrame(l),l=null),T=null};let l=null,T=null;const A=o=>{a()&&(t.sidebarState!=="opened"&&t.sidebarState!=="closed"||(v=o.touches[0].clientX,_=o.touches[0].clientY,y=performance.now(),M=!0,p=!1))},k=o=>t.sidebarState==="closed"&&o>0||t.sidebarState==="closeSwiping"&&o>0||t.sidebarState==="opened"&&o<0||t.sidebarState==="openSwiping"&&o<0,H=()=>{if(a()){if(a().style.setProperty("--transition-timing","0s"),!a().open&&t.sidebarState==="closed")try{a().showModal(),a().offsetWidth}catch{return}t.onSwipe();try{const o=window.getComputedStyle(a()),s=o.transform||o.webkitTransform||"";if(m=a().offsetWidth,t.sidebarState==="closeSwiping"||t.sidebarState==="closed"?u=-m:(t.sidebarState==="openSwiping"||t.sidebarState==="opened")&&(u=0),s&&s!=="none")try{u=new DOMMatrix(s).m41}catch{}p=!0}catch{f()}}},Y=()=>{if(!a())return;const o=-(m*.27),s=-m;let r=0;const d=window.getComputedStyle(a()),E=d.transform||d.webkitTransform||"";if(E&&E!=="none")try{r=new DOMMatrix(E).m41}catch{r=0}const N=.25*Math.min(1,Math.max(0,(r-s)/(o-s)));a().style.setProperty("--backdrop-bg",`rgba(0, 0, 0, ${N})`)},F=()=>{if(l=null,!T||!M||!a()||e(S))return;const{x:o,y:s}=T;T=null;const r=o-v,d=s-_,E=Math.abs(r)>Math.abs(d),D=Math.abs(r)>P;if(!p)if(E&&D&&k(r))try{H()}catch{f();return}else return;if(!k(r))return;a().style.setProperty("--transition-timing","0s");let b=u+r*C;const N=-m,O=-(m*.27);b=Math.max(N,Math.min(O,b)),a().style.transform=`translate3d(${b}px, 0, 0)`,w=(b-u)/m*100,Y()},n=o=>{if(!M)return;const s=o.touches[0].clientX,r=o.touches[0].clientY;T={x:s,y:r},l===null&&(l=requestAnimationFrame(F)),p&&Math.abs(s-v)>Math.abs(r-_)&&o.preventDefault()},g=o=>{const s=Math.abs(o);if(s>=i)return L;if(s>=h){const r=(s-h)/(i-h);return x-r*(x-L)}else return x},R=(o,s)=>{if(Math.abs(o)>=i)return c*.5;const d=Math.abs(w)/100;return s?c*Math.max(.5,1-d):c*Math.max(.5,d)},I=o=>{if(l!==null&&(cancelAnimationFrame(l),l=null),T=null,!M||!a()){f();return}if(!p){f();return}let s=0;if(o?.changedTouches?.[0]){const b=o.changedTouches[0].clientX,O=performance.now()-y;O>0&&(s=(b-v)/O)}const r=g(s);let d=null;t.sidebarState==="closeSwiping"?d=Math.abs(w)>r||s>h?"open":"close":t.sidebarState==="openSwiping"&&(d=Math.abs(w)>r||s<-h?"close":"open");const E=t.sidebarState==="closeSwiping"&&d==="open"||t.sidebarState==="openSwiping"&&d==="close",D=R(s,E);a().style.setProperty("--transition-timing",`${D}s`),a().offsetWidth,a().style.transform="",d==="open"?t.onOpen():d==="close"&&t.onClose(),a()?.style.removeProperty("--backdrop-bg"),f()};$(()=>(document.addEventListener("touchstart",A,{passive:!0}),document.addEventListener("touchmove",n,{passive:!1}),document.addEventListener("touchend",I,{passive:!0}),document.addEventListener("touchcancel",I,{passive:!0}),()=>{document.removeEventListener("touchstart",A),document.removeEventListener("touchmove",n),document.removeEventListener("touchend",I),document.removeEventListener("touchcancel",I),l!==null&&cancelAnimationFrame(l)})),ee()}var he=re('<dialog><div class="dialogInner svelte-1nov8pn"><!></div></dialog> <!> <!>',1);function Se(B,t){Z(t,!0);const{getStackPages:V}=oe(),{getSidebarState:a,handleComputeState:S}=ie();let P=350;const x=se(),{isScrolling:L}=ae();let i=K(null),h=K(null),c=X(a);z(()=>{V().length>0&&S({type:"close"})});const C=()=>{t.blocked||S({type:"close"})},v=()=>{t.blocked||S({type:"open"})},_=()=>{S({type:"opened"})},y=()=>{S({type:"closed"})},M=()=>{S({type:"swipe"})},p=n=>{n.preventDefault(),C()};$(()=>(e(i)?.addEventListener("close",y),e(i)?.addEventListener("cancel",p),()=>{e(i)?.removeEventListener("close",y),e(i)?.removeEventListener("cancel",p)}));const u=()=>{e(i)?.style.removeProperty("--transition-timing"),e(i)?.style.removeProperty("transform"),e(i)?.style.removeProperty("--backdrop-bg")},m=X(L);z(()=>{if(e(c),!!e(i))switch(e(c).type){case"closeSwiping":{const n=setTimeout(()=>{C()},3e3);return()=>{clearTimeout(n)}}case"openSwiping":{const n=setTimeout(()=>{v()},3e3);return()=>{clearTimeout(n)}}case"opening":{e(i).open||e(i).showModal(),e(i).getBoundingClientRect();const n=setTimeout(()=>{u()},P+1),g=()=>{clearTimeout(n),u()};return e(i)?.addEventListener("transitionend",g,{once:!0}),_(),()=>{e(i)?.removeEventListener("transitionend",g)}}case"closing":{const n=setTimeout(()=>{e(c).type==="closing"&&y()},P+1),g=()=>{clearTimeout(n),y()};return e(i)?.addEventListener("transitionend",g,{once:!0}),()=>{e(i)?.removeEventListener("transitionend",g)}}case"closed":e(i)?.close(),u();break;case"opened":u();break}});var w=he(),f=U(w),l=G(f),T=G(l);{var A=n=>{var g=le(),R=U(g);de(R,()=>t.children),J(n,g)};W(T,n=>{e(c).type!=="closed"&&n(A)})}j(l,n=>Q(h,n),()=>e(h)),j(f,n=>Q(i,n),()=>e(i));var k=q(f,2);{var H=n=>{ue(n,{get dialog(){return e(i)},get dialogInner(){return e(h)},onClose:C})};W(k,n=>{e(c).type==="opened"&&!t.blocked&&n(H)})}var Y=q(k,2);{var F=n=>{ge(n,{onClose:C,onOpen:v,onSwipe:M,get sidebarState(){return e(c).type},get dialog(){return e(i)}})};W(Y,n=>{(!e(m)&&e(c).type==="closed"||e(c).type==="opened"||e(c).type==="openSwiping"||e(c).type==="closeSwiping")&&!t.blocked&&n(F)})}ce(()=>me(f,1,fe([{open:e(c).type==="opened",hidden:t.blocked,isAnimationOn:x.working&&(!x.isSwiping||!t.blocked)}]),"svelte-1nov8pn")),J(B,w),ee()}export{Se as default};
