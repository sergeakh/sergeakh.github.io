import{p as ie,b as M,E as ve,u as R,s as U,a as t,o as de,n as i,f as l,i as v,c as n,d as a,e as ge,L as V,l as O,j as h,x as fe,h as d,K as pe,M as ue,N as q,q as ye,O as _e,V as me,t as B,P as he,J as Ae,B as z,Q as Ke,R as ke,S as we,T as Q}from"./index-5Q1JuVjx.js";import{g as Pe}from"./api-7nXQQ8YG.js";var be=l('<p class="message svelte-1aog49v">Loading access keys</p>'),Ce=l('<p class="message svelte-1aog49v">Confirming</p>'),xe=(F,A,e)=>A(t(e).id),De=l('<button class="buttonDelete svelte-1aog49v"><!> <!></button>'),$e=l('<li class="svelte-1aog49v"><div class="keyInfo svelte-1aog49v"><div><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper></div> <div class="keyName svelte-1aog49v"> </div></div> <div class="keyActions svelte-1aog49v"><!></div></li>'),Se=l('<p class="message error svelte-1aog49v">Error deleting access key</p>'),je=l('<div class="buttonContainer svelte-1aog49v"><!></div>'),Te=l('<p class="message svelte-1aog49v">You have reached the maximum number of access keys.</p>'),Ee=l('<p class="message svelte-1aog49v">Access Keys</p> <ul class="svelte-1aog49v"></ul> <!> <!>',1),Le=l('<p class="message error svelte-1aog49v">Something went wrong</p> <div class="buttonContainer svelte-1aog49v"><!></div>',1),Oe=l('<div class="content svelte-1aog49v"><!></div>');function Ne(F,A){ie(A,!0);let e=M("loadingAccessKeys"),K=M(ve([]));R(()=>{U(t(e)==="loadingAccessKeys"||t(e)==="confirmingDeleteAccessKey")}),de(()=>()=>{U(!1)}),R(()=>{if(!A.hidden&&t(e)==="successAccessKeys"||t(e)==="loadingAccessKeys"){const s=new AbortController;return(async()=>{try{const c=await fetch("/api/auth/accessKeys",{method:"POST",signal:s.signal});if(!c.ok)throw new Error("Failed to fetch access keys");const g=await c.json();i(K,g.credentials||[],!0),i(e,"successAccessKeys")}catch{i(e,"errorAccessKeys")}})(),()=>{s.abort()}}});const Y=()=>{const s=we();s.includes("confirmAccessKey")||s.push("confirmAccessKey");const c=new URLSearchParams(Q.search);return c.set("stackPages",s.join(",")),`${Q.pathname}?${c}`},G=s=>{s.preventDefault(),ke("confirmAccessKey")},W=async s=>{i(e,"confirmingDeleteAccessKey");try{const c=await Pe(),g=await Ae({challenge:c}),f=await fetch("/api/auth/deleteCredential",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({challenge:c,id:s,confirmCredential:g.credentialData})});if(!f.ok)throw new Error("Failed to add access key");if(!(await f.json()).success){i(e,"errorDeleteAccessKey");return}i(e,"loadingAccessKeys")}catch{i(e,"errorDeleteAccessKey");return}};var H=Oe(),X=n(H);{var Z=s=>{V(s,{children:(c,g)=>{var f=be();a(c,f)},$$slots:{default:!0}})},ee=s=>{var c=O(),g=h(c);{var f=p=>{V(p,{children:(k,I)=>{var D=Ce();a(k,D)},$$slots:{default:!0}})},N=p=>{var k=O(),I=h(k);{var D=u=>{var _=Ee(),w=d(h(_),2);pe(w,21,()=>t(K),he,(r,o)=>{var y=$e(),C=n(y),x=n(C),j=n(x);ue(j,()=>({"--size":"20px"})),q(j.lastChild,{name:"key"});var T=d(x,2),ae=n(T),te=d(C,2),re=n(te);{var ce=E=>{var L=De();L.__click=[xe,W,o];var J=n(L);q(J,{name:"close"});var oe=d(J,2);me(oe,{children:(le,Be)=>{var ne=B("delete access key");a(le,ne)}}),a(E,L)};v(re,E=>{t(K).length>1&&E(ce)})}ye(()=>_e(ae,t(o).name)),a(r,y)});var P=d(w,2);{var m=r=>{var o=Se();a(r,o)};v(P,r=>{t(e)==="errorDeleteAccessKey"&&r(m)})}var b=d(P,2);{var $=r=>{var o=je(),y=n(o);{let C=Ke(Y);z(y,{element:"a",get href(){return t(C)},onClick:G,children:(x,j)=>{var T=B("Add access key");a(x,T)},$$slots:{default:!0}})}a(r,o)},S=r=>{var o=Te();a(r,o)};v(b,r=>{t(K).length<5?r($):r(S,!1)})}a(u,_)},se=u=>{var _=O(),w=h(_);{var P=m=>{var b=Le(),$=d(h(b),2),S=n($);z(S,{onClick:()=>{i(e,"loadingAccessKeys")},children:(r,o)=>{var y=B("Try Again");a(r,y)},$$slots:{default:!0}}),a(m,b)};v(w,m=>{t(e)==="errorAccessKeys"&&m(P)},!0)}a(u,_)};v(I,u=>{t(e)==="successAccessKeys"||t(e)==="errorDeleteAccessKey"?u(D):u(se,!1)},!0)}a(p,k)};v(g,p=>{t(e)==="confirmingDeleteAccessKey"?p(f):p(N,!1)},!0)}a(s,c)};v(X,s=>{t(e)==="loadingAccessKeys"?s(Z):s(ee,!1)})}a(F,H),ge()}fe(["click"]);export{Ne as default};
