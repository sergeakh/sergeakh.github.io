import{p as j,s as w,a as I,o as L,g as s,x as O,b as v,a7 as h,u as T,f as m,i as A,d as p,e as l,h as $,A as R,c,w as F,a8 as G,K as H,G as J,a9 as M,aa as N,O as W,ab as q,m as B,k as S,L as z,j as Q,B as V,v as X}from"./index-HG9Zaxut.js";import{g as Y}from"./api-C5JaEwh0.js";var a=(t=>(t[t.Signin=0]="Signin",t[t.SigninError=1]="SigninError",t))(a||{}),Z=m('<p class="message svelte-9hh95f">signin</p> <!>',1),ee=m('<p class="message svelte-9hh95f">error signin</p> <div class="buttonContainer svelte-9hh95f"><div class="buttonContainerItem svelte-9hh95f"><!></div></div>',1),ae=m('<div class="content svelte-9hh95f"><!></div>');function se(t,E){j(E,!0);let y=O(R),_=w(""),r=w(I(a.Signin));const b=async()=>{c(r,a.Signin,!0);try{const e=await Y(),{credentialData:n,clientKey:o}=await F({challenge:e}),g=await fetch("/api/signin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(g.status!==200){c(r,a.SigninError,!0);return}const i=await g.json();if(!i.serverKey){c(r,a.SigninError,!0);return}const d=i.serverKey,u=s(y)===void 0;if(await G({clientKey:o,serverKey:new Uint8Array(H(d))}),u)v(!1),J();else{v(!1);let f=new URLSearchParams(M.search).get("retPath")||"";f&&(c(_,f,!0),N("retPath")),W({to:s(_)}),q()}}catch(e){console.error("Error during sign-in:",e),c(r,a.SigninError,!0)}};L(()=>(s(y)===void 0&&(v(!0),h(!1)),b(),()=>{h(!1)})),T(()=>{v(s(r)===a.Signin),h(s(r)!==a.Signin)});var k=ae(),P=p(k);{var C=e=>{var n=Z(),o=B(S(n),2);z(o,{}),l(e,n)},K=e=>{var n=Q(),o=S(n);{var g=i=>{var d=ee(),u=B(S(d),2),f=p(u),x=p(f);V(x,{onClick:()=>b(),fullWidth:!0,children:(D,re)=>{var U=X("try again");l(D,U)},$$slots:{default:!0}}),l(i,d)};A(o,i=>{s(r)===a.SigninError&&i(g)},!0)}l(e,n)};A(P,e=>{s(r)===a.Signin?e(C):e(K,!1)})}l(t,k),$()}export{se as default};
