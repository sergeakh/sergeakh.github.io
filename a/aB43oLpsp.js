import{p as Oe,J as Le,u as $e,v as Se,K as Ie,b as T,w as Re,x as He,g as e,o as de,f as y,j as x,c as l,i as c,m as Be,a as d,n as O,s as v,d as Pe,I as je,y as te,z as F,N as Fe,B as ae,A as re,L as Me,r as Ne}from"./aDtRHTHbT.js";import{S as Ue,a as M}from"./aB3_R2dYG.js";const ze=W=>{const E=Math.floor(Date.now()/1e3),u={};W.forEach(s=>{if(!s)return;const f=s.data.tags||["Imported"];if(f.length===0){u.ROOT||(u.ROOT=[]),u.ROOT.push(s);return}f.forEach(p=>{u[p]||(u[p]=[]),u[p].push(s)})});let h=`<!DOCTYPE NETSCAPE-Note-file-1>
<!-- This is an automatically generated file.
 It will be read and overwritten.
 DO NOT EDIT! -->
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8">
<TITLE>Bookmarks</TITLE>
<H1>Bookmarks</H1>
<DL><p>
<DT><H3 ADD_DATE="${E}" LAST_MODIFIED="${E}" PERSONAL_TOOLBAR_FOLDER="true">Bookmarks bar</H3>
<DL><p>`;return Object.keys(u).forEach(s=>{s!=="ROOT"&&s!=="other"&&(h+=`
    <DT><H3 ADD_DATE="${E}" LAST_MODIFIED="${E}">${s}</H3>
    <DL><p>`,u[s].forEach(f=>{if(!f.data.link)return;const p=f.data.link.title.replace(/"/g,"&quot;");h+=`
        <DT><A HREF="${f.data.link.url}" ADD_DATE="${Math.floor(f.data.createdAt/1e3)||E}">${p}</A>`}),h+=`
    </DL><p>`)}),u.ROOT&&u.ROOT.forEach(s=>{if(!s.data.link)return;const f=s.data.link.title.replace(/"/g,"&quot;");h+=`
    <DT><A HREF="${s.data.link.url}" ADD_DATE="${Math.floor(s.data.createdAt/1e3)||E}">${f}</A>`}),h+=`
</DL><p>`,u.other&&u.other.forEach(s=>{if(!s.data.link)return;const f=s.data.link.title.replace(/"/g,"&quot;");h+=`
    <DT><A HREF="${s.data.link.url}" ADD_DATE="${Math.floor(s.data.createdAt/1e3)||E}">${f}</A>`}),h+="</DL><p>",h};var qe=y('<div class="g p-10n6f3r"><p class="h p-10n6f3r">Exclude history</p> <div class="i p-10n6f3r"><!></div></div>'),We=y('<div class="g p-10n6f3r"><p class="h p-10n6f3r">Exclude other tags</p> <div class="i p-10n6f3r"><!></div></div>'),Je=y('<div class="g p-10n6f3r"><p class="h p-10n6f3r">Exclude bin</p> <div class="i p-10n6f3r"><!></div></div> <div class="g p-10n6f3r"><p class="h p-10n6f3r">Exclude archive</p> <div class="i p-10n6f3r"><!></div></div> <!> <div class="g p-10n6f3r"><p class="h p-10n6f3r">Exclude tags</p> <div class="i p-10n6f3r"><!></div></div> <!> <p class="j k p-10n6f3r">Filter tags:</p> <!>',1),Ge=y('<div class="l p-10n6f3r"><!></div>'),Ke=y('<div class="b p-10n6f3r"><div class="c p-10n6f3r"><!> <p class="d p-10n6f3r"><!></p></div></div> <div><div class="e p-10n6f3r"><button class="f p-10n6f3r"><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper><span>Settings</span></button></div> <!> <!></div>',1),Qe=y('<div class="b p-10n6f3r"><p class="j p-10n6f3r">Exporting...</p> <!></div>'),Ve=y('<div class="b p-10n6f3r"><p class="j m p-10n6f3r">Something went wrong</p></div> <div class="l p-10n6f3r"><!></div>',1),Ye=y('<div class="b p-10n6f3r"><p class="j p-10n6f3r">Exported successfully!</p></div> <div class="l p-10n6f3r"><!></div>',1),Xe=y('<div class="a p-10n6f3r"><!></div>');function tt(W,E){Oe(E,!0);const{getGetNotes:u}=Le(),{clearDialogPages:h}=$e(),{blockDialog:s}=Se(),{checkMobileSize:f}=Ie();let p=T("idle"),H=T("sync"),_=T(Re([])),L=T(!1),J=T(!1),A=T(!1),N=T(!1),U=T(!1),G=T(!1),K=T(!1);const ce=()=>{h()};He(()=>{s(e(p)==="loading")}),de(()=>()=>{s(!1)});const ve=()=>{d(J,!e(J)),d(U,!1),d(N,!1),d(L,!1),d(_,[],!0)},fe=async()=>{d(p,"loading"),await new Promise(r=>setTimeout(r,0));let n=(u()()||[]).filter(r=>r.data).filter(r=>e(_).length===0?!0:e(_).every(t=>r.data.tags.includes(t)));if(e(U)&&(n=n.map(r=>{const t={...r};return t.data={...t.data,history:[]},t})),e(G)&&(n=n.filter(r=>!r.data.deletedAt)),e(K)&&(n=n.filter(r=>!r.data.archivedAt)),e(A)&&(n=n.map(r=>{const t={...r};return t.data={...t.data,tags:[],history:t.data.history.map(o=>({...o,tags:[]}))},t})),e(N)&&e(A)===!1&&(n=n.map(r=>{const t={...r};return t.data={...t.data,tags:t.data.tags.filter(o=>e(_).includes(o)),history:t.data.history.map(o=>({...o,tags:o.tags.filter(m=>e(_).includes(m))}))},t})),e(H)==="sync"){const r=`${[...e(A)?[]:e(_),"notes"].join("_")}.json`,t=JSON.stringify({filteredNotes:n}),o=new Blob([t],{type:"application/json"});return{filename:r,blob:o}}else{const r=`${[...e(A)?[]:e(_),"bookmarks"].join("_")}_${new Date().toLocaleDateString().replace(/\//g,"_")}.html`,t=ze(n),o=new Blob([t],{type:"text/html"});return{filename:r,blob:o}}},pe=async()=>{try{const{filename:a,blob:n}=await fe(),r=new File([n],a,{type:n.type});if(navigator.canShare({files:[r]}))await navigator.share({files:[r]});else{const t=URL.createObjectURL(n),o=document.createElement("a");o.href=t,o.download=a,document.body.appendChild(o),o.click(),setTimeout(()=>{document.body.removeChild(o),URL.revokeObjectURL(t)},0)}await new Promise(t=>setTimeout(t,0)),d(p,"success")}catch{d(p,"error")}},ue=a=>{d(_,a,!0)},se=a=>{a.key==="Escape"&&(document.activeElement instanceof HTMLInputElement&&document.activeElement.type==="text"||document.activeElement instanceof HTMLTextAreaElement)&&(e(L)&&d(L,!1),document.activeElement.blur(),a.preventDefault(),a.stopPropagation())},ge=a=>{d(N,a,!0)},he=a=>{d(U,a,!0)},_e=a=>{d(G,a,!0)},me=a=>{d(K,a,!0)},Te=a=>{d(A,a,!0)};de(()=>(document.addEventListener("keydown",se),()=>document.removeEventListener("keydown",se)));var ne=Xe(),Ee=l(ne);{var ke=a=>{var n=Ke(),r=O(n),t=l(r),o=l(t);Ue(o,{items:[{title:"Sync",value:"sync"},{title:"Bookmarks",value:"bookmarks"}],get value(){return e(H)},onChange:i=>{d(H,i,!0)}});var m=v(o,2),w=l(m);{var B=i=>{var g=F("App format for sync or backup");c(i,g)},Q=i=>{var g=F("Browser bookmarks format (exports only bookmarks, not notes)");c(i,g)};x(w,i=>{e(H)==="sync"?i(B):i(Q,!1)})}var V=v(r,2),k=l(V),b=l(k);b.__click=ve;var $=l(b);Pe($,()=>({"--rotate":"30deg","--size":"20px"})),je($.lastChild,{name:"settings"});var S=v(k,2);{var C=i=>{var g=Je(),R=O(g),q=v(l(R),2),P=l(q);M(P,{get checked(){return e(G)},onChange:_e});var Y=v(R,2),X=v(l(Y),2),xe=l(X);M(xe,{get checked(){return e(K)},onChange:me});var oe=v(Y,2);{var ye=D=>{var j=qe(),Z=v(l(j),2),ee=l(Z);M(ee,{get checked(){return e(U)},onChange:he}),c(D,j)};x(oe,D=>{e(H)==="sync"&&D(ye)})}var le=v(oe,2),be=v(l(le),2),Ae=l(be);M(Ae,{get checked(){return e(A)},onChange:Te});var ie=v(le,2);{var we=D=>{var j=We(),Z=v(l(j),2),ee=l(Z);M(ee,{get checked(){return e(N)},onChange:ge}),c(D,j)};x(ie,D=>{e(_).length>0&&!e(A)&&D(we)})}var Ce=v(ie,4);Fe(Ce,{mode:"exit",get selectedTags(){return e(_)},onChangeTags:ue,get shownTagInput(){return e(L)},set shownTagInput(D){d(L,D,!0)}}),c(i,g)};x(S,i=>{e(J)&&i(C)})}var I=v(S,2);{var z=i=>{var g=Ge(),R=l(g);{let q=re(f);ae(R,{get fullWidth(){return e(q)},onClick:pe,children:(P,Y)=>{var X=F("Export");c(P,X)},$$slots:{default:!0}})}c(i,g)};x(I,i=>{e(L)||i(z)})}c(a,n)},De=a=>{var n=te(),r=O(n);{var t=m=>{var w=Qe(),B=v(l(w),2);Me(B,{}),c(m,w)},o=m=>{var w=te(),B=O(w);{var Q=k=>{var b=Ve(),$=v(O(b),2),S=l($);{let C=re(f);ae(S,{get fullWidth(){return e(C)},onClick:()=>{d(p,"idle")},children:(I,z)=>{var i=F("Try Again");c(I,i)},$$slots:{default:!0}})}c(k,b)},V=k=>{var b=te(),$=O(b);{var S=C=>{var I=Ye(),z=v(O(I),2),i=l(z);{let g=re(f);ae(i,{get fullWidth(){return e(g)},onClick:ce,children:(R,q)=>{var P=F("Close");c(R,P)},$$slots:{default:!0}})}c(C,I)};x($,C=>{e(p)==="success"&&C(S)},!0)}c(k,b)};x(B,k=>{e(p)==="error"?k(Q):k(V,!1)},!0)}c(m,w)};x(r,m=>{e(p)==="loading"?m(t):m(o,!1)},!0)}c(a,n)};x(Ee,a=>{e(p)==="idle"?a(ke):a(De,!1)})}c(W,ne),Be()}Ne(["click"]);export{tt as default};
