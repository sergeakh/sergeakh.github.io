import{p as H,v as L,D as O,C as R,a as b,x as z,w as J,y as M,g as s,o as N,f as y,i as x,b as h,e as o,h as V,s as d,u as A,ab as W,L as q,z as F,j as G,H as I,A as U,d as Q,B as X}from"./aBhExeEdR.js";import{g as Y}from"./a9q_jSmK4.js";import{c as Z,e as ee,b as ae,a as te}from"./agMDNaL23.js";var t=(r=>(r[r.Signup=0]="Signup",r[r.SignupError=1]="SignupError",r))(t||{}),re=y('<div class="b p-mcehu"><!></div>'),ne=y('<div class="b p-mcehu"><!> <!></div>'),se=y('<div class="a p-mcehu"><!></div>');function le(r,B){H(B,!0);const K=L(),m=O(),S=R();let D=A(()=>S.get()),E=A(()=>m.getAccount()),_=b(""),n=b(z(t.Signup));const{blockDialog:C}=J(),w=async()=>{d(n,t.Signup,!0);try{const e=await Y(),a=crypto.getRandomValues(new Uint8Array(32)),i=await Z({challenge:e,clientKey:a}),l=await fetch("/api/signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(l.status!==200){d(n,t.SignupError,!0);return}const c=await l.json(),u=s(E)===void 0,{encryptedClientKey:p}=await ee({clientKey:a,serverKey:new Uint8Array(ae(c.serverKey))});if(W(),await m.initCloudAccount({encryptedClientKey:te(p)}),C(!1),u)K.clear();else{let g=s(D).get("retPath")||"";g&&d(_,g,!0),S.replace(s(_)||"")}}catch{d(n,t.SignupError,!0)}};M(()=>{C(s(n)===t.Signup)}),N(()=>{w()});var P=se(),$=h(P);{var T=e=>{var a=re(),i=h(a);q(i,{}),o(e,a)},j=e=>{var a=F(),i=G(a);{var l=c=>{var u=ne(),p=h(u);I(p,{children:(v,k)=>{var f=U("something went wrong");o(v,f)}});var g=Q(p,2);X(g,{onClick:()=>w(),fullWidth:!0,children:(v,k)=>{var f=U("try again");o(v,f)},$$slots:{default:!0}}),o(c,u)};x(i,c=>{s(n)===t.SignupError&&c(l)},!0)}o(e,a)};x($,e=>{s(n)===t.Signup?e(T):e(j,!1)})}o(r,P),V()}export{le as default};
