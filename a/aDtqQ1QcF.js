import{p as He,J as Ne,u as Pe,v as Be,K as Fe,b as m,w as Me,x as je,g as e,o as ce,f as A,j as y,c as n,i as f,m as Ue,a as l,n as w,s as c,d as ze,I as qe,y as ae,z as M,N as We,B as re,A as se,L as Je,r as Ge}from"./aBm_qFcdv.js";import{S as Ke}from"./aCQ5vSr5x.js";import{S as N}from"./avDMjaIGH.js";const Qe=J=>{const k=Math.floor(Date.now()/1e3),h={};J.forEach(o=>{if(!o)return;const u=o.data.tags||["Imported"];if(u.length===0){h.ROOT||(h.ROOT=[]),h.ROOT.push(o);return}u.forEach(p=>{h[p]||(h[p]=[]),h[p].push(o)})});let T=`<!DOCTYPE NETSCAPE-Note-file-1>
<!-- This is an automatically generated file.
 It will be read and overwritten.
 DO NOT EDIT! -->
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8">
<TITLE>Bookmarks</TITLE>
<H1>Bookmarks</H1>
<DL><p>
<DT><H3 ADD_DATE="${k}" LAST_MODIFIED="${k}" PERSONAL_TOOLBAR_FOLDER="true">Bookmarks bar</H3>
<DL><p>`;return Object.keys(h).forEach(o=>{o!=="ROOT"&&o!=="other"&&(T+=`
    <DT><H3 ADD_DATE="${k}" LAST_MODIFIED="${k}">${o}</H3>
    <DL><p>`,h[o].forEach(u=>{if(!u.data.link)return;const p=u.data.link.title.replace(/"/g,"&quot;");T+=`
        <DT><A HREF="${u.data.link.url}" ADD_DATE="${Math.floor(u.data.createdAt/1e3)||k}">${p}</A>`}),T+=`
    </DL><p>`)}),h.ROOT&&h.ROOT.forEach(o=>{if(!o.data.link)return;const u=o.data.link.title.replace(/"/g,"&quot;");T+=`
    <DT><A HREF="${o.data.link.url}" ADD_DATE="${Math.floor(o.data.createdAt/1e3)||k}">${u}</A>`}),T+=`
</DL><p>`,h.other&&h.other.forEach(o=>{if(!o.data.link)return;const u=o.data.link.title.replace(/"/g,"&quot;");T+=`
    <DT><A HREF="${o.data.link.url}" ADD_DATE="${Math.floor(o.data.createdAt/1e3)||k}">${u}</A>`}),T+="</DL><p>",T};var Ve=A('<div class="g p-10n6f3r"><p class="h p-10n6f3r">Exclude history</p> <div class="i p-10n6f3r"><!></div></div> <div class="g p-10n6f3r"><p class="h p-10n6f3r">Exclude notes</p> <div class="i p-10n6f3r"><!></div></div>',1),Ye=A('<div class="g p-10n6f3r"><p class="h p-10n6f3r">Exclude other tags</p> <div class="i p-10n6f3r"><!></div></div>'),Xe=A('<div class="g p-10n6f3r"><p class="h p-10n6f3r">Exclude bin</p> <div class="i p-10n6f3r"><!></div></div> <div class="g p-10n6f3r"><p class="h p-10n6f3r">Exclude archive</p> <div class="i p-10n6f3r"><!></div></div> <!> <div class="g p-10n6f3r"><p class="h p-10n6f3r">Exclude tags</p> <div class="i p-10n6f3r"><!></div></div> <!> <p class="j k p-10n6f3r">Filter tags:</p> <!>',1),Ze=A('<div class="l p-10n6f3r"><!></div>'),et=A('<div class="b p-10n6f3r"><div class="c p-10n6f3r"><!> <p class="d p-10n6f3r"><!></p></div></div> <div><div class="e p-10n6f3r"><button class="f p-10n6f3r"><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper><span>Settings</span></button></div> <!> <!></div>',1),tt=A('<div class="b p-10n6f3r"><p class="j p-10n6f3r">Exporting...</p> <!></div>'),at=A('<div class="b p-10n6f3r"><p class="j m p-10n6f3r">Something went wrong</p></div> <div class="l p-10n6f3r"><!></div>',1),rt=A('<div class="b p-10n6f3r"><p class="j p-10n6f3r">Success!</p></div> <div class="l p-10n6f3r"><!></div>',1),st=A('<div class="a p-10n6f3r"><!></div>');function lt(J,k){He(k,!0);const{getGetNotes:h}=Ne(),{clearDialogPages:T}=Pe(),{blockDialog:o}=Be(),{checkMobileSize:u}=Fe();let p=m("idle"),C=m("sync"),E=m(Me([])),$=m(!1),G=m(!1),O=m(!1),j=m(!1),U=m(!1),K=m(!1),Q=m(!1),V=m(!1);const ve=()=>{T()};je(()=>{o(e(p)==="loading")}),ce(()=>()=>{o(!1)});const fe=()=>{l(G,!e(G)),l(U,!1),l(j,!1),l($,!1),l(E,[],!0)},pe=async()=>{l(p,"loading"),await new Promise(r=>setTimeout(r,0));let s=(h()()||[]).filter(r=>r.data).filter(r=>e(E).length===0?!0:e(E).every(t=>r.data.tags.includes(t)));if(e(U)&&(s=s.map(r=>{const t={...r};return t.data={...t.data,history:[]},t})),e(K)&&(s=s.filter(r=>!r.data.deletedAt)),e(Q)&&(s=s.filter(r=>!r.data.archivedAt)),e(O)&&(s=s.map(r=>{const t={...r};return t.data={...t.data,tags:[],history:t.data.history.map(d=>({...d,tags:[]}))},t})),e(V)&&(s=s.map(r=>{const t={...r};return t.data={...t.data,tags:[],text:"",history:t.data.history.map(d=>({...d,text:"",tags:[]}))},t})),e(j)&&e(O)===!1&&(s=s.map(r=>{const t={...r};return t.data={...t.data,tags:t.data.tags.filter(d=>e(E).includes(d)),history:t.data.history.map(d=>({...d,tags:d.tags.filter(v=>e(E).includes(v))}))},t})),e(C)==="sync"){const r=`${[...e(O)?[]:e(E),"notes"].join("_")}.txt`,t=JSON.stringify({notes:s});return{filename:r,data:t}}else{const r=`${[...e(O)?[]:e(E),"bookmarks"].join("_")}_${new Date().toLocaleDateString().replace(/\//g,"_")}.html`,t=Qe(s);return{filename:r,data:t}}},ue=async()=>{try{const{filename:a,data:s}=await pe(),r=new File([s],a,{type:e(C)==="sync"?"text/plain":"text/html"}),t=()=>{const d=new Blob([s],{type:e(C)==="sync"?"text/plain":"text/html"}),v=URL.createObjectURL(d),g=document.createElement("a");g.href=v,g.download=a,document.body.appendChild(g),g.click(),setTimeout(()=>{document.body.removeChild(g),URL.revokeObjectURL(v)},0)};if(navigator.canShare({files:[r]}))try{await navigator.share({files:[r]})}catch(d){const v=d;if(v&&v.name!=="AbortError")t();else if(v&&v.name==="AbortError"){l(p,"idle");return}}else t();await new Promise(d=>setTimeout(d,500)),l(p,"success")}catch{l(p,"error")}},he=a=>{l(E,a,!0)},ne=a=>{a.key==="Escape"&&(document.activeElement instanceof HTMLInputElement&&document.activeElement.type==="text"||document.activeElement instanceof HTMLTextAreaElement)&&(e($)&&l($,!1),document.activeElement.blur(),a.preventDefault(),a.stopPropagation())},ge=a=>{l(j,a,!0)},_e=a=>{l(U,a,!0)},me=a=>{l(K,a,!0)},Te=a=>{l(Q,a,!0)},Ee=a=>{l(O,a,!0)},ke=a=>{l(V,a,!0)};ce(()=>(document.addEventListener("keydown",ne),()=>document.removeEventListener("keydown",ne)));var oe=st(),xe=n(oe);{var De=a=>{var s=et(),r=w(s),t=n(r),d=n(t);Ke(d,{items:[{title:"Sync",value:"sync"},{title:"Bookmarks",value:"bookmarks"}],get value(){return e(C)},onChange:i=>{l(C,i,!0)}});var v=c(d,2),g=n(v);{var P=i=>{var _=M("App format for sync or backup");f(i,_)},Y=i=>{var _=M("Browser bookmarks format (exports only bookmarks, not notes)");f(i,_)};y(g,i=>{e(C)==="sync"?i(P):i(Y,!1)})}var X=c(r,2),x=n(X),b=n(x);b.__click=fe;var S=n(b);ze(S,()=>({"--rotate":"30deg","--size":"20px"})),qe(S.lastChild,{name:"settings"});var I=c(x,2);{var L=i=>{var _=Xe(),H=w(_),q=c(n(H),2),B=n(q);N(B,{get checked(){return e(K)},onChange:me});var Z=c(H,2),ee=c(n(Z),2),Ae=n(ee);N(Ae,{get checked(){return e(Q)},onChange:Te});var ie=c(Z,2);{var be=D=>{var F=Ve(),W=w(F),te=c(n(W),2),$e=n(te);N($e,{get checked(){return e(U)},onChange:_e});var Se=c(W,2),Ie=c(n(Se),2),Re=n(Ie);N(Re,{get checked(){return e(V)},onChange:ke}),f(D,F)};y(ie,D=>{e(C)==="sync"&&D(be)})}var le=c(ie,2),we=c(n(le),2),Ce=n(we);N(Ce,{get checked(){return e(O)},onChange:Ee});var de=c(le,2);{var Oe=D=>{var F=Ye(),W=c(n(F),2),te=n(W);N(te,{get checked(){return e(j)},onChange:ge}),f(D,F)};y(de,D=>{e(E).length>0&&!e(O)&&D(Oe)})}var Le=c(de,4);We(Le,{mode:"exit",get selectedTags(){return e(E)},onChangeTags:he,get shownTagInput(){return e($)},set shownTagInput(D){l($,D,!0)}}),f(i,_)};y(I,i=>{e(G)&&i(L)})}var R=c(I,2);{var z=i=>{var _=Ze(),H=n(_);{let q=se(u);re(H,{get fullWidth(){return e(q)},onClick:ue,children:(B,Z)=>{var ee=M("Export");f(B,ee)},$$slots:{default:!0}})}f(i,_)};y(R,i=>{e($)||i(z)})}f(a,s)},ye=a=>{var s=ae(),r=w(s);{var t=v=>{var g=tt(),P=c(n(g),2);Je(P,{}),f(v,g)},d=v=>{var g=ae(),P=w(g);{var Y=x=>{var b=at(),S=c(w(b),2),I=n(S);{let L=se(u);re(I,{get fullWidth(){return e(L)},onClick:()=>{l(p,"idle")},children:(R,z)=>{var i=M("Try Again");f(R,i)},$$slots:{default:!0}})}f(x,b)},X=x=>{var b=ae(),S=w(b);{var I=L=>{var R=rt(),z=c(w(R),2),i=n(z);{let _=se(u);re(i,{get fullWidth(){return e(_)},onClick:ve,children:(H,q)=>{var B=M("Close");f(H,B)},$$slots:{default:!0}})}f(L,R)};y(S,L=>{e(p)==="success"&&L(I)},!0)}f(x,b)};y(P,x=>{e(p)==="error"?x(Y):x(X,!1)},!0)}f(v,g)};y(r,v=>{e(p)==="loading"?v(t):v(d,!1)},!0)}f(a,s)};y(xe,a=>{e(p)==="idle"?a(De):a(ye,!1)})}f(J,oe),Ue()}Ge(["click"]);export{lt as default};
