import{p as J,z as K,h as M,A as N,i as Q,u as V,g as p,j as X,f,m as b,c as d,d as t,n as Z,r as _,H as tt,w as x,s as P,y as st,q as w,B as S,P as at,l as C,t as et,x as rt}from"./CDUztbMs.js";var ot=f('<p class="message svelte-1v77ma3">You need to connect to the cloud account to get an access to a subscription</p> <div class="buttonContainer svelte-1v77ma3"><!></div>',1),it=f('<div class="buttonContainer svelte-1v77ma3"><!></div>'),nt=f('<p class="message svelte-1v77ma3"> </p>'),ct=f("<!> <!>",1),vt=f('<p class="message svelte-1v77ma3">error signin</p> <div class="buttonContainer svelte-1v77ma3"><div class="buttonContainerItem"><!></div></div>',1),lt=f('<p class="message svelte-1v77ma3">Subscription updated successfully</p> <div class="buttonContainer svelte-1v77ma3"><div class="buttonContainerItem"><!></div></div>',1),ut=f('<div class="block svelte-1v77ma3"><!></div>');function pt(H,I){J(I,!0);const{addSearchParam:j,closeDialogStack:B,getAppHistory:G}=K(),{pushStackPages:L}=M(),{getAccount:W,updateSubscription:Y}=N();let i=X("idle"),$=st(W);const{blockDialog:q}=Q(),z=()=>{new URLSearchParams(G().search).get("retPath")!=="subscription"&&j("retPath","subscription"),L(at.Auth)},F=()=>{B()},A=async()=>{C(i,"loading");try{const e=await fetch("/api/getSubscription",{method:"POST"});if(e.status!==200){C(i,"error");return}const v=await e.json();if(!v.subscriptionExpires){C(i,"error");return}const g=v.subscriptionExpires;Y(g),C(i,"success")}catch{C(i,"error")}};V(()=>{q(p(i)==="loading")});var E=ut(),O=d(E);{var R=e=>{var v=ct(),g=_(v);tt(g,{children:(s,r)=>{var n=x("Subscription");t(s,n)}});var k=P(g,2);{var y=s=>{var r=ot(),n=P(_(r),2),c=d(n);S(c,{onClick:z,children:(u,o)=>{var a=x("Connect");t(u,a)},$$slots:{default:!0}}),t(s,r)},l=s=>{var r=w(),n=_(r);{var c=o=>{var a=it(),m=d(a);S(m,{onClick:A,children:(h,U)=>{var D=x("Get subscription");t(h,D)},$$slots:{default:!0}}),t(o,a)},u=o=>{var a=nt(),m=d(a);et(h=>rt(m,`Your subscription is active until ${h??""}`),[()=>new Date(p($).subscriptionExpires).toLocaleDateString()]),t(o,a)};b(n,o=>{p($).subscriptionExpires<Date.now()?o(c):o(u,!1)},!0)}t(s,r)};b(k,s=>{p($)?s(l,!1):s(y)})}t(e,v)},T=e=>{var v=w(),g=_(v);{var k=l=>{var s=vt(),r=P(_(s),2),n=d(r),c=d(n);S(c,{onClick:A,fullWidth:!0,children:(u,o)=>{var a=x("try again");t(u,a)},$$slots:{default:!0}}),t(l,s)},y=l=>{var s=w(),r=_(s);{var n=c=>{var u=lt(),o=P(_(u),2),a=d(o),m=d(a);S(m,{onClick:F,fullWidth:!0,children:(h,U)=>{var D=x("Close");t(h,D)},$$slots:{default:!0}}),t(c,u)};b(r,c=>{p(i)==="success"&&c(n)},!0)}t(l,s)};b(g,l=>{p(i)==="error"?l(k):l(y,!1)},!0)}t(e,v)};b(O,e=>{p(i)==="idle"?e(R):e(T,!1)})}t(H,E),Z()}export{pt as default};
