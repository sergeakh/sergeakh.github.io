import{p as M,h as N,A as V,z as W,j as A,k as F,i as G,u as I,g as e,y as P,o as Q,f as _,m as x,c as S,d as i,n as X,l as f,U as Y,H as U,w as m,s as B,L as Z,q as ee,r as te,B as ae}from"./C2_kz5eG.js";import{e as re}from"./Cpa8lgv9.js";import{c as ne,b as se,a as oe}from"./BEGDcNQV.js";import{g as ie}from"./9q_jSmK4.js";var t=(n=>(n[n.Signup=0]="Signup",n[n.SignupError=1]="SignupError",n))(t||{}),ce=_('<div class="container svelte-apkzbu"><!> <!></div>'),le=_('<div class="container svelte-apkzbu"><!> <!></div>'),ue=_('<div class="block svelte-apkzbu"><!></div>');function ve(n,$){M($,!0);const{updateStackPages:K}=N(),{getAccount:D,initCloudAccount:E}=V(),{getAppHistory:H,back:z,closeDialogStack:T,deleteSearchParam:j}=W();let L=P(H),v=P(D),k=A(""),s=A(F(t.Signup));const{blockDialog:d,unBlockBackDialog:C}=G(),b=async()=>{f(s,t.Signup,!0);try{const a=await ie(),r=crypto.getRandomValues(new Uint8Array(32)),c=await ne({challenge:a,clientKey:r}),l=await fetch("/api/signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)});if(l.status!==200){f(s,t.SignupError,!0);return}const o=await l.json(),p=e(v)===void 0,{encryptedClientKey:u}=await re({clientKey:r,serverKey:new Uint8Array(se(o.serverKey))});if(Y(),await E({encryptedClientKey:oe(u)}),p)d(!1),T();else{d(!1);let g=new URLSearchParams(e(L).search).get("retPath")||"";g&&(f(k,g,!0),j("retPath")),z({to:e(k)}),K()}}catch{f(s,t.SignupError,!0)}};I(()=>{e(v)===null&&d(e(s)===t.Signup),C(e(s)!==t.Signup)}),Q(()=>{e(v)===void 0&&(d(!0),C(!1)),b()});var w=ue(),R=S(w);{var O=a=>{var r=ce(),c=S(r);U(c,{children:(o,p)=>{var u=m("signup");i(o,u)}});var l=B(c,2);Z(l,{}),i(a,r)},q=a=>{var r=ee(),c=te(r);{var l=o=>{var p=le(),u=S(p);U(u,{children:(y,J)=>{var h=m("error signup");i(y,h)}});var g=B(u,2);ae(g,{onClick:()=>b(),fullWidth:!0,children:(y,J)=>{var h=m("try again");i(y,h)},$$slots:{default:!0}}),i(o,p)};x(c,o=>{e(s)===t.SignupError&&o(l)},!0)}i(a,r)};x(R,a=>{e(s)===t.Signup?a(O):a(q,!1)})}i(n,w),X()}export{ve as default};
