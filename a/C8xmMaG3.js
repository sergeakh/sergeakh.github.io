import{p as et,C as bt,J as S,u as ut,g as t,j as _,l as r,o as tt,f as y,e as st,W as z,c as d,s as w,m as E,y as P,T as Q,d as b,n as at,q as kt,r as vt,D as ct,v as nt,k as O,E as Tt,K as xt,M as Ct,X as it,B as ot,w as dt,t as pt,x as yt}from"./DMKohntk.js";import{I as ft}from"./DmN3pgfk.js";var Dt=(k,e,s,g)=>{t(e)!==""&&s(t(e)),g(!1),r(e,"")},It=y('<form class="formNewTag svelte-1dwadiy"><div class="inputWrapper svelte-1dwadiy"><!></div> <button type="button" class="buttonDone svelte-1dwadiy">Done</button></form>'),Nt=y('<div class="block"><div class="tags svelte-1dwadiy"><!> <!> <!> <!></div> <!></div>');function Ut(k,e){et(e,!0);const{isReadyNotes:s,getGetNotes:g}=bt();let m=_(null),l=_(""),h=_(null);const R=P(s);let u=S(e,"shownTagInput",15);const I=a=>{e.selectedTags.includes(a)||(r(l,""),e.onChangeTags([...e.selectedTags,a]),t(m)?.focus())},N=a=>{const o=e.selectedTags.filter(x=>x!==a);o.length===0?e.onChangeTags([]):e.onChangeTags(o)};let D=P(()=>t(R)?[...(g()()||[]).reduce((a,o)=>(o?.data.tags.forEach(x=>{a.has(x)||a.add(x)}),a),new Set)]:[]),i=P(()=>t(R)?t(D).filter(a=>!e.selectedTags.some(o=>a===o)&&a!=="inbox"):[]),f=P(()=>t(i).find(a=>a.toLowerCase()===t(l).toLowerCase())||e.selectedTags.includes(t(l))),C=P(()=>t(i).filter(a=>t(l)===""?!0:a.toLowerCase().indexOf(t(l).toLowerCase())===0).slice(0,t(f)||t(l)===""?3:2));const p=a=>{a.preventDefault(),t(l)!==""?(I(t(l)),r(l,"")):u(!1)};ut(()=>{t(m)&&u()&&t(m).focus(),u()||r(l,"")});const T=a=>{a.target&&t(h)&&!t(h).contains(a.target)&&(u(!1),r(l,""))};tt(()=>(document.addEventListener("click",T,{capture:!0}),()=>{document.removeEventListener("click",T,{capture:!0})}));var v=Nt(),c=d(v),W=d(c);st(W,16,()=>e.selectedTags,a=>a,(a,o)=>{z(a,{get title(){return o},onClick:()=>N(o),type:"button",style:"selected"})});var A=w(W,2);{var j=a=>{var o=kt(),x=vt(o);st(x,16,()=>t(C),U=>U,(U,L)=>{z(U,{get title(){return L},onClick:()=>I(L)})}),b(a,o)};E(A,a=>{t(l)!==""&&a(j)})}var q=w(A,2);{var V=a=>{z(a,{get title(){return t(l)},onClick:()=>{I(t(l)),r(l,"")}})};E(q,a=>{!t(f)&&t(l)!==""&&a(V)})}var Y=w(q,2);{var Z=a=>{z(a,{title:"add tag",onClick:()=>u(!0)})};E(Y,a=>{u()||a(Z)})}var G=w(c,2);{var J=a=>{var o=It(),x=d(o),U=d(x);ft(U,{placeholder:"tag",get ref(){return t(m)},set ref(F){r(m,F,!0)},get value(){return t(l)},set value(F){r(l,F,!0)}});var L=w(x,2);L.__click=[Dt,l,I,u],ct("submit",o,p),b(a,o)};E(G,a=>{u()&&a(J)})}Q(v,a=>r(h,a),()=>t(h)),b(k,v),at()}nt(["click"]);var Et=(k,e,s,g)=>{r(e,s.url,!0),g(!1)},Lt=(k,e,s,g,m)=>{if(t(e)&&t(s)){r(e,"");return}g.onChangeUrl(t(e)),m(!1)},St=y('<div class="wrapper svelte-w8w68w"><!> <div class="containerButtons svelte-w8w68w"><button class="svelte-w8w68w">Cancel</button> <button class="svelte-w8w68w">Done</button></div></div>'),Rt=(k,e)=>{e(!0)},Wt=(k,e,s)=>{r(e,""),s.onDeleteUrl()},Bt=y('<button class="button svelte-w8w68w">Edit link</button> <button class="button svelte-w8w68w">Delete link</button>',1),Mt=(k,e)=>{e(!0)},At=y('<button class="button svelte-w8w68w">Add link</button>'),Ft=y('<div class="wrapperButtons svelte-w8w68w"><!></div>'),Ht=y("<div><!></div>");function Pt(k,e){et(e,!0);let s=S(e,"shownUrlInput",15),g=_(""),m=_(null),l=_(null),h=_(O(e.url));const R=i=>{r(g,""),r(h,i.target.value||"",!0);try{new URL(t(h))}catch{r(g,"Invalid URL")}};ut(()=>{s()&&t(m)?.focus()});var u=Ht(),I=d(u);{var N=i=>{var f=St(),C=d(f);ft(C,{get value(){return t(h)},get error(){return t(g)},onInput:R,placeholder:"url",get ref(){return t(m)},set ref(c){r(m,c,!0)}});var p=w(C,2),T=d(p);T.__click=[Et,h,e,s];var v=w(T,2);v.__click=[Lt,h,g,e,s],b(i,f)},D=i=>{var f=Ft(),C=d(f);{var p=v=>{var c=Bt(),W=vt(c);W.__click=[Rt,s];var A=w(W,2);A.__click=[Wt,h,e],b(v,c)},T=v=>{var c=At();c.__click=[Mt,s],b(v,c)};E(C,v=>{e.url?v(p):v(T,!1)})}b(i,f)};E(I,i=>{s()?i(N):i(D,!1)})}Q(u,i=>r(l,i),()=>t(l)),b(k,u),at()}nt(["click"]);const Ot=(k,e,s)=>{t(e)&&(t(e).style.height="auto",t(e).style.height=t(e).scrollHeight+"px"),s()},jt=(k,e)=>{e()};var qt=y("<span> </span>"),Gt=y('<div class="dateInfo svelte-t8fgpr"><!></div>'),Jt=y('<div class="submitButtons svelte-t8fgpr"><!> <!></div>'),Kt=y('<div class="form svelte-t8fgpr"><div class="scrollWrapper"><div class="formFields"><!> <form><input class="inputName svelte-t8fgpr" placeholder="Name"/></form> <textarea placeholder="Note" class="svelte-t8fgpr"></textarea></div></div> <div><!> <div class="formTagsWrapper svelte-t8fgpr"><!></div> <!></div></div>');function Qt(k,e){et(e,!0);const{deleteDraft:s,putDraft:g}=Tt();let m=S(e,"initialName",3,""),l=S(e,"initialUrl",3,""),h=S(e,"initialText",3,""),R=S(e,"initialTags",19,()=>[]),u=S(e,"noteId",3,""),I=S(e,"mode",3,"add"),N=_(O(e.draft?.data.name||m())),D=_(O(e.draft?.data.url||l())),i=_(O(e.draft?.data.text||h())),f=_(O((e.draft?.data.tags||R()).filter(n=>n!=="inbox"))),C=_(null),p=_(!1),T=_(!1),v=_(null);const c=()=>{const n={id:u(),data:{name:t(N),url:t(D),text:t(i),tags:t(f).map(B=>B.trim())}};g(n)},W=n=>{n.preventDefault(),s(u()),e.onSubmit({name:t(N).trim().slice(0,256)||"unkwown",url:t(D).trim().slice(0,2048),text:t(i).trim().slice(0,2048),tags:t(f).length>0?t(f):["inbox"]})},A=n=>{n.preventDefault(),t(C)&&t(C).focus()},j=n=>{n.key==="Escape"&&(document.activeElement instanceof HTMLInputElement&&document.activeElement.type==="text"||document.activeElement instanceof HTMLTextAreaElement)&&(t(p)&&r(p,!1),t(T)&&r(T,!1),document.activeElement.blur(),n.preventDefault(),n.stopPropagation())};tt(()=>(document.addEventListener("keydown",j),()=>document.removeEventListener("keydown",j)));const q=n=>{r(D,n,!0),c()},V=()=>{r(D,""),c()},Y=n=>{r(f,n,!0),c()},Z=()=>{s(u()),r(N,m()),r(D,l()),r(i,h()),r(f,R(),!0)};tt(()=>{I()==="add"&&t(v)?.focus()});var G=Kt(),J=d(G),a=d(J),o=d(a);Pt(o,{get url(){return t(D)},onChangeUrl:q,onDeleteUrl:V,get shownUrlInput(){return t(T)},set shownUrlInput(n){r(T,n,!0)}});var x=w(o,2),U=d(x);U.__input=[jt,c],Q(U,n=>r(v,n),()=>t(v));var L=w(x,2);L.__input=[Ot,C,c],Q(L,n=>r(C,n),()=>t(C));var F=w(J,2);xt(F,1,Ct(["bottom","bottomSpace"]),"svelte-t8fgpr");var rt=d(F);{var _t=n=>{var B=Gt(),K=d(B);{var $=M=>{var X=qt(),H=d(X);pt(wt=>yt(H,`updated: ${wt??""}`),[()=>new Date(e.updatedAt).toLocaleString()]),b(M,X)};E(K,M=>{e.updatedAt&&M($)})}b(n,B)};E(rt,n=>{I()==="edit"&&n(_t)})}var lt=w(rt,2),gt=d(lt);Ut(gt,{get selectedTags(){return t(f)},onChangeTags:Y,get shownTagInput(){return t(p)},set shownTagInput(n){r(p,n,!0)}});var mt=w(lt,2);{var ht=n=>{var B=Jt(),K=d(B);ot(K,{fullWidth:!0,withoutMinWidth:!0,onClick:Z,type:"secondary",typeButton:"button",children:(M,X)=>{var H=dt("cancel");b(M,H)},$$slots:{default:!0}});var $=w(K,2);ot($,{fullWidth:!0,withoutMinWidth:!0,onClick:W,typeButton:"submit",children:(M,X)=>{var H=dt("save");b(M,H)},$$slots:{default:!0}}),b(n,B)};E(mt,n=>{!t(p)&&!t(T)&&e.draft&&n(ht)})}ct("submit",x,A),it(U,()=>t(N),n=>r(N,n)),it(L,()=>t(i),n=>r(i,n)),b(k,G),at()}nt(["input"]);export{Qt as N};
