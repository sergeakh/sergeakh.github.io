import{p as M,C as N,u as Q,D as R,v as U,x as V,g as u,b as X,f as m,j as h,c as l,i as a,m as Z,y as x,n as f,A as aa,s as k,B as P,z as C,P as ta,a as b,t as sa,q as ea}from"./aS7cgTiYv.js";var ra=m('<p class="b p-f05mma">You need to connect to the cloud account to get an access to a subscription</p> <div class="c p-f05mma"><!></div>',1),oa=m('<div class="c p-f05mma"><!></div>'),ia=m('<p class="b p-f05mma"> </p>'),ca=m('<p class="b p-f05mma">error signin</p> <div class="c p-f05mma"><div class="d"><!></div></div>',1),na=m('<p class="b p-f05mma">Subscription updated successfully</p> <div class="c p-f05mma"><div class="d"><!></div></div>',1),la=m('<div class="a p-f05mma"><!></div>');function da(j,B){M(B,!0);const{setSearchParam:G,getSearchParams:W}=N(),{pushDialogPage:Y,clearDialogPages:q}=Q(),{getAccount:z,updateSubscription:F}=R();let c=X("idle"),S=aa(z);const{blockDialog:I}=U(),L=()=>{const e=W(),o=`${window.location.search}`;Y(ta.Auth),e.has("retPath")||G("retPath",o)},O=()=>{q()},w=async()=>{b(c,"loading");try{const e=await fetch("/api/getSubscription",{method:"POST"});if(e.status!==200){b(c,"error");return}const o=await e.json();if(!o.subscriptionExpires){b(c,"error");return}const _=o.subscriptionExpires;F(_),b(c,"success")}catch{b(c,"error")}};V(()=>{I(u(c)==="loading")});var y=la(),T=l(y);{var H=e=>{var o=x(),_=f(o);{var $=t=>{var r=ra(),v=k(f(r),2),d=l(v);P(d,{onClick:L,children:(n,s)=>{var i=C("Connect");a(n,i)},$$slots:{default:!0}}),a(t,r)},D=t=>{var r=x(),v=f(r);{var d=s=>{var i=oa(),p=l(i);P(p,{onClick:w,children:(g,E)=>{var A=C("Get subscription");a(g,A)},$$slots:{default:!0}}),a(s,i)},n=s=>{var i=ia(),p=l(i);sa(g=>ea(p,`Your subscription is active until ${g??""}`),[()=>new Date(u(S).subscriptionExpires).toLocaleDateString()]),a(s,i)};h(v,s=>{u(S).subscriptionExpires<Date.now()?s(d):s(n,!1)},!0)}a(t,r)};h(_,t=>{u(S)?t(D,!1):t($)})}a(e,o)},J=e=>{var o=x(),_=f(o);{var $=t=>{var r=ca(),v=k(f(r),2),d=l(v),n=l(d);P(n,{onClick:w,fullWidth:!0,children:(s,i)=>{var p=C("try again");a(s,p)},$$slots:{default:!0}}),a(t,r)},D=t=>{var r=x(),v=f(r);{var d=n=>{var s=na(),i=k(f(s),2),p=l(i),g=l(p);P(g,{onClick:O,fullWidth:!0,children:(E,A)=>{var K=C("Close");a(E,K)},$$slots:{default:!0}}),a(n,s)};h(v,n=>{u(c)==="success"&&n(d)},!0)}a(t,r)};h(_,t=>{u(c)==="error"?t($):t(D,!1)},!0)}a(e,o)};h(T,e=>{u(c)==="idle"?e(H):e(J,!1)})}a(j,y),Z()}export{da as default};
