import{p as de,n as pe,q as fe,h as N,r as _e,u as Y,g as a,o as ge,k as n,f as i,i as v,c as l,d as s,j as ye,L as G,v as F,l as h,w as ue,H as he,x as $,s as d,e as me,a as be,I as Q,t as Ae,m as Ke,V as ke,B as R,y as U,P as W}from"./aqgPJN1wH.js";import{g as Ce}from"./a9q_jSmK4.js";import{g as we}from"./aBEGDcNQV.js";var xe=i('<p class="b p-78vibc">Loading access keys</p>'),Pe=i('<p class="b p-78vibc">Confirming</p>'),De=(I,m,H)=>m(a(H).id),$e=i('<button class="f p-78vibc"><!> <!></button>'),He=i('<li class="p-78vibc"><div class="c p-78vibc"><div><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper></div> <div class="d p-78vibc"> </div></div> <div class="e p-78vibc"><!></div></li>'),Se=i('<p class="b g p-78vibc">Error deleting access key</p>'),Te=i('<div class="h p-78vibc"><!></div>'),je=i('<p class="b p-78vibc">You have reached the maximum number of access keys.</p>'),Ee=i('<!> <ul class="p-78vibc"></ul> <!> <!>',1),Le=i('<p class="b g p-78vibc">Something went wrong</p> <div class="h p-78vibc"><!></div>',1),Oe=i('<div class="a p-78vibc"><!></div>');function qe(I,m){de(m,!0);const{createHandleClickDialogPage:H,createDialogPageHref:X}=pe(),{blockDialog:V}=fe();let r=N("loadingAccessKeys"),b=N(_e([]));Y(()=>{V(a(r)==="loadingAccessKeys"||a(r)==="confirmingDeleteAccessKey")}),ge(()=>()=>{V(!1)}),Y(()=>{if(!m.hidden&&a(r)==="successAccessKeys"||a(r)==="loadingAccessKeys"){const c=new AbortController;return(async()=>{try{const o=await fetch("/api/credentials",{method:"POST",signal:c.signal});if(!o.ok)throw new Error("Failed to fetch access keys");const p=await o.json();n(b,p.credentials||[],!0),n(r,"successAccessKeys")}catch{n(r,"errorAccessKeys")}})(),()=>{c.abort()}}});const Z=async c=>{n(r,"confirmingDeleteAccessKey");try{const o=await Ce(),p=await we({challenge:o});if(!(await fetch("/api/deleteCredential",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({challenge:o,id:c,confirmCredential:p.credentialData})})).ok)throw new Error("Failed to add access key");n(r,"loadingAccessKeys")}catch{n(r,"errorDeleteAccessKey");return}};var q=Oe(),ee=l(q);{var se=c=>{G(c,{children:(o,p)=>{var A=xe();s(o,A)},$$slots:{default:!0}})},ae=c=>{var o=F(),p=h(o);{var A=f=>{G(f,{children:(K,z)=>{var S=Pe();s(K,S)},$$slots:{default:!0}})},re=f=>{var K=F(),z=h(K);{var S=_=>{var u=Ee(),k=h(u);he(k,{children:(e,t)=>{var y=$("Access Keys");s(e,y)}});var C=d(k,2);me(C,21,()=>a(b),e=>e.id,(e,t)=>{var y=He(),x=l(y),P=l(x),D=l(P);be(D,()=>({"--size":"20px"})),Q(D.lastChild,{name:"key"});var J=d(P,2),L=l(J),ce=d(x,2),oe=l(ce);{var ie=O=>{var B=$e();B.__click=[De,Z,t];var M=l(B);Q(M,{name:"close"});var le=d(M,2);ke(le,{children:(ne,Be)=>{var ve=$("delete access key");s(ne,ve)}}),s(O,B)};v(oe,O=>{a(b).length>1&&O(ie)})}Ae(()=>Ke(L,a(t).name)),s(e,y)});var g=d(C,2);{var w=e=>{var t=Se();s(e,t)};v(g,e=>{a(r)==="errorDeleteAccessKey"&&e(w)})}var T=d(g,2);{var j=e=>{var t=Te(),y=l(t);{let x=U(()=>X(W.ConfirmAccessKey)),P=U(()=>H(W.ConfirmAccessKey));R(y,{element:"a",get href(){return a(x)},get onClick(){return a(P)},children:(D,J)=>{var L=$("Add access key");s(D,L)},$$slots:{default:!0}})}s(e,t)},E=e=>{var t=je();s(e,t)};v(T,e=>{a(b).length<5?e(j):e(E,!1)})}s(_,u)},te=_=>{var u=F(),k=h(u);{var C=g=>{var w=Le(),T=d(h(w),2),j=l(T);R(j,{onClick:()=>{n(r,"loadingAccessKeys")},children:(E,e)=>{var t=$("Try Again");s(E,t)},$$slots:{default:!0}}),s(g,w)};v(k,g=>{a(r)==="errorAccessKeys"&&g(C)},!0)}s(_,u)};v(z,_=>{a(r)==="successAccessKeys"||a(r)==="errorDeleteAccessKey"?_(S):_(te,!1)},!0)}s(f,K)};v(p,f=>{a(r)==="confirmingDeleteAccessKey"?f(A):f(re,!1)},!0)}s(c,o)};v(ee,c=>{a(r)==="loadingAccessKeys"?c(se):c(ae,!1)})}s(I,q),ye()}ue(["click"]);export{qe as default};
