import{p as de,n as ge,q as me,h as M,r as fe,u as Y,g as a,o as _e,k as i,f as l,i as v,c as n,d as s,j as pe,L as G,v as B,l as u,w as ye,H as ue,x as $,s as d,e as he,a as we,I as Q,t as Ae,m as Ke,V as ke,B as R,y as U,P as W}from"./aC8NhpE_b.js";import{g as Ce}from"./a9q_jSmK4.js";import{g as be}from"./abA9hIFUQ.js";var xe=l('<p class="message svelte-ga1mwc">Loading access keys</p>'),De=l('<p class="message svelte-ga1mwc">Confirming</p>'),Pe=(F,h,H)=>h(a(H).id),$e=l('<button class="buttonDelete svelte-ga1mwc"><!> <!></button>'),He=l('<li class="svelte-ga1mwc"><div class="keyInfo svelte-ga1mwc"><div><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper></div> <div class="keyName svelte-ga1mwc"> </div></div> <div class="keyActions svelte-ga1mwc"><!></div></li>'),Se=l('<p class="message error svelte-ga1mwc">Error deleting access key</p>'),Te=l('<div class="buttonContainer svelte-ga1mwc"><!></div>'),je=l('<p class="message svelte-ga1mwc">You have reached the maximum number of access keys.</p>'),Ee=l('<!> <ul class="svelte-ga1mwc"></ul> <!> <!>',1),Ie=l('<p class="message error svelte-ga1mwc">Something went wrong</p> <div class="buttonContainer svelte-ga1mwc"><!></div>',1),Le=l('<div class="block svelte-ga1mwc"><!></div>');function Ve(F,h){de(h,!0);const{createHandleClickDialogPage:H,createDialogPageHref:X}=ge(),{blockDialog:N}=me();let t=M("loadingAccessKeys"),w=M(fe([]));Y(()=>{N(a(t)==="loadingAccessKeys"||a(t)==="confirmingDeleteAccessKey")}),_e(()=>()=>{N(!1)}),Y(()=>{if(!h.hidden&&a(t)==="successAccessKeys"||a(t)==="loadingAccessKeys"){const c=new AbortController;return(async()=>{try{const o=await fetch("/api/credentials",{method:"POST",signal:c.signal});if(!o.ok)throw new Error("Failed to fetch access keys");const g=await o.json();i(w,g.credentials||[],!0),i(t,"successAccessKeys")}catch{i(t,"errorAccessKeys")}})(),()=>{c.abort()}}});const Z=async c=>{i(t,"confirmingDeleteAccessKey");try{const o=await Ce(),g=await be({challenge:o});if(!(await fetch("/api/deleteCredential",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({challenge:o,id:c,confirmCredential:g.credentialData})})).ok)throw new Error("Failed to add access key");i(t,"loadingAccessKeys")}catch{i(t,"errorDeleteAccessKey");return}};var V=Le(),ee=n(V);{var se=c=>{G(c,{children:(o,g)=>{var A=xe();s(o,A)},$$slots:{default:!0}})},ae=c=>{var o=B(),g=u(o);{var A=m=>{G(m,{children:(K,q)=>{var S=De();s(K,S)},$$slots:{default:!0}})},te=m=>{var K=B(),q=u(K);{var S=f=>{var y=Ee(),k=u(y);ue(k,{children:(e,r)=>{var p=$("Access Keys");s(e,p)}});var C=d(k,2);he(C,21,()=>a(w),e=>e.id,(e,r)=>{var p=He(),x=n(p),D=n(x),P=n(D);we(P,()=>({"--size":"20px"})),Q(P.lastChild,{name:"key"});var z=d(D,2),I=n(z),ce=d(x,2),oe=n(ce);{var le=L=>{var O=$e();O.__click=[Pe,Z,r];var J=n(O);Q(J,{name:"close"});var ne=d(J,2);ke(ne,{children:(ie,Oe)=>{var ve=$("delete access key");s(ie,ve)}}),s(L,O)};v(oe,L=>{a(w).length>1&&L(le)})}Ae(()=>Ke(I,a(r).name)),s(e,p)});var _=d(C,2);{var b=e=>{var r=Se();s(e,r)};v(_,e=>{a(t)==="errorDeleteAccessKey"&&e(b)})}var T=d(_,2);{var j=e=>{var r=Te(),p=n(r);{let x=U(()=>X(W.ConfirmAccessKey)),D=U(()=>H(W.ConfirmAccessKey));R(p,{element:"a",get href(){return a(x)},get onClick(){return a(D)},children:(P,z)=>{var I=$("Add access key");s(P,I)},$$slots:{default:!0}})}s(e,r)},E=e=>{var r=je();s(e,r)};v(T,e=>{a(w).length<5?e(j):e(E,!1)})}s(f,y)},re=f=>{var y=B(),k=u(y);{var C=_=>{var b=Ie(),T=d(u(b),2),j=n(T);R(j,{onClick:()=>{i(t,"loadingAccessKeys")},children:(E,e)=>{var r=$("Try Again");s(E,r)},$$slots:{default:!0}}),s(_,b)};v(k,_=>{a(t)==="errorAccessKeys"&&_(C)},!0)}s(f,y)};v(q,f=>{a(t)==="successAccessKeys"||a(t)==="errorDeleteAccessKey"?f(S):f(re,!1)},!0)}s(m,K)};v(g,m=>{a(t)==="confirmingDeleteAccessKey"?m(A):m(te,!1)},!0)}s(c,o)};v(ee,c=>{a(t)==="loadingAccessKeys"?c(se):c(ae,!1)})}s(F,V),pe()}ye(["click"]);export{Ve as default};
