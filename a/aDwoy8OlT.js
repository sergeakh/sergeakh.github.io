import{p as He,J as Ne,u as Pe,v as je,K as Be,b as m,w as Fe,x as Me,g as e,o as ce,f as A,j as y,c as n,i as v,m as Ue,a as i,n as b,s as d,d as ze,I as qe,y as ae,z as F,N as We,B as re,A as se,L as Je,r as Ge}from"./afuD9HrEl.js";import{S as Ke,a as N}from"./aC7d2m8Nq.js";const Qe=J=>{const k=Math.floor(Date.now()/1e3),u={};J.forEach(o=>{if(!o)return;const f=o.data.tags||["Imported"];if(f.length===0){u.ROOT||(u.ROOT=[]),u.ROOT.push(o);return}f.forEach(p=>{u[p]||(u[p]=[]),u[p].push(o)})});let T=`<!DOCTYPE NETSCAPE-Note-file-1>
<!-- This is an automatically generated file.
 It will be read and overwritten.
 DO NOT EDIT! -->
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8">
<TITLE>Bookmarks</TITLE>
<H1>Bookmarks</H1>
<DL><p>
<DT><H3 ADD_DATE="${k}" LAST_MODIFIED="${k}" PERSONAL_TOOLBAR_FOLDER="true">Bookmarks bar</H3>
<DL><p>`;return Object.keys(u).forEach(o=>{o!=="ROOT"&&o!=="other"&&(T+=`
    <DT><H3 ADD_DATE="${k}" LAST_MODIFIED="${k}">${o}</H3>
    <DL><p>`,u[o].forEach(f=>{if(!f.data.link)return;const p=f.data.link.title.replace(/"/g,"&quot;");T+=`
        <DT><A HREF="${f.data.link.url}" ADD_DATE="${Math.floor(f.data.createdAt/1e3)||k}">${p}</A>`}),T+=`
    </DL><p>`)}),u.ROOT&&u.ROOT.forEach(o=>{if(!o.data.link)return;const f=o.data.link.title.replace(/"/g,"&quot;");T+=`
    <DT><A HREF="${o.data.link.url}" ADD_DATE="${Math.floor(o.data.createdAt/1e3)||k}">${f}</A>`}),T+=`
</DL><p>`,u.other&&u.other.forEach(o=>{if(!o.data.link)return;const f=o.data.link.title.replace(/"/g,"&quot;");T+=`
    <DT><A HREF="${o.data.link.url}" ADD_DATE="${Math.floor(o.data.createdAt/1e3)||k}">${f}</A>`}),T+="</DL><p>",T};var Ve=A('<div class="g p-10n6f3r"><p class="h p-10n6f3r">Exclude history</p> <div class="i p-10n6f3r"><!></div></div> <div class="g p-10n6f3r"><p class="h p-10n6f3r">Exclude notes</p> <div class="i p-10n6f3r"><!></div></div>',1),Ye=A('<div class="g p-10n6f3r"><p class="h p-10n6f3r">Exclude other tags</p> <div class="i p-10n6f3r"><!></div></div>'),Xe=A('<div class="g p-10n6f3r"><p class="h p-10n6f3r">Exclude bin</p> <div class="i p-10n6f3r"><!></div></div> <div class="g p-10n6f3r"><p class="h p-10n6f3r">Exclude archive</p> <div class="i p-10n6f3r"><!></div></div> <!> <div class="g p-10n6f3r"><p class="h p-10n6f3r">Exclude tags</p> <div class="i p-10n6f3r"><!></div></div> <!> <p class="j k p-10n6f3r">Filter tags:</p> <!>',1),Ze=A('<div class="l p-10n6f3r"><!></div>'),et=A('<div class="b p-10n6f3r"><div class="c p-10n6f3r"><!> <p class="d p-10n6f3r"><!></p></div></div> <div><div class="e p-10n6f3r"><button class="f p-10n6f3r"><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper><span>Settings</span></button></div> <!> <!></div>',1),tt=A('<div class="b p-10n6f3r"><p class="j p-10n6f3r">Exporting...</p> <!></div>'),at=A('<div class="b p-10n6f3r"><p class="j m p-10n6f3r">Something went wrong</p></div> <div class="l p-10n6f3r"><!></div>',1),rt=A('<div class="b p-10n6f3r"><p class="j p-10n6f3r">Success!</p></div> <div class="l p-10n6f3r"><!></div>',1),st=A('<div class="a p-10n6f3r"><!></div>');function lt(J,k){He(k,!0);const{getGetNotes:u}=Ne(),{clearDialogPages:T}=Pe(),{blockDialog:o}=je(),{checkMobileSize:f}=Be();let p=m("idle"),C=m("sync"),E=m(Fe([])),$=m(!1),G=m(!1),O=m(!1),M=m(!1),U=m(!1),K=m(!1),Q=m(!1),V=m(!1);const ve=()=>{T()};Me(()=>{o(e(p)==="loading")}),ce(()=>()=>{o(!1)});const fe=()=>{i(G,!e(G)),i(U,!1),i(M,!1),i($,!1),i(E,[],!0)},pe=async()=>{i(p,"loading"),await new Promise(r=>setTimeout(r,0));let s=(u()()||[]).filter(r=>r.data).filter(r=>e(E).length===0?!0:e(E).every(t=>r.data.tags.includes(t)));if(e(U)&&(s=s.map(r=>{const t={...r};return t.data={...t.data,history:[]},t})),e(K)&&(s=s.filter(r=>!r.data.deletedAt)),e(Q)&&(s=s.filter(r=>!r.data.archivedAt)),e(O)&&(s=s.map(r=>{const t={...r};return t.data={...t.data,tags:[],history:t.data.history.map(c=>({...c,tags:[]}))},t})),e(V)&&(s=s.map(r=>{const t={...r};return t.data={...t.data,tags:[],text:"",history:t.data.history.map(c=>({...c,text:"",tags:[]}))},t})),e(M)&&e(O)===!1&&(s=s.map(r=>{const t={...r};return t.data={...t.data,tags:t.data.tags.filter(c=>e(E).includes(c)),history:t.data.history.map(c=>({...c,tags:c.tags.filter(h=>e(E).includes(h))}))},t})),e(C)==="sync"){const r=`${[...e(O)?[]:e(E),"notes"].join("_")}.json`,t=JSON.stringify({filteredNotes:s});return{filename:r,data:t}}else{const r=`${[...e(O)?[]:e(E),"bookmarks"].join("_")}_${new Date().toLocaleDateString().replace(/\//g,"_")}.html`,t=Qe(s);return{filename:r,data:t}}},ue=async()=>{try{const{filename:a,data:s}=await pe(),r=new File([s],a,{type:e(C)==="sync"?"text/plain":"text/html"}),t=()=>{const c=new Blob([s],{type:e(C)==="sync"?"application/json":"text/html"}),h=URL.createObjectURL(c),g=document.createElement("a");g.href=h,g.download=a,document.body.appendChild(g),g.click(),setTimeout(()=>{document.body.removeChild(g),URL.revokeObjectURL(h)},0)};if(navigator.canShare({files:[r]}))try{await navigator.share({files:[r]})}catch{t()}else t();await new Promise(c=>setTimeout(c,500)),i(p,"success")}catch{i(p,"error")}},he=a=>{i(E,a,!0)},ne=a=>{a.key==="Escape"&&(document.activeElement instanceof HTMLInputElement&&document.activeElement.type==="text"||document.activeElement instanceof HTMLTextAreaElement)&&(e($)&&i($,!1),document.activeElement.blur(),a.preventDefault(),a.stopPropagation())},ge=a=>{i(M,a,!0)},_e=a=>{i(U,a,!0)},me=a=>{i(K,a,!0)},Te=a=>{i(Q,a,!0)},Ee=a=>{i(O,a,!0)},ke=a=>{i(V,a,!0)};ce(()=>(document.addEventListener("keydown",ne),()=>document.removeEventListener("keydown",ne)));var oe=st(),xe=n(oe);{var De=a=>{var s=et(),r=b(s),t=n(r),c=n(t);Ke(c,{items:[{title:"Sync",value:"sync"},{title:"Bookmarks",value:"bookmarks"}],get value(){return e(C)},onChange:l=>{i(C,l,!0)}});var h=d(c,2),g=n(h);{var P=l=>{var _=F("App format for sync or backup");v(l,_)},Y=l=>{var _=F("Browser bookmarks format (exports only bookmarks, not notes)");v(l,_)};y(g,l=>{e(C)==="sync"?l(P):l(Y,!1)})}var X=d(r,2),x=n(X),w=n(x);w.__click=fe;var S=n(w);ze(S,()=>({"--rotate":"30deg","--size":"20px"})),qe(S.lastChild,{name:"settings"});var I=d(x,2);{var L=l=>{var _=Xe(),H=b(_),q=d(n(H),2),j=n(q);N(j,{get checked(){return e(K)},onChange:me});var Z=d(H,2),ee=d(n(Z),2),Ae=n(ee);N(Ae,{get checked(){return e(Q)},onChange:Te});var le=d(Z,2);{var we=D=>{var B=Ve(),W=b(B),te=d(n(W),2),$e=n(te);N($e,{get checked(){return e(U)},onChange:_e});var Se=d(W,2),Ie=d(n(Se),2),Re=n(Ie);N(Re,{get checked(){return e(V)},onChange:ke}),v(D,B)};y(le,D=>{e(C)==="sync"&&D(we)})}var ie=d(le,2),be=d(n(ie),2),Ce=n(be);N(Ce,{get checked(){return e(O)},onChange:Ee});var de=d(ie,2);{var Oe=D=>{var B=Ye(),W=d(n(B),2),te=n(W);N(te,{get checked(){return e(M)},onChange:ge}),v(D,B)};y(de,D=>{e(E).length>0&&!e(O)&&D(Oe)})}var Le=d(de,4);We(Le,{mode:"exit",get selectedTags(){return e(E)},onChangeTags:he,get shownTagInput(){return e($)},set shownTagInput(D){i($,D,!0)}}),v(l,_)};y(I,l=>{e(G)&&l(L)})}var R=d(I,2);{var z=l=>{var _=Ze(),H=n(_);{let q=se(f);re(H,{get fullWidth(){return e(q)},onClick:ue,children:(j,Z)=>{var ee=F("Export");v(j,ee)},$$slots:{default:!0}})}v(l,_)};y(R,l=>{e($)||l(z)})}v(a,s)},ye=a=>{var s=ae(),r=b(s);{var t=h=>{var g=tt(),P=d(n(g),2);Je(P,{}),v(h,g)},c=h=>{var g=ae(),P=b(g);{var Y=x=>{var w=at(),S=d(b(w),2),I=n(S);{let L=se(f);re(I,{get fullWidth(){return e(L)},onClick:()=>{i(p,"idle")},children:(R,z)=>{var l=F("Try Again");v(R,l)},$$slots:{default:!0}})}v(x,w)},X=x=>{var w=ae(),S=b(w);{var I=L=>{var R=rt(),z=d(b(R),2),l=n(z);{let _=se(f);re(l,{get fullWidth(){return e(_)},onClick:ve,children:(H,q)=>{var j=F("Close");v(H,j)},$$slots:{default:!0}})}v(L,R)};y(S,L=>{e(p)==="success"&&L(I)},!0)}v(x,w)};y(P,x=>{e(p)==="error"?x(Y):x(X,!1)},!0)}v(h,g)};y(r,h=>{e(p)==="loading"?h(t):h(c,!1)},!0)}v(a,s)};y(xe,a=>{e(p)==="idle"?a(De):a(ye,!1)})}v(J,oe),Ue()}Ge(["click"]);export{lt as default};
