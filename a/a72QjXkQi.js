import{p as M,z as N,n as Q,A as R,q as U,u as V,g as p,h as X,f,i as b,c as d,d as t,j as Z,l as _,H as tt,x,s as C,y as at,v as y,B as $,P as st,k as P,t as et,m as rt}from"./aCxKU5lFO.js";var ot=f('<p class="message svelte-1v77ma3">You need to connect to the cloud account to get an access to a subscription</p> <div class="buttonContainer svelte-1v77ma3"><!></div>',1),it=f('<div class="buttonContainer svelte-1v77ma3"><!></div>'),nt=f('<p class="message svelte-1v77ma3"> </p>'),ct=f("<!> <!>",1),vt=f('<p class="message svelte-1v77ma3">error signin</p> <div class="buttonContainer svelte-1v77ma3"><div class="buttonContainerItem"><!></div></div>',1),lt=f('<p class="message svelte-1v77ma3">Subscription updated successfully</p> <div class="buttonContainer svelte-1v77ma3"><div class="buttonContainerItem"><!></div></div>',1),ut=f('<div class="block svelte-1v77ma3"><!></div>');function pt(H,I){M(I,!0);const{setSearchParam:j,getAppLocation:B}=N(),{pushDialogPage:G,clearDialogPages:L}=Q(),{getAccount:W,updateSubscription:Y}=R();let n=X("idle"),S=at(W);const{blockDialog:q}=U(),z=()=>{const s=B().searchParams,r=`${window.location.pathname}${window.location.search}`;G(st.Auth),s.has("retPath")||j("retPath",r)},F=()=>{L()},A=async()=>{P(n,"loading");try{const s=await fetch("/api/getSubscription",{method:"POST"});if(s.status!==200){P(n,"error");return}const r=await s.json();if(!r.subscriptionExpires){P(n,"error");return}const g=r.subscriptionExpires;Y(g),P(n,"success")}catch{P(n,"error")}};V(()=>{q(p(n)==="loading")});var E=ut(),O=d(E);{var T=s=>{var r=ct(),g=_(r);tt(g,{children:(a,o)=>{var c=x("Subscription");t(a,c)}});var D=C(g,2);{var k=a=>{var o=ot(),c=C(_(o),2),v=d(c);$(v,{onClick:z,children:(u,i)=>{var e=x("Connect");t(u,e)},$$slots:{default:!0}}),t(a,o)},l=a=>{var o=y(),c=_(o);{var v=i=>{var e=it(),m=d(e);$(m,{onClick:A,children:(h,K)=>{var w=x("Get subscription");t(h,w)},$$slots:{default:!0}}),t(i,e)},u=i=>{var e=nt(),m=d(e);et(h=>rt(m,`Your subscription is active until ${h??""}`),[()=>new Date(p(S).subscriptionExpires).toLocaleDateString()]),t(i,e)};b(c,i=>{p(S).subscriptionExpires<Date.now()?i(v):i(u,!1)},!0)}t(a,o)};b(D,a=>{p(S)?a(l,!1):a(k)})}t(s,r)},J=s=>{var r=y(),g=_(r);{var D=l=>{var a=vt(),o=C(_(a),2),c=d(o),v=d(c);$(v,{onClick:A,fullWidth:!0,children:(u,i)=>{var e=x("try again");t(u,e)},$$slots:{default:!0}}),t(l,a)},k=l=>{var a=y(),o=_(a);{var c=v=>{var u=lt(),i=C(_(u),2),e=d(i),m=d(e);$(m,{onClick:F,fullWidth:!0,children:(h,K)=>{var w=x("Close");t(h,w)},$$slots:{default:!0}}),t(v,u)};b(o,v=>{p(n)==="success"&&v(c)},!0)}t(l,a)};b(g,l=>{p(n)==="error"?l(D):l(k,!1)},!0)}t(s,r)};b(O,s=>{p(n)==="idle"?s(T):s(J,!1)})}t(H,E),Z()}export{pt as default};
