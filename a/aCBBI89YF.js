import{p as He,J as Ne,u as Pe,v as Be,K as Fe,b as _,w as Me,x as je,g as e,o as ce,f as A,j as y,c as l,i as f,m as Ue,a as i,n as w,s as c,d as ze,I as qe,y as ae,z as M,N as We,B as re,A as se,L as Je,r as Ge}from"./aCkPDbFHh.js";import{S as Ke}from"./aBJIb15le.js";import{S as N}from"./aBaqPhgAO.js";const Qe=J=>{const E=Math.floor(Date.now()/1e3),h={};J.forEach(o=>{if(!o)return;const u=o.data.tags||["Imported"];if(u.length===0){h.ROOT||(h.ROOT=[]),h.ROOT.push(o);return}u.forEach(p=>{h[p]||(h[p]=[]),h[p].push(o)})});let m=`<!DOCTYPE NETSCAPE-Note-file-1>
<!-- This is an automatically generated file.
 It will be read and overwritten.
 DO NOT EDIT! -->
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8">
<TITLE>Bookmarks</TITLE>
<H1>Bookmarks</H1>
<DL><p>
<DT><H3 ADD_DATE="${E}" LAST_MODIFIED="${E}" PERSONAL_TOOLBAR_FOLDER="true">Bookmarks bar</H3>
<DL><p>`;return Object.keys(h).forEach(o=>{o!=="ROOT"&&o!=="other"&&(m+=`
    <DT><H3 ADD_DATE="${E}" LAST_MODIFIED="${E}">${o}</H3>
    <DL><p>`,h[o].forEach(u=>{if(!u.data.link)return;const p=u.data.link.title.replace(/"/g,"&quot;");m+=`
        <DT><A HREF="${u.data.link.url}" ADD_DATE="${Math.floor(u.data.createdAt/1e3)||E}">${p}</A>`}),m+=`
    </DL><p>`)}),h.ROOT&&h.ROOT.forEach(o=>{if(!o.data.link)return;const u=o.data.link.title.replace(/"/g,"&quot;");m+=`
    <DT><A HREF="${o.data.link.url}" ADD_DATE="${Math.floor(o.data.createdAt/1e3)||E}">${u}</A>`}),m+=`
</DL><p>`,h.other&&h.other.forEach(o=>{if(!o.data.link)return;const u=o.data.link.title.replace(/"/g,"&quot;");m+=`
    <DT><A HREF="${o.data.link.url}" ADD_DATE="${Math.floor(o.data.createdAt/1e3)||E}">${u}</A>`}),m+="</DL><p>",m};var Ve=A('<div class="g p-1vlf05k"><p class="h p-1vlf05k">Exclude history</p> <div class="i p-1vlf05k"><!></div></div> <div class="g p-1vlf05k"><p class="h p-1vlf05k">Exclude notes</p> <div class="i p-1vlf05k"><!></div></div>',1),Ye=A('<div class="g p-1vlf05k"><p class="h p-1vlf05k">Exclude other tags</p> <div class="i p-1vlf05k"><!></div></div>'),Xe=A('<div class="g p-1vlf05k"><p class="h p-1vlf05k">Exclude bin</p> <div class="i p-1vlf05k"><!></div></div> <div class="g p-1vlf05k"><p class="h p-1vlf05k">Exclude archive</p> <div class="i p-1vlf05k"><!></div></div> <!> <div class="g p-1vlf05k"><p class="h p-1vlf05k">Exclude tags</p> <div class="i p-1vlf05k"><!></div></div> <!> <p class="j k p-1vlf05k">Filter tags:</p> <!>',1),Ze=A('<div class="l p-1vlf05k"><!></div>'),et=A('<div class="b p-1vlf05k"><div class="c p-1vlf05k"><!> <p class="d p-1vlf05k"><!></p></div></div> <div><div class="e p-1vlf05k"><button class="f p-1vlf05k"><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper><span>Settings</span></button></div> <!> <!></div>',1),tt=A('<div class="b p-1vlf05k"><p class="j p-1vlf05k">Exporting...</p> <!></div>'),at=A('<div class="b p-1vlf05k"><p class="j m p-1vlf05k">Something went wrong</p></div> <div class="l p-1vlf05k"><!></div>',1),rt=A('<div class="b p-1vlf05k"><p class="j p-1vlf05k">Success!</p></div> <div class="l p-1vlf05k"><!></div>',1),st=A('<div class="a p-1vlf05k"><!></div>');function it(J,E){He(E,!0);const{getGetNotes:h}=Ne(),{clearDialogPages:m}=Pe(),{blockDialog:o}=Be(),{checkMobileSize:u}=Fe();let p=_("idle"),C=_("sync"),T=_(Me([])),$=_(!1),G=_(!1),O=_(!1),j=_(!1),U=_(!1),K=_(!1),Q=_(!1),V=_(!1);const ve=()=>{m()};je(()=>{o(e(p)==="loading")}),ce(()=>()=>{o(!1)});const fe=()=>{i(G,!e(G)),i(U,!1),i(j,!1),i($,!1),i(T,[],!0)},pe=async()=>{i(p,"loading"),await new Promise(r=>setTimeout(r,0));let s=(h()()||[]).filter(r=>r.data).filter(r=>e(T).length===0?!0:e(T).every(t=>r.data.tags.includes(t)));if(e(U)&&(s=s.map(r=>{const t={...r};return t.data={...t.data,history:[]},t})),e(K)&&(s=s.filter(r=>!r.data.deletedAt)),e(Q)&&(s=s.filter(r=>!r.data.archivedAt)),e(O)&&(s=s.map(r=>{const t={...r};return t.data={...t.data,tags:[],history:t.data.history.map(d=>({...d,tags:[]}))},t})),e(V)&&(s=s.map(r=>{const t={...r};return t.data={...t.data,tags:[],text:"",history:t.data.history.map(d=>({...d,text:"",tags:[]}))},t})),e(j)&&e(O)===!1&&(s=s.map(r=>{const t={...r};return t.data={...t.data,tags:t.data.tags.filter(d=>e(T).includes(d)),history:t.data.history.map(d=>({...d,tags:d.tags.filter(v=>e(T).includes(v))}))},t})),e(C)==="sync"){const r=`${[...e(O)?[]:e(T),"notes"].join("_")}.txt`,t=JSON.stringify({notes:s});return{filename:r,data:t}}else{const r=`${[...e(O)?[]:e(T),"bookmarks"].join("_")}_${new Date().toLocaleDateString().replace(/\//g,"_")}.html`,t=Qe(s);return{filename:r,data:t}}},ue=async()=>{try{const{filename:a,data:s}=await pe(),r=new File([s],a,{type:e(C)==="sync"?"text/plain":"text/html"}),t=()=>{const d=new Blob([s],{type:e(C)==="sync"?"text/plain":"text/html"}),v=URL.createObjectURL(d),g=document.createElement("a");g.href=v,g.download=a,document.body.appendChild(g),g.click(),setTimeout(()=>{document.body.removeChild(g),URL.revokeObjectURL(v)},0)};if(navigator.canShare({files:[r]}))try{await navigator.share({files:[r]})}catch(d){const v=d;if(v&&v.name!=="AbortError")t();else if(v&&v.name==="AbortError"){i(p,"idle");return}}else t();await new Promise(d=>setTimeout(d,500)),i(p,"success")}catch(a){console.error("Error sharing file:",a),i(p,"error")}},he=a=>{i(T,a,!0)},le=a=>{a.key==="Escape"&&(document.activeElement instanceof HTMLInputElement&&document.activeElement.type==="text"||document.activeElement instanceof HTMLTextAreaElement)&&(e($)&&i($,!1),document.activeElement.blur(),a.preventDefault(),a.stopPropagation())},ge=a=>{i(j,a,!0)},ke=a=>{i(U,a,!0)},_e=a=>{i(K,a,!0)},me=a=>{i(Q,a,!0)},Te=a=>{i(O,a,!0)},Ee=a=>{i(V,a,!0)};ce(()=>(document.addEventListener("keydown",le),()=>document.removeEventListener("keydown",le)));var oe=st(),xe=l(oe);{var De=a=>{var s=et(),r=w(s),t=l(r),d=l(t);Ke(d,{items:[{title:"Sync",value:"sync"},{title:"Bookmarks",value:"bookmarks"}],get value(){return e(C)},onChange:n=>{i(C,n,!0)}});var v=c(d,2),g=l(v);{var P=n=>{var k=M("App format for sync or backup");f(n,k)},Y=n=>{var k=M("Browser bookmarks format (exports only bookmarks, not notes)");f(n,k)};y(g,n=>{e(C)==="sync"?n(P):n(Y,!1)})}var X=c(r,2),x=l(X),b=l(x);b.__click=fe;var S=l(b);ze(S,()=>({"--rotate":"30deg","--size":"20px"})),qe(S.lastChild,{name:"settings"});var I=c(x,2);{var L=n=>{var k=Xe(),H=w(k),q=c(l(H),2),B=l(q);N(B,{get checked(){return e(K)},onChange:_e});var Z=c(H,2),ee=c(l(Z),2),Ae=l(ee);N(Ae,{get checked(){return e(Q)},onChange:me});var ne=c(Z,2);{var be=D=>{var F=Ve(),W=w(F),te=c(l(W),2),$e=l(te);N($e,{get checked(){return e(U)},onChange:ke});var Se=c(W,2),Ie=c(l(Se),2),Re=l(Ie);N(Re,{get checked(){return e(V)},onChange:Ee}),f(D,F)};y(ne,D=>{e(C)==="sync"&&D(be)})}var ie=c(ne,2),we=c(l(ie),2),Ce=l(we);N(Ce,{get checked(){return e(O)},onChange:Te});var de=c(ie,2);{var Oe=D=>{var F=Ye(),W=c(l(F),2),te=l(W);N(te,{get checked(){return e(j)},onChange:ge}),f(D,F)};y(de,D=>{e(T).length>0&&!e(O)&&D(Oe)})}var Le=c(de,4);We(Le,{mode:"exit",get selectedTags(){return e(T)},onChangeTags:he,get shownTagInput(){return e($)},set shownTagInput(D){i($,D,!0)}}),f(n,k)};y(I,n=>{e(G)&&n(L)})}var R=c(I,2);{var z=n=>{var k=Ze(),H=l(k);{let q=se(u);re(H,{get fullWidth(){return e(q)},onClick:ue,children:(B,Z)=>{var ee=M("Export");f(B,ee)},$$slots:{default:!0}})}f(n,k)};y(R,n=>{e($)||n(z)})}f(a,s)},ye=a=>{var s=ae(),r=w(s);{var t=v=>{var g=tt(),P=c(l(g),2);Je(P,{}),f(v,g)},d=v=>{var g=ae(),P=w(g);{var Y=x=>{var b=at(),S=c(w(b),2),I=l(S);{let L=se(u);re(I,{get fullWidth(){return e(L)},onClick:()=>{i(p,"idle")},children:(R,z)=>{var n=M("Try Again");f(R,n)},$$slots:{default:!0}})}f(x,b)},X=x=>{var b=ae(),S=w(b);{var I=L=>{var R=rt(),z=c(w(R),2),n=l(z);{let k=se(u);re(n,{get fullWidth(){return e(k)},onClick:ve,children:(H,q)=>{var B=M("Close");f(H,B)},$$slots:{default:!0}})}f(L,R)};y(S,L=>{e(p)==="success"&&L(I)},!0)}f(x,b)};y(P,x=>{e(p)==="error"?x(Y):x(X,!1)},!0)}f(v,g)};y(r,v=>{e(p)==="loading"?v(t):v(d,!1)},!0)}f(a,s)};y(xe,a=>{e(p)==="idle"?a(De):a(ye,!1)})}f(J,oe),Ue()}Ge(["click"]);export{it as default};
