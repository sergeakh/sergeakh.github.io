import{p as $,C as ht,J as U,u as it,g as t,j as m,l as r,o as ot,f as p,e as rt,W as X,c as u,s as h,m as E,y as H,T as tt,d as w,n as et,q as wt,r as dt,D as ut,v as at,k as O,E as bt,K as kt,M as Tt,X as Ct,B as lt,w as st,t as xt,x as pt}from"./CZ1Tatuc.js";import{I as vt}from"./CwbH8yhI.js";var yt=(b,e,i,f)=>{t(e)!==""&&i(t(e)),f(!1),r(e,"")},Dt=p('<form class="formNewTag svelte-1dwadiy"><div class="inputWrapper svelte-1dwadiy"><!></div> <button type="button" class="buttonDone svelte-1dwadiy">Done</button></form>'),It=p('<div class="block"><div class="tags svelte-1dwadiy"><!> <!> <!> <!></div> <!></div>');function Et(b,e){$(e,!0);const{isReadyNotes:i,getGetNotes:f}=ht();let _=m(null),l=m(""),g=m(null);const L=H(i);let v=U(e,"shownTagInput",15);const N=a=>{e.selectedTags.includes(a)||(r(l,""),e.onChangeTags([...e.selectedTags,a]),t(_)?.focus())},I=a=>{const s=e.selectedTags.filter(k=>k!==a);s.length===0?e.onChangeTags([]):e.onChangeTags(s)};let y=H(()=>t(L)?[...(f()()||[]).reduce((a,s)=>(s?.data.tags.forEach(k=>{a.has(k)||a.add(k)}),a),new Set)]:[]),d=H(()=>t(L)?t(y).filter(a=>!e.selectedTags.some(s=>a===s)&&a!=="inbox"):[]),c=H(()=>t(d).find(a=>a.toLowerCase()===t(l).toLowerCase())||e.selectedTags.includes(t(l))),T=H(()=>t(d).filter(a=>t(l)===""?!0:a.toLowerCase().indexOf(t(l).toLowerCase())===0).slice(0,t(c)||t(l)===""?3:2));const x=a=>{a.preventDefault(),t(l)!==""?(N(t(l)),r(l,"")):v(!1)};it(()=>{t(_)&&v()&&t(_).focus(),v()||r(l,"")});const D=a=>{a.target&&t(g)&&!t(g).contains(a.target)&&(v(!1),r(l,""))};ot(()=>(document.addEventListener("click",D,{capture:!0}),()=>{document.removeEventListener("click",D,{capture:!0})}));var o=It(),C=u(o),S=u(C);rt(S,16,()=>e.selectedTags,a=>a,(a,s)=>{X(a,{get title(){return s},onClick:()=>I(s),type:"button",style:"selected"})});var R=h(S,2);{var z=a=>{var s=wt(),k=dt(s);rt(k,16,()=>t(T),W=>W,(W,B)=>{X(W,{get title(){return B},onClick:()=>N(B)})}),w(a,s)};E(R,a=>{t(l)!==""&&a(z)})}var j=h(R,2);{var Q=a=>{X(a,{get title(){return t(l)},onClick:()=>{N(t(l)),r(l,"")}})};E(j,a=>{!t(c)&&t(l)!==""&&a(Q)})}var V=h(j,2);{var q=a=>{X(a,{title:"add tag",onClick:()=>v(!0)})};E(V,a=>{v()||a(q)})}var G=h(C,2);{var Y=a=>{var s=Dt(),k=u(s),W=u(k);vt(W,{placeholder:"tag",get ref(){return t(_)},set ref(F){r(_,F,!0)},get value(){return t(l)},set value(F){r(l,F,!0)}});var B=h(k,2);B.__click=[yt,l,N,v],ut("submit",s,x),w(a,s)};E(G,a=>{v()&&a(Y)})}tt(o,a=>r(g,a),()=>t(g)),w(b,o),et()}at(["click"]);var Nt=(b,e,i,f)=>{r(e,i.url,!0),f(!1)},Ut=(b,e,i,f,_)=>{if(t(e)&&t(i)){r(e,"");return}f.onChangeUrl(t(e)),_(!1)},Lt=p('<div class="wrapper svelte-w8w68w"><!> <div class="containerButtons svelte-w8w68w"><button class="svelte-w8w68w">Cancel</button> <button class="svelte-w8w68w">Done</button></div></div>'),St=(b,e)=>{e(!0)},Rt=(b,e,i)=>{r(e,""),i.onDeleteUrl()},Wt=p('<button class="button svelte-w8w68w">Edit link</button> <button class="button svelte-w8w68w">Delete link</button>',1),Bt=(b,e)=>{e(!0)},Mt=p('<button class="button svelte-w8w68w">Add link</button>'),At=p('<div class="wrapperButtons svelte-w8w68w"><!></div>'),Ft=p("<div><!></div>");function Pt(b,e){$(e,!0);let i=U(e,"shownUrlInput",15),f=m(""),_=m(null),l=m(null),g=m(O(e.url));const L=d=>{r(f,""),r(g,d.target.value||"",!0);try{new URL(t(g))}catch{r(f,"Invalid URL")}};it(()=>{i()&&t(_)?.focus()});var v=Ft(),N=u(v);{var I=d=>{var c=Lt(),T=u(c);vt(T,{get value(){return t(g)},get error(){return t(f)},onInput:L,placeholder:"url",get ref(){return t(_)},set ref(C){r(_,C,!0)}});var x=h(T,2),D=u(x);D.__click=[Nt,g,e,i];var o=h(D,2);o.__click=[Ut,g,f,e,i],w(d,c)},y=d=>{var c=At(),T=u(c);{var x=o=>{var C=Wt(),S=dt(C);S.__click=[St,i];var R=h(S,2);R.__click=[Rt,g,e],w(o,C)},D=o=>{var C=Mt();C.__click=[Bt,i],w(o,C)};E(T,o=>{e.url?o(x):o(D,!1)})}w(d,c)};E(N,d=>{i()?d(I):d(y,!1)})}tt(v,d=>r(l,d),()=>t(l)),w(b,v),et()}at(["click"]);const Ht=(b,e)=>{e()},Ot=(b,e)=>{e()};var jt=p("<span> </span>"),qt=p('<div class="dateInfo svelte-t8fgpr"><!></div>'),Gt=p('<div class="submitButtons svelte-t8fgpr"><!> <!></div>'),Jt=p('<div class="form svelte-t8fgpr"><div class="scrollWrapper"><div class="formFields"><!> <form><input class="inputName svelte-t8fgpr" placeholder="Name"/></form> <div class="textarea svelte-t8fgpr" contenteditable="true"></div></div></div> <div><!> <div class="formTagsWrapper svelte-t8fgpr"><!></div> <!></div></div>');function zt(b,e){$(e,!0);const{deleteDraft:i,putDraft:f}=bt();let _=U(e,"initialName",3,""),l=U(e,"initialUrl",3,""),g=U(e,"initialText",3,""),L=U(e,"initialTags",19,()=>[]),v=U(e,"noteId",3,""),N=U(e,"mode",3,"add"),I=m(O(e.draft?.data.name||_())),y=m(O(e.draft?.data.url||l())),d=m(O(e.draft?.data.text||g())),c=m(O((e.draft?.data.tags||L()).filter(n=>n!=="inbox"))),T=m(!1),x=m(!1),D=m(null);const o=()=>{const n={id:v(),data:{name:t(I),url:t(y),text:t(d),tags:t(c).map(M=>M.trim())}};f(n)},C=n=>{n.preventDefault(),i(v()),e.onSubmit({name:t(I).trim().slice(0,256)||"unkwown",url:t(y).trim().slice(0,2048),text:t(d).trim().slice(0,2048),tags:t(c).length>0?t(c):["inbox"]})},S=n=>{n.preventDefault()},R=n=>{n.key==="Escape"&&(document.activeElement instanceof HTMLInputElement&&document.activeElement.type==="text"||document.activeElement instanceof HTMLTextAreaElement)&&(t(T)&&r(T,!1),t(x)&&r(x,!1),document.activeElement.blur(),n.preventDefault(),n.stopPropagation())};ot(()=>(document.addEventListener("keydown",R),()=>document.removeEventListener("keydown",R)));const z=n=>{r(y,n,!0),o()},j=()=>{r(y,""),o()},Q=n=>{r(c,n,!0),o()},V=()=>{i(v()),r(I,_()),r(y,l()),r(d,g()),r(c,L().filter(n=>n!=="inbox"),!0)};var q=Jt(),G=u(q),Y=u(G),a=u(Y);Pt(a,{get url(){return t(y)},onChangeUrl:z,onDeleteUrl:j,get shownUrlInput(){return t(x)},set shownUrlInput(n){r(x,n,!0)}});var s=h(a,2),k=u(s);k.__input=[Ot,o],tt(k,n=>r(D,n),()=>t(D));var W=h(s,2);W.__input=[Ht,o];var B=h(G,2);kt(B,1,Tt(["bottom","bottomSpace"]),"svelte-t8fgpr");var F=u(B);{var ct=n=>{var M=qt(),J=u(M);{var Z=A=>{var K=jt(),P=u(K);xt(mt=>pt(P,`updated: ${mt??""}`),[()=>new Date(e.updatedAt).toLocaleString()]),w(A,K)};E(J,A=>{e.updatedAt&&A(Z)})}w(n,M)};E(F,n=>{N()==="edit"&&n(ct)})}var nt=h(F,2),ft=u(nt);Et(ft,{get selectedTags(){return t(c)},onChangeTags:Q,get shownTagInput(){return t(T)},set shownTagInput(n){r(T,n,!0)}});var _t=h(nt,2);{var gt=n=>{var M=Gt(),J=u(M);lt(J,{fullWidth:!0,withoutMinWidth:!0,onClick:V,type:"secondary",typeButton:"button",children:(A,K)=>{var P=st("cancel");w(A,P)},$$slots:{default:!0}});var Z=h(J,2);lt(Z,{fullWidth:!0,withoutMinWidth:!0,onClick:C,typeButton:"submit",children:(A,K)=>{var P=st("save");w(A,P)},$$slots:{default:!0}}),w(n,M)};E(_t,n=>{!t(T)&&!t(x)&&e.draft&&n(gt)})}ut("submit",s,S),Ct(k,()=>t(I),n=>r(I,n)),w(b,q),et()}at(["input"]);export{zt as N};
