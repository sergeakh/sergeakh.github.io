import{p as de,n as ge,q as me,h as M,r as fe,u as U,g as a,o as _e,k as i,f as l,i as v,c as n,d as s,j as pe,L as Y,v as B,l as u,w as ye,H as ue,x as D,s as d,e as he,a as we,I as G,t as Ae,m as Ke,V as ke,B as Q,y as R,P as W}from"./B2r9qYV_.js";import{g as Ce}from"./9q_jSmK4.js";import{g as be}from"./bA9hIFUQ.js";var xe=l('<p class="message svelte-ga1mwc">Loading access keys</p>'),Pe=l('<p class="message svelte-ga1mwc">Confirming</p>'),$e=(F,h,S)=>h(a(S).id),De=l('<button class="buttonDelete svelte-ga1mwc"><!> <!></button>'),Se=l('<li class="svelte-ga1mwc"><div class="keyInfo svelte-ga1mwc"><div><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper></div> <div class="keyName svelte-ga1mwc"> </div></div> <div class="keyActions svelte-ga1mwc"><!></div></li>'),He=l('<p class="message error svelte-ga1mwc">Error deleting access key</p>'),Te=l('<div class="buttonContainer svelte-ga1mwc"><!></div>'),je=l('<p class="message svelte-ga1mwc">You have reached the maximum number of access keys.</p>'),Ee=l('<!> <ul class="svelte-ga1mwc"></ul> <!> <!>',1),Ie=l('<p class="message error svelte-ga1mwc">Something went wrong</p> <div class="buttonContainer svelte-ga1mwc"><!></div>',1),Le=l('<div class="block svelte-ga1mwc"><!></div>');function Ve(F,h){de(h,!0);const{createHandlePage:S,getPageUrl:X}=ge(),{blockDialog:N}=me();let t=M("loadingAccessKeys"),w=M(fe([]));U(()=>{N(a(t)==="loadingAccessKeys"||a(t)==="confirmingDeleteAccessKey")}),_e(()=>()=>{N(!1)}),U(()=>{if(!h.hidden&&a(t)==="successAccessKeys"||a(t)==="loadingAccessKeys"){const c=new AbortController;return(async()=>{try{const o=await fetch("/api/credentials",{method:"POST",signal:c.signal});if(!o.ok)throw new Error("Failed to fetch access keys");const g=await o.json();i(w,g.credentials||[],!0),i(t,"successAccessKeys")}catch{i(t,"errorAccessKeys")}})(),()=>{c.abort()}}});const Z=async c=>{i(t,"confirmingDeleteAccessKey");try{const o=await Ce(),g=await be({challenge:o});if(!(await fetch("/api/deleteCredential",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({challenge:o,id:c,confirmCredential:g.credentialData})})).ok)throw new Error("Failed to add access key");i(t,"loadingAccessKeys")}catch{i(t,"errorDeleteAccessKey");return}};var V=Le(),ee=n(V);{var se=c=>{Y(c,{children:(o,g)=>{var A=xe();s(o,A)},$$slots:{default:!0}})},ae=c=>{var o=B(),g=u(o);{var A=m=>{Y(m,{children:(K,q)=>{var H=Pe();s(K,H)},$$slots:{default:!0}})},te=m=>{var K=B(),q=u(K);{var H=f=>{var y=Ee(),k=u(y);ue(k,{children:(e,r)=>{var p=D("Access Keys");s(e,p)}});var C=d(k,2);he(C,21,()=>a(w),e=>e.id,(e,r)=>{var p=Se(),x=n(p),P=n(x),$=n(P);we($,()=>({"--size":"20px"})),G($.lastChild,{name:"key"});var z=d(P,2),I=n(z),ce=d(x,2),oe=n(ce);{var le=L=>{var O=De();O.__click=[$e,Z,r];var J=n(O);G(J,{name:"close"});var ne=d(J,2);ke(ne,{children:(ie,Oe)=>{var ve=D("delete access key");s(ie,ve)}}),s(L,O)};v(oe,L=>{a(w).length>1&&L(le)})}Ae(()=>Ke(I,a(r).name)),s(e,p)});var _=d(C,2);{var b=e=>{var r=He();s(e,r)};v(_,e=>{a(t)==="errorDeleteAccessKey"&&e(b)})}var T=d(_,2);{var j=e=>{var r=Te(),p=n(r);{let x=R(()=>X(W.ConfirmAccessKey)),P=R(()=>S(W.ConfirmAccessKey));Q(p,{element:"a",get href(){return a(x)},get onClick(){return a(P)},children:($,z)=>{var I=D("Add access key");s($,I)},$$slots:{default:!0}})}s(e,r)},E=e=>{var r=je();s(e,r)};v(T,e=>{a(w).length<5?e(j):e(E,!1)})}s(f,y)},re=f=>{var y=B(),k=u(y);{var C=_=>{var b=Ie(),T=d(u(b),2),j=n(T);Q(j,{onClick:()=>{i(t,"loadingAccessKeys")},children:(E,e)=>{var r=D("Try Again");s(E,r)},$$slots:{default:!0}}),s(_,b)};v(k,_=>{a(t)==="errorAccessKeys"&&_(C)},!0)}s(f,y)};v(q,f=>{a(t)==="successAccessKeys"||a(t)==="errorDeleteAccessKey"?f(H):f(re,!1)},!0)}s(m,K)};v(g,m=>{a(t)==="confirmingDeleteAccessKey"?m(A):m(te,!1)},!0)}s(c,o)};v(ee,c=>{a(t)==="loadingAccessKeys"?c(se):c(ae,!1)})}s(F,V),pe()}ye(["click"]);export{Ve as default};
