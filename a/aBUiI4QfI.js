import{p as ee,q as re,A as te,z as ae,u as se,g as s,h as L,o as ne,f as p,i as C,c as y,d as e,j as oe,H as le,x as K,s as k,k as i,B,E as ie,v as $,l as m,L as O}from"./aBVoKl8bg.js";import{b as q,c as ce,g as de}from"./abA9hIFUQ.js";import{g as ve,a as fe}from"./a9q_jSmK4.js";import{d as ye}from"./aCpa8lgv9.js";import{I as me}from"./aDX2HgrTT.js";var pe=p('<form><!> <div class="inputContainer svelte-1wrlvyn"><!></div> <div class="buttonContainer svelte-1wrlvyn"><!></div></form>'),ue=p('<p class="message svelte-1wrlvyn">Adding the access key</p>'),ge=p('<p class="message svelte-1wrlvyn">Confirming</p>'),he=p('<p class="message error svelte-1wrlvyn">Something went wrong</p> <div class="buttonContainer svelte-1wrlvyn"><!></div>',1),_e=p('<p class="message svelte-1wrlvyn">Confirm this operation with another key</p> <div class="buttonContainer svelte-1wrlvyn"><!></div>',1),Ce=p('<div class="block svelte-1wrlvyn"><!></div>');function xe(z,F){ee(F,!0);const{blockDialog:H}=re(),{getAccount:J}=te(),{back:U}=ae();let r=L("idle"),w="",b=null,x=L("");se(()=>{H(s(r)==="confirmingAccessKey"||s(r)==="addingAccessKey")}),ne(()=>()=>{H(!1)});const M=async t=>{t.preventDefault(),i(r,"addingAccessKey");try{w=await ve();const a=await fe(),n=J();if(!n||!n.encryptedClientKey)throw new Error("No account found");const c=await ye({encryptedClientKey:q(n.encryptedClientKey),serverKey:q(a)});b=await ce({challenge:w,clientKey:c}),i(r,"confirmAccessKey")}catch{i(r,"error");return}},G=async()=>{i(r,"confirmingAccessKey");try{const t=await de({challenge:w});if(!b)throw new Error("No credential data found");if(!(await fetch("/api/addCredential",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({challenge:w,name:s(x)||`key ${Math.floor(Math.random()*1e3)}`,newCredential:b,confirmCredential:t.credentialData})})).ok)throw new Error("Failed to add access key");U()}catch{i(r,"error");return}};var j=Ce(),Q=y(j);{var R=t=>{var a=pe(),n=y(a);le(n,{children:(l,u)=>{var g=K("Enter a name for a key");e(l,g)}});var c=k(n,2),P=y(c);me(P,{placeholder:"key name",get value(){return s(x)},set value(l){i(x,l,!0)}});var o=k(c,2),d=y(o);B(d,{onClick:M,children:(l,u)=>{var g=K("Add key");e(l,g)},$$slots:{default:!0}}),ie("submit",a,M),e(t,a)},V=t=>{var a=$(),n=m(a);{var c=o=>{O(o,{children:(d,l)=>{var u=ue();e(d,u)},$$slots:{default:!0}})},P=o=>{var d=$(),l=m(d);{var u=v=>{O(v,{children:(A,I)=>{var D=ge();e(A,D)},$$slots:{default:!0}})},g=v=>{var A=$(),I=m(A);{var D=f=>{var h=he(),E=k(m(h),2),N=y(E);B(N,{onClick:()=>{i(r,"idle")},children:(_,S)=>{var T=K("Try Again");e(_,T)},$$slots:{default:!0}}),e(f,h)},W=f=>{var h=$(),E=m(h);{var N=_=>{var S=_e(),T=k(m(S),2),X=y(T);B(X,{onClick:G,children:(Y,we)=>{var Z=K("Confirm");e(Y,Z)},$$slots:{default:!0}}),e(_,S)};C(E,_=>{s(r)==="confirmAccessKey"&&_(N)},!0)}e(f,h)};C(I,f=>{s(r)==="error"?f(D):f(W,!1)},!0)}e(v,A)};C(l,v=>{s(r)==="confirmingAccessKey"?v(u):v(g,!1)},!0)}e(o,d)};C(n,o=>{s(r)==="addingAccessKey"?o(c):o(P,!1)},!0)}e(t,a)};C(Q,t=>{s(r)==="idle"?t(R):t(V,!1)})}e(z,j),oe()}export{xe as default};
