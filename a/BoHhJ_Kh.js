import{p as Q,D as X,G as Y,u as Z,g as t,h as y,k as d,o as p,f as V,e as R,U as h,x as _,t as L,m as N,d as u,c as T,s as v,i as k,y as O,S as $,j as ee,v as te,l as ae,V as se,E as le,W as ne,w as re}from"./CCTl85eR.js";import{I as oe}from"./Cbu1hgRI.js";var ie=(P,a,C,w)=>{t(a)!==""&&C(t(a)),w(!1),d(a,"")},de=V('<form class="formNewTag svelte-1dwadiy"><div class="inputWrapper svelte-1dwadiy"><!></div> <button type="button" class="buttonDone svelte-1dwadiy">Done</button></form>'),ce=V('<div class="block"><div class="tags svelte-1dwadiy"><!> <!> <!> <!></div> <!></div>');function ge(P,a){Q(a,!0);const{isInitedNotes:C,getGetMapTags:w,getGetNotes:W}=X();let f=y(null),l=y(""),g=y(null);const j=O(C);let o=Y(a,"shownTagInput",15);const F=()=>t(j)?a.mode==="exit"?ne(new Set(a.selectedTags),W()()||[]):[...w()().keys()]:[];let x=O(()=>F().filter(e=>a.selectedTags.some(s=>e===s)||e==="inbox"?!1:t(l)===""||e.toLowerCase().indexOf(t(l).toLowerCase())===0));const m=e=>{if(!a.selectedTags.includes(e)){if(a.mode!=="exit"||t(x).includes(e)){a.onChangeTags([...a.selectedTags,e]),d(l,"");return}t(f)?.focus()}},H=e=>{const s=a.selectedTags.filter(r=>r!==e);s.length===0?a.onChangeTags([]):a.onChangeTags(s)},U=e=>{e.preventDefault(),t(l)!==""?m(t(l)):o(!1)};Z(()=>{t(f)&&o()&&t(f).focus(),o()||d(l,"")});const S=e=>{e.target&&t(g)&&!t(g).contains(e.target)&&(o(!1),d(l,""))};p(()=>(document.addEventListener("click",S,{capture:!0}),()=>{document.removeEventListener("click",S,{capture:!0})}));var b=ce(),D=T(b),E=T(D);R(E,16,()=>a.selectedTags,e=>e,(e,s)=>{h(e,{onClick:()=>H(s),type:"button",style:"selected",children:(r,n)=>{var i=_();L(()=>N(i,s)),u(r,i)},$$slots:{default:!0}})});var G=v(E,2);{var q=e=>{var s=te(),r=ae(s);R(r,16,()=>t(x).filter(n=>n.toLowerCase()!==t(l).toLowerCase()).slice(0,Math.max(3,3-a.selectedTags.length)),n=>n,(n,i)=>{h(n,{onClick:()=>m(i),children:(c,ue)=>{var M=_();L(()=>N(M,i)),u(c,M)},$$slots:{default:!0}})}),u(e,s)};k(G,e=>{(t(l)!==""||a.selectedTags.length>0&&o()&&a.mode==="exit")&&e(q)})}var I=v(G,2);{var z=e=>{h(e,{onClick:()=>{m(t(l)),d(l,"")},children:(s,r)=>{var n=_();L(()=>N(n,t(l))),u(s,n)},$$slots:{default:!0}})};k(I,e=>{t(l)!==""&&(a.mode!=="exit"||t(x).find(s=>s.toLowerCase()===t(l).toLowerCase()))&&e(z)})}var A=v(I,2);{var B=e=>{h(e,{onClick:()=>o(!0),children:(s,r)=>{se(s,{children:(n,i)=>{var c=_("add tag");u(n,c)}})},$$slots:{default:!0}})};k(A,e=>{o()||e(B)})}var J=v(D,2);{var K=e=>{var s=de(),r=T(s),n=T(r);oe(n,{placeholder:"tag",get ref(){return t(f)},set ref(c){d(f,c,!0)},get value(){return t(l)},set value(c){d(l,c,!0)}});var i=v(r,2);i.__click=[ie,l,m,o],le("submit",s,U),u(e,s)};k(J,e=>{o()&&e(K)})}$(b,e=>d(g,e),()=>t(g)),u(P,b),ee()}re(["click"]);export{ge as N};
