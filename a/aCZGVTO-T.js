import{p as U,J as Y,u as Z,C as E,b as f,w as G,x as k,g as t,A as h,Y as K,a,Z as M,y as _,n as S,j as C,i as v,m as Q,f as T,s as W,c as X,B as tt,z as et}from"./aDVJRJgX9.js";import{s as J,N as at}from"./aBachEBfv.js";var it=T('<div class="a p-1hq9a8m"><p class="p-1hq9a8m">Note not found</p> <!></div>');function lt(O,y){U(y,!0);const{getNoteById:c,isInitedNotes:w,saveNote:A,updateNote:P,revertNote:I}=Y(),{clearDialogPages:b}=Z(),{getHref:B}=E();let r=f("idle"),n=f(""),u=f(void 0),s=f(void 0),l=f(""),d=f(G([])),p=f(0);const N=h(w);k(()=>{t(N)&&K(()=>{const e=new URLSearchParams(y.params).get("id");if(e){a(n,e,!0);const i=c(t(n));i?.data&&(a(s,i.data.link?M(i.data.link):void 0,!0),a(l,i.data.text,!0),a(d,i.data.tags.slice(),!0),a(p,i.data.updatedAt,!0))}})});const D=async()=>{if(t(u)){const e=c(t(n));if(!e?.data)return;const i=e.data.history?.find?.(m=>m.id===t(u));if(!i){a(u,void 0);return}if(i.link?.url===t(s)?.url&&i.link?.title===t(s)?.title&&i.text===t(l)&&JSON.stringify(i.tags)===JSON.stringify(t(d))){if(t(r)==="idle"){a(r,"loading");try{await I(t(n),t(u)),a(u,void 0),a(p,i.updatedAt,!0)}finally{a(r,"idle")}}}else if((e.data.link?.url!==t(s)?.url||e.data.link?.title!==t(s)?.title||e.data.text!==t(l)||JSON.stringify(e.data.tags)!==JSON.stringify(t(d)))&&t(r)==="idle"){a(r,"loading");try{await P(t(n),{link:J(t(s)),text:t(l),tags:t(d).slice()})}finally{a(r,"idle")}}}else{const e=c(t(n));if(!e?.data)return;if((e.data.link?.url!==t(s)?.url||e.data.link?.title!==t(s)?.title||e.data.text!==t(l)||JSON.stringify(e.data.tags)!==JSON.stringify(t(d)))&&t(r)==="idle"){a(r,"loading");try{a(p,0),a(u,await A(t(n),{link:J(t(s)),text:t(l),tags:t(d).slice()}),!0)}finally{a(r,"idle")}}}};k(()=>{t(N)&&t(r)!=="loading"&&D()});const q=e=>{e.preventDefault(),b()};var x=_(),V=S(x);{var $=e=>{var i=_(),m=S(i);{var j=g=>{var o=it(),F=W(X(o),2);{let H=h(()=>B(""));tt(F,{element:"a",get href(){return t(H)},onClick:q,children:(L,st)=>{var R=et("close");v(L,R)},$$slots:{default:!0}})}v(g,o)},z=g=>{at(g,{mode:"edit",get updatedAt(){return t(p)},get link(){return t(s)},set link(o){a(s,o,!0)},get text(){return t(l)},set text(o){a(l,o,!0)},get tags(){return t(d)},set tags(o){a(d,o,!0)}})};C(m,g=>{!t(n)||!c(t(n))?g(j):g(z,!1)})}v(e,i)};C(V,e=>{t(N)&&e($)})}v(O,x),Q()}export{lt as default};
