import{p as gt,J as ft,u as ct,C as pt,b as l,w as H,o as O,g as t,A as c,_ as S,a as n,$ as s,x as b,y as L,n as M,j as U,i as C,m as ht,f as xt,s as kt,c as vt,B as Nt,z as yt,a0 as mt}from"./aCdxsrhIi.js";var Ct=xt('<div class="a p-1hq9a8m"><p class="p-1hq9a8m">Note not found</p> <!></div>');function _t(q,w){gt(w,!0);const{getNoteById:N,isInitedNotes:z,saveNote:j,updateNote:F,revertNote:G,pinNote:R,getGetMapNotes:V,zipNoteHistory:E}=ft(),{clearDialogPages:K}=ct(),{getHref:Q}=pt();let y=l("idle"),d=l(""),o=l(void 0),u=l(""),g=l(H([])),x=l(!1),A=l(0),f=l(void 0),I=l(void 0),r=l(-1),a=l(H([])),p=l("unknown");const _=c(z);let k=l(null);O(()=>{if(!t(_))return;const e=new URLSearchParams(w.params).get("id");!e||e===t(d)||S(()=>{n(d,e,!0);const i=N(t(d));i?.data&&(n(o,i.data.link?s(i.data.link):void 0,!0),n(u,i.data.text,!0),n(g,i.data.tags.slice(),!0),n(x,!!i.data.pinned,!0),n(A,i.data.updatedAt,!0),n(a,s(i.data.history??[]),!0),n(f,{versionId:i.data.versionId,link:i.data.link?s(i.data.link):void 0,text:i.data.text,tags:i.data.tags.slice(),updatedAt:i.data.updatedAt},!0),t(a).push(s(t(f))),n(r,t(a).length-1))})});const W=async e=>{n(y,"loading");try{t(I)?t(f)?.link?.url===e.link?.url&&t(f)?.link?.title===e.link?.title&&t(f)?.text===e.text&&JSON.stringify(t(f)?.tags)===JSON.stringify(e.tags)?(await G(t(d),t(f).versionId),n(I,void 0)):await F(t(d),{link:s(e.link),text:e.text,tags:e.tags.slice()}):(n(A,0),n(I,await j(t(d),{link:s(e.link),text:e.text,tags:e.tags.slice()}),!0))}finally{n(y,"idle")}},X=e=>{e.preventDefault(),K()};let Y=c(()=>t(r)>0),Z=c(()=>t(r)<t(a).length-1);const D=()=>{if(t(r)<=0)return;n(r,t(r)-1);const e=t(a)[t(r)];n(o,s(e.link),!0),n(u,e.text,!0),n(g,s(e.tags),!0),n(p,"unknown"),v()},tt=()=>{if(t(r)>=t(a).length-1)return;n(r,t(r)+1);const e=t(a)[t(r)];n(o,s(e.link),!0),n(u,e.text,!0),n(g,s(e.tags),!0),n(p,"unknown"),v()},et=e=>{n(x,e,!0),t(d)&&R(t(d),e)},v=()=>{n(k,{link:s(t(o)),text:t(u),tags:t(g).slice()},!0)},J=e=>{n(o,e,!0),n(a,t(a).slice(0,t(r)+1),!0),n(p,"unknown"),t(a).push({versionId:void 0,link:s(t(o)),text:t(u),tags:s(t(g)),updatedAt:Date.now()}),n(r,t(a).length-1),v()},T=e=>{n(g,e,!0),n(a,t(a).slice(0,t(r)+1),!0),n(p,"unknown"),t(a).push({versionId:void 0,link:s(t(o)),text:t(u),tags:s(t(g)),updatedAt:Date.now()}),n(r,t(a).length-1),v()},$=e=>{n(u,e,!0),n(a,t(a).slice(0,t(r)+1),!0),t(p)!=="text"?(t(a).push({versionId:void 0,link:s(t(o)),text:t(u),tags:s(t(g)),updatedAt:Date.now()}),n(r,t(a).length-1)):(t(a)[t(r)].text=t(u),t(a)[t(r)].updatedAt=Date.now()),n(p,"text"),v()};b(()=>{t(y)!=="loading"&&t(k)&&S(()=>{t(k)&&(W(t(k)),n(k,null))})});let nt=c(V);b(()=>{if(!t(_)||t(y)==="loading"||!t(d))return;const e=t(nt)().get(t(d));S(()=>{e?.data&&(e.data.pinned!==t(x)&&n(x,!!e.data.pinned),e.data.text!==t(u)&&$(e.data.text),(e.data.link?.url!==t(o)?.url||e.data.link?.title!==t(o)?.title)&&J(s(e.data.link)),JSON.stringify(e.data.tags)!==JSON.stringify(t(g))&&T(s(e.data.tags)))})}),O(()=>()=>{E(t(d))});var B=L(),at=M(B);{var rt=e=>{var i=L(),st=M(i);{var it=h=>{var m=Ct(),P=kt(vt(m),2);{let lt=c(()=>Q(""));Nt(P,{element:"a",get href(){return t(lt)},onClick:X,children:(ot,At)=>{var ut=yt("close");C(ot,ut)},$$slots:{default:!0}})}C(h,m)},dt=h=>{{let m=c(()=>N(t(d))?.data.deletedAt),P=c(()=>N(t(d))?.data.archivedAt);mt(h,{get noteId(){return t(d)},mode:"edit",get link(){return t(o)},onChangeLink:J,get text(){return t(u)},onChangeText:$,get tags(){return t(g)},onChangeTags:T,get updatedAt(){return t(A)},get deletedAt(){return t(m)},get archivedAt(){return t(P)},get pinned(){return t(x)},onPinnedChange:et,get canNext(){return t(Z)},get canPrev(){return t(Y)},onNext:tt,onPrev:D})}};U(st,h=>{!t(d)||!N(t(d))?h(it):h(dt,!1)})}C(e,i)};U(at,e=>{t(_)&&e(rt)})}C(q,B),ht()}export{_t as default};
