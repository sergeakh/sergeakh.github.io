import{p as M,z as N,n as Q,A as R,q as U,u as V,g as p,h as X,f,i as b,c as d,d as t,j as Z,l as _,H as tt,x,s as C,y as at,v as A,B as S,P as st,k as P,t as et,m as rt}from"./ByNqTBaJ.js";var ot=f('<p class="message svelte-1v77ma3">You need to connect to the cloud account to get an access to a subscription</p> <div class="buttonContainer svelte-1v77ma3"><!></div>',1),it=f('<div class="buttonContainer svelte-1v77ma3"><!></div>'),nt=f('<p class="message svelte-1v77ma3"> </p>'),ct=f("<!> <!>",1),vt=f('<p class="message svelte-1v77ma3">error signin</p> <div class="buttonContainer svelte-1v77ma3"><div class="buttonContainerItem"><!></div></div>',1),lt=f('<p class="message svelte-1v77ma3">Subscription updated successfully</p> <div class="buttonContainer svelte-1v77ma3"><div class="buttonContainerItem"><!></div></div>',1),ut=f('<div class="block svelte-1v77ma3"><!></div>');function pt(H,I){M(I,!0);const{addSearchParam:j,getAppLocation:B}=N(),{pushStackPages:G,clearStackPages:L}=Q(),{getAccount:T,updateSubscription:W}=R();let n=X("idle"),$=at(T);const{blockDialog:Y}=U(),q=()=>{const s=B().searchParams,r=`${window.location.pathname}${window.location.search}`;G(st.Auth),setTimeout(()=>{s.has("retPath")||j("retPath",r)},0)},z=()=>{L()},D=async()=>{P(n,"loading");try{const s=await fetch("/api/getSubscription",{method:"POST"});if(s.status!==200){P(n,"error");return}const r=await s.json();if(!r.subscriptionExpires){P(n,"error");return}const m=r.subscriptionExpires;W(m),P(n,"success")}catch{P(n,"error")}};V(()=>{Y(p(n)==="loading")});var E=ut(),F=d(E);{var O=s=>{var r=ct(),m=_(r);tt(m,{children:(a,o)=>{var c=x("Subscription");t(a,c)}});var k=C(m,2);{var w=a=>{var o=ot(),c=C(_(o),2),v=d(c);S(v,{onClick:q,children:(u,i)=>{var e=x("Connect");t(u,e)},$$slots:{default:!0}}),t(a,o)},l=a=>{var o=A(),c=_(o);{var v=i=>{var e=it(),g=d(e);S(g,{onClick:D,children:(h,K)=>{var y=x("Get subscription");t(h,y)},$$slots:{default:!0}}),t(i,e)},u=i=>{var e=nt(),g=d(e);et(h=>rt(g,`Your subscription is active until ${h??""}`),[()=>new Date(p($).subscriptionExpires).toLocaleDateString()]),t(i,e)};b(c,i=>{p($).subscriptionExpires<Date.now()?i(v):i(u,!1)},!0)}t(a,o)};b(k,a=>{p($)?a(l,!1):a(w)})}t(s,r)},J=s=>{var r=A(),m=_(r);{var k=l=>{var a=vt(),o=C(_(a),2),c=d(o),v=d(c);S(v,{onClick:D,fullWidth:!0,children:(u,i)=>{var e=x("try again");t(u,e)},$$slots:{default:!0}}),t(l,a)},w=l=>{var a=A(),o=_(a);{var c=v=>{var u=lt(),i=C(_(u),2),e=d(i),g=d(e);S(g,{onClick:z,fullWidth:!0,children:(h,K)=>{var y=x("Close");t(h,y)},$$slots:{default:!0}}),t(v,u)};b(o,v=>{p(n)==="success"&&v(c)},!0)}t(l,a)};b(m,l=>{p(n)==="error"?l(k):l(w,!1)},!0)}t(s,r)};b(F,s=>{p(n)==="idle"?s(O):s(J,!1)})}t(H,E),Z()}export{pt as default};
