import{p as q,n as z,A as J,z as M,h as A,r as N,q as V,u as W,g as u,o as F,f as m,i as P,c as h,d as s,j as G,k as g,y as w,a0 as I,H as b,x as y,s as U,L as Q,v as X,l as Y,B as Z}from"./aDd0l0vf3.js";import{e as ee}from"./aCpa8lgv9.js";import{c as te,b as ae,a as re}from"./aBEGDcNQV.js";import{g as ne}from"./a9q_jSmK4.js";var a=(r=>(r[r.Signup=0]="Signup",r[r.SignupError=1]="SignupError",r))(a||{}),se=m('<div class="b p-mcehu"><!> <!></div>'),oe=m('<div class="b p-mcehu"><!> <!></div>'),ie=m('<div class="a p-mcehu"><!></div>');function de(r,$){q($,!0);const{clearDialogPages:B}=z(),{getAccount:K,initCloudAccount:D}=J(),{getAppLocation:E,replace:k}=M();let T=w(()=>E().searchParams),j=w(K),_=A(""),o=A(N(a.Signup));const{blockDialog:S}=V(),C=async()=>{g(o,a.Signup,!0);try{const e=await ne(),t=crypto.getRandomValues(new Uint8Array(32)),i=await te({challenge:e,clientKey:t}),c=await fetch("/api/signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(c.status!==200){g(o,a.SignupError,!0);return}const n=await c.json(),p=u(j)===void 0,{encryptedClientKey:l}=await ee({clientKey:t,serverKey:new Uint8Array(ae(n.serverKey))});if(I(),await D({encryptedClientKey:re(l)}),S(!1),p)B();else{let d=u(T).get("retPath")||"";d&&g(_,d,!0),k(u(_)||"/")}}catch{g(o,a.SignupError,!0)}};W(()=>{S(u(o)===a.Signup)}),F(()=>{C()});var x=ie(),H=h(x);{var L=e=>{var t=se(),i=h(t);b(i,{children:(n,p)=>{var l=y("signup");s(n,l)}});var c=U(i,2);Q(c,{}),s(e,t)},O=e=>{var t=X(),i=Y(t);{var c=n=>{var p=oe(),l=h(p);b(l,{children:(v,R)=>{var f=y("error signup");s(v,f)}});var d=U(l,2);Z(d,{onClick:()=>C(),fullWidth:!0,children:(v,R)=>{var f=y("try again");s(v,f)},$$slots:{default:!0}}),s(n,p)};P(i,n=>{u(o)===a.SignupError&&n(c)},!0)}s(e,t)};P(H,e=>{u(o)===a.Signup?e(L):e(O,!1)})}s(r,x),G()}export{de as default};
