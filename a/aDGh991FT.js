import{p as U,J as X,u as Y,C as Z,b as u,w as E,x as k,g as t,A as h,X as G,a,Y as K,y as _,n as S,j as C,i as v,m as M,Z as J,f as Q,s as T,c as W,B as tt,z as et,_ as at}from"./aCXQNcsrB.js";var it=Q('<div class="a p-1hq9a8m"><p class="p-1hq9a8m">Note not found</p> <!></div>');function rt(O,m){U(m,!0);const{getNoteById:c,isInitedNotes:w,saveNote:A,updateNote:P,revertNote:I}=X(),{clearDialogPages:b}=Y(),{getHref:B}=Z();let n=u("idle"),r=u(""),f=u(void 0),s=u(void 0),l=u(""),d=u(E([])),p=u(0);const N=h(w);k(()=>{t(N)&&G(()=>{const e=new URLSearchParams(m.params).get("id");if(e){a(r,e,!0);const i=c(t(r));i?.data&&(a(s,i.data.link?K(i.data.link):void 0,!0),a(l,i.data.text,!0),a(d,i.data.tags.slice(),!0),a(p,i.data.updatedAt,!0))}})});const D=async()=>{if(t(f)){const e=c(t(r));if(!e?.data)return;const i=e.data.history?.find?.(y=>y.id===t(f));if(!i){a(f,void 0);return}if(i.link?.url===t(s)?.url&&i.link?.title===t(s)?.title&&i.text===t(l)&&JSON.stringify(i.tags)===JSON.stringify(t(d))){if(t(n)==="idle"){a(n,"loading");try{await I(t(r),t(f)),a(f,void 0),a(p,i.updatedAt,!0)}finally{a(n,"idle")}}}else if((e.data.link?.url!==t(s)?.url||e.data.link?.title!==t(s)?.title||e.data.text!==t(l)||JSON.stringify(e.data.tags)!==JSON.stringify(t(d)))&&t(n)==="idle"){a(n,"loading");try{await P(t(r),{link:J(t(s)),text:t(l),tags:t(d).slice()})}finally{a(n,"idle")}}}else{const e=c(t(r));if(!e?.data)return;if((e.data.link?.url!==t(s)?.url||e.data.link?.title!==t(s)?.title||e.data.text!==t(l)||JSON.stringify(e.data.tags)!==JSON.stringify(t(d)))&&t(n)==="idle"){a(n,"loading");try{a(p,0),a(f,await A(t(r),{link:J(t(s)),text:t(l),tags:t(d).slice()}),!0)}finally{a(n,"idle")}}}};k(()=>{t(N)&&t(n)!=="loading"&&D()});const q=e=>{e.preventDefault(),b()};var x=_(),V=S(x);{var $=e=>{var i=_(),y=S(i);{var j=g=>{var o=it(),F=T(W(o),2);{let H=h(()=>B(""));tt(F,{element:"a",get href(){return t(H)},onClick:q,children:(L,st)=>{var R=et("close");v(L,R)},$$slots:{default:!0}})}v(g,o)},z=g=>{at(g,{mode:"edit",get updatedAt(){return t(p)},get link(){return t(s)},set link(o){a(s,o,!0)},get text(){return t(l)},set text(o){a(l,o,!0)},get tags(){return t(d)},set tags(o){a(d,o,!0)}})};C(y,g=>{!t(r)||!c(t(r))?g(j):g(z,!1)})}v(e,i)};C(V,e=>{t(N)&&e($)})}v(O,x),M()}export{rt as default};
