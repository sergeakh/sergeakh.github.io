import{Q as ge,p as pe,i as fe,C as ue,h as me,j as F,k as _e,R as he,u as be,g as t,o as Z,f as A,m as M,c as w,d as l,n as we,l as o,q,r as E,s as _,S as Q,B,w as J,t as ye,J as je,K as xe,D as R,L as ke,v as De,y as ee}from"./B-5UZjRn.js";import{N as te}from"./BuEK7jxZ.js";import"./C0oCT9x_.js";const U=(T,h,v,y=new Set,f={},i=Date.now())=>{for(let d=0;d<T.children.length;d++){const c=T.children[d];if(c.tagName==="DT"){const L=c.querySelector(":scope > A"),j=c.querySelector(":scope > H3");if(L){const s=L.getAttribute("href"),x=Number(L.getAttribute("add_date"))*1e3||i+d,P=L.textContent||"unknown";if(!s)return v;const z=h.find(u=>u.toLowerCase()==="bookmarks bar")?h.filter(u=>u.toLowerCase()!=="bookmarks bar"):["other"];if(f[s])f[s].data.tags=[...new Set([...f[s].data.tags,...z])];else{const u={id:ge(),data:{type:"note",url:s,name:P,text:"",tags:z.length>0?z:[],updatedAt:x,createdAt:x}};f[u.data.url]=u,v.push(u)}}else if(j){const s=j.textContent?.trim();if(s&&j.nextElementSibling?.tagName==="DL"){const x=[...h];x.push(s);const P=j.nextElementSibling;y.has(P)||(y.add(P),U(P,x,v,y,f,i+d))}}}else c.tagName!=="DL"&&c.children.length>0&&(y.has(c)||(y.add(c),U(c,[...h],v,y,f,i+d)))}return v},Te=async T=>{const h=await T.text(),f=new DOMParser().parseFromString(h,"text/html").querySelector("DL");return f?U(f,[],[]):[]},ae=async(T,h)=>{const v=T.target;!v.files||v.files.length===0||await h(v.files[0])};var Se=A('<div class="buttonContainer svelte-1gjle5b"><!></div>'),Ce=A(`<div class="top svelte-1gjle5b"><p class="message svelte-1gjle5b">Select a file to import your data</p> <p>(browser bookmarks or a this app's file)</p></div> <div class="mobileBottom svelte-1gjle5b"><div class="tagsContainer svelte-1gjle5b"><p class="message message__tags svelte-1gjle5b">Additional tags:</p> <!></div> <!></div> <input type="file" accept=".json, .html" style="display: none;"/>`,1),Ee=A('<p class="message svelte-1gjle5b">Select a file to import your data</p> <div class="desktopContainer svelte-1gjle5b"><div class="dropzoneButtonContainer svelte-1gjle5b"><!></div> <div role="button" tabindex="-1"><div tabindex="-1" class="dropzone-content svelte-1gjle5b"><p class="svelte-1gjle5b">Drag and drop your file here</p> <p class="svelte-1gjle5b">or</p></div> <input type="file" accept=".json, .html" style="display: none;"/></div></div> <p class="message message__tags svelte-1gjle5b">Additional tags:</p> <!>',1),Le=A('<div class="top svelte-1gjle5b"><p class="message svelte-1gjle5b">Loading...</p> <!></div>'),Pe=A('<div class="top svelte-1gjle5b"><p class="message error svelte-1gjle5b">Something went wrong</p></div> <div class="buttonContainer svelte-1gjle5b"><!></div>',1),Ie=A('<div class="top svelte-1gjle5b"><p class="message success svelte-1gjle5b">Notes imported successfully!</p></div> <div class="buttonContainer svelte-1gjle5b"><!></div>',1),Ae=A('<div class="block svelte-1gjle5b"><!></div>');function ze(T,h){pe(h,!0);const{blockDialog:v}=fe(),{importNotes:y}=ue(),{clearStackPages:f}=me();let i=F("idle"),d=F(null),c=F(!1),L=F(null),j=F(_e([])),s=F(!1);const{checkMobileSize:x}=he(),P=()=>{f()};be(()=>{v(t(i)==="loading")}),Z(()=>(t(d)&&t(d).addEventListener("cancel",e=>{e.preventDefault(),e.stopImmediatePropagation(),e.stopPropagation()}),()=>{v(!1)}));const z=async e=>{const n=await e.text(),g=JSON.parse(n),N=[];if(!g.notes)throw new Error("Invalid import file format");for(const $ of Object.values(g.notes))$&&N.push($);return N},u=async e=>{o(i,"loading");let n=[];try{if(e.name.endsWith(".json"))n=await z(e);else if(e.name.endsWith(".html"))n=await Te(e);else throw new Error("Unsupported file format. Please upload a JSON or HTML file.");await y(n.map(g=>({...g,data:{...g.data,tags:Array.from(new Set([...g.data.tags||[],...t(j)]))}}))),await new Promise(g=>setTimeout(g,500)),o(i,"success")}catch{o(i,"error")}},G=()=>{t(d)?.click()},se=e=>{e.preventDefault(),e.stopPropagation(),o(c,!0)},re=e=>{e.preventDefault(),e.stopPropagation(),o(c,!1)},oe=e=>{e.preventDefault(),e.stopPropagation(),o(c,!0)},ne=async e=>{if(e.preventDefault(),e.stopPropagation(),o(c,!1),!e.dataTransfer?.files||e.dataTransfer.files.length===0)return;const n=e.dataTransfer.files[0];if(n.type!=="application/json"&&n.type!=="text/html"){o(i,"error");return}await u(n)},V=e=>{o(j,e,!0)},X=e=>{e.key==="Escape"&&(document.activeElement instanceof HTMLInputElement&&document.activeElement.type==="text"||document.activeElement instanceof HTMLTextAreaElement)&&(t(s)&&o(s,!1),document.activeElement.blur(),e.preventDefault(),e.stopPropagation())};Z(()=>(document.addEventListener("keydown",X),()=>document.removeEventListener("keydown",X)));var Y=Ae(),le=w(Y);{var ie=e=>{var n=q(),g=E(n);{var N=p=>{var m=Ce(),k=_(E(m),2),I=w(k),H=_(w(I),2);te(H,{get selectedTags(){return t(j)},onChangeTags:V,get shownTagInput(){return t(s)},set shownTagInput(a){o(s,a,!0)}});var r=_(I,2);{var b=a=>{var D=Se(),C=w(D);B(C,{fullWidth:!0,onClick:G,children:(O,W)=>{var K=J("Select File");l(O,K)},$$slots:{default:!0}}),l(a,D)};M(r,a=>{t(s)||a(b)})}var S=_(k,2);S.__change=[ae,u],Q(S,a=>o(d,a),()=>t(d)),l(p,m)},$=p=>{var m=Ee(),k=_(E(m),2),I=w(k),H=w(I);B(H,{onClick:G,children:(a,D)=>{var C=J("Select File");l(a,C)},$$slots:{default:!0}});var r=_(I,2),b=_(w(r),2);b.__change=[ae,u],Q(b,a=>o(d,a),()=>t(d)),Q(r,a=>o(L,a),()=>t(L));var S=_(k,4);te(S,{get selectedTags(){return t(j)},onChangeTags:V,get shownTagInput(){return t(s)},set shownTagInput(a){o(s,a,!0)}}),ye(()=>je(r,1,xe(["dropzone",{active:t(c)}]),"svelte-1gjle5b")),R("dragenter",r,se),R("dragover",r,oe),R("dragleave",r,re),R("drop",r,ne),l(p,m)};M(g,p=>{x()?p(N):p($,!1)})}l(e,n)},de=e=>{var n=q(),g=E(n);{var N=p=>{var m=Le(),k=_(w(m),2);ke(k,{}),l(p,m)},$=p=>{var m=q(),k=E(m);{var I=r=>{var b=Pe(),S=_(E(b),2),a=w(S);{let D=ee(x);B(a,{get fullWidth(){return t(D)},onClick:()=>{o(i,"idle")},children:(C,O)=>{var W=J("Try Again");l(C,W)},$$slots:{default:!0}})}l(r,b)},H=r=>{var b=q(),S=E(b);{var a=D=>{var C=Ie(),O=_(E(C),2),W=w(O);{let K=ee(x);B(W,{get fullWidth(){return t(K)},onClick:P,children:(ce,Ne)=>{var ve=J("Close");l(ce,ve)},$$slots:{default:!0}})}l(D,C)};M(S,D=>{t(i)==="success"&&D(a)},!0)}l(r,b)};M(k,r=>{t(i)==="error"?r(I):r(H,!1)},!0)}l(p,m)};M(g,p=>{t(i)==="loading"?p(N):p($,!1)},!0)}l(e,n)};M(le,e=>{t(i)==="idle"?e(ie):e(de,!1)})}l(T,Y),we()}De(["change"]);export{ze as default};
