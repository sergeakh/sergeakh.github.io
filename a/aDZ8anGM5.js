import{M as Ie,p as We,v as Me,J as Ne,u as Fe,b as R,w as je,K as ze,x as Oe,g as a,o as we,a as r,f as p,j as m,c as l,i as t,m as He,n as c,s as i,O as he,y as te,B as j,z,t as qe,k as Je,l as Be,G as ne,L as Ge,r as Ke,A as ye,d as xe,I as be,N as ke}from"./aC1t3sNCD.js";const ce=(U,W,S,P=new Set,b={},o=Date.now())=>{for(let _=0;_<U.children.length;_++){const d=U.children[_];if(d.tagName==="DT"){const O=d.querySelector(":scope > A"),w=d.querySelector(":scope > H3");if(O){const n=O.getAttribute("href"),k=Number(O.getAttribute("add_date"))*1e3||o+_,h=O.textContent||"unknown";if(!n)return S;const M=W.find(N=>N.toLowerCase()==="bookmarks bar")?W.filter(N=>N.toLowerCase()!=="bookmarks bar"):["other"];if(b[n])b[n].data.tags=[...new Set([...b[n].data.tags,...M])];else{const N={id:Ie(),data:{link:{url:n,title:h},text:"",tags:M.length>0?M:[],updatedAt:k,createdAt:k,history:[]}};b[n]=N,S.push(N)}}else if(w){const n=w.textContent?.trim();if(n&&w.nextElementSibling?.tagName==="DL"){const k=[...W];k.push(n);const h=w.nextElementSibling;P.has(h)||(P.add(h),ce(h,k,S,P,b,o+_))}}}else d.tagName!=="DL"&&d.children.length>0&&(P.has(d)||(P.add(d),ce(d,[...W],S,P,b,o+_)))}return S},Re=async U=>{const W=await U.text(),b=new DOMParser().parseFromString(W,"text/html").querySelector("DL");return b?ce(b,[],[]):[]};var Ue=p(`<div class="b p-1gmuo2w"><p class="c p-1gmuo2w">Select a file to import your data</p> <p>(browser bookmarks or a this app's file)</p></div> <div class="d p-1gmuo2w"><div class="e p-1gmuo2w"><!></div></div>`,1),Qe=p('<p class="c p-1gmuo2w">Select a file to import your data</p>'),Ve=p('<!> <div class="h p-1gmuo2w"><div class="i p-1gmuo2w"><!></div> <div role="button" tabindex="-1"><div tabindex="-1" class="j p-1gmuo2w"><p class="p-1gmuo2w">Drag and drop your file here</p> <p class="p-1gmuo2w">or</p></div></div></div>',1),Xe=p('<!> <input type="file" accept=".json, .html" style="display: none;"/>',1),Ye=p('<div class="b p-1gmuo2w"><p class="c k p-1gmuo2w">Loading...</p> <!></div>'),Ze=p('<div class="b p-1gmuo2w"><p class="c l p-1gmuo2w">Something went wrong</p></div> <div class="f p-1gmuo2w"><!></div>',1),et=p('<div class="o p-1gmuo2w"><p class="c p p-1gmuo2w">Additional tags:</p> <!></div>'),tt=p('<div class="f p-1gmuo2w"><!> <!></div>'),at=p('<div class="b p-1gmuo2w"><p class="c p-1gmuo2w">Loaded</p></div> <div class="d p-1gmuo2w"><div class="m p-1gmuo2w"><button class="n p-1gmuo2w"><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper><span>Settings</span></button></div> <!> <!></div>',1),rt=p('<p class="c p p-1gmuo2w">Additional tags:</p> <div class="q"><!></div>',1),st=p('<div class="f p-1gmuo2w"><!> <!></div>'),ot=p('<p class="c p-1gmuo2w">Loaded</p> <div class="m p-1gmuo2w"><button class="n p-1gmuo2w"><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper><span>Settings</span></button></div> <!> <!>',1),nt=p('<div class="b p-1gmuo2w"><p class="c r p-1gmuo2w">Success!</p></div> <div class="f p-1gmuo2w"><!></div>',1),lt=p('<div class="a p-1gmuo2w"><!></div>');function dt(U,W){We(W,!0);const{blockDialog:S}=Me(),{importNotes:P}=Ne(),{clearDialogPages:b}=Fe();let o=R("idle"),_=R(null),d=R(!1),O=R(null),w=R(je([])),n=R(!1),k=[],h=R(!1);const{checkMobileSize:M}=ze(),N=()=>{b()};Oe(()=>{S(a(o)==="loading")}),we(()=>(a(_)&&a(_).addEventListener("cancel",e=>{r(o,"idle"),e.preventDefault(),e.stopImmediatePropagation(),e.stopPropagation()}),()=>{S(!1)}));const Te=async e=>{const s=await e.text(),H=JSON.parse(s),Q=[];if(!H.notes)throw new Error("Invalid import file format");for(const V of Object.values(H.notes))V&&Q.push(V);return Q},pe=async e=>{r(o,"loading"),await new Promise(s=>setTimeout(s,500));try{if(e.name.endsWith(".json"))k=await Te(e);else if(e.name.endsWith(".html"))k=await Re(e);else throw new Error("Unsupported file format. Please upload a JSON or HTML file.");await new Promise(s=>setTimeout(s,0)),r(o,"success-loaded")}catch{r(o,"error")}},De=async e=>{const s=e.target;!s.files||s.files.length===0||await pe(s.files[0])},ue=()=>{a(_)?.click()},Se=e=>{e.preventDefault(),e.stopPropagation(),r(d,!0)},Pe=e=>{e.preventDefault(),e.stopPropagation(),r(d,!1)},Ce=e=>{e.preventDefault(),e.stopPropagation(),r(d,!0)},$e=async e=>{if(e.preventDefault(),e.stopPropagation(),r(d,!1),!e.dataTransfer?.files||e.dataTransfer.files.length===0)return;const s=e.dataTransfer.files[0];if(s.type!=="application/json"&&s.type!=="text/html"){r(o,"error");return}await pe(s)},ge=e=>{r(w,e,!0)},fe=async()=>{r(o,"loading");try{await P(k.map(e=>({...e,data:{...e.data,tags:Array.from(new Set([...e.data.tags||[],...a(w)])),history:(e.data.history||[]).map(s=>({...s,tags:Array.from(new Set([...s.tags||[],...a(w)]))}))}}))),await new Promise(e=>setTimeout(e,500))}catch{r(o,"error");return}r(o,"success")},me=e=>{e.key==="Escape"&&(document.activeElement instanceof HTMLInputElement&&document.activeElement.type==="text"||document.activeElement instanceof HTMLTextAreaElement)&&(a(n)&&r(n,!1),document.activeElement.blur(),e.preventDefault(),e.stopPropagation())};we(()=>(document.addEventListener("keydown",me),()=>document.removeEventListener("keydown",me)));var _e=lt(),Le=l(_e);{var Ee=e=>{var s=Xe(),H=c(s);{var Q=v=>{var $=te(),X=c($);{var ae=y=>{var T=Ue(),q=i(c(T),2),x=l(q),u=l(x);j(u,{fullWidth:!0,onClick:ue,children:(g,L)=>{var J=z("Select File");t(g,J)},$$slots:{default:!0}}),t(y,T)};m(X,y=>{y(ae,!1)})}t(v,$)},V=v=>{var $=Ve(),X=c($);{var ae=u=>{var g=Qe();t(u,g)};m(X,u=>{u(ae,!1)})}var y=i(X,2),T=l(y),q=l(T);j(q,{onClick:ue,children:(u,g)=>{var L=z("Select File");t(u,L)},$$slots:{default:!0}});var x=i(T,2);he(x,u=>r(O,u),()=>a(O)),qe(()=>Je(x,1,Be({s:!0,t:a(d)}),"p-1gmuo2w")),ne("dragenter",x,Se),ne("dragover",x,Ce),ne("dragleave",x,Pe),ne("drop",x,$e),t(v,$)};m(H,v=>{M()?v(Q):v(V,!1)})}var C=i(H,2);C.__change=De,he(C,v=>r(_,v),()=>a(_)),t(e,s)},Ae=e=>{var s=te(),H=c(s);{var Q=C=>{var v=Ye(),$=i(l(v),2);Ge($,{}),t(C,v)},V=C=>{var v=te(),$=c(v);{var X=y=>{var T=Ze(),q=i(c(T),2),x=l(q);{let u=ye(M);j(x,{get fullWidth(){return a(u)},onClick:()=>{r(o,"idle")},children:(g,L)=>{var J=z("Try Again");t(g,J)},$$slots:{default:!0}})}t(y,T)},ae=y=>{var T=te(),q=c(T);{var x=g=>{var L=te(),J=c(L);{var le=E=>{var B=at(),Y=i(c(B),2),G=l(Y),K=l(G);K.__click=()=>{r(h,!a(h)),r(n,!1)};var Z=l(K);xe(Z,()=>({"--rotate":"30deg","--size":"20px"})),be(Z.lastChild,{name:"settings"});var ee=i(G,2);{var ie=f=>{var D=et(),F=i(l(D),2);ke(F,{get selectedTags(){return a(w)},onChangeTags:ge,get shownTagInput(){return a(n)},set shownTagInput(I){r(n,I,!0)}}),t(f,D)};m(ee,f=>{a(h)&&f(ie)})}var de=i(ee,2);{var A=f=>{var D=tt(),F=l(D);j(F,{withoutMinWidth:!0,fullWidth:!0,type:"secondary",onClick:()=>{r(o,"idle"),k=[],r(w,[],!0)},children:(se,oe)=>{var ve=z("Cancel");t(se,ve)},$$slots:{default:!0}});var I=i(F,2);j(I,{fullWidth:!0,withoutMinWidth:!0,onClick:fe,children:(se,oe)=>{var ve=z("Confirm");t(se,ve)},$$slots:{default:!0}}),t(f,D)};m(de,f=>{a(n)||f(A)})}t(E,B)},re=E=>{var B=ot(),Y=i(c(B),2),G=l(Y);G.__click=()=>r(h,!a(h));var K=l(G);xe(K,()=>({"--rotate":"30deg","--size":"20px"})),be(K.lastChild,{name:"settings"});var Z=i(Y,2);{var ee=A=>{var f=rt(),D=i(c(f),2),F=l(D);ke(F,{get selectedTags(){return a(w)},onChangeTags:ge,get shownTagInput(){return a(n)},set shownTagInput(I){r(n,I,!0)}}),t(A,f)};m(Z,A=>{a(h)&&A(ee)})}var ie=i(Z,2);{var de=A=>{var f=st(),D=l(f);j(D,{type:"secondary",fullWidth:!0,onClick:()=>{r(o,"idle"),k=[],r(w,[],!0)},children:(I,se)=>{var oe=z("Cancel");t(I,oe)},$$slots:{default:!0}});var F=i(D,2);j(F,{fullWidth:!0,onClick:fe,children:(I,se)=>{var oe=z("Add");t(I,oe)},$$slots:{default:!0}}),t(A,f)};m(ie,A=>{a(n)||A(de)})}t(E,B)};m(J,E=>{M()?E(le):E(re,!1)})}t(g,L)},u=g=>{var L=te(),J=c(L);{var le=re=>{var E=nt(),B=i(c(E),2),Y=l(B);{let G=ye(M);j(Y,{get fullWidth(){return a(G)},onClick:N,children:(K,Z)=>{var ee=z("Close");t(K,ee)},$$slots:{default:!0}})}t(re,E)};m(J,re=>{a(o)==="success"&&re(le)},!0)}t(g,L)};m(q,g=>{a(o)==="success-loaded"?g(x):g(u,!1)},!0)}t(y,T)};m($,y=>{a(o)==="error"?y(X):y(ae,!1)},!0)}t(C,v)};m(H,C=>{a(o)==="loading"?C(Q):C(V,!1)},!0)}t(e,s)};m(Le,e=>{a(o)==="idle"?e(Ee):e(Ae,!1)})}t(U,_e),He()}Ke(["change","click"]);export{dt as default};
