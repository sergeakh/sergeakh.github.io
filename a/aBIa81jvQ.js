import{M as It,p as Wt,v as Mt,J as Nt,u as Ft,b as R,w as jt,K as zt,x as Ot,g as a,o as ht,f as p,j as _,c as o,i as e,m as Ht,a as r,n as v,s as i,O as xt,y as et,B as j,z,t as qt,k as Jt,l as Bt,G as lt,L as Gt,r as Kt,A as kt,d as wt,I as yt,N as bt}from"./aCXQNcsrB.js";const vt=(U,W,S,C=new Set,y={},n=Date.now())=>{for(let m=0;m<U.children.length;m++){const d=U.children[m];if(d.tagName==="DT"){const O=d.querySelector(":scope > A"),h=d.querySelector(":scope > H3");if(O){const l=O.getAttribute("href"),b=Number(O.getAttribute("add_date"))*1e3||n+m,x=O.textContent||"unknown";if(!l)return S;const M=W.find(N=>N.toLowerCase()==="bookmarks bar")?W.filter(N=>N.toLowerCase()!=="bookmarks bar"):["other"];if(y[l])y[l].data.tags=[...new Set([...y[l].data.tags,...M])];else{const N={id:It(),data:{link:{url:l,title:x},text:"",tags:M.length>0?M:[],updatedAt:b,createdAt:b,history:[]}};y[l]=N,S.push(N)}}else if(h){const l=h.textContent?.trim();if(l&&h.nextElementSibling?.tagName==="DL"){const b=[...W];b.push(l);const x=h.nextElementSibling;C.has(x)||(C.add(x),vt(x,b,S,C,y,n+m))}}}else d.tagName!=="DL"&&d.children.length>0&&(C.has(d)||(C.add(d),vt(d,[...W],S,C,y,n+m)))}return S},Rt=async U=>{const W=await U.text(),y=new DOMParser().parseFromString(W,"text/html").querySelector("DL");return y?vt(y,[],[]):[]};var Ut=p(`<div class="b p-l9xk4n"><p class="c p-l9xk4n">Select a file to import your data</p> <p>(browser bookmarks or a this app's file)</p></div> <div class="d p-l9xk4n"><div class="e p-l9xk4n"><!></div></div>`,1),Qt=p('<p class="c p-l9xk4n">Select a file to import your data</p>'),Vt=p('<!> <div class="h p-l9xk4n"><div class="i p-l9xk4n"><!></div> <div role="button" tabindex="-1"><div tabindex="-1" class="j p-l9xk4n"><p class="p-l9xk4n">Drag and drop your file here</p> <p class="p-l9xk4n">or</p></div></div></div>',1),Xt=p('<!> <input type="file" accept=".json, .html" style="display: none;"/>',1),Yt=p('<div class="b p-l9xk4n"><p class="c p-l9xk4n">Loading...</p> <!></div>'),Zt=p('<div class="b p-l9xk4n"><p class="c k p-l9xk4n">Something went wrong</p></div> <div class="f p-l9xk4n"><!></div>',1),te=p('<div class="n p-l9xk4n"><p class="c o p-l9xk4n">Additional tags:</p> <!></div>'),ee=p('<div class="f p-l9xk4n"><!> <!></div>'),ae=p('<div class="b p-l9xk4n"><p class="c p-l9xk4n">Data loaded successfully</p></div> <div class="d p-l9xk4n"><div class="l p-l9xk4n"><button class="m p-l9xk4n"><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper><span>Settings</span></button></div> <!> <!></div>',1),re=p('<p class="c o p-l9xk4n">Additional tags:</p> <div class="p"><!></div>',1),se=p('<div class="f p-l9xk4n"><!> <!></div>'),ne=p('<p class="c p-l9xk4n">Data loaded successfully</p> <div class="l p-l9xk4n"><button class="m p-l9xk4n"><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper><span>Settings</span></button></div> <!> <!>',1),le=p('<div class="b p-l9xk4n"><p class="c q p-l9xk4n">Success!</p></div> <div class="f p-l9xk4n"><!></div>',1),oe=p('<div class="a p-l9xk4n"><!></div>');function de(U,W){Wt(W,!0);const{blockDialog:S}=Mt(),{importNotes:C}=Nt(),{clearDialogPages:y}=Ft();let n=R("idle"),m=R(null),d=R(!1),O=R(null),h=R(jt([])),l=R(!1),b=[],x=R(!1);const{checkMobileSize:M}=zt(),N=()=>{y()};Ot(()=>{S(a(n)==="loading")}),ht(()=>(a(m)&&a(m).addEventListener("cancel",t=>{t.preventDefault(),t.stopImmediatePropagation(),t.stopPropagation()}),()=>{S(!1)}));const Dt=async t=>{const s=await t.text(),H=JSON.parse(s),Q=[];if(!H.notes)throw new Error("Invalid import file format");for(const V of Object.values(H.notes))V&&Q.push(V);return Q},pt=async t=>{r(n,"loading");try{if(t.name.endsWith(".json"))b=await Dt(t);else if(t.name.endsWith(".html"))b=await Rt(t);else throw new Error("Unsupported file format. Please upload a JSON or HTML file.");await new Promise(s=>setTimeout(s,0)),r(n,"success-loaded")}catch{r(n,"error")}},Tt=async t=>{const s=t.target;!s.files||s.files.length===0||await pt(s.files[0])},ft=()=>{a(m)?.click()},St=t=>{t.preventDefault(),t.stopPropagation(),r(d,!0)},Ct=t=>{t.preventDefault(),t.stopPropagation(),r(d,!1)},Pt=t=>{t.preventDefault(),t.stopPropagation(),r(d,!0)},$t=async t=>{if(t.preventDefault(),t.stopPropagation(),r(d,!1),!t.dataTransfer?.files||t.dataTransfer.files.length===0)return;const s=t.dataTransfer.files[0];if(s.type!=="application/json"&&s.type!=="text/html"){r(n,"error");return}await pt(s)},ut=t=>{r(h,t,!0)},gt=async()=>{r(n,"loading");try{await C(b.map(t=>({...t,data:{...t.data,tags:Array.from(new Set([...t.data.tags||[],...a(h)])),history:(t.data.history||[]).map(s=>({...s,tags:Array.from(new Set([...s.tags||[],...a(h)]))}))}}))),await new Promise(t=>setTimeout(t,0))}catch{r(n,"error");return}r(n,"success")},_t=t=>{t.key==="Escape"&&(document.activeElement instanceof HTMLInputElement&&document.activeElement.type==="text"||document.activeElement instanceof HTMLTextAreaElement)&&(a(l)&&r(l,!1),document.activeElement.blur(),t.preventDefault(),t.stopPropagation())};ht(()=>(document.addEventListener("keydown",_t),()=>document.removeEventListener("keydown",_t)));var mt=oe(),Et=o(mt);{var Lt=t=>{var s=Xt(),H=v(s);{var Q=c=>{var $=et(),X=v($);{var at=k=>{var D=Ut(),q=i(v(D),2),w=o(q),f=o(w);j(f,{fullWidth:!0,onClick:ft,children:(u,E)=>{var J=z("Select File");e(u,J)},$$slots:{default:!0}}),e(k,D)};_(X,k=>{k(at,!1)})}e(c,$)},V=c=>{var $=Vt(),X=v($);{var at=f=>{var u=Qt();e(f,u)};_(X,f=>{f(at,!1)})}var k=i(X,2),D=o(k),q=o(D);j(q,{onClick:ft,children:(f,u)=>{var E=z("Select File");e(f,E)},$$slots:{default:!0}});var w=i(D,2);xt(w,f=>r(O,f),()=>a(O)),qt(()=>Jt(w,1,Bt({r:!0,s:a(d)}),"p-l9xk4n")),lt("dragenter",w,St),lt("dragover",w,Pt),lt("dragleave",w,Ct),lt("drop",w,$t),e(c,$)};_(H,c=>{M()?c(Q):c(V,!1)})}var P=i(H,2);P.__change=Tt,xt(P,c=>r(m,c),()=>a(m)),e(t,s)},At=t=>{var s=et(),H=v(s);{var Q=P=>{var c=Yt(),$=i(o(c),2);Gt($,{}),e(P,c)},V=P=>{var c=et(),$=v(c);{var X=k=>{var D=Zt(),q=i(v(D),2),w=o(q);{let f=kt(M);j(w,{get fullWidth(){return a(f)},onClick:()=>{r(n,"idle")},children:(u,E)=>{var J=z("Try Again");e(u,J)},$$slots:{default:!0}})}e(k,D)},at=k=>{var D=et(),q=v(D);{var w=u=>{var E=et(),J=v(E);{var ot=L=>{var B=ae(),Y=i(v(B),2),G=o(Y),K=o(G);K.__click=()=>{r(x,!a(x)),r(l,!1)};var Z=o(K);wt(Z,()=>({"--rotate":"30deg","--size":"20px"})),yt(Z.lastChild,{name:"settings"});var tt=i(G,2);{var it=g=>{var T=te(),F=i(o(T),2);bt(F,{get selectedTags(){return a(h)},onChangeTags:ut,get shownTagInput(){return a(l)},set shownTagInput(I){r(l,I,!0)}}),e(g,T)};_(tt,g=>{a(x)&&g(it)})}var dt=i(tt,2);{var A=g=>{var T=ee(),F=o(T);j(F,{withoutMinWidth:!0,fullWidth:!0,type:"secondary",onClick:()=>{r(n,"idle"),b=[],r(h,[],!0)},children:(st,nt)=>{var ct=z("Cancel");e(st,ct)},$$slots:{default:!0}});var I=i(F,2);j(I,{fullWidth:!0,withoutMinWidth:!0,onClick:gt,children:(st,nt)=>{var ct=z("Confirm");e(st,ct)},$$slots:{default:!0}}),e(g,T)};_(dt,g=>{a(l)||g(A)})}e(L,B)},rt=L=>{var B=ne(),Y=i(v(B),2),G=o(Y);G.__click=()=>r(x,!a(x));var K=o(G);wt(K,()=>({"--rotate":"30deg","--size":"20px"})),yt(K.lastChild,{name:"settings"});var Z=i(Y,2);{var tt=A=>{var g=re(),T=i(v(g),2),F=o(T);bt(F,{get selectedTags(){return a(h)},onChangeTags:ut,get shownTagInput(){return a(l)},set shownTagInput(I){r(l,I,!0)}}),e(A,g)};_(Z,A=>{a(x)&&A(tt)})}var it=i(Z,2);{var dt=A=>{var g=se(),T=o(g);j(T,{type:"secondary",fullWidth:!0,onClick:()=>{r(n,"idle"),b=[],r(h,[],!0)},children:(I,st)=>{var nt=z("Cancel");e(I,nt)},$$slots:{default:!0}});var F=i(T,2);j(F,{fullWidth:!0,onClick:gt,children:(I,st)=>{var nt=z("Add");e(I,nt)},$$slots:{default:!0}}),e(A,g)};_(it,A=>{a(l)||A(dt)})}e(L,B)};_(J,L=>{M()?L(ot):L(rt,!1)})}e(u,E)},f=u=>{var E=et(),J=v(E);{var ot=rt=>{var L=le(),B=i(v(L),2),Y=o(B);{let G=kt(M);j(Y,{get fullWidth(){return a(G)},onClick:N,children:(K,Z)=>{var tt=z("Close");e(K,tt)},$$slots:{default:!0}})}e(rt,L)};_(J,rt=>{a(n)==="success"&&rt(ot)},!0)}e(u,E)};_(q,u=>{a(n)==="success-loaded"?u(w):u(f,!1)},!0)}e(k,D)};_($,k=>{a(n)==="error"?k(X):k(at,!1)},!0)}e(P,c)};_(H,P=>{a(n)==="loading"?P(Q):P(V,!1)},!0)}e(t,s)};_(Et,t=>{a(n)==="idle"?t(Lt):t(At,!1)})}e(U,mt),Ht()}Kt(["change","click"]);export{de as default};
