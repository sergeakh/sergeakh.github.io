import{p as K,J as M,u as Q,C as T,b as u,w as W,x as _,g as t,A as h,_ as C,a,$ as X,y as J,n as O,j as w,i as m,m as Y,a0 as I,f as Z,s as tt,c as et,B as at,z as it,a1 as nt}from"./aDb0K7ahq.js";var rt=Z('<div class="a p-1hq9a8m"><p class="p-1hq9a8m">Note not found</p> <!></div>');function lt(P,A){K(A,!0);const{getNoteById:f,isInitedNotes:$,saveNote:b,updateNote:B,revertNote:D,pinNote:q}=M(),{clearDialogPages:V}=Q(),{getHref:j}=T();let s=u("idle"),n=u(""),g=u(void 0),r=u(void 0),l=u(""),o=u(W([])),c=u(!1),v=u(0);const N=h($);_(()=>{t(N)&&(t(c),C(()=>{f(t(n))?.data.pinned!==t(c)&&q(t(n),t(c))}))}),_(()=>{t(N)&&C(()=>{const e=new URLSearchParams(A.params).get("id");if(e){a(n,e,!0);const i=f(t(n));i?.data&&(a(r,i.data.link?X(i.data.link):void 0,!0),a(l,i.data.text,!0),a(o,i.data.tags.slice(),!0),a(c,!!i.data.pinned,!0),a(v,i.data.updatedAt,!0))}})});const z=async()=>{if(t(g)){const e=f(t(n));if(!e?.data)return;const i=e.data.history?.find?.(x=>x.id===t(g));if(!i){a(g,void 0);return}if(i.link?.url===t(r)?.url&&i.link?.title===t(r)?.title&&i.text===t(l)&&JSON.stringify(i.tags)===JSON.stringify(t(o))){if(t(s)==="idle"){a(s,"loading");try{await D(t(n),t(g)),a(g,void 0),a(v,i.updatedAt,!0)}finally{a(s,"idle")}}}else if((e.data.link?.url!==t(r)?.url||e.data.link?.title!==t(r)?.title||e.data.text!==t(l)||JSON.stringify(e.data.tags)!==JSON.stringify(t(o)))&&t(s)==="idle"){a(s,"loading");try{await B(t(n),{link:I(t(r)),text:t(l),tags:t(o).slice()})}finally{a(s,"idle")}}}else{const e=f(t(n));if(!e?.data)return;if((e.data.link?.url!==t(r)?.url||e.data.link?.title!==t(r)?.title||e.data.text!==t(l)||JSON.stringify(e.data.tags)!==JSON.stringify(t(o)))&&t(s)==="idle"){a(s,"loading");try{a(v,0),a(g,await b(t(n),{link:I(t(r)),text:t(l),tags:t(o).slice()}),!0)}finally{a(s,"idle")}}}};_(()=>{t(N)&&t(s)!=="loading"&&z()});const F=e=>{e.preventDefault(),V()};var S=J(),H=O(S);{var L=e=>{var i=J(),x=O(i);{var R=p=>{var y=rt(),k=tt(et(y),2);{let d=h(()=>j(""));at(k,{element:"a",get href(){return t(d)},onClick:F,children:(E,st)=>{var G=it("close");m(E,G)},$$slots:{default:!0}})}m(p,y)},U=p=>{{let y=h(()=>f(t(n))?.data.deletedAt),k=h(()=>f(t(n))?.data.archivedAt);nt(p,{get noteId(){return t(n)},mode:"edit",get updatedAt(){return t(v)},get deletedAt(){return t(y)},get archivedAt(){return t(k)},get link(){return t(r)},set link(d){a(r,d,!0)},get text(){return t(l)},set text(d){a(l,d,!0)},get tags(){return t(o)},set tags(d){a(o,d,!0)},get pinned(){return t(c)},set pinned(d){a(c,d,!0)}})}};w(x,p=>{!t(n)||!f(t(n))?p(R):p(U,!1)})}m(e,i)};w(H,e=>{t(N)&&e(L)})}m(P,S),Y()}export{lt as default};
