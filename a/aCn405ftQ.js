import{p as ut,J as gt,u as ft,C as ct,b as l,w as O,x as S,g as t,A as c,_ as w,a as n,$ as s,o as pt,y as b,n as L,j as M,i as C,m as ht,f as xt,s as kt,c as vt,B as Nt,z as yt,a0 as mt}from"./aBxIaNIxL.js";var Ct=xt('<div class="a p-1hq9a8m"><p class="p-1hq9a8m">Note not found</p> <!></div>');function _t(U,J){ut(J,!0);const{getNoteById:N,isInitedNotes:q,saveNote:z,updateNote:j,revertNote:F,pinNote:G,getGetMapNotes:R,zipNoteHistory:V}=gt(),{clearDialogPages:E}=ft(),{getHref:K}=ct();let y=l("idle"),d=l(""),o=l(void 0),u=l(""),g=l(O([])),x=l(!1),A=l(0),f=l(void 0),I=l(void 0),r=l(-1),a=l(O([])),p=l("unknown");const _=c(q);let k=l(null);S(()=>{if(!t(_))return;const e=new URLSearchParams(J.params).get("id");!e||e===t(d)||w(()=>{n(d,e,!0);const i=N(t(d));i?.data&&(n(o,i.data.link?s(i.data.link):void 0,!0),n(u,i.data.text,!0),n(g,i.data.tags.slice(),!0),n(x,!!i.data.pinned,!0),n(A,i.data.updatedAt,!0),n(a,s(i.data.history??[]),!0),n(f,{versionId:i.data.versionId,link:i.data.link?s(i.data.link):void 0,text:i.data.text,tags:i.data.tags.slice(),updatedAt:i.data.updatedAt},!0),t(a).push(s(t(f))),n(r,t(a).length-1))})});const Q=async e=>{n(y,"loading");try{t(I)?t(f)?.link?.url===e.link?.url&&t(f)?.link?.title===e.link?.title&&t(f)?.text===e.text&&JSON.stringify(t(f)?.tags)===JSON.stringify(e.tags)?(await F(t(d),t(f).versionId),n(I,void 0)):await j(t(d),{link:s(e.link),text:e.text,tags:e.tags.slice()}):(n(A,0),n(I,await z(t(d),{link:s(e.link),text:e.text,tags:e.tags.slice()}),!0))}finally{n(y,"idle")}},W=e=>{e.preventDefault(),E()};let X=c(()=>t(r)>0),Y=c(()=>t(r)<t(a).length-1);const Z=()=>{if(t(r)<=0)return;n(r,t(r)-1);const e=t(a)[t(r)];n(o,s(e.link),!0),n(u,e.text,!0),n(g,s(e.tags),!0),n(p,"unknown"),v()},D=()=>{if(t(r)>=t(a).length-1)return;n(r,t(r)+1);const e=t(a)[t(r)];n(o,s(e.link),!0),n(u,e.text,!0),n(g,s(e.tags),!0),n(p,"unknown"),v()},tt=e=>{n(x,e,!0),t(d)&&G(t(d),e)},v=()=>{n(k,{link:s(t(o)),text:t(u),tags:t(g).slice()},!0)},T=e=>{n(o,e,!0),n(a,t(a).slice(0,t(r)+1),!0),n(p,"unknown"),t(a).push({versionId:void 0,link:s(t(o)),text:t(u),tags:s(t(g)),updatedAt:Date.now()}),n(r,t(a).length-1),v()},$=e=>{n(g,e,!0),n(a,t(a).slice(0,t(r)+1),!0),n(p,"unknown"),t(a).push({versionId:void 0,link:s(t(o)),text:t(u),tags:s(t(g)),updatedAt:Date.now()}),n(r,t(a).length-1),v()},B=e=>{n(u,e,!0),n(a,t(a).slice(0,t(r)+1),!0),t(p)!=="text"?(t(a).push({versionId:void 0,link:s(t(o)),text:t(u),tags:s(t(g)),updatedAt:Date.now()}),n(r,t(a).length-1)):(t(a)[t(r)].text=t(u),t(a)[t(r)].updatedAt=Date.now()),n(p,"text"),v()};S(()=>{t(y)!=="loading"&&t(k)&&w(()=>{t(k)&&(Q(t(k)),n(k,null))})});let et=c(R);S(()=>{if(!t(_)||t(y)==="loading"||!t(d))return;const e=t(et)().get(t(d));w(()=>{e?.data&&(e.data.pinned!==t(x)&&n(x,!!e.data.pinned),e.data.text!==t(u)&&B(e.data.text),(e.data.link?.url!==t(o)?.url||e.data.link?.title!==t(o)?.title)&&T(s(e.data.link)),JSON.stringify(e.data.tags)!==JSON.stringify(t(g))&&$(s(e.data.tags)))})}),pt(()=>()=>{V(t(d))});var H=b(),nt=L(H);{var at=e=>{var i=b(),rt=L(i);{var st=h=>{var m=Ct(),P=kt(vt(m),2);{let dt=c(()=>K(""));Nt(P,{element:"a",get href(){return t(dt)},onClick:W,children:(lt,At)=>{var ot=yt("close");C(lt,ot)},$$slots:{default:!0}})}C(h,m)},it=h=>{{let m=c(()=>N(t(d))?.data.deletedAt),P=c(()=>N(t(d))?.data.archivedAt);mt(h,{get noteId(){return t(d)},mode:"edit",get link(){return t(o)},onChangeLink:T,get text(){return t(u)},onChangeText:B,get tags(){return t(g)},onChangeTags:$,get updatedAt(){return t(A)},get deletedAt(){return t(m)},get archivedAt(){return t(P)},get pinned(){return t(x)},onPinnedChange:tt,get canNext(){return t(Y)},get canPrev(){return t(X)},onNext:D,onPrev:Z})}};M(rt,h=>{!t(d)||!N(t(d))?h(st):h(it,!1)})}C(e,i)};M(nt,e=>{t(_)&&e(at)})}C(U,H),ht()}export{_t as default};
