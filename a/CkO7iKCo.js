import{p as ee,Z as te,_ as ie,G as se,o as ne,n as oe,g as e,y as z,h as ae,$ as re,a0 as le,u as G,j as U,f as ce,r as q,m as X,c as j,S as J,s as Z,t as de,d as Q,q as ue,a1 as me,a2 as ge,l as $,J as fe,K as pe}from"./BCy4tIMk.js";function he(K,t){ee(t,!0);const O=te(),{getIsKeyboardVisible:H}=ie();let i=se(t,"dialog",7);const A=z(H),m=3,C=50,I=5,P=.6,s=.3,y=.35,c=.95;let g=0,w=0,_=0,f=!1,b=!1,h=0,d=0,T=0;const v=()=>{g=0,w=0,f=!1,b=!1,h=0,d=0,T=0,_=0,l!==null&&(cancelAnimationFrame(l),l=null),S=null};let l=null,S=null;const D=o=>{i()&&(t.sidebarState!=="opened"&&t.sidebarState!=="closed"||(g=o.touches[0].clientX,w=o.touches[0].clientY,_=performance.now(),f=!0,b=!1))},Y=o=>t.sidebarState==="closed"&&o>0||t.sidebarState==="closeSwiping"&&o>0||t.sidebarState==="opened"&&o<0||t.sidebarState==="openSwiping"&&o<0,N=()=>{if(i()){if(i().style.setProperty("--transition-timing","0s"),!i().open&&t.sidebarState==="closed")try{i().showModal(),i().offsetWidth}catch{return}t.onSwipe();try{const o=window.getComputedStyle(i()),a=o.transform||o.webkitTransform||"";if(d=i().offsetWidth,t.sidebarState==="closeSwiping"||t.sidebarState==="closed"?h=-d:(t.sidebarState==="openSwiping"||t.sidebarState==="opened")&&(h=0),a&&a!=="none")try{h=new DOMMatrix(a).m41}catch{}b=!0}catch{v()}}},F=()=>{if(!i())return;const o=-(d*.3),a=-d;let r=0;const u=window.getComputedStyle(i()),M=u.transform||u.webkitTransform||"";if(M&&M!=="none")try{r=new DOMMatrix(M).m41}catch{r=0}const V=.25*Math.min(1,Math.max(0,(r-a)/(o-a)));i().style.setProperty("--backdrop-bg",`rgba(0, 0, 0, ${V})`)},W=()=>{if(l=null,!S||!f||!i()||e(A))return;const{x:o,y:a}=S;S=null;const r=o-g,u=a-w,M=Math.abs(r)>Math.abs(u),k=Math.abs(r)>m;if(!b)if(M&&k&&Y(r))try{N()}catch{v();return}else return;let x=h+r*c;const V=-d,L=-(d*.3);let B=Math.max(V,Math.min(L,x));i().style.setProperty("--transition-timing","0s"),i().style.transform=`translate3d(${B}px, 0, 0)`,O.swipingRatio=(-1+Math.abs(B/d))/7*10,T=(B-h)/d*100,F()},R=o=>{if(!f)return;const a=o.touches[0].clientX,r=o.touches[0].clientY;S={x:a,y:r},l===null&&(l=requestAnimationFrame(W)),b&&Math.abs(a-g)>Math.abs(r-w)&&o.preventDefault()},n=o=>{const a=Math.abs(o);if(a>=P)return I;if(a>=s){const r=(a-s)/(P-s);return C-r*(C-I)}else return C},p=(o,a)=>{if(Math.abs(o)>=P)return y*.5;const u=Math.abs(T)/100;return a?y*Math.max(.5,1-u):y*Math.max(.5,u)},E=o=>{if(l!==null&&(cancelAnimationFrame(l),l=null),S=null,!f||!i()){v();return}if(!b){v();return}let a=0;if(o?.changedTouches?.[0]){const x=o.changedTouches[0].clientX,L=performance.now()-_;L>0&&(a=(x-g)/L)}const r=n(a);let u=null;t.sidebarState==="closeSwiping"?u=Math.abs(T)>r||a>s?"open":"close":t.sidebarState==="openSwiping"&&(u=Math.abs(T)>r||a<-s?"close":"open");const M=t.sidebarState==="closeSwiping"&&u==="open"||t.sidebarState==="openSwiping"&&u==="close",k=p(a,M);O.duration=k-.02,i().style.setProperty("--transition-timing",`${k}s`),i().offsetWidth,i().style.transform="",u==="open"?t.onOpen():u==="close"&&t.onClose(),i()?.style.removeProperty("--backdrop-bg"),v()};ne(()=>(document.addEventListener("touchstart",D,{passive:!0}),document.addEventListener("touchmove",R,{passive:!1}),document.addEventListener("touchend",E,{passive:!0}),document.addEventListener("touchcancel",E,{passive:!0}),()=>{document.removeEventListener("touchstart",D),document.removeEventListener("touchmove",R),document.removeEventListener("touchend",E),document.removeEventListener("touchcancel",E),l!==null&&cancelAnimationFrame(l)})),oe()}var Se=ce('<dialog><div class="dialogInner svelte-1nov8pn"><!></div></dialog> <!> <!>',1);function ye(K,t){ee(t,!0);const{getStackPages:O}=ae(),{getSidebarState:H,handleComputeState:i}=re();let A=350;const m=te(),{isScrolling:C,blockScrolling:I,unblockScrolling:P}=le();let s=U(null),y=U(null),c=z(H);G(()=>{O().length>0&&i({type:"close"})});const g=()=>{t.blocked||(i({type:"close"}),m.swipingRatio=0,m.duration=.2)},w=()=>{t.blocked||(I(),i({type:"open"}))},_=()=>{i({type:"opened"}),m.swipingRatio=-1,m.duration=.2},f=()=>{i({type:"closed"}),P()},b=()=>{i({type:"swipe"})},h=n=>{n.preventDefault(),g()};ne(()=>(e(s)?.addEventListener("close",f),e(s)?.addEventListener("cancel",h),()=>{e(s)?.removeEventListener("close",f),e(s)?.removeEventListener("cancel",h)}));const d=()=>{e(s)?.style.removeProperty("--transition-timing"),e(s)?.style.removeProperty("transform"),e(s)?.style.removeProperty("--backdrop-bg")},T=z(C);G(()=>{if(e(c),!!e(s))switch(e(c).type==="openSwiping"||e(c).type==="closeSwiping"?m.isSwiping=!0:m.isSwiping=!1,e(c).type){case"closeSwiping":{const n=setTimeout(()=>{g()},3e3);return()=>{clearTimeout(n)}}case"openSwiping":{const n=setTimeout(()=>{w()},3e3);return()=>{clearTimeout(n)}}case"opening":{e(s).open||e(s).showModal(),e(s).getBoundingClientRect();const n=setTimeout(()=>{d()},A+1),p=()=>{clearTimeout(n),d()};return e(s)?.addEventListener("transitionend",p,{once:!0}),_(),()=>{clearTimeout(n),e(s)?.removeEventListener("transitionend",p)}}case"closing":{const n=setTimeout(()=>{e(c).type==="closing"&&f()},A+1),p=()=>{clearTimeout(n),f()};return e(s)?.addEventListener("transitionend",p,{once:!0}),()=>{clearTimeout(n),e(s)?.removeEventListener("transitionend",p)}}case"closed":e(s)?.close(),d();break;case"opened":d();break}});var v=Se(),l=q(v),S=j(l),D=j(S);{var Y=n=>{var p=ue(),E=q(p);me(E,()=>t.children),Q(n,p)};X(D,n=>{e(c).type!=="closed"&&n(Y)})}J(S,n=>$(y,n),()=>e(y)),J(l,n=>$(s,n),()=>e(s));var N=Z(l,2);{var F=n=>{ge(n,{get dialog(){return e(s)},get dialogInner(){return e(y)},onClose:g})};X(N,n=>{e(c).type==="opened"&&!t.blocked&&n(F)})}var W=Z(N,2);{var R=n=>{he(n,{onClose:g,onOpen:w,onSwipe:b,get sidebarState(){return e(c).type},get dialog(){return e(s)}})};X(W,n=>{(!e(T)&&e(c).type==="closed"||e(c).type==="opened"||e(c).type==="openSwiping"||e(c).type==="closeSwiping")&&!t.blocked&&n(R)})}de(()=>fe(l,1,pe([{open:e(c).type==="opened",hidden:t.blocked,isAnimationOn:m.working&&(!m.isSwiping||!t.blocked)}]),"svelte-1nov8pn")),Q(K,v),oe()}export{ye as default};
