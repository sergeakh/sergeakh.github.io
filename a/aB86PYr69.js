import{p as K,J as M,u as Q,C as T,b as u,w as W,x,g as t,A as _,_ as S,a,$ as X,y as C,n as J,j as O,i as y,m as Y,a0 as w,f as Z,s as tt,c as et,B as at,z as it,a1 as nt}from"./aBAHzzzS2.js";var st=Z('<div class="a p-1hq9a8m"><p class="p-1hq9a8m">Note not found</p> <!></div>');function lt(A,k){K(k,!0);const{getNoteById:p,isInitedNotes:P,saveNote:I,updateNote:b,revertNote:B,pinNote:D}=M(),{clearDialogPages:$}=Q(),{getHref:q}=T();let r=u("idle"),n=u(""),f=u(void 0),s=u(void 0),l=u(""),o=u(W([])),g=u(!1),v=u(0);const N=_(P);x(()=>{t(N)&&(t(g),S(()=>{p(t(n))?.data.pinned!==t(g)&&D(t(n),t(g))}))}),x(()=>{t(N)&&S(()=>{const e=new URLSearchParams(k.params).get("id");if(e){a(n,e,!0);const i=p(t(n));i?.data&&(a(s,i.data.link?X(i.data.link):void 0,!0),a(l,i.data.text,!0),a(o,i.data.tags.slice(),!0),a(g,!!i.data.pinned,!0),a(v,i.data.updatedAt,!0))}})});const V=async()=>{if(t(f)){const e=p(t(n));if(!e?.data)return;const i=e.data.history?.find?.(m=>m.id===t(f));if(!i){a(f,void 0);return}if(i.link?.url===t(s)?.url&&i.link?.title===t(s)?.title&&i.text===t(l)&&JSON.stringify(i.tags)===JSON.stringify(t(o))){if(t(r)==="idle"){a(r,"loading");try{await B(t(n),t(f)),a(f,void 0),a(v,i.updatedAt,!0)}finally{a(r,"idle")}}}else if((e.data.link?.url!==t(s)?.url||e.data.link?.title!==t(s)?.title||e.data.text!==t(l)||JSON.stringify(e.data.tags)!==JSON.stringify(t(o)))&&t(r)==="idle"){a(r,"loading");try{await b(t(n),{link:w(t(s)),text:t(l),tags:t(o).slice()})}finally{a(r,"idle")}}}else{const e=p(t(n));if(!e?.data)return;if((e.data.link?.url!==t(s)?.url||e.data.link?.title!==t(s)?.title||e.data.text!==t(l)||JSON.stringify(e.data.tags)!==JSON.stringify(t(o)))&&t(r)==="idle"){a(r,"loading");try{a(v,0),a(f,await I(t(n),{link:w(t(s)),text:t(l),tags:t(o).slice()}),!0)}finally{a(r,"idle")}}}};x(()=>{t(N)&&t(r)!=="loading"&&V()});const j=e=>{e.preventDefault(),$()};var h=C(),z=J(h);{var F=e=>{var i=C(),m=J(i);{var H=c=>{var d=st(),R=tt(et(d),2);{let U=_(()=>q(""));at(R,{element:"a",get href(){return t(U)},onClick:j,children:(E,rt)=>{var G=it("close");y(E,G)},$$slots:{default:!0}})}y(c,d)},L=c=>{nt(c,{mode:"edit",get updatedAt(){return t(v)},get link(){return t(s)},set link(d){a(s,d,!0)},get text(){return t(l)},set text(d){a(l,d,!0)},get tags(){return t(o)},set tags(d){a(o,d,!0)},get pinned(){return t(g)},set pinned(d){a(g,d,!0)}})};O(m,c=>{!t(n)||!p(t(n))?c(H):c(L,!1)})}y(e,i)};O(z,e=>{t(N)&&e(F)})}y(A,h),Y()}export{lt as default};
