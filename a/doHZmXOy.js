import{p as J,h as M,A as N,z as V,j as A,k as W,i as F,u as G,g as e,y as w,o as I,f as _,m as x,c as m,d as i,n as Q,l as f,T as X,H as B,w as S,s as U,L as Y,q as Z,r as ee,B as te}from"./BL5iVsYA.js";import{e as ae}from"./Cpa8lgv9.js";import{c as re,b as ne,a as se}from"./BEGDcNQV.js";import{g as oe}from"./9q_jSmK4.js";var t=(n=>(n[n.Signup=0]="Signup",n[n.SignupError=1]="SignupError",n))(t||{}),ie=_('<div class="container svelte-apkzbu"><!> <!></div>'),ce=_('<div class="container svelte-apkzbu"><!> <!></div>'),le=_('<div class="block svelte-apkzbu"><!></div>');function fe(n,$){J($,!0);const{clearStackPages:K}=M(),{getAccount:E,initCloudAccount:T}=N(),{getAppLocation:z,back:D,deleteSearchParam:j}=V();let H=w(()=>z().searchParams),v=w(E),k=A(""),s=A(W(t.Signup));const{blockDialog:d,unBlockBackDialog:C}=F(),P=async()=>{f(s,t.Signup,!0);try{const a=await oe(),r=crypto.getRandomValues(new Uint8Array(32)),c=await re({challenge:a,clientKey:r}),l=await fetch("/api/signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)});if(l.status!==200){f(s,t.SignupError,!0);return}const o=await l.json(),p=e(v)===void 0,{encryptedClientKey:u}=await ae({clientKey:r,serverKey:new Uint8Array(ne(o.serverKey))});if(X(),await T({encryptedClientKey:se(u)}),p)d(!1),K();else{d(!1);let g=e(H).get("retPath")||"";g&&(f(k,g,!0),j("retPath")),D({to:e(k)})}}catch{f(s,t.SignupError,!0)}};G(()=>{e(v)===null&&d(e(s)===t.Signup),C(e(s)!==t.Signup)}),I(()=>{e(v)===void 0&&(d(!0),C(!1)),P()});var b=le(),L=m(b);{var O=a=>{var r=ie(),c=m(r);B(c,{children:(o,p)=>{var u=S("signup");i(o,u)}});var l=U(c,2);Y(l,{}),i(a,r)},R=a=>{var r=Z(),c=ee(r);{var l=o=>{var p=ce(),u=m(p);B(u,{children:(h,q)=>{var y=S("error signup");i(h,y)}});var g=U(u,2);te(g,{onClick:()=>P(),fullWidth:!0,children:(h,q)=>{var y=S("try again");i(h,y)},$$slots:{default:!0}}),i(o,p)};x(c,o=>{e(s)===t.SignupError&&o(l)},!0)}i(a,r)};x(L,a=>{e(s)===t.Signup?a(O):a(R,!1)})}i(n,b),Q()}export{fe as default};
