import{p as M,z as N,n as Q,A as R,q as U,u as V,g as u,h as X,f,i as b,c as d,d as t,j as Z,l as _,H as tt,x as m,s as $,y as at,v as k,B as C,P as st,k as P,t as et,m as rt}from"./aDx0Bkhjd.js";var ot=f('<p class="b p-83c8zx">You need to connect to the cloud account to get an access to a subscription</p> <div class="c p-83c8zx"><!></div>',1),it=f('<div class="c p-83c8zx"><!></div>'),ct=f('<p class="b p-83c8zx"> </p>'),nt=f("<!> <!>",1),lt=f('<p class="b p-83c8zx">error signin</p> <div class="c p-83c8zx"><div class="d"><!></div></div>',1),vt=f('<p class="b p-83c8zx">Subscription updated successfully</p> <div class="c p-83c8zx"><div class="d"><!></div></div>',1),pt=f('<div class="a p-83c8zx"><!></div>');function ut(E,H){M(H,!0);const{setSearchParam:j,getAppLocation:B}=N(),{pushDialogPage:G,clearDialogPages:L}=Q(),{getAccount:W,updateSubscription:Y}=R();let c=X("idle"),S=at(W);const{blockDialog:q}=U(),F=()=>{const s=B().searchParams,r=`${window.location.pathname}${window.location.search}`;G(st.Auth),s.has("retPath")||j("retPath",r)},I=()=>{L()},y=async()=>{P(c,"loading");try{const s=await fetch("/api/getSubscription",{method:"POST"});if(s.status!==200){P(c,"error");return}const r=await s.json();if(!r.subscriptionExpires){P(c,"error");return}const g=r.subscriptionExpires;Y(g),P(c,"success")}catch{P(c,"error")}};V(()=>{q(u(c)==="loading")});var A=pt(),O=d(A);{var T=s=>{var r=nt(),g=_(r);tt(g,{children:(a,o)=>{var n=m("Subscription");t(a,n)}});var z=$(g,2);{var D=a=>{var o=ot(),n=$(_(o),2),l=d(n);C(l,{onClick:F,children:(p,i)=>{var e=m("Connect");t(p,e)},$$slots:{default:!0}}),t(a,o)},v=a=>{var o=k(),n=_(o);{var l=i=>{var e=it(),h=d(e);C(h,{onClick:y,children:(x,K)=>{var w=m("Get subscription");t(x,w)},$$slots:{default:!0}}),t(i,e)},p=i=>{var e=ct(),h=d(e);et(x=>rt(h,`Your subscription is active until ${x??""}`),[()=>new Date(u(S).subscriptionExpires).toLocaleDateString()]),t(i,e)};b(n,i=>{u(S).subscriptionExpires<Date.now()?i(l):i(p,!1)},!0)}t(a,o)};b(z,a=>{u(S)?a(v,!1):a(D)})}t(s,r)},J=s=>{var r=k(),g=_(r);{var z=v=>{var a=lt(),o=$(_(a),2),n=d(o),l=d(n);C(l,{onClick:y,fullWidth:!0,children:(p,i)=>{var e=m("try again");t(p,e)},$$slots:{default:!0}}),t(v,a)},D=v=>{var a=k(),o=_(a);{var n=l=>{var p=vt(),i=$(_(p),2),e=d(i),h=d(e);C(h,{onClick:I,fullWidth:!0,children:(x,K)=>{var w=m("Close");t(x,w)},$$slots:{default:!0}}),t(l,p)};b(o,l=>{u(c)==="success"&&l(n)},!0)}t(v,a)};b(g,v=>{u(c)==="error"?v(z):v(D,!1)},!0)}t(s,r)};b(O,s=>{u(c)==="idle"?s(T):s(J,!1)})}t(E,A),Z()}export{ut as default};
