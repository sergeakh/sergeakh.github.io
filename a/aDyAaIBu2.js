import{p as Oe,J as Le,u as Se,v as Ie,K as Re,b as T,w as He,x as Pe,g as e,o as fe,f as y,j as E,c as o,i as d,m as Be,a as i,n as L,s as c,d as Fe,I as je,y as oe,z as P,N as Me,B as Q,A as V,L as Ne,r as Ue}from"./aCXQNcsrB.js";import{S as We,a as W}from"./arjieG3uv.js";const ze=Y=>{const k=Math.floor(Date.now()/1e3),u={};Y.forEach(n=>{if(!n)return;const p=n.data.tags||["Imported"];if(p.length===0){u.ROOT||(u.ROOT=[]),u.ROOT.push(n);return}p.forEach(v=>{u[v]||(u[v]=[]),u[v].push(n)})});let g=`<!DOCTYPE NETSCAPE-Note-file-1>
<!-- This is an automatically generated file.
 It will be read and overwritten.
 DO NOT EDIT! -->
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8">
<TITLE>Bookmarks</TITLE>
<H1>Bookmarks</H1>
<DL><p>
<DT><H3 ADD_DATE="${k}" LAST_MODIFIED="${k}" PERSONAL_TOOLBAR_FOLDER="true">Bookmarks bar</H3>
<DL><p>`;return Object.keys(u).forEach(n=>{n!=="ROOT"&&n!=="other"&&(g+=`
    <DT><H3 ADD_DATE="${k}" LAST_MODIFIED="${k}">${n}</H3>
    <DL><p>`,u[n].forEach(p=>{if(!p.data.link)return;const v=p.data.link.title.replace(/"/g,"&quot;");g+=`
        <DT><A HREF="${p.data.link.url}" ADD_DATE="${Math.floor(p.data.createdAt/1e3)||k}">${v}</A>`}),g+=`
    </DL><p>`)}),u.ROOT&&u.ROOT.forEach(n=>{if(!n.data.link)return;const p=n.data.link.title.replace(/"/g,"&quot;");g+=`
    <DT><A HREF="${n.data.link.url}" ADD_DATE="${Math.floor(n.data.createdAt/1e3)||k}">${p}</A>`}),g+=`
</DL><p>`,u.other&&u.other.forEach(n=>{if(!n.data.link)return;const p=n.data.link.title.replace(/"/g,"&quot;");g+=`
    <DT><A HREF="${n.data.link.url}" ADD_DATE="${Math.floor(n.data.createdAt/1e3)||k}">${p}</A>`}),g+="</DL><p>",g};var qe=y('<div class="g p-10n6f3r"><p class="h p-10n6f3r">Exclude history</p> <div class="i p-10n6f3r"><!></div></div>'),Je=y('<div class="g p-10n6f3r"><p class="h p-10n6f3r">Exclude other tags</p> <div class="i p-10n6f3r"><!></div></div>'),Ge=y('<div class="g p-10n6f3r"><p class="h p-10n6f3r">Exclude bin</p> <div class="i p-10n6f3r"><!></div></div> <div class="g p-10n6f3r"><p class="h p-10n6f3r">Exclude archive</p> <div class="i p-10n6f3r"><!></div></div> <!> <div class="g p-10n6f3r"><p class="h p-10n6f3r">Exclude tags</p> <div class="i p-10n6f3r"><!></div></div> <!> <p class="j k p-10n6f3r">Filter tags:</p> <!>',1),Ke=y('<div class="l p-10n6f3r"><!> <!></div>'),Qe=y('<div class="b p-10n6f3r"><div class="c p-10n6f3r"><!> <p class="d p-10n6f3r"><!></p></div></div> <div><div class="e p-10n6f3r"><button class="f p-10n6f3r"><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper><span>Settings</span></button></div> <!> <!></div>',1),Ve=y('<div class="b p-10n6f3r"><p class="j p-10n6f3r">Exporting data...</p> <!></div>'),Ye=y('<div class="b p-10n6f3r"><p class="j m p-10n6f3r">Something went wrong</p></div> <div class="l p-10n6f3r"><!></div>',1),Xe=y('<div class="b p-10n6f3r"><p class="j p-10n6f3r">Data exported successfully!</p></div> <div class="l p-10n6f3r"><!></div>',1),Ze=y('<div class="a p-10n6f3r"><!></div>');function at(Y,k){Oe(k,!0);const{getGetNotes:u}=Le(),{clearDialogPages:g}=Se(),{blockDialog:n}=Ie(),{checkMobileSize:p}=Re();let v=T("idle"),B=T("sync"),_=T(He([])),S=T(!1),X=T(!1),A=T(!1),z=T(!1),q=T(!1),Z=T(!1),ee=T(!1);const pe=()=>{g()};Pe(()=>{n(e(v)==="loading")}),fe(()=>()=>{n(!1)});const ue=()=>{i(X,!e(X)),i(q,!1),i(z,!1),i(S,!1),i(_,[],!0)},le=async()=>{i(v,"loading"),await new Promise(r=>setTimeout(r,0));let s=(u()()||[]).filter(r=>r.data).filter(r=>e(_).length===0?!0:e(_).every(t=>r.data.tags.includes(t)));if(e(q)&&(s=s.map(r=>{const t={...r};return t.data={...t.data,history:[]},t})),e(Z)&&(s=s.filter(r=>!r.data.deletedAt)),e(ee)&&(s=s.filter(r=>!r.data.archivedAt)),e(A)&&(s=s.map(r=>{const t={...r};return t.data={...t.data,tags:[],history:t.data.history.map(f=>({...f,tags:[]}))},t})),e(z)&&e(A)===!1&&(s=s.map(r=>{const t={...r};return t.data={...t.data,tags:t.data.tags.filter(f=>e(_).includes(f)),history:t.data.history.map(f=>({...f,tags:f.tags.filter(m=>e(_).includes(m))}))},t})),e(B)==="sync"){const r=`${[...e(A)?[]:e(_),"notes"].join("_")}.json`,t=JSON.stringify({filteredNotes:s}),f=new Blob([t],{type:"application/json"});return{filename:r,blob:f}}else{const r=`${[...e(A)?[]:e(_),"bookmarks"].join("_")}bookmarks_${new Date().toLocaleDateString().replace(/\//g,"_")}.html`,t=ze(s),f=new Blob([t],{type:"text/html"});return{filename:r,blob:f}}},he=async()=>{try{const{filename:a,blob:s}=await le(),r=URL.createObjectURL(s),t=document.createElement("a");t.href=r,t.download=a,document.body.appendChild(t),t.click(),setTimeout(()=>{document.body.removeChild(t),URL.revokeObjectURL(r)},0),await new Promise(f=>setTimeout(f,0)),i(v,"success")}catch{i(v,"error")}},ge=async()=>{try{const{filename:a,blob:s}=await le(),r=new File([s],a,{type:s.type});await navigator.share({files:[r],title:a.endsWith("html")?"Exported Bookmarks":"Exported Notes"}),await new Promise(t=>setTimeout(t,0)),i(v,"success")}catch{i(v,"error")}},_e=a=>{i(_,a,!0)},ie=a=>{a.key==="Escape"&&(document.activeElement instanceof HTMLInputElement&&document.activeElement.type==="text"||document.activeElement instanceof HTMLTextAreaElement)&&(e(S)&&i(S,!1),document.activeElement.blur(),a.preventDefault(),a.stopPropagation())},me=a=>{i(z,a,!0)},Te=a=>{i(q,a,!0)},Ee=a=>{i(Z,a,!0)},ke=a=>{i(ee,a,!0)},xe=a=>{i(A,a,!0)};fe(()=>(document.addEventListener("keydown",ie),()=>document.removeEventListener("keydown",ie)));var de=Ze(),De=o(de);{var ye=a=>{var s=Qe(),r=L(s),t=o(r),f=o(t);We(f,{items:[{title:"Sync",value:"sync"},{title:"Bookmarks",value:"bookmarks"}],get value(){return e(B)},onChange:l=>{i(B,l,!0)}});var m=c(f,2),$=o(m);{var F=l=>{var h=P("App format for sync or backup");d(l,h)},te=l=>{var h=P("Browser bookmarks format (exports only bookmarks, not notes)");d(l,h)};E($,l=>{e(B)==="sync"?l(F):l(te,!1)})}var ae=c(r,2),x=o(ae),b=o(x);b.__click=ue;var I=o(b);Fe(I,()=>({"--rotate":"30deg","--size":"20px"})),je(I.lastChild,{name:"settings"});var R=c(x,2);{var C=l=>{var h=Ge(),O=L(h),G=c(o(O),2),j=o(G);W(j,{get checked(){return e(Z)},onChange:Ee});var w=c(O,2),M=c(o(w),2),K=o(M);W(K,{get checked(){return e(ee)},onChange:ke});var N=c(w,2);{var re=D=>{var U=qe(),se=c(o(U),2),ne=o(se);W(ne,{get checked(){return e(q)},onChange:Te}),d(D,U)};E(N,D=>{e(B)==="sync"&&D(re)})}var ce=c(N,2),we=c(o(ce),2),Ae=o(we);W(Ae,{get checked(){return e(A)},onChange:xe});var ve=c(ce,2);{var $e=D=>{var U=Je(),se=c(o(U),2),ne=o(se);W(ne,{get checked(){return e(z)},onChange:me}),d(D,U)};E(ve,D=>{e(_).length>0&&!e(A)&&D($e)})}var Ce=c(ve,4);Me(Ce,{mode:"exit",get selectedTags(){return e(_)},onChangeTags:_e,get shownTagInput(){return e(S)},set shownTagInput(D){i(S,D,!0)}}),d(l,h)};E(R,l=>{e(X)&&l(C)})}var H=c(R,2);{var J=l=>{var h=Ke(),O=o(h);{var G=w=>{{let M=V(p);Q(w,{get fullWidth(){return e(M)},onClick:ge,children:(K,N)=>{var re=P("Share file");d(K,re)},$$slots:{default:!0}})}};E(O,w=>{navigator.canShare({files:[]})&&w(G)})}var j=c(O,2);{let w=V(p);Q(j,{get fullWidth(){return e(w)},onClick:he,children:(M,K)=>{var N=P("Export file");d(M,N)},$$slots:{default:!0}})}d(l,h)};E(H,l=>{e(S)||l(J)})}d(a,s)},be=a=>{var s=oe(),r=L(s);{var t=m=>{var $=Ve(),F=c(o($),2);Ne(F,{}),d(m,$)},f=m=>{var $=oe(),F=L($);{var te=x=>{var b=Ye(),I=c(L(b),2),R=o(I);{let C=V(p);Q(R,{get fullWidth(){return e(C)},onClick:()=>{i(v,"idle")},children:(H,J)=>{var l=P("Try Again");d(H,l)},$$slots:{default:!0}})}d(x,b)},ae=x=>{var b=oe(),I=L(b);{var R=C=>{var H=Xe(),J=c(L(H),2),l=o(J);{let h=V(p);Q(l,{get fullWidth(){return e(h)},onClick:pe,children:(O,G)=>{var j=P("Close");d(O,j)},$$slots:{default:!0}})}d(C,H)};E(I,C=>{e(v)==="success"&&C(R)},!0)}d(x,b)};E(F,x=>{e(v)==="error"?x(te):x(ae,!1)},!0)}d(m,$)};E(r,m=>{e(v)==="loading"?m(t):m(f,!1)},!0)}d(a,s)};E(De,a=>{e(v)==="idle"?a(ye):a(be,!1)})}d(Y,de),Be()}Ue(["click"]);export{at as default};
