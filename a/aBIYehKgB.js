import{R as se,O as re,p as Me,v as Ne,J as Fe,u as Be,C as We,b as W,w as ue,K as ze,M as je,x as He,g as a,o as ne,a as o,f as x,j as u,c as f,i,m as Oe,n as L,s as m,S as me,y as te,d as _e,I as he,L as Je,r as Re,N as xe,B as V,z as X,A as we,t as Ge,k as Ke,l as Ue,G as ae}from"./aBxIaNIxL.js";const ie=(w,l,d,n=new Set,c={},Q=Date.now())=>{for(let b=0;b<w.children.length;b++){const s=w.children[b];if(s.tagName==="DT"){const D=s.querySelector(":scope > A"),P=s.querySelector(":scope > H3");if(D){const k=D.getAttribute("href"),y=Number(D.getAttribute("add_date"))*1e3||Q+b,p=D.textContent||"unknown";if(!k)return d;const S=l.find(C=>C.toLowerCase()==="bookmarks bar")?l.filter(C=>C.toLowerCase()!=="bookmarks bar"):["other"];if(c[k])c[k].data.tags=[...new Set([...c[k].data.tags,...S])];else{const C={id:se(),data:{link:{url:k,title:p},versionId:se(),text:"",tags:S.length>0?S:[],updatedAt:y,createdAt:y,history:[]}};c[k]=C,d.push(C)}}else if(P){const k=P.textContent?.trim();if(k&&P.nextElementSibling?.tagName==="DL"){const y=[...l];y.push(k);const p=P.nextElementSibling;n.has(p)||(n.add(p),ie(p,y,d,n,c,Q+b))}}}else s.tagName!=="DL"&&s.children.length>0&&(n.has(s)||(n.add(s),ie(s,[...l],d,n,c,Q+b)))}return d},Ve=async w=>{const l=await w.text(),c=new DOMParser().parseFromString(l,"text/html").querySelector("DL");return c?ie(c,[],[]):[]};function Xe(w){const l=[];return ke(w,[],l),l}function ke(w,l,d){for(const n of w){if(!n.url){const c=[...l,n.title].filter(Boolean);n.children&&ke(n.children,c,d);continue}d.push({id:se(),data:{link:{url:n.url,title:n.title||"unknown"},versionId:se(),text:"",tags:l.length>0?[...l]:[],updatedAt:n.dateAdded||Date.now(),createdAt:n.dateAdded||Date.now(),history:[]}})}}const Qe=async()=>{const w=await re().bookmarks.getTree();return Xe(w).map(d=>(d.data.tags=d.data.tags.map(n=>{const c=n.trim();return c.toLocaleLowerCase()==="other bookmarks"?"other":c}).filter(n=>!(n===""||n.toLocaleLowerCase()==="bookmarks bar")),d))};var Ye=x(`<div class="b c p-1gxeqe6"><p>(browser bookmarks or a this app's file)</p></div>`),Ze=x('<div class="h p-1gxeqe6"><p class="i j p-1gxeqe6">Additional tags:</p> <!></div>'),et=x('<div class="k p-1gxeqe6"><!></div>'),tt=x('<!> <div class="e p-1gxeqe6"><div class="f p-1gxeqe6"><button class="g p-1gxeqe6"><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper><span>Settings</span></button></div> <!> <!></div>',1),at=x("<p>(browser bookmarks or a this app's file)</p>"),rt=x('<p class="i j p-1gxeqe6">Additional tags:</p> <div class="o p-1gxeqe6"><!></div>',1),st=x('<div class="p p-1gxeqe6"><!></div> <div role="button" tabindex="-1"><div tabindex="-1" class="q p-1gxeqe6"><p class="p-1gxeqe6">Drag and drop your file here</p> <p class="p-1gxeqe6">or</p></div></div>',1),ot=x('<div class="l p-1gxeqe6"><div class="m p-1gxeqe6"><!> <div class="f p-1gxeqe6"><button class="g n p-1gxeqe6"><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper><span>Settings</span></button></div> <!></div> <!></div>'),nt=x('<!> <!> <input type="file" accept=".txt, .html" style="display: none;"/>',1),it=x('<div class="b c p-1gxeqe6"><p class="i r p-1gxeqe6">Loading...</p> <!></div>'),lt=x('<div class="b c p-1gxeqe6"><p class="i s p-1gxeqe6">Something went wrong</p></div> <div class="t p-1gxeqe6"><!></div>',1),dt=x('<div class="b c p-1gxeqe6"><p class="i u p-1gxeqe6">Success!</p></div> <div class="t p-1gxeqe6"><!></div>',1),ct=x('<div class="a p-1gxeqe6"><!></div>');function gt(w,l){Me(l,!0);const{blockDialog:d}=Ne(),{importNotes:n}=Fe(),{clearDialogPages:c}=Be(),{getSearchParams:Q}=We();let b=W(ue("file")),s=W("idle"),D=W(null),P=W(!1),k=W(null),y=W(ue([])),p=W(!1),S=W(!1);const{checkMobileSize:C}=ze(),{getViewMode:be}=je(),ye=()=>{c()};He(()=>{d(a(s)==="loading")}),ne(()=>(a(D)&&a(D).addEventListener("cancel",e=>{o(s,"idle"),e.preventDefault(),e.stopImmediatePropagation(),e.stopPropagation()}),()=>{d(!1)}));const qe=async e=>{const t=await e.text(),v=JSON.parse(t),z=[];if(!v.notes)throw new Error("Invalid import file format");for(const G of Object.values(v.notes))G&&z.push(G);return z},le=async e=>{o(s,"loading");let t=[];try{if(e.name.endsWith(".txt"))t=await qe(e);else if(e.name.endsWith(".html"))t=await Ve(e);else throw new Error("Unsupported file format. Please upload a TXT or HTML file.");await pe(t),o(s,"success")}catch(v){console.error("Error processing file:",v),o(s,"error")}},Te=async e=>{const t=e.target;!t.files||t.files.length===0||await le(t.files[0])},de=()=>{a(D)?.click()},De=e=>{e.preventDefault(),e.stopPropagation(),o(P,!0)},Pe=e=>{e.preventDefault(),e.stopPropagation(),o(P,!1)},Se=e=>{e.preventDefault(),e.stopPropagation(),o(P,!0)},Ce=async e=>{if(e.preventDefault(),e.stopPropagation(),o(P,!1),!e.dataTransfer?.files||e.dataTransfer.files.length===0)return;const t=e.dataTransfer.files[0];if(t.type!=="application/json"&&t.type!=="text/html"){o(s,"error");return}await le(t)},ce=e=>{o(y,e,!0)},pe=async e=>{await n(e.map(t=>({...t,data:{...t.data,tags:Array.from(new Set([...t.data.tags||[],...a(y)])),history:(t.data.history||[]).map(v=>({...v,tags:Array.from(new Set([...v.tags||[],...a(y)]))}))}}))),await new Promise(t=>setTimeout(t,500))},ve=e=>{e.key==="Escape"&&(document.activeElement instanceof HTMLInputElement&&document.activeElement.type==="text"||document.activeElement instanceof HTMLTextAreaElement)&&(a(p)&&o(p,!1),document.activeElement.blur(),e.preventDefault(),e.stopPropagation())},Le=async()=>new Promise(e=>{re().permissions.contains({permissions:["bookmarks"],origins:["<all_urls>"]},t=>{t?e(!0):be()==="popup"?(re().runtime.sendMessage({type:"requestPermissions",data:{name:"importBookmarks",permissions:["bookmarks"],origins:["<all_urls>"],retpath:Q().toString()}}),e(!1)):re().permissions.request({permissions:["bookmarks"],origins:["<all_urls>"]},v=>{e(!!v)})})}),ge=async()=>{if(o(s,"loading"),!await Le()){o(s,"idle");return}let t=[];try{t=await Qe(),await pe(t),o(s,"success")}catch(v){console.error("Error importing bookmarks from browser:",v),o(s,"error")}};ne(()=>(document.addEventListener("keydown",ve),()=>document.removeEventListener("keydown",ve))),ne(()=>{});var fe=ct(),Ie=f(fe);{var Ee=e=>{var t=nt(),v=L(t);u(v,_=>{});var z=m(v,2);{var G=_=>{var j=tt(),H=L(j);{var q=r=>{var g=Ye();i(r,g)};u(H,r=>{a(b)==="file"&&r(q)})}var I=m(H,2),E=f(I),A=f(E);A.__click=()=>{o(S,!a(S)),o(p,!1)};var T=f(A);_e(T,()=>({"--rotate":"30deg","--size":"20px"})),he(T.lastChild,{name:"settings"});var $=m(E,2);{var K=r=>{var g=Ze(),M=m(f(g),2);xe(M,{get selectedTags(){return a(y)},onChangeTags:ce,get shownTagInput(){return a(p)},set shownTagInput(J){o(p,J,!0)}}),i(r,g)};u($,r=>{a(S)&&r(K)})}var O=m($,2);{var Y=r=>{var g=et(),M=f(g);{var J=h=>{V(h,{fullWidth:!0,onClick:ge,children:(B,ee)=>{var R=X("Import");i(B,R)},$$slots:{default:!0}})},Z=h=>{V(h,{fullWidth:!0,onClick:de,children:(B,ee)=>{var R=X("Select file");i(B,R)},$$slots:{default:!0}})};u(M,h=>{a(b)==="browser"?h(J):h(Z,!1)})}i(r,g)};u(O,r=>{a(p)||r(Y)})}i(_,j)},N=_=>{var j=ot(),H=f(j),q=f(H);{var I=r=>{var g=at();i(r,g)};u(q,r=>{a(b)==="file"&&r(I)})}var E=m(q,2),A=f(E);A.__click=()=>{o(S,!a(S)),o(p,!1)};var T=f(A);_e(T,()=>({"--rotate":"30deg","--size":"20px"})),he(T.lastChild,{name:"settings"});var $=m(E,2);{var K=r=>{var g=rt(),M=m(L(g),2),J=f(M);xe(J,{get selectedTags(){return a(y)},onChangeTags:ce,get shownTagInput(){return a(p)},set shownTagInput(Z){o(p,Z,!0)}}),i(r,g)};u($,r=>{a(S)&&r(K)})}var O=m(H,2);{var Y=r=>{var g=te(),M=L(g);{var J=h=>{V(h,{fullWidth:!0,onClick:ge,children:(B,ee)=>{var R=X("Import");i(B,R)},$$slots:{default:!0}})},Z=h=>{var B=st(),ee=L(B),R=f(ee);V(R,{onClick:de,children:(oe,pt)=>{var $e=X("Select File");i(oe,$e)},$$slots:{default:!0}});var U=m(ee,2);me(U,oe=>o(k,oe),()=>a(k)),Ge(()=>Ke(U,1,Ue({v:!0,w:a(P)}),"p-1gxeqe6")),ae("dragenter",U,De),ae("dragover",U,Se),ae("dragleave",U,Pe),ae("drop",U,Ce),i(h,B)};u(M,h=>{a(b)==="browser"?h(J):h(Z,!1)})}i(r,g)};u(O,r=>{a(p)||r(Y)})}i(_,j)};u(z,_=>{C()?_(G):_(N,!1)})}var F=m(z,2);F.__change=Te,me(F,_=>o(D,_),()=>a(D)),i(e,t)},Ae=e=>{var t=te(),v=L(t);{var z=N=>{var F=it(),_=m(f(F),2);Je(_,{}),i(N,F)},G=N=>{var F=te(),_=L(F);{var j=q=>{var I=lt(),E=m(L(I),2),A=f(E);{let T=we(C);V(A,{get fullWidth(){return a(T)},onClick:()=>{o(s,"idle")},children:($,K)=>{var O=X("Try Again");i($,O)},$$slots:{default:!0}})}i(q,I)},H=q=>{var I=te(),E=L(I);{var A=T=>{var $=dt(),K=m(L($),2),O=f(K);{let Y=we(C);V(O,{get fullWidth(){return a(Y)},onClick:ye,children:(r,g)=>{var M=X("Close");i(r,M)},$$slots:{default:!0}})}i(T,$)};u(E,T=>{a(s)==="success"&&T(A)},!0)}i(q,I)};u(_,q=>{a(s)==="error"?q(j):q(H,!1)},!0)}i(N,F)};u(v,N=>{a(s)==="loading"?N(z):N(G,!1)},!0)}i(e,t)};u(Ie,e=>{a(s)==="idle"?e(Ee):e(Ae,!1)})}i(w,fe),Oe()}Re(["click","change"]);export{gt as default};
