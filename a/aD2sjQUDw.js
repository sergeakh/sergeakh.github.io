import{Q as Lt,p as At,q as It,D as Ft,n as Nt,h as B,r as Wt,O as Mt,u as Ot,g as e,o as ht,f as _,i as w,c as n,d as a,j as qt,k as r,l as g,s as l,R as yt,v as ot,B as W,x as M,t as zt,S as Ht,T as Jt,E as it,L as Bt,w as Rt,y as jt,a as wt,I as xt}from"./aCTCscuk4.js";import{N as bt}from"./aDvFK_73t.js";import"./aBwlsdL1m.js";const vt=(x,d,u,T=new Set,y={},s=Date.now())=>{for(let m=0;m<x.children.length;m++){const c=x.children[m];if(c.tagName==="DT"){const O=c.querySelector(":scope > A"),h=c.querySelector(":scope > H3");if(O){const o=O.getAttribute("href"),j=Number(O.getAttribute("add_date"))*1e3||s+m,b=O.textContent||"unknown";if(!o)return u;const L=d.find(A=>A.toLowerCase()==="bookmarks bar")?d.filter(A=>A.toLowerCase()!=="bookmarks bar"):["other"];if(y[o])y[o].data.tags=[...new Set([...y[o].data.tags,...L])];else{const A={id:Lt(),data:{url:o,name:b,text:"",tags:L.length>0?L:[],updatedAt:j,createdAt:j,history:[]}};y[o]=A,u.push(A)}}else if(h){const o=h.textContent?.trim();if(o&&h.nextElementSibling?.tagName==="DL"){const j=[...d];j.push(o);const b=h.nextElementSibling;T.has(b)||(T.add(b),vt(b,j,u,T,y,s+m))}}}else c.tagName!=="DL"&&c.children.length>0&&(T.has(c)||(T.add(c),vt(c,[...d],u,T,y,s+m)))}return u},Qt=async x=>{const d=await x.text(),y=new DOMParser().parseFromString(d,"text/html").querySelector("DL");return y?vt(y,[],[]):[]},Ut=async(x,d)=>{const u=x.target;!u.files||u.files.length===0||await d(u.files[0])};var Gt=_(`<div class="b p-1tioj8"><p class="c p-1tioj8">Select a file to import your data</p> <p>(browser bookmarks or a this app's file)</p></div> <div class="d p-1tioj8"><div class="e p-1tioj8"><!></div></div>`,1),Kt=_('<p class="c p-1tioj8">Select a file to import your data</p> <div class="f p-1tioj8"><div class="g p-1tioj8"><!></div> <div role="button" tabindex="-1"><div tabindex="-1" class="h p-1tioj8"><p class="p-1tioj8">Drag and drop your file here</p> <p class="p-1tioj8">or</p></div></div></div>',1),Vt=_('<!> <input type="file" accept=".json, .html" style="display: none;"/>',1),Xt=_('<div class="b p-1tioj8"><p class="c p-1tioj8">Loading...</p> <!></div>'),Yt=_('<div class="b p-1tioj8"><p class="c i p-1tioj8">Something went wrong</p></div> <div class="e p-1tioj8"><!></div>',1),Zt=(x,d)=>r(d,!e(d)),te=_('<div class="l p-1tioj8"><p class="c m p-1tioj8">Additional tags:</p> <!></div>'),ee=_('<div class="e p-1tioj8"><!> <!></div>'),ae=_('<div class="b p-1tioj8"><p class="c p-1tioj8">File loaded successfully</p></div> <div class="d p-1tioj8"><div class="j p-1tioj8"><button class="k p-1tioj8"><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper><span>Settings</span></button></div> <!> <!></div>',1),re=(x,d)=>r(d,!e(d)),se=_('<p class="c m p-1tioj8">Additional tags:</p> <div class="n"><!></div>',1),oe=_('<div class="e p-1tioj8"><!> <!></div>'),ie=_('<p class="c p-1tioj8">File loaded successfully</p> <div class="j p-1tioj8"><button class="k p-1tioj8"><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper><span>Settings</span></button></div> <!> <!>',1),ne=_('<div class="b p-1tioj8"><p class="c o p-1tioj8">Notes imported successfully!</p></div> <div class="e p-1tioj8"><!></div>',1),le=_('<div class="a p-1tioj8"><!></div>');function pe(x,d){At(d,!0);const{blockDialog:u}=It(),{importNotes:T}=Ft(),{clearDialogPages:y}=Nt();let s=B("idle"),m=B(null),c=B(!1),O=B(null),h=B(Wt([])),o=B(!1),j=[],b=B(!1);const{checkMobileSize:L}=Mt(),A=()=>{y()};Ot(()=>{u(e(s)==="loading")}),ht(()=>(e(m)&&e(m).addEventListener("cancel",t=>{t.preventDefault(),t.stopImmediatePropagation(),t.stopPropagation()}),()=>{u(!1)}));const kt=async t=>{const i=await t.text(),q=JSON.parse(i),R=[];if(!q.notes)throw new Error("Invalid import file format");for(const Q of Object.values(q.notes))Q&&R.push(Q);return R},pt=async t=>{r(s,"loading");try{if(t.name.endsWith(".json"))j=await kt(t);else if(t.name.endsWith(".html"))j=await Qt(t);else throw new Error("Unsupported file format. Please upload a JSON or HTML file.");await new Promise(i=>setTimeout(i,500)),r(s,"success-loaded")}catch{r(s,"error")}},ut=()=>{e(m)?.click()},Dt=t=>{t.preventDefault(),t.stopPropagation(),r(c,!0)},Tt=t=>{t.preventDefault(),t.stopPropagation(),r(c,!1)},Pt=t=>{t.preventDefault(),t.stopPropagation(),r(c,!0)},St=async t=>{if(t.preventDefault(),t.stopPropagation(),r(c,!1),!t.dataTransfer?.files||t.dataTransfer.files.length===0)return;const i=t.dataTransfer.files[0];if(i.type!=="application/json"&&i.type!=="text/html"){r(s,"error");return}await pt(i)},ft=t=>{r(h,t,!0)},gt=async()=>{r(s,"loading");try{await T(j.map(t=>({...t,data:{...t.data,tags:Array.from(new Set([...t.data.tags||[],...e(h)])),history:(t.data.history||[]).map(i=>({...i,tags:Array.from(new Set([...i.tags||[],...e(h)]))}))}}))),await new Promise(t=>setTimeout(t,500))}catch{r(s,"error");return}r(s,"success")},_t=t=>{t.key==="Escape"&&(document.activeElement instanceof HTMLInputElement&&document.activeElement.type==="text"||document.activeElement instanceof HTMLTextAreaElement)&&(e(o)&&r(o,!1),document.activeElement.blur(),t.preventDefault(),t.stopPropagation())};ht(()=>(document.addEventListener("keydown",_t),()=>document.removeEventListener("keydown",_t)));var mt=le(),$t=n(mt);{var Ct=t=>{var i=Vt(),q=g(i);{var R=v=>{var S=Gt(),Z=l(g(S),2),U=n(Z),k=n(U);W(k,{fullWidth:!0,onClick:ut,children:(p,I)=>{var G=M("Select File");a(p,G)},$$slots:{default:!0}}),a(v,S)},Q=v=>{var S=Kt(),Z=l(g(S),2),U=n(Z),k=n(U);W(k,{onClick:ut,children:(I,G)=>{var tt=M("Select File");a(I,tt)},$$slots:{default:!0}});var p=l(U,2);yt(p,I=>r(O,I),()=>e(O)),zt(()=>Ht(p,1,Jt({p:!0,q:e(c)}),"p-1tioj8")),it("dragenter",p,Dt),it("dragover",p,Pt),it("dragleave",p,Tt),it("drop",p,St),a(v,S)};w(q,v=>{L()?v(R):v(Q,!1)})}var P=l(q,2);P.__change=[Ut,pt],yt(P,v=>r(m,v),()=>e(m)),a(t,i)},Et=t=>{var i=ot(),q=g(i);{var R=P=>{var v=Xt(),S=l(n(v),2);Bt(S,{}),a(P,v)},Q=P=>{var v=ot(),S=g(v);{var Z=k=>{var p=Yt(),I=l(g(p),2),G=n(I);{let tt=jt(L);W(G,{get fullWidth(){return e(tt)},onClick:()=>{r(s,"idle")},children:(F,K)=>{var et=M("Try Again");a(F,et)},$$slots:{default:!0}})}a(k,p)},U=k=>{var p=ot(),I=g(p);{var G=F=>{var K=ot(),et=g(K);{var nt=$=>{var z=ae(),V=l(g(z),2),H=n(V),J=n(H);J.__click=[Zt,b];var X=n(J);wt(X,()=>({"--rotate":"30deg","--size":"20px"})),xt(X.lastChild,{name:"settings"});var Y=l(H,2);{var lt=f=>{var D=te(),N=l(n(D),2);bt(N,{get selectedTags(){return e(h)},onChangeTags:ft,get shownTagInput(){return e(o)},set shownTagInput(E){r(o,E,!0)}}),a(f,D)};w(Y,f=>{e(b)&&f(lt)})}var dt=l(Y,2);{var C=f=>{var D=ee(),N=n(D);W(N,{withoutMinWidth:!0,fullWidth:!0,type:"secondary",onClick:()=>{r(s,"idle"),j=[],r(h,[],!0)},children:(rt,st)=>{var ct=M("Cancel");a(rt,ct)},$$slots:{default:!0}});var E=l(N,2);W(E,{fullWidth:!0,withoutMinWidth:!0,onClick:gt,children:(rt,st)=>{var ct=M("Add notes");a(rt,ct)},$$slots:{default:!0}}),a(f,D)};w(dt,f=>{e(o)||f(C)})}a($,z)},at=$=>{var z=ie(),V=l(g(z),2),H=n(V);H.__click=[re,b];var J=n(H);wt(J,()=>({"--rotate":"30deg","--size":"20px"})),xt(J.lastChild,{name:"settings"});var X=l(V,2);{var Y=C=>{var f=se(),D=l(g(f),2),N=n(D);bt(N,{get selectedTags(){return e(h)},onChangeTags:ft,get shownTagInput(){return e(o)},set shownTagInput(E){r(o,E,!0)}}),a(C,f)};w(X,C=>{e(b)&&C(Y)})}var lt=l(X,2);{var dt=C=>{var f=oe(),D=n(f);W(D,{type:"secondary",fullWidth:!0,onClick:()=>{r(s,"idle"),j=[],r(h,[],!0)},children:(E,rt)=>{var st=M("Cancel");a(E,st)},$$slots:{default:!0}});var N=l(D,2);W(N,{fullWidth:!0,onClick:gt,children:(E,rt)=>{var st=M("Add notes");a(E,st)},$$slots:{default:!0}}),a(C,f)};w(lt,C=>{e(o)||C(dt)})}a($,z)};w(et,$=>{L()?$(nt):$(at,!1)})}a(F,K)},tt=F=>{var K=ot(),et=g(K);{var nt=at=>{var $=ne(),z=l(g($),2),V=n(z);{let H=jt(L);W(V,{get fullWidth(){return e(H)},onClick:A,children:(J,X)=>{var Y=M("Close");a(J,Y)},$$slots:{default:!0}})}a(at,$)};w(et,at=>{e(s)==="success"&&at(nt)},!0)}a(F,K)};w(I,F=>{e(s)==="success-loaded"?F(G):F(tt,!1)},!0)}a(k,p)};w(S,k=>{e(s)==="error"?k(Z):k(U,!1)},!0)}a(P,v)};w(q,P=>{e(s)==="loading"?P(R):P(Q,!1)},!0)}a(t,i)};w($t,t=>{e(s)==="idle"?t(Ct):t(Et,!1)})}a(x,mt),qt()}Rt(["change","click"]);export{pe as default};
