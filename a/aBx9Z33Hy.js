import{p as $,D as q,n as z,h as f,r as E,u as _,g as t,y as G,U as H,k as a,v as S,l as J,i as O,d as v,j as K,f as M,s as Q,c as T,B as W,x as X}from"./aqgPJN1wH.js";import{N as Y}from"./aftxHu19F.js";import"./aCDngVt8o.js";import"./a-qp5G90e.js";var Z=M('<div class="a p-1a2sxlt"><p class="p-1a2sxlt">Note not found</p> <!></div>');function it(C,y){$(y,!0);const{getNoteById:m,isInitedNotes:k,saveNote:w,updateNote:A,revertNote:D}=q(),{clearDialogPages:I}=z();let s=f("idle"),n=f(""),g=f(void 0),d=f(""),l=f(""),o=f(""),u=f(E([])),p=f(0);const N=G(k);_(()=>{t(N)&&H(()=>{const e=new URLSearchParams(y.params).get("id");if(e){a(n,e,!0);const r=m(t(n));r?.data&&(a(d,r.data.url,!0),a(l,r.data.name,!0),a(o,r.data.text,!0),a(u,r.data.tags.slice(),!0),a(p,r.data.updatedAt,!0))}})});const P=async()=>{if(t(g)){const e=m(t(n));if(!e?.data)return;const r=e.data.history?.find?.(x=>x.id===t(g));if(!r){a(g,void 0);return}if(r.url===t(d)&&r.name===t(l)&&r.text===t(o)&&JSON.stringify(r.tags)===JSON.stringify(t(u))){if(t(s)==="idle"){a(s,"loading");try{await D(t(n),t(g)),a(g,void 0),a(p,r.updatedAt,!0)}finally{a(s,"idle")}}}else if((e.data.url!==t(d)||e.data.name!==t(l)||e.data.text!==t(o)||JSON.stringify(e.data.tags)!==JSON.stringify(t(u)))&&t(s)==="idle"){a(s,"loading");try{await A(t(n),{url:t(d),name:t(l),text:t(o),tags:t(u).slice()})}finally{a(s,"idle")}}}else{const e=m(t(n));if(!e?.data)return;if((e.data.url!==t(d)||e.data.name!==t(l)||e.data.text!==t(o)||JSON.stringify(e.data.tags)!==JSON.stringify(t(u)))&&t(s)==="idle"){a(s,"loading");try{a(p,0),a(g,await w(t(n),{url:t(d),name:t(l),text:t(o),tags:t(u).slice()}),!0)}finally{a(s,"idle")}}}};_(()=>{t(N)&&t(s)!=="loading"&&P()});const B=e=>{e.preventDefault(),I()};var h=S(),b=J(h);{var U=e=>{var r=S(),x=J(r);{var V=c=>{var i=Z(),F=Q(T(i),2);W(F,{element:"a",href:"/",onClick:B,children:(L,tt)=>{var R=X("close");v(L,R)},$$slots:{default:!0}}),v(c,i)},j=c=>{Y(c,{mode:"edit",get updatedAt(){return t(p)},get url(){return t(d)},set url(i){a(d,i,!0)},get name(){return t(l)},set name(i){a(l,i,!0)},get text(){return t(o)},set text(i){a(o,i,!0)},get tags(){return t(u)},set tags(i){a(u,i,!0)}})};O(x,c=>{!t(n)||!m(t(n))?c(V):c(j,!1)})}v(e,r)};O(b,e=>{t(N)&&e(U)})}v(C,h),K()}export{it as default};
