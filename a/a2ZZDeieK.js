import{p as P,M as D,u as J,Z as L,b as l,w as O,x as j,g as t,A,o as B,y as E,n as F,j as G,i as V,m as Z,a as e}from"./aDxdVuYxT.js";import{s as g,N as q}from"./aCzLX17Eb.js";function K(y,x){P(x,!0);const{isInitedNotes:N,createNote:u,updateNote:m,deleteNote:k,getNoteById:h}=D(),{clearDialogPages:w}=J(),{getViewMode:v}=L();let S=!0,f=l("loading"),a=l("idle"),n=l(""),s=l(void 0),o=l(""),r=l(O([]));const I=()=>{e(f,"finish")},c=A(()=>N()&&t(f)==="finish"),M=async()=>{if(t(s)||t(o)||t(r).length>0){if(t(n)){const i=h(t(n));if(!i?.data)return;if((i.data.link?.url!==t(s)?.url||i.data.link?.title!==t(s)?.title||i.data.text!==t(o)||JSON.stringify(i.data.tags)!==JSON.stringify(t(r)))&&t(a)==="idle"){e(a,"loading");try{await m(t(n),{link:g(t(s)),text:t(o),tags:t(r).slice()})}finally{e(a,"idle")}}}else if(t(a)==="idle"){e(a,"loading");try{e(n,await u({link:g(t(s)),text:t(o),tags:t(r).slice()}),!0)}catch{}finally{e(a,"idle")}}}else if(t(n)&&t(a)==="idle"){e(a,"loading");try{await k(t(n)),e(n,"")}finally{e(a,"idle")}}};j(()=>{t(c)&&t(a)!=="loading"&&M()}),B(()=>{I()});const b=async()=>{if(await u({link:g(t(s)),text:t(o),tags:t(r).slice()}),v()==="popup"){window.close();return}else w()};var p=E(),C=F(p);{var _=i=>{q(i,{get autoSaveMode(){return S},onSubmit:b,mode:"add",get link(){return t(s)},set link(d){e(s,d,!0)},get text(){return t(o)},set text(d){e(o,d,!0)},get tags(){return t(r)},set tags(d){e(r,d,!0)}})};G(C,i=>{t(c)&&i(_)})}V(y,p),Z()}export{K as default};
