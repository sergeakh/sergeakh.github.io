import{R as we,p as Ce,v as Ae,J as Ie,u as $e,b as W,w as fe,K as Ne,x as Fe,g as t,o as pe,a as o,f as b,j as h,c as g,i as n,m as Me,n as L,s as m,S as ue,y as te,d as ge,I as he,L as We,r as ze,N as me,B as Q,z as V,A as _e,t as Be,k as qe,l as He,G as ae}from"./aNRpKmeQN.js";const se=(y,c,p,i=new Set,d={},S=Date.now())=>{for(let r=0;r<y.children.length;r++){const l=y.children[r];if(l.tagName==="DT"){const _=l.querySelector(":scope > A"),z=l.querySelector(":scope > H3");if(_){const u=_.getAttribute("href"),v=Number(_.getAttribute("add_date"))*1e3||S+r,x=_.textContent||"unknown";if(!u)return p;const B=c.find($=>$.toLowerCase()==="bookmarks bar")?c.filter($=>$.toLowerCase()!=="bookmarks bar"):["other"];if(d[u])d[u].data.tags=[...new Set([...d[u].data.tags,...B])];else{const $={id:we(),data:{link:{url:u,title:x},text:"",tags:B.length>0?B:[],updatedAt:v,createdAt:v,history:[]}};d[u]=$,p.push($)}}else if(z){const u=z.textContent?.trim();if(u&&z.nextElementSibling?.tagName==="DL"){const v=[...c];v.push(u);const x=z.nextElementSibling;i.has(x)||(i.add(x),se(x,v,p,i,d,S+r))}}}else l.tagName!=="DL"&&l.children.length>0&&(i.has(l)||(i.add(l),se(l,[...c],p,i,d,S+r)))}return p},Oe=async y=>{const c=await y.text(),d=new DOMParser().parseFromString(c,"text/html").querySelector("DL");return d?se(d,[],[]):[]},Je=()=>chrome;function Re(y){const c=[];return ke(y,[],c),c}function ke(y,c,p){for(const i of y){if(!i.url){const d=[...c,i.title].filter(Boolean);i.children&&ke(i.children,d,p);continue}p.push({id:we(),data:{link:{url:i.url,title:i.title||"unknown"},text:"",tags:c.length>0?[...c]:[],updatedAt:i.dateAdded||Date.now(),createdAt:i.dateAdded||Date.now(),history:[]}})}}const Ge=async()=>new Promise((y,c)=>{const p=Je();p.permissions.request({permissions:["bookmarks"]},async i=>{if(i)try{const d=await p.bookmarks.getTree(),S=Re(d).map(r=>(r.data.tags=r.data.tags.map(l=>{const _=l.trim();return _.toLocaleLowerCase()==="other bookmarks"?"other":_}).filter(l=>!(l===""||l.toLocaleLowerCase()==="bookmarks bar")),r));y(S)}catch(d){c(d)}else c(new Error("Permission denied for bookmarks"))})});var Ke=b(`<div class="b c p-1c1sfjh"><p>(browser bookmarks or a this app's file)</p></div>`),Ue=b('<div class="h p-1c1sfjh"><p class="i j p-1c1sfjh">Additional tags:</p> <!></div>'),Xe=b('<div class="k p-1c1sfjh"><!></div>'),Qe=b('<!> <div class="e p-1c1sfjh"><div class="f p-1c1sfjh"><button class="g p-1c1sfjh"><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper><span>Settings</span></button></div> <!> <!></div>',1),Ve=b("<p>(browser bookmarks or a this app's file)</p>"),Ye=b('<p class="i j p-1c1sfjh">Additional tags:</p> <div class="o p-1c1sfjh"><!></div>',1),Ze=b('<div class="p p-1c1sfjh"><!></div> <div role="button" tabindex="-1"><div tabindex="-1" class="q p-1c1sfjh"><p class="p-1c1sfjh">Drag and drop your file here</p> <p class="p-1c1sfjh">or</p></div></div>',1),et=b('<div class="l p-1c1sfjh"><div class="m p-1c1sfjh"><!> <div class="f p-1c1sfjh"><button class="g n p-1c1sfjh"><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper><span>Settings</span></button></div> <!></div> <!></div>'),tt=b('<!> <!> <input type="file" accept=".txt, .html" style="display: none;"/>',1),at=b('<div class="b c p-1c1sfjh"><p class="i r p-1c1sfjh">Loading...</p> <!></div>'),rt=b('<div class="b c p-1c1sfjh"><p class="i s p-1c1sfjh">Something went wrong</p></div> <div class="t p-1c1sfjh"><!></div>',1),st=b('<div class="b c p-1c1sfjh"><p class="i u p-1c1sfjh">Success!</p></div> <div class="t p-1c1sfjh"><!></div>',1),ot=b('<div class="a p-1c1sfjh"><!></div>');function lt(y,c){Ce(c,!0);const{blockDialog:p}=Ae(),{importNotes:i}=Ie(),{clearDialogPages:d}=$e();let S=W(fe("file")),r=W("idle"),l=W(null),_=W(!1),z=W(null),u=W(fe([])),v=W(!1),x=W(!1);const{checkMobileSize:B}=Ne(),$=()=>{d()};Fe(()=>{p(t(r)==="loading")}),pe(()=>(t(l)&&t(l).addEventListener("cancel",e=>{o(r,"idle"),e.preventDefault(),e.stopImmediatePropagation(),e.stopPropagation()}),()=>{p(!1)}));const be=async e=>{const a=await e.text(),j=JSON.parse(a),q=[];if(!j.notes)throw new Error("Invalid import file format");for(const K of Object.values(j.notes))K&&q.push(K);return q},oe=async e=>{o(r,"loading");let a=[];try{if(e.name.endsWith(".txt"))a=await be(e);else if(e.name.endsWith(".html"))a=await Oe(e);else throw new Error("Unsupported file format. Please upload a TXT or HTML file.");await le(a),o(r,"success")}catch{o(r,"error")}},ye=async e=>{const a=e.target;!a.files||a.files.length===0||await oe(a.files[0])},ne=()=>{t(l)?.click()},xe=e=>{e.preventDefault(),e.stopPropagation(),o(_,!0)},je=e=>{e.preventDefault(),e.stopPropagation(),o(_,!1)},Te=e=>{e.preventDefault(),e.stopPropagation(),o(_,!0)},De=async e=>{if(e.preventDefault(),e.stopPropagation(),o(_,!1),!e.dataTransfer?.files||e.dataTransfer.files.length===0)return;const a=e.dataTransfer.files[0];if(a.type!=="application/json"&&a.type!=="text/html"){o(r,"error");return}await oe(a)},ie=e=>{o(u,e,!0)},le=async e=>{await i(e.map(a=>({...a,data:{...a.data,tags:Array.from(new Set([...a.data.tags||[],...t(u)])),history:(a.data.history||[]).map(j=>({...j,tags:Array.from(new Set([...j.tags||[],...t(u)]))}))}}))),await new Promise(a=>setTimeout(a,500))},ce=e=>{e.key==="Escape"&&(document.activeElement instanceof HTMLInputElement&&document.activeElement.type==="text"||document.activeElement instanceof HTMLTextAreaElement)&&(t(v)&&o(v,!1),document.activeElement.blur(),e.preventDefault(),e.stopPropagation())},de=async()=>{o(r,"loading");let e=[];try{e=await Ge(),await le(e),o(r,"success")}catch{o(r,"error")}};pe(()=>(document.addEventListener("keydown",ce),()=>document.removeEventListener("keydown",ce)));var ve=ot(),Se=g(ve);{var Le=e=>{var a=tt(),j=L(a);h(j,w=>{});var q=m(j,2);{var K=w=>{var H=Qe(),O=L(H);{var T=s=>{var f=Ke();n(s,f)};h(O,s=>{t(S)==="file"&&s(T)})}var P=m(O,2),E=g(P),C=g(E);C.__click=()=>{o(x,!t(x)),o(v,!1)};var D=g(C);ge(D,()=>({"--rotate":"30deg","--size":"20px"})),he(D.lastChild,{name:"settings"});var A=m(E,2);{var U=s=>{var f=Ue(),I=m(g(f),2);me(I,{get selectedTags(){return t(u)},onChangeTags:ie,get shownTagInput(){return t(v)},set shownTagInput(R){o(v,R,!0)}}),n(s,f)};h(A,s=>{t(x)&&s(U)})}var J=m(A,2);{var Y=s=>{var f=Xe(),I=g(f);{var R=k=>{Q(k,{fullWidth:!0,onClick:de,children:(M,ee)=>{var G=V("Import");n(M,G)},$$slots:{default:!0}})},Z=k=>{Q(k,{fullWidth:!0,onClick:ne,children:(M,ee)=>{var G=V("Select file");n(M,G)},$$slots:{default:!0}})};h(I,k=>{t(S)==="browser"?k(R):k(Z,!1)})}n(s,f)};h(J,s=>{t(v)||s(Y)})}n(w,H)},N=w=>{var H=et(),O=g(H),T=g(O);{var P=s=>{var f=Ve();n(s,f)};h(T,s=>{t(S)==="file"&&s(P)})}var E=m(T,2),C=g(E);C.__click=()=>{o(x,!t(x)),o(v,!1)};var D=g(C);ge(D,()=>({"--rotate":"30deg","--size":"20px"})),he(D.lastChild,{name:"settings"});var A=m(E,2);{var U=s=>{var f=Ye(),I=m(L(f),2),R=g(I);me(R,{get selectedTags(){return t(u)},onChangeTags:ie,get shownTagInput(){return t(v)},set shownTagInput(Z){o(v,Z,!0)}}),n(s,f)};h(A,s=>{t(x)&&s(U)})}var J=m(O,2);{var Y=s=>{var f=te(),I=L(f);{var R=k=>{Q(k,{fullWidth:!0,onClick:de,children:(M,ee)=>{var G=V("Import");n(M,G)},$$slots:{default:!0}})},Z=k=>{var M=Ze(),ee=L(M),G=g(ee);Q(G,{onClick:ne,children:(re,nt)=>{var Ee=V("Select File");n(re,Ee)},$$slots:{default:!0}});var X=m(ee,2);ue(X,re=>o(z,re),()=>t(z)),Be(()=>qe(X,1,He({v:!0,w:t(_)}),"p-1c1sfjh")),ae("dragenter",X,xe),ae("dragover",X,Te),ae("dragleave",X,je),ae("drop",X,De),n(k,M)};h(I,k=>{t(S)==="browser"?k(R):k(Z,!1)})}n(s,f)};h(J,s=>{t(v)||s(Y)})}n(w,H)};h(q,w=>{B()?w(K):w(N,!1)})}var F=m(q,2);F.__change=ye,ue(F,w=>o(l,w),()=>t(l)),n(e,a)},Pe=e=>{var a=te(),j=L(a);{var q=N=>{var F=at(),w=m(g(F),2);We(w,{}),n(N,F)},K=N=>{var F=te(),w=L(F);{var H=T=>{var P=rt(),E=m(L(P),2),C=g(E);{let D=_e(B);Q(C,{get fullWidth(){return t(D)},onClick:()=>{o(r,"idle")},children:(A,U)=>{var J=V("Try Again");n(A,J)},$$slots:{default:!0}})}n(T,P)},O=T=>{var P=te(),E=L(P);{var C=D=>{var A=st(),U=m(L(A),2),J=g(U);{let Y=_e(B);Q(J,{get fullWidth(){return t(Y)},onClick:$,children:(s,f)=>{var I=V("Close");n(s,I)},$$slots:{default:!0}})}n(D,A)};h(E,D=>{t(r)==="success"&&D(C)},!0)}n(T,P)};h(w,T=>{t(r)==="error"?T(H):T(O,!1)},!0)}n(N,F)};h(j,N=>{t(r)==="loading"?N(q):N(K,!1)},!0)}n(e,a)};h(Se,e=>{t(r)==="idle"?e(Le):e(Pe,!1)})}n(y,ve),Me()}ze(["click","change"]);export{lt as default};
