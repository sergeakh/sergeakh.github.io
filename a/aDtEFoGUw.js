import{p as Le,J as $e,u as Se,v as Ie,K as Re,b as T,w as Fe,x as He,g as e,o as ce,f as x,j as D,c as o,i as v,m as Pe,a as i,n as O,s as f,d as Be,I as je,y as te,z as j,N as Me,B as ae,A as re,L as Ne,r as Ue}from"./aDdr6KNai.js";import{S as ze,a as M}from"./aBOmYimnG.js";const qe=W=>{const E=Math.floor(Date.now()/1e3),u={};W.forEach(n=>{if(!n)return;const p=n.data.tags||["Imported"];if(p.length===0){u.ROOT||(u.ROOT=[]),u.ROOT.push(n);return}p.forEach(d=>{u[d]||(u[d]=[]),u[d].push(n)})});let h=`<!DOCTYPE NETSCAPE-Note-file-1>
<!-- This is an automatically generated file.
 It will be read and overwritten.
 DO NOT EDIT! -->
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8">
<TITLE>Bookmarks</TITLE>
<H1>Bookmarks</H1>
<DL><p>
<DT><H3 ADD_DATE="${E}" LAST_MODIFIED="${E}" PERSONAL_TOOLBAR_FOLDER="true">Bookmarks bar</H3>
<DL><p>`;return Object.keys(u).forEach(n=>{n!=="ROOT"&&n!=="other"&&(h+=`
    <DT><H3 ADD_DATE="${E}" LAST_MODIFIED="${E}">${n}</H3>
    <DL><p>`,u[n].forEach(p=>{if(!p.data.link)return;const d=p.data.link.title.replace(/"/g,"&quot;");h+=`
        <DT><A HREF="${p.data.link.url}" ADD_DATE="${Math.floor(p.data.createdAt/1e3)||E}">${d}</A>`}),h+=`
    </DL><p>`)}),u.ROOT&&u.ROOT.forEach(n=>{if(!n.data.link)return;const p=n.data.link.title.replace(/"/g,"&quot;");h+=`
    <DT><A HREF="${n.data.link.url}" ADD_DATE="${Math.floor(n.data.createdAt/1e3)||E}">${p}</A>`}),h+=`
</DL><p>`,u.other&&u.other.forEach(n=>{if(!n.data.link)return;const p=n.data.link.title.replace(/"/g,"&quot;");h+=`
    <DT><A HREF="${n.data.link.url}" ADD_DATE="${Math.floor(n.data.createdAt/1e3)||E}">${p}</A>`}),h+="</DL><p>",h};var We=x('<div class="g p-10n6f3r"><p class="h p-10n6f3r">Exclude history</p> <div class="i p-10n6f3r"><!></div></div>'),Je=x('<div class="g p-10n6f3r"><p class="h p-10n6f3r">Exclude other tags</p> <div class="i p-10n6f3r"><!></div></div>'),Ge=x('<div class="g p-10n6f3r"><p class="h p-10n6f3r">Exclude bin</p> <div class="i p-10n6f3r"><!></div></div> <div class="g p-10n6f3r"><p class="h p-10n6f3r">Exclude archive</p> <div class="i p-10n6f3r"><!></div></div> <!> <div class="g p-10n6f3r"><p class="h p-10n6f3r">Exclude tags</p> <div class="i p-10n6f3r"><!></div></div> <!> <p class="j k p-10n6f3r">Filter tags:</p> <!>',1),Ke=x('<div class="l p-10n6f3r"><!></div>'),Qe=x('<div class="b p-10n6f3r"><div class="c p-10n6f3r"><!> <p class="d p-10n6f3r"><!></p></div></div> <div><div class="e p-10n6f3r"><button class="f p-10n6f3r"><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper><span>Settings</span></button></div> <!> <!></div>',1),Ve=x('<div class="b p-10n6f3r"><p class="j p-10n6f3r">Exporting...</p> <!></div>'),Ye=x('<div class="b p-10n6f3r"><p class="j m p-10n6f3r">Something went wrong</p></div> <div class="l p-10n6f3r"><!></div>',1),Xe=x('<div class="b p-10n6f3r"><p class="j p-10n6f3r">Exported successfully!</p></div> <div class="l p-10n6f3r"><!></div>',1),Ze=x('<div class="a p-10n6f3r"><!></div>');function at(W,E){Le(E,!0);const{getGetNotes:u}=$e(),{clearDialogPages:h}=Se(),{blockDialog:n}=Ie(),{checkMobileSize:p}=Re();let d=T("idle"),F=T("sync"),_=T(Fe([])),L=T(!1),J=T(!1),w=T(!1),N=T(!1),U=T(!1),G=T(!1),K=T(!1);const ve=()=>{h()};He(()=>{n(e(d)==="loading")}),ce(()=>()=>{n(!1)});const fe=()=>{i(J,!e(J)),i(U,!1),i(N,!1),i(L,!1),i(_,[],!0)},se=async()=>{i(d,"loading"),await new Promise(r=>setTimeout(r,0));let s=(u()()||[]).filter(r=>r.data).filter(r=>e(_).length===0?!0:e(_).every(t=>r.data.tags.includes(t)));if(e(U)&&(s=s.map(r=>{const t={...r};return t.data={...t.data,history:[]},t})),e(G)&&(s=s.filter(r=>!r.data.deletedAt)),e(K)&&(s=s.filter(r=>!r.data.archivedAt)),e(w)&&(s=s.map(r=>{const t={...r};return t.data={...t.data,tags:[],history:t.data.history.map(c=>({...c,tags:[]}))},t})),e(N)&&e(w)===!1&&(s=s.map(r=>{const t={...r};return t.data={...t.data,tags:t.data.tags.filter(c=>e(_).includes(c)),history:t.data.history.map(c=>({...c,tags:c.tags.filter(m=>e(_).includes(m))}))},t})),e(F)==="sync"){const r=`${[...e(w)?[]:e(_),"notes"].join("_")}.json`,t=JSON.stringify({filteredNotes:s}),c=new Blob([t],{type:"application/json"});return{filename:r,blob:c}}else{const r=`${[...e(w)?[]:e(_),"bookmarks"].join("_")}bookmarks_${new Date().toLocaleDateString().replace(/\//g,"_")}.html`,t=qe(s),c=new Blob([t],{type:"text/html"});return{filename:r,blob:c}}},pe=async()=>{try{const{filename:a,blob:s}=await se(),r=URL.createObjectURL(s),t=document.createElement("a");t.href=r,t.download=a,document.body.appendChild(t),t.click(),setTimeout(()=>{document.body.removeChild(t),URL.revokeObjectURL(r)},0),await new Promise(c=>setTimeout(c,500)),i(d,"success")}catch{i(d,"error")}},ue=async()=>{if(navigator.canShare({files:[new File([],"dummy")]})===!1){pe();return}try{const{filename:a,blob:s}=await se(),r=new File([s],a,{type:s.type});await navigator.share({files:[r]}),await new Promise(t=>setTimeout(t,0)),i(d,"success")}catch{i(d,"error")}},ge=a=>{i(_,a,!0)},ne=a=>{a.key==="Escape"&&(document.activeElement instanceof HTMLInputElement&&document.activeElement.type==="text"||document.activeElement instanceof HTMLTextAreaElement)&&(e(L)&&i(L,!1),document.activeElement.blur(),a.preventDefault(),a.stopPropagation())},he=a=>{i(N,a,!0)},_e=a=>{i(U,a,!0)},me=a=>{i(G,a,!0)},Te=a=>{i(K,a,!0)},Ee=a=>{i(w,a,!0)};ce(()=>(document.addEventListener("keydown",ne),()=>document.removeEventListener("keydown",ne)));var oe=Ze(),ke=o(oe);{var ye=a=>{var s=Qe(),r=O(s),t=o(r),c=o(t);ze(c,{items:[{title:"Sync",value:"sync"},{title:"Bookmarks",value:"bookmarks"}],get value(){return e(F)},onChange:l=>{i(F,l,!0)}});var m=f(c,2),A=o(m);{var H=l=>{var g=j("App format for sync or backup");v(l,g)},Q=l=>{var g=j("Browser bookmarks format (exports only bookmarks, not notes)");v(l,g)};D(A,l=>{e(F)==="sync"?l(H):l(Q,!1)})}var V=f(r,2),k=o(V),b=o(k);b.__click=fe;var $=o(b);Be($,()=>({"--rotate":"30deg","--size":"20px"})),je($.lastChild,{name:"settings"});var S=f(k,2);{var C=l=>{var g=Ge(),R=O(g),q=f(o(R),2),P=o(q);M(P,{get checked(){return e(G)},onChange:me});var Y=f(R,2),X=f(o(Y),2),xe=o(X);M(xe,{get checked(){return e(K)},onChange:Te});var le=f(Y,2);{var be=y=>{var B=We(),Z=f(o(B),2),ee=o(Z);M(ee,{get checked(){return e(U)},onChange:_e}),v(y,B)};D(le,y=>{e(F)==="sync"&&y(be)})}var ie=f(le,2),we=f(o(ie),2),Ae=o(we);M(Ae,{get checked(){return e(w)},onChange:Ee});var de=f(ie,2);{var Ce=y=>{var B=Je(),Z=f(o(B),2),ee=o(Z);M(ee,{get checked(){return e(N)},onChange:he}),v(y,B)};D(de,y=>{e(_).length>0&&!e(w)&&y(Ce)})}var Oe=f(de,4);Me(Oe,{mode:"exit",get selectedTags(){return e(_)},onChangeTags:ge,get shownTagInput(){return e(L)},set shownTagInput(y){i(L,y,!0)}}),v(l,g)};D(S,l=>{e(J)&&l(C)})}var I=f(S,2);{var z=l=>{var g=Ke(),R=o(g);{let q=re(p);ae(R,{get fullWidth(){return e(q)},onClick:ue,children:(P,Y)=>{var X=j("Export");v(P,X)},$$slots:{default:!0}})}v(l,g)};D(I,l=>{e(L)||l(z)})}v(a,s)},De=a=>{var s=te(),r=O(s);{var t=m=>{var A=Ve(),H=f(o(A),2);Ne(H,{}),v(m,A)},c=m=>{var A=te(),H=O(A);{var Q=k=>{var b=Ye(),$=f(O(b),2),S=o($);{let C=re(p);ae(S,{get fullWidth(){return e(C)},onClick:()=>{i(d,"idle")},children:(I,z)=>{var l=j("Try Again");v(I,l)},$$slots:{default:!0}})}v(k,b)},V=k=>{var b=te(),$=O(b);{var S=C=>{var I=Xe(),z=f(O(I),2),l=o(z);{let g=re(p);ae(l,{get fullWidth(){return e(g)},onClick:ve,children:(R,q)=>{var P=j("Close");v(R,P)},$$slots:{default:!0}})}v(C,I)};D($,C=>{e(d)==="success"&&C(S)},!0)}v(k,b)};D(H,k=>{e(d)==="error"?k(Q):k(V,!1)},!0)}v(m,A)};D(r,m=>{e(d)==="loading"?m(t):m(c,!1)},!0)}v(a,s)};D(ke,a=>{e(d)==="idle"?a(ye):a(De,!1)})}v(W,oe),Pe()}Ue(["click"]);export{at as default};
