import{p as ee,v as ae,D as re,u as te,x as se,g as s,b as L,o as oe,f as m,j as w,c as p,i as e,m as ne,H as ce,z as A,s as $,F as ie,a as i,B,G as le,y as k,n as y,L as O}from"./aC-II1AfE.js";import{b as z,c as de,g as ve}from"./aBEGDcNQV.js";import{g as fe,a as pe}from"./a9q_jSmK4.js";import{d as ye}from"./aCpa8lgv9.js";var me=m('<form><!> <div class="b p-1smyw3s"><!></div> <div class="c p-1smyw3s"><!></div></form>'),ue=m('<p class="d p-1smyw3s">Adding the access key</p>'),ge=m('<p class="d p-1smyw3s">Confirming</p>'),he=m('<p class="d e p-1smyw3s">Something went wrong</p> <div class="c p-1smyw3s"><!></div>',1),_e=m('<p class="d p-1smyw3s">Confirm this operation with another key</p> <div class="c p-1smyw3s"><!></div>',1),we=m('<div class="a p-1smyw3s"><!></div>');function xe(G,I){ee(I,!0);const{blockDialog:M}=ae(),{getAccount:J}=re(),{popDialogPage:U}=te();let a=L("idle"),C="",x=null,P=L("");se(()=>{M(s(a)==="confirmingAccessKey"||s(a)==="addingAccessKey")}),oe(()=>()=>{M(!1)});const j=async r=>{r.preventDefault(),i(a,"addingAccessKey");try{C=await fe();const t=await pe(),o=J();if(!o||!o.encryptedClientKey)throw new Error("No account found");const l=await ye({encryptedClientKey:z(o.encryptedClientKey),serverKey:z(t)});x=await de({challenge:C,clientKey:l}),i(a,"confirmAccessKey")}catch{i(a,"error");return}},q=async()=>{i(a,"confirmingAccessKey");try{const r=await ve({challenge:C});if(!x)throw new Error("No credential data found");if(!(await fetch("/api/addCredential",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({challenge:C,name:s(P)||`key ${Math.floor(Math.random()*1e3)}`,newCredential:x,confirmCredential:r.credentialData})})).ok)throw new Error("Failed to add access key");U()}catch{i(a,"error");return}};var F=we(),Q=p(F);{var R=r=>{var t=me(),o=p(t);ce(o,{children:(c,u)=>{var g=A("Enter a name for a key");e(c,g)}});var l=$(o,2),b=p(l);ie(b,{placeholder:"key name",get value(){return s(P)},set value(c){i(P,c,!0)}});var n=$(l,2),d=p(n);B(d,{onClick:j,children:(c,u)=>{var g=A("Add key");e(c,g)},$$slots:{default:!0}}),le("submit",t,j),e(r,t)},V=r=>{var t=k(),o=y(t);{var l=n=>{O(n,{children:(d,c)=>{var u=ue();e(d,u)},$$slots:{default:!0}})},b=n=>{var d=k(),c=y(d);{var u=v=>{O(v,{children:(K,H)=>{var D=ge();e(K,D)},$$slots:{default:!0}})},g=v=>{var K=k(),H=y(K);{var D=f=>{var h=he(),S=$(y(h),2),E=p(S);B(E,{onClick:()=>{i(a,"idle")},children:(_,N)=>{var T=A("Try Again");e(_,T)},$$slots:{default:!0}}),e(f,h)},W=f=>{var h=k(),S=y(h);{var E=_=>{var N=_e(),T=$(y(N),2),X=p(T);B(X,{onClick:q,children:(Y,Ce)=>{var Z=A("Confirm");e(Y,Z)},$$slots:{default:!0}}),e(_,N)};w(S,_=>{s(a)==="confirmAccessKey"&&_(E)},!0)}e(f,h)};w(H,f=>{s(a)==="error"?f(D):f(W,!1)},!0)}e(v,K)};w(c,v=>{s(a)==="confirmingAccessKey"?v(u):v(g,!1)},!0)}e(n,d)};w(o,n=>{s(a)==="addingAccessKey"?n(l):n(b,!1)},!0)}e(r,t)};w(Q,r=>{s(a)==="idle"?r(R):r(V,!1)})}e(G,F),ne()}export{xe as default};
