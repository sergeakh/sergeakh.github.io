import{S as Le,p as Ae,q as Ie,D as Fe,n as Ne,h as J,r as We,R as Me,u as ze,g as t,o as be,f as _,i as w,c as n,d as a,j as Be,k as s,l as f,s as i,T as he,v as le,B as W,x as M,t as He,K as Oe,M as qe,E as oe,L as Je,w as Re,y as ye,a as we,I as je}from"./aC1xpSvD-.js";import{N as ke}from"./a9vnhDBJf.js";import"./aDq3vB9Uh.js";const ce=(j,d,p,T=new Set,h={},r=Date.now())=>{for(let m=0;m<j.children.length;m++){const v=j.children[m];if(v.tagName==="DT"){const z=v.querySelector(":scope > A"),b=v.querySelector(":scope > H3");if(z){const l=z.getAttribute("href"),y=Number(z.getAttribute("add_date"))*1e3||r+m,k=z.textContent||"unknown";if(!l)return p;const L=d.find(A=>A.toLowerCase()==="bookmarks bar")?d.filter(A=>A.toLowerCase()!=="bookmarks bar"):["other"];if(h[l])h[l].data.tags=[...new Set([...h[l].data.tags,...L])];else{const A={id:Le(),data:{url:l,name:k,text:"",tags:L.length>0?L:[],updatedAt:y,createdAt:y,history:[]}};h[l]=A,p.push(A)}}else if(b){const l=b.textContent?.trim();if(l&&b.nextElementSibling?.tagName==="DL"){const y=[...d];y.push(l);const k=b.nextElementSibling;T.has(k)||(T.add(k),ce(k,y,p,T,h,r+m))}}}else v.tagName!=="DL"&&v.children.length>0&&(T.has(v)||(T.add(v),ce(v,[...d],p,T,h,r+m)))}return p},Ke=async j=>{const d=await j.text(),h=new DOMParser().parseFromString(d,"text/html").querySelector("DL");return h?ce(h,[],[]):[]},Ue=async(j,d)=>{const p=j.target;!p.files||p.files.length===0||await d(p.files[0])};var Ge=_(`<div class="top svelte-1gjle5b"><p class="message svelte-1gjle5b">Select a file to import your data</p> <p>(browser bookmarks or a this app's file)</p></div> <div class="mobileBottom svelte-1gjle5b"><div class="buttonContainer svelte-1gjle5b"><!></div></div>`,1),Qe=_('<p class="message svelte-1gjle5b">Select a file to import your data</p> <div class="desktopContainer svelte-1gjle5b"><div class="dropzoneButtonContainer svelte-1gjle5b"><!></div> <div role="button" tabindex="-1"><div tabindex="-1" class="dropzone-content svelte-1gjle5b"><p class="svelte-1gjle5b">Drag and drop your file here</p> <p class="svelte-1gjle5b">or</p></div></div></div>',1),Ve=_('<!> <input type="file" accept=".json, .html" style="display: none;"/>',1),Xe=_('<div class="top svelte-1gjle5b"><p class="message svelte-1gjle5b">Loading...</p> <!></div>'),Ye=_('<div class="top svelte-1gjle5b"><p class="message error svelte-1gjle5b">Something went wrong</p></div> <div class="buttonContainer svelte-1gjle5b"><!></div>',1),Ze=(j,d)=>s(d,!t(d)),et=_('<div class="tagsContainer svelte-1gjle5b"><p class="message message__tags svelte-1gjle5b">Additional tags:</p> <!></div>'),tt=_('<div class="buttonContainer svelte-1gjle5b"><!> <!></div>'),at=_('<div class="top svelte-1gjle5b"><p class="message svelte-1gjle5b">File loaded successfully</p></div> <div class="mobileBottom svelte-1gjle5b"><div class="settings svelte-1gjle5b"><button class="link svelte-1gjle5b"><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper><span>Settings</span></button></div> <!> <!></div>',1),st=(j,d)=>s(d,!t(d)),rt=_('<p class="message message__tags svelte-1gjle5b">Additional tags:</p> <div class="wrapNoteFormTags"><!></div>',1),lt=_('<div class="buttonContainer svelte-1gjle5b"><!> <!></div>'),ot=_('<p class="message svelte-1gjle5b">File loaded successfully</p> <div class="settings svelte-1gjle5b"><button class="link svelte-1gjle5b"><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper><span>Settings</span></button></div> <!> <!>',1),nt=_('<div class="top svelte-1gjle5b"><p class="message success svelte-1gjle5b">Notes imported successfully!</p></div> <div class="buttonContainer svelte-1gjle5b"><!></div>',1),it=_('<div class="block svelte-1gjle5b"><!></div>');function gt(j,d){Ae(d,!0);const{blockDialog:p}=Ie(),{importNotes:T}=Fe(),{clearDialogPages:h}=Ne();let r=J("idle"),m=J(null),v=J(!1),z=J(null),b=J(We([])),l=J(!1),y=[],k=J(!1);const{checkMobileSize:L}=Me(),A=()=>{h()};ze(()=>{p(t(r)==="loading")}),be(()=>(t(m)&&t(m).addEventListener("cancel",e=>{e.preventDefault(),e.stopImmediatePropagation(),e.stopPropagation()}),()=>{p(!1)}));const xe=async e=>{const o=await e.text(),B=JSON.parse(o),R=[];if(!B.notes)throw new Error("Invalid import file format");for(const K of Object.values(B.notes))K&&R.push(K);return R},ge=async e=>{s(r,"loading");try{if(e.name.endsWith(".json"))y=await xe(e);else if(e.name.endsWith(".html"))y=await Ke(e);else throw new Error("Unsupported file format. Please upload a JSON or HTML file.");await new Promise(o=>setTimeout(o,500)),s(r,"success-loaded")}catch(o){console.error("Error processing file:",o),s(r,"error")}},pe=()=>{t(m)?.click()},Ce=e=>{e.preventDefault(),e.stopPropagation(),s(v,!0)},Te=e=>{e.preventDefault(),e.stopPropagation(),s(v,!1)},De=e=>{e.preventDefault(),e.stopPropagation(),s(v,!0)},Pe=async e=>{if(e.preventDefault(),e.stopPropagation(),s(v,!1),!e.dataTransfer?.files||e.dataTransfer.files.length===0)return;const o=e.dataTransfer.files[0];if(o.type!=="application/json"&&o.type!=="text/html"){s(r,"error");return}await ge(o)},ue=e=>{s(b,e,!0)},fe=async()=>{s(r,"loading");try{await T(y.map(e=>({...e,data:{...e.data,tags:Array.from(new Set([...e.data.tags||[],...t(b)])),history:(e.data.history||[]).map(o=>({...o,tags:Array.from(new Set([...o.tags||[],...t(b)]))}))}}))),await new Promise(e=>setTimeout(e,500))}catch{s(r,"error");return}s(r,"success")},_e=e=>{e.key==="Escape"&&(document.activeElement instanceof HTMLInputElement&&document.activeElement.type==="text"||document.activeElement instanceof HTMLTextAreaElement)&&(t(l)&&s(l,!1),document.activeElement.blur(),e.preventDefault(),e.stopPropagation())};be(()=>(document.addEventListener("keydown",_e),()=>document.removeEventListener("keydown",_e)));var me=it(),Se=n(me);{var $e=e=>{var o=Ve(),B=f(o);{var R=c=>{var P=Ge(),Z=i(f(P),2),U=n(Z),x=n(U);W(x,{fullWidth:!0,onClick:pe,children:(g,I)=>{var G=M("Select File");a(g,G)},$$slots:{default:!0}}),a(c,P)},K=c=>{var P=Qe(),Z=i(f(P),2),U=n(Z),x=n(U);W(x,{onClick:pe,children:(I,G)=>{var ee=M("Select File");a(I,ee)},$$slots:{default:!0}});var g=i(U,2);he(g,I=>s(z,I),()=>t(z)),He(()=>Oe(g,1,qe(["dropzone",{active:t(v)}]),"svelte-1gjle5b")),oe("dragenter",g,Ce),oe("dragover",g,De),oe("dragleave",g,Te),oe("drop",g,Pe),a(c,P)};w(B,c=>{L()?c(R):c(K,!1)})}var D=i(B,2);D.__change=[Ue,ge],he(D,c=>s(m,c),()=>t(m)),a(e,o)},Ee=e=>{var o=le(),B=f(o);{var R=D=>{var c=Xe(),P=i(n(c),2);Je(P,{}),a(D,c)},K=D=>{var c=le(),P=f(c);{var Z=x=>{var g=Ye(),I=i(f(g),2),G=n(I);{let ee=ye(L);W(G,{get fullWidth(){return t(ee)},onClick:()=>{s(r,"idle")},children:(F,Q)=>{var te=M("Try Again");a(F,te)},$$slots:{default:!0}})}a(x,g)},U=x=>{var g=le(),I=f(g);{var G=F=>{var Q=le(),te=f(Q);{var ne=S=>{var H=at(),V=i(f(H),2),O=n(V),q=n(O);q.__click=[Ze,k];var X=n(q);we(X,()=>({"--rotate":"30deg","--size":"20px"})),je(X.lastChild,{name:"settings"});var Y=i(O,2);{var ie=u=>{var C=et(),N=i(n(C),2);ke(N,{get selectedTags(){return t(b)},onChangeTags:ue,get shownTagInput(){return t(l)},set shownTagInput(E){s(l,E,!0)}}),a(u,C)};w(Y,u=>{t(k)&&u(ie)})}var de=i(Y,2);{var $=u=>{var C=tt(),N=n(C);W(N,{withoutMinWidth:!0,fullWidth:!0,type:"secondary",onClick:()=>{s(r,"idle"),y=[],s(b,[],!0)},children:(se,re)=>{var ve=M("Cancel");a(se,ve)},$$slots:{default:!0}});var E=i(N,2);W(E,{fullWidth:!0,withoutMinWidth:!0,onClick:fe,children:(se,re)=>{var ve=M("Add notes");a(se,ve)},$$slots:{default:!0}}),a(u,C)};w(de,u=>{t(l)||u($)})}a(S,H)},ae=S=>{var H=ot(),V=i(f(H),2),O=n(V);O.__click=[st,k];var q=n(O);we(q,()=>({"--rotate":"30deg","--size":"20px"})),je(q.lastChild,{name:"settings"});var X=i(V,2);{var Y=$=>{var u=rt(),C=i(f(u),2),N=n(C);ke(N,{get selectedTags(){return t(b)},onChangeTags:ue,get shownTagInput(){return t(l)},set shownTagInput(E){s(l,E,!0)}}),a($,u)};w(X,$=>{t(k)&&$(Y)})}var ie=i(X,2);{var de=$=>{var u=lt(),C=n(u);W(C,{type:"secondary",fullWidth:!0,onClick:()=>{s(r,"idle"),y=[],s(b,[],!0)},children:(E,se)=>{var re=M("Cancel");a(E,re)},$$slots:{default:!0}});var N=i(C,2);W(N,{fullWidth:!0,onClick:fe,children:(E,se)=>{var re=M("Add notes");a(E,re)},$$slots:{default:!0}}),a($,u)};w(ie,$=>{t(l)||$(de)})}a(S,H)};w(te,S=>{L()?S(ne):S(ae,!1)})}a(F,Q)},ee=F=>{var Q=le(),te=f(Q);{var ne=ae=>{var S=nt(),H=i(f(S),2),V=n(H);{let O=ye(L);W(V,{get fullWidth(){return t(O)},onClick:A,children:(q,X)=>{var Y=M("Close");a(q,Y)},$$slots:{default:!0}})}a(ae,S)};w(te,ae=>{t(r)==="success"&&ae(ne)},!0)}a(F,Q)};w(I,F=>{t(r)==="success-loaded"?F(G):F(ee,!1)},!0)}a(x,g)};w(P,x=>{t(r)==="error"?x(Z):x(U,!1)},!0)}a(D,c)};w(B,D=>{t(r)==="loading"?D(R):D(K,!1)},!0)}a(e,o)};w(Se,e=>{t(r)==="idle"?e($e):e(Ee,!1)})}a(j,me),Be()}Re(["change","click"]);export{gt as default};
