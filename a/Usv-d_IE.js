import{p as U,D as V,G as Y,u as Z,g as t,j as b,l as i,o as p,f as W,e as R,W as _,w as y,t as L,x as N,d as c,c as T,s as v,m as h,y as O,T as $,n as ee,q as te,r as ae,E as se,X as ne,v as re}from"./D2EkbsE3.js";import{I as le}from"./BYIHO6zA.js";var oe=(D,a,C,k)=>{t(a)!==""&&C(t(a)),k(!1),i(a,"")},ie=W('<form class="formNewTag svelte-1dwadiy"><div class="inputWrapper svelte-1dwadiy"><!></div> <button type="button" class="buttonDone svelte-1dwadiy">Done</button></form>'),de=W('<div class="block"><div class="tags svelte-1dwadiy"><!> <!> <!> <!></div> <!></div>');function ve(D,a){U(a,!0);const{isInitedNotes:C,getGetMapTags:k,getGetNotes:j}=V();let u=b(null),n=b(""),g=b(null);const q=O(C);let l=Y(a,"shownTagInput",15);const F=()=>t(q)?a.mode==="exit"?ne(new Set(a.selectedTags),j()()||[]):[...k()().keys()]:[];let w=O(()=>F().filter(e=>a.selectedTags.some(s=>e===s)||e==="inbox"?!1:t(n)===""||e.toLowerCase().indexOf(t(n).toLowerCase())===0));const m=e=>{if(!a.selectedTags.includes(e)){if(a.mode!=="exit"||t(w).includes(e)){a.onChangeTags([...a.selectedTags,e]),i(n,"");return}t(u)?.focus()}},X=e=>{const s=a.selectedTags.filter(o=>o!==e);s.length===0?a.onChangeTags([]):a.onChangeTags(s)},z=e=>{e.preventDefault(),t(n)!==""?m(t(n)):l(!1)};Z(()=>{t(u)&&l()&&t(u).focus(),l()||i(n,"")});const S=e=>{e.target&&t(g)&&!t(g).contains(e.target)&&(l(!1),i(n,""))};p(()=>(document.addEventListener("click",S,{capture:!0}),()=>{document.removeEventListener("click",S,{capture:!0})}));var x=de(),E=T(x),G=T(E);R(G,16,()=>a.selectedTags,e=>e,(e,s)=>{_(e,{onClick:()=>X(s),type:"button",style:"selected",children:(o,r)=>{var d=y();L(()=>N(d,s)),c(o,d)},$$slots:{default:!0}})});var I=v(G,2);{var A=e=>{var s=te(),o=ae(s);R(o,16,()=>t(w).filter(r=>r.toLowerCase()!==t(n).toLowerCase()).slice(0,Math.max(3,3-a.selectedTags.length)),r=>r,(r,d)=>{_(r,{onClick:()=>m(d),children:(f,ce)=>{var P=y();L(()=>N(P,d)),c(f,P)},$$slots:{default:!0}})}),c(e,s)};h(I,e=>{(t(n)!==""||a.selectedTags.length>0&&l()&&a.mode==="exit")&&e(A)})}var M=v(I,2);{var B=e=>{_(e,{onClick:()=>{m(t(n)),i(n,"")},children:(s,o)=>{var r=y();L(()=>N(r,t(n))),c(s,r)},$$slots:{default:!0}})};h(M,e=>{t(n)!==""&&(a.mode!=="exit"||t(w).find(s=>s.toLowerCase()===t(n).toLowerCase()))&&e(B)})}var H=v(M,2);{var J=e=>{_(e,{onClick:()=>l(!0)})};h(H,e=>{l()||e(J)})}var K=v(E,2);{var Q=e=>{var s=ie(),o=T(s),r=T(o);le(r,{placeholder:"tag",get ref(){return t(u)},set ref(f){i(u,f,!0)},get value(){return t(n)},set value(f){i(n,f,!0)}});var d=v(o,2);d.__click=[oe,n,m,l],se("submit",s,z),c(e,s)};h(K,e=>{l()&&e(Q)})}$(x,e=>i(g,e),()=>t(g)),c(D,x),ee()}re(["click"]);export{ve as N};
