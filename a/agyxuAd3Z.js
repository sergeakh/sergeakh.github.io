import{M as he,p as Ee,v as Pe,J as Ae,u as $e,b as W,w as pe,K as Ie,x as Ne,g as t,o as fe,a as r,f as k,j as g,c as v,i as s,m as Fe,n as C,s as m,O as ue,y as te,d as ge,I as me,L as Me,r as We,N as we,B as X,z as Y,A as _e,t as ze,k as Be,l as Oe,G as ae}from"./akcz8jFBP.js";const se=(y,d,w,o=new Set,l={},x=Date.now())=>{for(let n=0;n<y.children.length;n++){const u=y.children[n];if(u.tagName==="DT"){const S=u.querySelector(":scope > A"),z=u.querySelector(":scope > H3");if(S){const p=S.getAttribute("href"),c=Number(S.getAttribute("add_date"))*1e3||x+n,b=S.textContent||"unknown";if(!p)return w;const B=d.find($=>$.toLowerCase()==="bookmarks bar")?d.filter($=>$.toLowerCase()!=="bookmarks bar"):["other"];if(l[p])l[p].data.tags=[...new Set([...l[p].data.tags,...B])];else{const $={id:he(),data:{link:{url:p,title:b},text:"",tags:B.length>0?B:[],updatedAt:c,createdAt:c,history:[]}};l[p]=$,w.push($)}}else if(z){const p=z.textContent?.trim();if(p&&z.nextElementSibling?.tagName==="DL"){const c=[...d];c.push(p);const b=z.nextElementSibling;o.has(b)||(o.add(b),se(b,c,w,o,l,x+n))}}}else u.tagName!=="DL"&&u.children.length>0&&(o.has(u)||(o.add(u),se(u,[...d],w,o,l,x+n)))}return w},He=async y=>{const d=await y.text(),l=new DOMParser().parseFromString(d,"text/html").querySelector("DL");return l?se(l,[],[]):[]},Je=()=>browser;function Ge(y){const d=[];return ke(y,[],d),d}function ke(y,d,w){for(const o of y){if(!o.url){const l=[...d,o.title].filter(Boolean);o.children&&ke(o.children,l,w);continue}w.push({id:he(),data:{link:{url:o.url,title:o.title||"unknown"},text:"",tags:d.length>0?[...d]:[],updatedAt:o.dateAdded||Date.now(),createdAt:o.dateAdded||Date.now(),history:[]}})}}const Ke=async()=>{const d=await Je().bookmarks.getTree();return Ge(d).map(o=>(o.data.tags=o.data.tags.map(l=>{const x=l.trim();return x.toLocaleLowerCase()==="other bookmarks"?"other":x}).filter(l=>!(l===""||l.toLocaleLowerCase()==="bookmarks bar")),o))};var Re=k("<p>(browser bookmarks or a this app's file)</p>"),Ue=k('<div class="g p-wkijq6"><p class="h i p-wkijq6">Additional tags:</p> <!></div>'),Qe=k('<div class="j p-wkijq6"><!></div>'),Ve=k('<div class="b p-wkijq6"><!></div> <div class="d p-wkijq6"><div class="e p-wkijq6"><button class="f p-wkijq6"><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper><span>Settings</span></button></div> <!> <!></div>',1),Xe=k("<p>(browser bookmarks or a this app's file)</p>"),Ye=k('<p class="h i p-wkijq6">Additional tags:</p> <div class="n p-wkijq6"><!></div>',1),Ze=k('<div class="o p-wkijq6"><!></div> <div role="button" tabindex="-1"><div tabindex="-1" class="p p-wkijq6"><p class="p-wkijq6">Drag and drop your file here</p> <p class="p-wkijq6">or</p></div></div>',1),et=k('<div class="k p-wkijq6"><div class="l p-wkijq6"><!> <div class="e p-wkijq6"><button class="f m p-wkijq6"><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper><span>Settings</span></button></div> <!></div> <!></div>'),tt=k('<!> <!> <input type="file" accept=".json, .html" style="display: none;"/>',1),at=k('<div class="b p-wkijq6"><p class="h q p-wkijq6">Loading...</p> <!></div>'),rt=k('<div class="b p-wkijq6"><p class="h r p-wkijq6">Something went wrong</p></div> <div class="s p-wkijq6"><!></div>',1),st=k('<div class="b p-wkijq6"><p class="h t p-wkijq6">Success!</p></div> <div class="s p-wkijq6"><!></div>',1),ot=k('<div class="a p-wkijq6"><!></div>');function lt(y,d){Ee(d,!0);const{blockDialog:w}=Pe(),{importNotes:o}=Ae(),{clearDialogPages:l}=$e();let x=W(pe("file")),n=W("idle"),u=W(null),S=W(!1),z=W(null),p=W(pe([])),c=W(!1),b=W(!1);const{checkMobileSize:B}=Ie(),$=()=>{l()};Ne(()=>{w(t(n)==="loading")}),fe(()=>(t(u)&&t(u).addEventListener("cancel",e=>{r(n,"idle"),e.preventDefault(),e.stopImmediatePropagation(),e.stopPropagation()}),()=>{w(!1)}));const be=async e=>{const a=await e.text(),j=JSON.parse(a),O=[];if(!j.notes)throw new Error("Invalid import file format");for(const V of Object.values(j.notes))V&&O.push(V);return O},oe=async e=>{r(n,"loading");let a=[];try{if(e.name.endsWith(".json"))a=await be(e);else if(e.name.endsWith(".html"))a=await He(e);else throw new Error("Unsupported file format. Please upload a JSON or HTML file.");await le(a),r(n,"success")}catch{r(n,"error")}},ye=async e=>{const a=e.target;!a.files||a.files.length===0||await oe(a.files[0])},ne=()=>{t(u)?.click()},xe=e=>{e.preventDefault(),e.stopPropagation(),r(S,!0)},je=e=>{e.preventDefault(),e.stopPropagation(),r(S,!1)},qe=e=>{e.preventDefault(),e.stopPropagation(),r(S,!0)},De=async e=>{if(e.preventDefault(),e.stopPropagation(),r(S,!1),!e.dataTransfer?.files||e.dataTransfer.files.length===0)return;const a=e.dataTransfer.files[0];if(a.type!=="application/json"&&a.type!=="text/html"){r(n,"error");return}await oe(a)},ie=e=>{r(p,e,!0)},le=async e=>{await o(e.map(a=>({...a,data:{...a.data,tags:Array.from(new Set([...a.data.tags||[],...t(p)])),history:(a.data.history||[]).map(j=>({...j,tags:Array.from(new Set([...j.tags||[],...t(p)]))}))}}))),await new Promise(a=>setTimeout(a,500))},de=e=>{e.key==="Escape"&&(document.activeElement instanceof HTMLInputElement&&document.activeElement.type==="text"||document.activeElement instanceof HTMLTextAreaElement)&&(t(c)&&r(c,!1),document.activeElement.blur(),e.preventDefault(),e.stopPropagation())},ce=async()=>{r(n,"loading");let e=[];try{e=await Ke(),await le(e),r(n,"success")}catch{r(n,"error")}};fe(()=>(document.addEventListener("keydown",de),()=>document.removeEventListener("keydown",de)));var ve=ot(),Te=v(ve);{var Se=e=>{var a=tt(),j=C(a);g(j,_=>{});var O=m(j,2);{var V=_=>{var H=Ve(),J=C(H),q=v(J);{var E=i=>{var h=Re();s(i,h)};g(q,i=>{t(x)==="file"&&i(E)})}var F=m(J,2),P=v(F),D=v(P);D.__click=()=>{r(b,!t(b)),r(c,!1)};var A=v(D);ge(A,()=>({"--rotate":"30deg","--size":"20px"})),me(A.lastChild,{name:"settings"});var G=m(P,2);{var K=i=>{var h=Ue(),R=m(v(h),2);we(R,{get selectedTags(){return t(p)},onChangeTags:ie,get shownTagInput(){return t(c)},set shownTagInput(U){r(c,U,!0)}}),s(i,h)};g(G,i=>{t(b)&&i(K)})}var Z=m(G,2);{var f=i=>{var h=Qe(),R=v(h);{var U=T=>{X(T,{fullWidth:!0,onClick:ce,children:(Q,ee)=>{var L=Y("From browser");s(Q,L)},$$slots:{default:!0}})},M=T=>{X(T,{fullWidth:!0,onClick:ne,children:(Q,ee)=>{var L=Y("Select file");s(Q,L)},$$slots:{default:!0}})};g(R,T=>{t(x)==="browser"?T(U):T(M,!1)})}s(i,h)};g(Z,i=>{t(c)||i(f)})}s(_,H)},I=_=>{var H=et(),J=v(H),q=v(J);{var E=f=>{var i=Xe();s(f,i)};g(q,f=>{t(x)==="file"&&f(E)})}var F=m(q,2),P=v(F);P.__click=()=>{r(b,!t(b)),r(c,!1)};var D=v(P);ge(D,()=>({"--rotate":"30deg","--size":"20px"})),me(D.lastChild,{name:"settings"});var A=m(F,2);{var G=f=>{var i=Ye(),h=m(C(i),2),R=v(h);we(R,{get selectedTags(){return t(p)},onChangeTags:ie,get shownTagInput(){return t(c)},set shownTagInput(U){r(c,U,!0)}}),s(f,i)};g(A,f=>{t(b)&&f(G)})}var K=m(J,2);{var Z=f=>{var i=te(),h=C(i);{var R=M=>{X(M,{fullWidth:!0,onClick:ce,children:(T,Q)=>{var ee=Y("From browser");s(T,ee)},$$slots:{default:!0}})},U=M=>{var T=Ze(),Q=C(T),ee=v(Q);X(ee,{onClick:ne,children:(re,nt)=>{var Ce=Y("Select File");s(re,Ce)},$$slots:{default:!0}});var L=m(Q,2);ue(L,re=>r(z,re),()=>t(z)),ze(()=>Be(L,1,Oe({u:!0,v:t(S)}),"p-wkijq6")),ae("dragenter",L,xe),ae("dragover",L,qe),ae("dragleave",L,je),ae("drop",L,De),s(M,T)};g(h,M=>{t(x)==="browser"?M(R):M(U,!1)})}s(f,i)};g(K,f=>{t(c)||f(Z)})}s(_,H)};g(O,_=>{B()?_(V):_(I,!1)})}var N=m(O,2);N.__change=ye,ue(N,_=>r(u,_),()=>t(u)),s(e,a)},Le=e=>{var a=te(),j=C(a);{var O=I=>{var N=at(),_=m(v(N),2);Me(_,{}),s(I,N)},V=I=>{var N=te(),_=C(N);{var H=q=>{var E=rt(),F=m(C(E),2),P=v(F);{let D=_e(B);X(P,{get fullWidth(){return t(D)},onClick:()=>{r(n,"idle")},children:(A,G)=>{var K=Y("Try Again");s(A,K)},$$slots:{default:!0}})}s(q,E)},J=q=>{var E=te(),F=C(E);{var P=D=>{var A=st(),G=m(C(A),2),K=v(G);{let Z=_e(B);X(K,{get fullWidth(){return t(Z)},onClick:$,children:(f,i)=>{var h=Y("Close");s(f,h)},$$slots:{default:!0}})}s(D,A)};g(F,D=>{t(n)==="success"&&D(P)},!0)}s(q,E)};g(_,q=>{t(n)==="error"?q(H):q(J,!1)},!0)}s(I,N)};g(j,I=>{t(n)==="loading"?I(O):I(V,!1)},!0)}s(e,a)};g(Te,e=>{t(n)==="idle"?e(Se):e(Le,!1)})}s(y,ve),Fe()}We(["click","change"]);export{lt as default};
