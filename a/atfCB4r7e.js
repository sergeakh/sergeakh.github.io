import{p as H,C as J,v as K,D as M,w as N,y as Q,g as u,a as R,f as m,i as h,b as l,e as a,h as U,z as x,j as f,u as V,d as k,B as P,A as C,P as X,s as b,t as Z,k as aa}from"./aBhExeEdR.js";var ta=m('<p class="b p-f05mma">You need to connect to the cloud account to get an access to a subscription</p> <div class="c p-f05mma"><!></div>',1),sa=m('<div class="c p-f05mma"><!></div>'),ea=m('<p class="b p-f05mma"> </p>'),ra=m('<p class="b p-f05mma">error signin</p> <div class="c p-f05mma"><div class="d"><!></div></div>',1),oa=m('<p class="b p-f05mma">Subscription updated successfully</p> <div class="c p-f05mma"><div class="d"><!></div></div>',1),ia=m('<div class="a p-f05mma"><!></div>');function na(W,Y){H(Y,!0);const w=J(),y=K(),E=M();let c=R("idle"),S=V(()=>E.getAccount());const{blockDialog:z}=N(),F=()=>{const e=w.get(),o=`${window.location.search}`;y.push(X.Auth),e.has("retPath")||w.set("retPath",o)},I=()=>{y.clear()},A=async()=>{b(c,"loading");try{const e=await fetch("/api/getSubscription",{method:"POST"});if(e.status!==200){b(c,"error");return}const o=await e.json();if(!o.subscriptionExpires){b(c,"error");return}const _=o.subscriptionExpires;E.updateSubscription(_),b(c,"success")}catch{b(c,"error")}};Q(()=>{z(u(c)==="loading")});var j=ia(),L=l(j);{var O=e=>{var o=x(),_=f(o);{var $=t=>{var r=ta(),v=k(f(r),2),d=l(v);P(d,{onClick:F,children:(n,s)=>{var i=C("Connect");a(n,i)},$$slots:{default:!0}}),a(t,r)},D=t=>{var r=x(),v=f(r);{var d=s=>{var i=sa(),p=l(i);P(p,{onClick:A,children:(g,B)=>{var G=C("Get subscription");a(g,G)},$$slots:{default:!0}}),a(s,i)},n=s=>{var i=ea(),p=l(i);Z(g=>aa(p,`Your subscription is active until ${g??""}`),[()=>new Date(u(S).subscriptionExpires).toLocaleDateString()]),a(s,i)};h(v,s=>{u(S).subscriptionExpires<Date.now()?s(d):s(n,!1)},!0)}a(t,r)};h(_,t=>{u(S)?t(D,!1):t($)})}a(e,o)},T=e=>{var o=x(),_=f(o);{var $=t=>{var r=ra(),v=k(f(r),2),d=l(v),n=l(d);P(n,{onClick:A,fullWidth:!0,children:(s,i)=>{var p=C("try again");a(s,p)},$$slots:{default:!0}}),a(t,r)},D=t=>{var r=x(),v=f(r);{var d=n=>{var s=oa(),i=k(f(s),2),p=l(i),g=l(p);P(g,{onClick:I,fullWidth:!0,children:(B,G)=>{var q=C("Close");a(B,q)},$$slots:{default:!0}}),a(n,s)};h(v,n=>{u(c)==="success"&&n(d)},!0)}a(t,r)};h(_,t=>{u(c)==="error"?t($):t(D,!1)},!0)}a(e,o)};h(L,e=>{u(c)==="idle"?e(O):e(T,!1)})}a(W,j),U()}export{na as default};
