import{p as Y,J as Z,h as w,r as $,u as _t,g as t,f as b,i as M,c as s,T as H,k as l,d,j as tt,s as h,l as pt,w as et,D as gt,R as mt,o as ht,y as E,K as wt,M as bt,t as O,N as Q,E as xt,B as V,x as X,m as kt}from"./aCxKU5lFO.js";import{N as Dt}from"./avn0fNL4C.js";import{I as Nt}from"./aDm_nMAGj.js";var It=(u,e,r,c)=>{l(e,r.url,!0),c(!1)},yt=(u,e,r,c,D)=>{if(t(e)&&t(r)){l(e,"");return}c.onChangeUrl(t(e)),D(!1)},Ut=b('<div class="wrapper svelte-w8w68w"><!> <div class="containerButtons svelte-w8w68w"><button class="svelte-w8w68w">Cancel</button> <button class="svelte-w8w68w">Done</button></div></div>'),Ct=(u,e)=>{e(!0)},Tt=(u,e,r)=>{l(e,""),r.onDeleteUrl()},Et=b('<button class="button svelte-w8w68w">Edit link</button> <button class="button svelte-w8w68w">Delete link</button>',1),Bt=(u,e)=>{e(!0)},Mt=b('<button class="button svelte-w8w68w">Add link</button>'),At=b('<div class="wrapperButtons svelte-w8w68w"><!></div>'),Lt=b("<div><!></div>");function St(u,e){Y(e,!0);let r=Z(e,"shownUrlInput",15),c=w(""),D=w(null),A=w(null),x=w($(e.url));const S=n=>{l(c,""),l(x,n.target.value||"",!0);try{new URL(t(x))}catch{l(c,"Invalid URL")}};_t(()=>{r()&&t(D)?.focus()});var p=Lt(),o=s(p);{var i=n=>{var v=Ut(),k=s(v);Nt(k,{get value(){return t(x)},get error(){return t(c)},onInput:S,placeholder:"url",get ref(){return t(D)},set ref(_){l(D,_,!0)}});var g=h(k,2),U=s(g);U.__click=[It,x,e,r];var f=h(U,2);f.__click=[yt,x,c,e,r],d(n,v)},N=n=>{var v=At(),k=s(v);{var g=f=>{var _=Et(),L=pt(_);L.__click=[Ct,r];var R=h(L,2);R.__click=[Tt,x,e],d(f,_)},U=f=>{var _=Mt();_.__click=[Bt,r],d(f,_)};M(k,f=>{e.url?f(g):f(U,!1)})}d(n,v)};M(o,n=>{r()?n(i):n(N,!1)})}H(p,n=>l(A,n),()=>t(A)),d(u,p),tt()}et(["click"]);const Rt=(u,e,r)=>{t(e)&&(t(e).style.height="auto",t(e).style.height=t(e).scrollHeight+"px"),r({text:u.target.value.trim()})},Wt=(u,e)=>{e({name:u.target.value.trim()})};var Ft=b("<span> </span>"),Pt=b('<div class="dateInfo svelte-t8fgpr"><!></div>'),Ht=b('<div class="submitButtons svelte-t8fgpr"><!> <!></div>'),zt=b('<div class="form svelte-t8fgpr"><div class="scrollWrapper"><div class="formFields"><!> <form><input class="inputName svelte-t8fgpr" placeholder="Name"/></form> <textarea class="textarea svelte-t8fgpr" placeholder="Note"></textarea></div></div> <div><!> <div class="formTagsWrapper svelte-t8fgpr"><!></div> <!></div></div>');function qt(u,e){Y(e,!0);const{getNoteById:r,deleteNoteDraft:c,saveNoteDraft:D,putNoteDraft:A}=gt(),{checkMobileSize:x}=mt();let S=Z(e,"mode",3,"add"),p=w($(e.noteId||r()?.id||"")),o=E(()=>r(t(p))?.data||null),i=E(()=>t(o)?.draft||null),N=w(null),n=w(!1),v=w(!1),k=w(null);const g=async({name:a,url:I,text:C,tags:B})=>{let m=B?.map(y=>y.trim())||t(i)?.tags||t(o)?.tags||[];const T={name:a??t(i)?.name??t(o)?.name??"",url:I??t(i)?.url??t(o)?.url??"",text:C??t(i)?.text??t(o)?.text??"",tags:m,createdAt:t(i)?.createdAt||Date.now(),updatedAt:Date.now()};l(p,await A(t(p),T)||"",!0)},U=a=>{a.preventDefault(),D(t(p)),e.onSubmit()},f=a=>{a.preventDefault(),t(N)&&t(N).focus()},_=a=>{a.key==="Escape"&&(document.activeElement instanceof HTMLInputElement&&document.activeElement.type==="text"||document.activeElement instanceof HTMLTextAreaElement)&&(t(n)&&(l(n,!1),a.preventDefault(),a.stopPropagation()),t(v)&&(l(v,!1),a.preventDefault(),a.stopPropagation()))};ht(()=>(x()||t(k)?.focus(),document.addEventListener("keydown",_),()=>document.removeEventListener("keydown",_)));const L=a=>{g({url:a})},R=()=>{g({url:""})},at=a=>{g({tags:a})},rt=()=>{c(t(p))};let nt=E(()=>t(i)?.name??t(o)?.name??""),lt=E(()=>t(i)?.url??t(o)?.url??""),ot=E(()=>t(i)?.text??t(o)?.text??""),st=E(()=>t(i)?.tags??t(o)?.tags??[]);var z=zt(),j=s(z),ut=s(j),J=s(ut);St(J,{get url(){return t(lt)},onChangeUrl:L,onDeleteUrl:R,get shownUrlInput(){return t(v)},set shownUrlInput(a){l(v,a,!0)}});var W=h(J,2),F=s(W);F.__input=[Wt,g],H(F,a=>l(k,a),()=>t(k));var P=h(W,2);P.__input=[Rt,N,g],H(P,a=>l(N,a),()=>t(N));var K=h(j,2);wt(K,1,bt(["bottom","bottomSpace"]),"svelte-t8fgpr");var q=s(K);{var it=a=>{var I=Pt(),C=s(I);{var B=m=>{var T=Ft(),y=s(T);O(ft=>kt(y,`updated: ${ft??""}`),[()=>new Date(t(o).updatedAt).toLocaleString()]),d(m,T)};M(C,m=>{t(o)?.updatedAt&&m(B)})}d(a,I)};M(q,a=>{S()==="edit"&&a(it)})}var G=h(q,2),vt=s(G);Dt(vt,{get selectedTags(){return t(st)},onChangeTags:at,get shownTagInput(){return t(n)},set shownTagInput(a){l(n,a,!0)}});var dt=h(G,2);{var ct=a=>{var I=Ht(),C=s(I);V(C,{fullWidth:!0,withoutMinWidth:!0,onClick:rt,type:"secondary",typeButton:"button",children:(m,T)=>{var y=X("cancel");d(m,y)},$$slots:{default:!0}});var B=h(C,2);V(B,{fullWidth:!0,withoutMinWidth:!0,onClick:U,typeButton:"submit",children:(m,T)=>{var y=X("save");d(m,y)},$$slots:{default:!0}}),d(a,I)};M(dt,a=>{!t(n)&&!t(v)&&t(i)&&a(ct)})}O(()=>{Q(F,t(nt)),Q(P,t(ot))}),xt("submit",W,f),d(u,z),tt()}et(["input"]);export{qt as N};
