import{p as ve,v as de,w as pe,a as N,x as fe,y as Y,g as s,o as _e,s as n,f as i,i as v,b as l,e as a,h as ge,L as q,z as O,j as h,r as ye,H as ue,A as $,d,l as he,c as me,I as G,t as be,k as Ae,V as Ke,B as Q,u as R,P as U}from"./aBhExeEdR.js";import{g as ke}from"./a9q_jSmK4.js";import{g as Ce}from"./agMDNaL23.js";var we=i('<p class="b p-78vibc">Loading access keys</p>'),xe=i('<p class="b p-78vibc">Confirming</p>'),Pe=i('<button class="f p-78vibc"><!> <!></button>'),$e=i('<li class="p-78vibc"><div class="c p-78vibc"><div><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper></div> <div class="d p-78vibc"> </div></div> <div class="e p-78vibc"><!></div></li>'),De=i('<p class="b g p-78vibc">Error deleting access key</p>'),He=i('<div class="h p-78vibc"><!></div>'),Se=i('<p class="b p-78vibc">You have reached the maximum number of access keys.</p>'),Te=i('<!> <ul class="p-78vibc"></ul> <!> <!>',1),je=i('<p class="b g p-78vibc">Something went wrong</p> <div class="h p-78vibc"><!></div>',1),Ee=i('<div class="a p-78vibc"><!></div>');function Fe(W,z){ve(z,!0);const B=de(),{blockDialog:F}=pe();let r=N("loadingAccessKeys"),m=N(fe([]));Y(()=>{F(s(r)==="loadingAccessKeys"||s(r)==="confirmingDeleteAccessKey")}),_e(()=>()=>{F(!1)}),Y(()=>{if(!z.hidden&&s(r)==="successAccessKeys"||s(r)==="loadingAccessKeys"){const c=new AbortController;return(async()=>{try{const o=await fetch("/api/credentials",{method:"POST",signal:c.signal});if(!o.ok)throw new Error("Failed to fetch access keys");const p=await o.json();n(m,p.credentials||[],!0),n(r,"successAccessKeys")}catch{n(r,"errorAccessKeys")}})(),()=>{c.abort()}}});const X=async c=>{n(r,"confirmingDeleteAccessKey");try{const o=await ke(),p=await Ce({challenge:o});if(!(await fetch("/api/deleteCredential",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({challenge:o,id:c,confirmCredential:p.credentialData})})).ok)throw new Error("Failed to add access key");n(r,"loadingAccessKeys")}catch{n(r,"errorDeleteAccessKey");return}};var I=Ee(),Z=l(I);{var ee=c=>{q(c,{children:(o,p)=>{var b=we();a(o,b)},$$slots:{default:!0}})},se=c=>{var o=O(),p=h(o);{var b=f=>{q(f,{children:(A,V)=>{var D=xe();a(A,D)},$$slots:{default:!0}})},ae=f=>{var A=O(),V=h(A);{var D=_=>{var u=Te(),K=h(u);ue(K,{children:(e,t)=>{var y=$("Access Keys");a(e,y)}});var k=d(K,2);he(k,21,()=>s(m),e=>e.id,(e,t)=>{var y=$e(),w=l(y),x=l(w),P=l(x);me(P,()=>({"--size":"20px"})),G(P.lastChild,{name:"key"});var J=d(x,2),j=l(J),te=d(w,2),ce=l(te);{var oe=E=>{var L=Pe();L.__click=()=>X(s(t).id);var M=l(L);G(M,{name:"close"});var ie=d(M,2);Ke(ie,{children:(le,Le)=>{var ne=$("delete access key");a(le,ne)}}),a(E,L)};v(ce,E=>{s(m).length>1&&E(oe)})}be(()=>Ae(j,s(t).name)),a(e,y)});var g=d(k,2);{var C=e=>{var t=De();a(e,t)};v(g,e=>{s(r)==="errorDeleteAccessKey"&&e(C)})}var H=d(g,2);{var S=e=>{var t=He(),y=l(t);{let w=R(()=>B.createHref(U.ConfirmAccessKey)),x=R(()=>B.createHandleClick(U.ConfirmAccessKey));Q(y,{element:"a",get href(){return s(w)},get onClick(){return s(x)},children:(P,J)=>{var j=$("Add access key");a(P,j)},$$slots:{default:!0}})}a(e,t)},T=e=>{var t=Se();a(e,t)};v(H,e=>{s(m).length<5?e(S):e(T,!1)})}a(_,u)},re=_=>{var u=O(),K=h(u);{var k=g=>{var C=je(),H=d(h(C),2),S=l(H);Q(S,{onClick:()=>{n(r,"loadingAccessKeys")},children:(T,e)=>{var t=$("Try Again");a(T,t)},$$slots:{default:!0}}),a(g,C)};v(K,g=>{s(r)==="errorAccessKeys"&&g(k)},!0)}a(_,u)};v(V,_=>{s(r)==="successAccessKeys"||s(r)==="errorDeleteAccessKey"?_(D):_(re,!1)},!0)}a(f,A)};v(p,f=>{s(r)==="confirmingDeleteAccessKey"?f(b):f(ae,!1)},!0)}a(c,o)};v(Z,c=>{s(r)==="loadingAccessKeys"?c(ee):c(se,!1)})}a(W,I),ge()}ye(["click"]);export{Fe as default};
