import{p as te,M as G,C as re,o as j,O as r,f as u,j as b,g as s,b as Q,c as d,s as g,A as T,i as n,m as oe,a as h,Q as U,n as w,B as ne,z as ie,y as H,L as le,t as de,q as ge}from"./aBxIaNIxL.js";import{S as q}from"./aMypcD0L-.js";const pe=(x,y,F={})=>{let f=null,p=null;return(...i)=>{p=i,!f&&(x(...p),p=null,f=setTimeout(()=>{if(f=null,F.trailing&&p){x(...p);return}},y))}};var ve=u('<div class="b p-7f8x00"><p class="c p-7f8x00">Local AI tags</p> <div class="d"><!></div></div>'),ce=u('<div class="b p-7f8x00"><p class="c p-7f8x00">Use page data for improving ai tags</p> <div class="d"><!></div></div>'),ue=u("<p>Local llm model is not downloaded. Download to enable tag generation. (model size 1.5â€“2.4 GB)</p> <!>",1),fe=u("<!> <p> </p>",1),me=u("<p>Local LLM is unavailable on this platform.</p>"),_e=u('<div class="a p-7f8x00"><!> <!> <!> <div class="b p-7f8x00"><p class="c p-7f8x00">Change icon for saved pages</p> <div class="d"><!></div></div></div>');function xe(x,y){te(y,!0);const{getLlmTagsEnabled:F,setLlmTagsEnabled:f,getPageDataForTagsEnabled:p,setPageDataForTagsEnabled:i,getIconForSavedPagesEnabled:J,setIconForSavedPagesEnabled:c}=G(),{getSearchParams:M}=re(),{getViewMode:C}=G();let E=T(F);const K=e=>{f(e),D()};let t=Q("unknown"),k=Q(0);const N=pe(e=>{h(k,e,!0)},100,{trailing:!0}),D=async()=>{if(typeof LanguageModel>"u"){h(t,"unavailable");return}h(t,await U().availability({expectedInputs:[{type:"text",languages:["en"]}],expectedOutputs:[{type:"text",languages:["en"]}]}),!0),s(t)==="downloading"&&I()},I=async()=>{h(t,"downloading");try{await U().create({expectedInputs:[{type:"text",languages:["en"]}],expectedOutputs:[{type:"text",languages:["en"]}],monitor(e){e.addEventListener("downloadprogress",a=>{if(a.loaded===1){h(t,"available");return}else N(Math.floor(a.loaded*100))})}})}catch(e){console.error("Error loading local LLM:",e);return}},R=e=>{i(e),e!==!1&&r().permissions.contains({permissions:["scripting"],origins:["<all_urls>"]},a=>{a?i(!0):(i(!1),C()==="popup"?r().runtime.sendMessage({type:"requestPermissions",data:{name:"pageDataForTags",permissions:["scripting"],origins:["<all_urls>"],retpath:M().toString()}}):r().permissions.request({permissions:["scripting"],origins:["<all_urls>"]},o=>{i(!!o)}))})},A=e=>{c(e),e!==!1&&r().permissions.contains({permissions:["tabs"],origins:["<all_urls>"]},a=>{a?c(!0):(c(!1),C()==="popup"?r().runtime.sendMessage({type:"requestPermissions",data:{name:"iconForSavedPages",permissions:["tabs"],origins:["<all_urls>"],retpath:M().toString()}}):r().permissions.request({permissions:["tabs"],origins:["<all_urls>"]},o=>{c(!!o)}))})};j(()=>{r().permissions.contains({permissions:["tabs"],origins:["<all_urls>"]},e=>{e||c(!1)}),r().storage.local.get("permissionsRequested_iconForSavedPages",e=>{e.permissionsRequested_iconForSavedPages&&A(!0),r().storage.local.remove("permissionsRequested_iconForSavedPages")}),r().permissions.contains({permissions:["scripting"],origins:["<all_urls>"]},e=>{e||i(!1)}),r().storage.local.get("permissionsRequested_pageDataForTags",e=>{e.permissionsRequested_pageDataForTags&&R(!0),r().storage.local.remove("permissionsRequested_pageDataForTags")})}),j(()=>{D()});var $=_e(),B=d($);{var W=e=>{var a=ve(),o=g(d(a),2),v=d(o);q(v,{get checked(){return s(E)},onChange:K}),n(e,a)};b(B,e=>{s(t)!=="unavailable"&&s(t)!=="unknown"&&e(W)})}var O=g(B,2);{var X=e=>{var a=ce(),o=g(d(a),2),v=d(o);{let L=T(p);q(v,{get checked(){return s(L)},onChange:R})}n(e,a)};b(O,e=>{s(t)!=="unavailable"&&s(t)!=="unknown"&&s(E)&&e(X)})}var z=g(O,2);{var Y=e=>{var a=ue(),o=g(w(a),2);ne(o,{onClick:I,children:(v,L)=>{var l=ie("Download");n(v,l)},$$slots:{default:!0}}),n(e,a)},Z=e=>{var a=H(),o=w(a);{var v=l=>{var m=fe(),P=w(m);le(P,{});var S=g(P,2),_=d(S);de(()=>ge(_,`downloading llm... ${s(k)??""}%`)),n(l,m)},L=l=>{var m=H(),P=w(m);{var S=_=>{var se=me();n(_,se)};b(P,_=>{s(t)==="unavailable"&&_(S)},!0)}n(l,m)};b(o,l=>{s(t)==="downloading"?l(v):l(L,!1)},!0)}n(e,a)};b(z,e=>{s(t)==="downloadable"?e(Y):e(Z,!1)})}var V=g(z,2),ee=g(d(V),2),ae=d(ee);{let e=T(J);q(ae,{get checked(){return s(e)},onChange:A})}n(x,$),oe()}export{xe as default};
