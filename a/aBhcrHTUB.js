import{p as de,u as pe,v as fe,b as J,w as ge,x as M,g as s,o as _e,a as n,f as i,j as v,c as l,i as a,m as ye,L as N,y as O,n as h,r as ue,H as he,z as D,s as d,e as me,d as be,I as Y,t as Ae,q as Ke,V as Ce,B as G,A as Q,P as R}from"./aDxdVuYxT.js";import{g as ke}from"./a9q_jSmK4.js";import{g as we}from"./aBEGDcNQV.js";var xe=i('<p class="b p-78vibc">Loading access keys</p>'),Pe=i('<p class="b p-78vibc">Confirming</p>'),De=i('<button class="f p-78vibc"><!> <!></button>'),$e=i('<li class="p-78vibc"><div class="c p-78vibc"><div><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper></div> <div class="d p-78vibc"> </div></div> <div class="e p-78vibc"><!></div></li>'),He=i('<p class="b g p-78vibc">Error deleting access key</p>'),Se=i('<div class="h p-78vibc"><!></div>'),Te=i('<p class="b p-78vibc">You have reached the maximum number of access keys.</p>'),je=i('<!> <ul class="p-78vibc"></ul> <!> <!>',1),Ee=i('<p class="b g p-78vibc">Something went wrong</p> <div class="h p-78vibc"><!></div>',1),Le=i('<div class="a p-78vibc"><!></div>');function Ie(U,z){de(z,!0);const{createHandleClickDialogPage:W,createDialogPageHref:X}=pe(),{blockDialog:B}=fe();let r=J("loadingAccessKeys"),m=J(ge([]));M(()=>{B(s(r)==="loadingAccessKeys"||s(r)==="confirmingDeleteAccessKey")}),_e(()=>()=>{B(!1)}),M(()=>{if(!z.hidden&&s(r)==="successAccessKeys"||s(r)==="loadingAccessKeys"){const c=new AbortController;return(async()=>{try{const o=await fetch("/api/credentials",{method:"POST",signal:c.signal});if(!o.ok)throw new Error("Failed to fetch access keys");const p=await o.json();n(m,p.credentials||[],!0),n(r,"successAccessKeys")}catch{n(r,"errorAccessKeys")}})(),()=>{c.abort()}}});const Z=async c=>{n(r,"confirmingDeleteAccessKey");try{const o=await ke(),p=await we({challenge:o});if(!(await fetch("/api/deleteCredential",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({challenge:o,id:c,confirmCredential:p.credentialData})})).ok)throw new Error("Failed to add access key");n(r,"loadingAccessKeys")}catch{n(r,"errorDeleteAccessKey");return}};var F=Le(),ee=l(F);{var se=c=>{N(c,{children:(o,p)=>{var b=xe();a(o,b)},$$slots:{default:!0}})},ae=c=>{var o=O(),p=h(o);{var b=f=>{N(f,{children:(A,I)=>{var $=Pe();a(A,$)},$$slots:{default:!0}})},re=f=>{var A=O(),I=h(A);{var $=g=>{var u=je(),K=h(u);he(K,{children:(e,t)=>{var y=D("Access Keys");a(e,y)}});var C=d(K,2);me(C,21,()=>s(m),e=>e.id,(e,t)=>{var y=$e(),w=l(y),x=l(w),P=l(x);be(P,()=>({"--size":"20px"})),Y(P.lastChild,{name:"key"});var V=d(x,2),j=l(V),ce=d(w,2),oe=l(ce);{var ie=E=>{var L=De();L.__click=()=>Z(s(t).id);var q=l(L);Y(q,{name:"close"});var le=d(q,2);Ce(le,{children:(ne,Oe)=>{var ve=D("delete access key");a(ne,ve)}}),a(E,L)};v(oe,E=>{s(m).length>1&&E(ie)})}Ae(()=>Ke(j,s(t).name)),a(e,y)});var _=d(C,2);{var k=e=>{var t=He();a(e,t)};v(_,e=>{s(r)==="errorDeleteAccessKey"&&e(k)})}var H=d(_,2);{var S=e=>{var t=Se(),y=l(t);{let w=Q(()=>X(R.ConfirmAccessKey)),x=Q(()=>W(R.ConfirmAccessKey));G(y,{element:"a",get href(){return s(w)},get onClick(){return s(x)},children:(P,V)=>{var j=D("Add access key");a(P,j)},$$slots:{default:!0}})}a(e,t)},T=e=>{var t=Te();a(e,t)};v(H,e=>{s(m).length<5?e(S):e(T,!1)})}a(g,u)},te=g=>{var u=O(),K=h(u);{var C=_=>{var k=Ee(),H=d(h(k),2),S=l(H);G(S,{onClick:()=>{n(r,"loadingAccessKeys")},children:(T,e)=>{var t=D("Try Again");a(T,t)},$$slots:{default:!0}}),a(_,k)};v(K,_=>{s(r)==="errorAccessKeys"&&_(C)},!0)}a(g,u)};v(I,g=>{s(r)==="successAccessKeys"||s(r)==="errorDeleteAccessKey"?g($):g(te,!1)},!0)}a(f,A)};v(p,f=>{s(r)==="confirmingDeleteAccessKey"?f(b):f(re,!1)},!0)}a(c,o)};v(ee,c=>{s(r)==="loadingAccessKeys"?c(se):c(ae,!1)})}a(U,F),ye()}ue(["click"]);export{Ie as default};
