import{p as R,n as q,A as J,z as M,h as A,r as N,q as V,u as W,g as u,o as F,f as m,i as b,c as y,d as s,j as G,k as g,y as P,U as I,H as w,x as h,s as U,L as Q,v as X,l as Y,B as Z}from"./aC8NhpE_b.js";import{e as ee}from"./aCpa8lgv9.js";import{c as te,b as ae,a as re}from"./abA9hIFUQ.js";import{g as ne}from"./a9q_jSmK4.js";var a=(r=>(r[r.Signup=0]="Signup",r[r.SignupError=1]="SignupError",r))(a||{}),se=m('<div class="container svelte-apkzbu"><!> <!></div>'),oe=m('<div class="container svelte-apkzbu"><!> <!></div>'),ie=m('<div class="block svelte-apkzbu"><!></div>');function de(r,k){R(k,!0);const{clearDialogPages:$}=q(),{getAccount:B,initCloudAccount:K}=J(),{getAppLocation:D,replace:E}=M();let z=P(()=>D().searchParams),T=P(B),_=A(""),o=A(N(a.Signup));const{blockDialog:S}=V(),C=async()=>{g(o,a.Signup,!0);try{const e=await ne(),t=crypto.getRandomValues(new Uint8Array(32)),i=await te({challenge:e,clientKey:t}),c=await fetch("/api/signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(c.status!==200){g(o,a.SignupError,!0);return}const n=await c.json(),p=u(T)===void 0,{encryptedClientKey:l}=await ee({clientKey:t,serverKey:new Uint8Array(ae(n.serverKey))});if(I(),await K({encryptedClientKey:re(l)}),S(!1),p)$();else{let d=u(z).get("retPath")||"";d&&g(_,d,!0),E(u(_)||"/")}}catch{g(o,a.SignupError,!0)}};W(()=>{S(u(o)===a.Signup)}),F(()=>{C()});var x=ie(),j=y(x);{var H=e=>{var t=se(),i=y(t);w(i,{children:(n,p)=>{var l=h("signup");s(n,l)}});var c=U(i,2);Q(c,{}),s(e,t)},L=e=>{var t=X(),i=Y(t);{var c=n=>{var p=oe(),l=y(p);w(l,{children:(v,O)=>{var f=h("error signup");s(v,f)}});var d=U(l,2);Z(d,{onClick:()=>C(),fullWidth:!0,children:(v,O)=>{var f=h("try again");s(v,f)},$$slots:{default:!0}}),s(n,p)};b(i,n=>{u(o)===a.SignupError&&n(c)},!0)}s(e,t)};b(j,e=>{u(o)===a.Signup?e(H):e(L,!1)})}s(r,x),G()}export{de as default};
