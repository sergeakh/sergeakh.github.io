import{p as $,Z as ee,_ as ie,G as se,o as te,n as ne,g as e,y as X,h as ae,$ as re,a0 as ce,u as K,j as G,f as le,r as U,m as B,c as q,S as j,s as J,t as de,d as Z,q as ue,a1 as me,a2 as ge,l as Q,J as fe,K as pe}from"./BqxBc7Lq.js";function he(z,t){$(t,!0);const O=ee(),{getIsKeyboardVisible:R}=ie();let i=se(t,"dialog",7);const A=X(R),f=3,C=50,s=5,T=.6,r=.3,S=.35,I=.95;let M=0,h=0,P=0,b=!1,m=!1,v=0,u=0,p=0;const y=()=>{M=0,h=0,b=!1,m=!1,v=0,u=0,p=0,P=0,d!==null&&(cancelAnimationFrame(d),d=null),w=null};let d=null,w=null;const _=o=>{i()&&(t.sidebarState!=="opened"&&t.sidebarState!=="closed"||(M=o.touches[0].clientX,h=o.touches[0].clientY,P=performance.now(),b=!0,m=!1))},V=o=>t.sidebarState==="closed"&&o>0||t.sidebarState==="closeSwiping"&&o>0||t.sidebarState==="opened"&&o<0||t.sidebarState==="openSwiping"&&o<0,H=()=>{if(i()){if(i().style.setProperty("--transition-timing","0s"),!i().open&&t.sidebarState==="closed")try{i().showModal(),i().offsetWidth}catch{return}t.onSwipe();try{const o=window.getComputedStyle(i()),a=o.transform||o.webkitTransform||"";if(u=i().offsetWidth,t.sidebarState==="closeSwiping"||t.sidebarState==="closed"?v=-u:(t.sidebarState==="openSwiping"||t.sidebarState==="opened")&&(v=0),a&&a!=="none")try{v=new DOMMatrix(a).m41}catch{}m=!0}catch{y()}}},Y=()=>{if(!i())return;const o=-(u*.3),a=-u;let c=0;const l=window.getComputedStyle(i()),E=l.transform||l.webkitTransform||"";if(E&&E!=="none")try{c=new DOMMatrix(E).m41}catch{c=0}const N=.25*Math.min(1,Math.max(0,(c-a)/(o-a)));i().style.setProperty("--backdrop-bg",`rgba(0, 0, 0, ${N})`)},n=()=>{if(d=null,!w||!b||!i()||e(A))return;const{x:o,y:a}=w;w=null;const c=o-M,l=a-h,E=Math.abs(c)>Math.abs(l),k=Math.abs(c)>f;if(!m)if(E&&k&&V(c))try{H()}catch{y();return}else return;let x=v+c*I;const N=-u,L=-(u*.3);let W=Math.max(N,Math.min(L,x));i().style.setProperty("--transition-timing","0s"),i().style.transform=`translate3d(${W}px, 0, 0)`,O.swipingRatio=(-1+Math.abs(W/u))/7*10,p=(W-v)/u*100,Y()},g=o=>{if(!b)return;const a=o.touches[0].clientX,c=o.touches[0].clientY;w={x:a,y:c},d===null&&(d=requestAnimationFrame(n)),m&&Math.abs(a-M)>Math.abs(c-h)&&o.preventDefault()},F=o=>{const a=Math.abs(o);if(a>=T)return s;if(a>=r){const c=(a-r)/(T-r);return C-c*(C-s)}else return C},oe=(o,a)=>{if(Math.abs(o)>=T)return S*.5;const l=Math.abs(p)/100;return a?S*Math.max(.5,1-l):S*Math.max(.5,l)},D=o=>{if(d!==null&&(cancelAnimationFrame(d),d=null),w=null,!b||!i()){y();return}if(!m){y();return}let a=0;if(o?.changedTouches?.[0]){const x=o.changedTouches[0].clientX,L=performance.now()-P;L>0&&(a=(x-M)/L)}const c=F(a);let l=null;t.sidebarState==="closeSwiping"?l=Math.abs(p)>c||a>r?"open":"close":t.sidebarState==="openSwiping"&&(l=Math.abs(p)>c||a<-r?"close":"open");const E=t.sidebarState==="closeSwiping"&&l==="open"||t.sidebarState==="openSwiping"&&l==="close",k=oe(a,E);O.duration=k-.02,i().style.setProperty("--transition-timing",`${k}s`),i().offsetWidth,i().style.transform="",l==="open"?t.onOpen():l==="close"&&t.onClose(),i()?.style.removeProperty("--backdrop-bg"),y()};te(()=>(document.addEventListener("touchstart",_,{passive:!0}),document.addEventListener("touchmove",g,{passive:!1}),document.addEventListener("touchend",D,{passive:!0}),document.addEventListener("touchcancel",D,{passive:!0}),()=>{document.removeEventListener("touchstart",_),document.removeEventListener("touchmove",g),document.removeEventListener("touchend",D),document.removeEventListener("touchcancel",D),d!==null&&cancelAnimationFrame(d)})),ne()}var Se=le('<dialog><div class="dialogInner svelte-1nov8pn"><!></div></dialog> <!> <!>',1);function ye(z,t){$(t,!0);const{getStackPages:O}=ae(),{getSidebarState:R,handleComputeState:i}=re();let A=350;const f=ee(),{isScrolling:C}=ce();let s=G(null),T=G(null),r=X(R);K(()=>{O().length>0&&i({type:"close"})});const S=()=>{t.blocked||(i({type:"close"}),f.swipingRatio=0,f.duration=.2)},I=()=>{t.blocked||i({type:"open"})},M=()=>{i({type:"opened"}),f.swipingRatio=-1,f.duration=.2},h=()=>{i({type:"closed"})},P=()=>{i({type:"swipe"})},b=n=>{n.preventDefault(),S()};te(()=>(e(s)?.addEventListener("close",h),e(s)?.addEventListener("cancel",b),()=>{e(s)?.removeEventListener("close",h),e(s)?.removeEventListener("cancel",b)}));const m=()=>{e(s)?.style.removeProperty("--transition-timing"),e(s)?.style.removeProperty("transform"),e(s)?.style.removeProperty("--backdrop-bg")},v=X(C);K(()=>{if(e(r),!!e(s))switch(e(r).type==="openSwiping"||e(r).type==="closeSwiping"?f.isSwiping=!0:f.isSwiping=!1,e(r).type){case"closeSwiping":{const n=setTimeout(()=>{S()},3e3);return()=>{clearTimeout(n)}}case"openSwiping":{const n=setTimeout(()=>{I()},3e3);return()=>{clearTimeout(n)}}case"opening":{e(s).open||e(s).showModal(),e(s).getBoundingClientRect();const n=setTimeout(()=>{m()},A+1),g=()=>{clearTimeout(n),m()};return e(s)?.addEventListener("transitionend",g,{once:!0}),M(),()=>{clearTimeout(n),e(s)?.removeEventListener("transitionend",g)}}case"closing":{const n=setTimeout(()=>{e(r).type==="closing"&&h()},A+1),g=()=>{clearTimeout(n),h()};return e(s)?.addEventListener("transitionend",g,{once:!0}),()=>{clearTimeout(n),e(s)?.removeEventListener("transitionend",g)}}case"closed":e(s)?.close(),m();break;case"opened":m();break}});var u=Se(),p=U(u),y=q(p),d=q(y);{var w=n=>{var g=ue(),F=U(g);me(F,()=>t.children),Z(n,g)};B(d,n=>{e(r).type!=="closed"&&n(w)})}j(y,n=>Q(T,n),()=>e(T)),j(p,n=>Q(s,n),()=>e(s));var _=J(p,2);{var V=n=>{ge(n,{get dialog(){return e(s)},get dialogInner(){return e(T)},onClose:S})};B(_,n=>{e(r).type==="opened"&&!t.blocked&&n(V)})}var H=J(_,2);{var Y=n=>{he(n,{onClose:S,onOpen:I,onSwipe:P,get sidebarState(){return e(r).type},get dialog(){return e(s)}})};B(H,n=>{(!e(v)&&e(r).type==="closed"||e(r).type==="opened"||e(r).type==="openSwiping"||e(r).type==="closeSwiping")&&!t.blocked&&n(Y)})}de(()=>fe(p,1,pe([{open:e(r).type==="opened",hidden:t.blocked,isAnimationOn:f.working&&(!f.isSwiping||!t.blocked)}]),"svelte-1nov8pn")),Z(z,u),ne()}export{ye as default};
