import{p as q,n as J,A as M,z as N,h as b,r as V,q as W,u as F,g as u,o as G,f as m,i as k,c as h,d as s,j as I,k as g,y as x,T as Q,H as A,x as y,s as w,L as X,v as Y,l as Z,B as ee}from"./BNp7-HqM.js";import{e as te}from"./Cpa8lgv9.js";import{c as ae,b as re,a as ne}from"./bA9hIFUQ.js";import{g as se}from"./9q_jSmK4.js";var a=(r=>(r[r.Signup=0]="Signup",r[r.SignupError=1]="SignupError",r))(a||{}),oe=m('<div class="container svelte-apkzbu"><!> <!></div>'),ie=m('<div class="container svelte-apkzbu"><!> <!></div>'),ce=m('<div class="block svelte-apkzbu"><!></div>');function ge(r,U){q(U,!0);const{clearStackPages:$}=J(),{getAccount:B,initCloudAccount:K}=M(),{getAppLocation:E,back:T,deleteSearchParam:z}=N();let j=x(()=>E().searchParams),D=x(B),S=b(""),o=b(V(a.Signup));const{blockDialog:_}=W(),C=async()=>{g(o,a.Signup,!0);try{const e=await se(),t=crypto.getRandomValues(new Uint8Array(32)),i=await ae({challenge:e,clientKey:t}),c=await fetch("/api/signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(c.status!==200){g(o,a.SignupError,!0);return}const n=await c.json(),p=u(D)===void 0,{encryptedClientKey:l}=await te({clientKey:t,serverKey:new Uint8Array(re(n.serverKey))});if(Q(),await K({encryptedClientKey:ne(l)}),_(!1),p)$();else{let d=u(j).get("retPath")||"";d&&(g(S,d,!0),z("retPath")),T({to:u(S)})}}catch{g(o,a.SignupError,!0)}};F(()=>{_(u(o)===a.Signup)}),G(()=>{C()});var P=ce(),H=h(P);{var L=e=>{var t=oe(),i=h(t);A(i,{children:(n,p)=>{var l=y("signup");s(n,l)}});var c=w(i,2);X(c,{}),s(e,t)},O=e=>{var t=Y(),i=Z(t);{var c=n=>{var p=ie(),l=h(p);A(l,{children:(v,R)=>{var f=y("error signup");s(v,f)}});var d=w(l,2);ee(d,{onClick:()=>C(),fullWidth:!0,children:(v,R)=>{var f=y("try again");s(v,f)},$$slots:{default:!0}}),s(n,p)};k(i,n=>{u(o)===a.SignupError&&n(c)},!0)}s(e,t)};k(H,e=>{u(o)===a.Signup?e(L):e(O,!1)})}s(r,P),I()}export{ge as default};
