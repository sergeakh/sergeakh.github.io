import{R as xe,p as Ce,v as Ae,J as Ie,u as $e,b as W,w as pe,K as Ne,x as Fe,g as t,o as ge,a as o,f as k,j as m,c as u,i as n,m as Me,n as L,s as _,S as fe,y as te,d as ue,I as me,L as We,r as ze,N as _e,B as Q,z as V,A as he,t as Be,k as He,l as je,G as ae}from"./aMCvnerna.js";const se=(b,d,g,i=new Set,c={},S=Date.now())=>{for(let r=0;r<b.children.length;r++){const l=b.children[r];if(l.tagName==="DT"){const h=l.querySelector(":scope > A"),z=l.querySelector(":scope > H3");if(h){const f=h.getAttribute("href"),v=Number(h.getAttribute("add_date"))*1e3||S+r,y=h.textContent||"unknown";if(!f)return g;const B=d.find($=>$.toLowerCase()==="bookmarks bar")?d.filter($=>$.toLowerCase()!=="bookmarks bar"):["other"];if(c[f])c[f].data.tags=[...new Set([...c[f].data.tags,...B])];else{const $={id:xe(),data:{link:{url:f,title:y},text:"",tags:B.length>0?B:[],updatedAt:v,createdAt:v,history:[]}};c[f]=$,g.push($)}}else if(z){const f=z.textContent?.trim();if(f&&z.nextElementSibling?.tagName==="DL"){const v=[...d];v.push(f);const y=z.nextElementSibling;i.has(y)||(i.add(y),se(y,v,g,i,c,S+r))}}}else l.tagName!=="DL"&&l.children.length>0&&(i.has(l)||(i.add(l),se(l,[...d],g,i,c,S+r)))}return g},Oe=async b=>{const d=await b.text(),c=new DOMParser().parseFromString(d,"text/html").querySelector("DL");return c?se(c,[],[]):[]},Je=()=>chrome;function Re(b){const d=[];return we(b,[],d),d}function we(b,d,g){for(const i of b){if(!i.url){const c=[...d,i.title].filter(Boolean);i.children&&we(i.children,c,g);continue}g.push({id:xe(),data:{link:{url:i.url,title:i.title||"unknown"},text:"",tags:d.length>0?[...d]:[],updatedAt:i.dateAdded||Date.now(),createdAt:i.dateAdded||Date.now(),history:[]}})}}const Ge=async()=>new Promise((b,d)=>{const g=Je();g.permissions.request({permissions:["bookmarks"]},async i=>{if(i)try{const c=await g.bookmarks.getTree(),S=Re(c).map(r=>(r.data.tags=r.data.tags.map(l=>{const h=l.trim();return h.toLocaleLowerCase()==="other bookmarks"?"other":h}).filter(l=>!(l===""||l.toLocaleLowerCase()==="bookmarks bar")),r));b(S)}catch(c){d(c)}else d(new Error("Permission denied for bookmarks"))})});var Ke=k(`<div class="b c p-1gxeqe6"><p>(browser bookmarks or a this app's file)</p></div>`),Ue=k('<div class="h p-1gxeqe6"><p class="i j p-1gxeqe6">Additional tags:</p> <!></div>'),Xe=k('<div class="k p-1gxeqe6"><!></div>'),Qe=k('<!> <div class="e p-1gxeqe6"><div class="f p-1gxeqe6"><button class="g p-1gxeqe6"><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper><span>Settings</span></button></div> <!> <!></div>',1),Ve=k("<p>(browser bookmarks or a this app's file)</p>"),Ye=k('<p class="i j p-1gxeqe6">Additional tags:</p> <div class="o p-1gxeqe6"><!></div>',1),Ze=k('<div class="p p-1gxeqe6"><!></div> <div role="button" tabindex="-1"><div tabindex="-1" class="q p-1gxeqe6"><p class="p-1gxeqe6">Drag and drop your file here</p> <p class="p-1gxeqe6">or</p></div></div>',1),et=k('<div class="l p-1gxeqe6"><div class="m p-1gxeqe6"><!> <div class="f p-1gxeqe6"><button class="g n p-1gxeqe6"><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper><span>Settings</span></button></div> <!></div> <!></div>'),tt=k('<!> <!> <input type="file" accept=".txt, .html" style="display: none;"/>',1),at=k('<div class="b c p-1gxeqe6"><p class="i r p-1gxeqe6">Loading...</p> <!></div>'),rt=k('<div class="b c p-1gxeqe6"><p class="i s p-1gxeqe6">Something went wrong</p></div> <div class="t p-1gxeqe6"><!></div>',1),st=k('<div class="b c p-1gxeqe6"><p class="i u p-1gxeqe6">Success!</p></div> <div class="t p-1gxeqe6"><!></div>',1),ot=k('<div class="a p-1gxeqe6"><!></div>');function lt(b,d){Ce(d,!0);const{blockDialog:g}=Ae(),{importNotes:i}=Ie(),{clearDialogPages:c}=$e();let S=W(pe("file")),r=W("idle"),l=W(null),h=W(!1),z=W(null),f=W(pe([])),v=W(!1),y=W(!1);const{checkMobileSize:B}=Ne(),$=()=>{c()};Fe(()=>{g(t(r)==="loading")}),ge(()=>(t(l)&&t(l).addEventListener("cancel",e=>{o(r,"idle"),e.preventDefault(),e.stopImmediatePropagation(),e.stopPropagation()}),()=>{g(!1)}));const ke=async e=>{const a=await e.text(),q=JSON.parse(a),H=[];if(!q.notes)throw new Error("Invalid import file format");for(const K of Object.values(q.notes))K&&H.push(K);return H},oe=async e=>{o(r,"loading");let a=[];try{if(e.name.endsWith(".txt"))a=await ke(e);else if(e.name.endsWith(".html"))a=await Oe(e);else throw new Error("Unsupported file format. Please upload a TXT or HTML file.");await le(a),o(r,"success")}catch(q){console.error("Error processing file:",q),o(r,"error")}},be=async e=>{const a=e.target;!a.files||a.files.length===0||await oe(a.files[0])},ne=()=>{t(l)?.click()},ye=e=>{e.preventDefault(),e.stopPropagation(),o(h,!0)},qe=e=>{e.preventDefault(),e.stopPropagation(),o(h,!1)},Te=e=>{e.preventDefault(),e.stopPropagation(),o(h,!0)},De=async e=>{if(e.preventDefault(),e.stopPropagation(),o(h,!1),!e.dataTransfer?.files||e.dataTransfer.files.length===0)return;const a=e.dataTransfer.files[0];if(a.type!=="application/json"&&a.type!=="text/html"){o(r,"error");return}await oe(a)},ie=e=>{o(f,e,!0)},le=async e=>{await i(e.map(a=>({...a,data:{...a.data,tags:Array.from(new Set([...a.data.tags||[],...t(f)])),history:(a.data.history||[]).map(q=>({...q,tags:Array.from(new Set([...q.tags||[],...t(f)]))}))}}))),await new Promise(a=>setTimeout(a,500))},de=e=>{e.key==="Escape"&&(document.activeElement instanceof HTMLInputElement&&document.activeElement.type==="text"||document.activeElement instanceof HTMLTextAreaElement)&&(t(v)&&o(v,!1),document.activeElement.blur(),e.preventDefault(),e.stopPropagation())},ce=async()=>{o(r,"loading");let e=[];try{e=await Ge(),await le(e),o(r,"success")}catch(a){console.error("Error importing bookmarks from browser:",a),o(r,"error")}};ge(()=>(document.addEventListener("keydown",de),()=>document.removeEventListener("keydown",de)));var ve=ot(),Se=u(ve);{var Le=e=>{var a=tt(),q=L(a);m(q,x=>{});var H=_(q,2);{var K=x=>{var j=Qe(),O=L(j);{var T=s=>{var p=Ke();n(s,p)};m(O,s=>{t(S)==="file"&&s(T)})}var P=_(O,2),E=u(P),C=u(E);C.__click=()=>{o(y,!t(y)),o(v,!1)};var D=u(C);ue(D,()=>({"--rotate":"30deg","--size":"20px"})),me(D.lastChild,{name:"settings"});var A=_(E,2);{var U=s=>{var p=Ue(),I=_(u(p),2);_e(I,{get selectedTags(){return t(f)},onChangeTags:ie,get shownTagInput(){return t(v)},set shownTagInput(R){o(v,R,!0)}}),n(s,p)};m(A,s=>{t(y)&&s(U)})}var J=_(A,2);{var Y=s=>{var p=Xe(),I=u(p);{var R=w=>{Q(w,{fullWidth:!0,onClick:ce,children:(M,ee)=>{var G=V("Import");n(M,G)},$$slots:{default:!0}})},Z=w=>{Q(w,{fullWidth:!0,onClick:ne,children:(M,ee)=>{var G=V("Select file");n(M,G)},$$slots:{default:!0}})};m(I,w=>{t(S)==="browser"?w(R):w(Z,!1)})}n(s,p)};m(J,s=>{t(v)||s(Y)})}n(x,j)},N=x=>{var j=et(),O=u(j),T=u(O);{var P=s=>{var p=Ve();n(s,p)};m(T,s=>{t(S)==="file"&&s(P)})}var E=_(T,2),C=u(E);C.__click=()=>{o(y,!t(y)),o(v,!1)};var D=u(C);ue(D,()=>({"--rotate":"30deg","--size":"20px"})),me(D.lastChild,{name:"settings"});var A=_(E,2);{var U=s=>{var p=Ye(),I=_(L(p),2),R=u(I);_e(R,{get selectedTags(){return t(f)},onChangeTags:ie,get shownTagInput(){return t(v)},set shownTagInput(Z){o(v,Z,!0)}}),n(s,p)};m(A,s=>{t(y)&&s(U)})}var J=_(O,2);{var Y=s=>{var p=te(),I=L(p);{var R=w=>{Q(w,{fullWidth:!0,onClick:ce,children:(M,ee)=>{var G=V("Import");n(M,G)},$$slots:{default:!0}})},Z=w=>{var M=Ze(),ee=L(M),G=u(ee);Q(G,{onClick:ne,children:(re,nt)=>{var Ee=V("Select File");n(re,Ee)},$$slots:{default:!0}});var X=_(ee,2);fe(X,re=>o(z,re),()=>t(z)),Be(()=>He(X,1,je({v:!0,w:t(h)}),"p-1gxeqe6")),ae("dragenter",X,ye),ae("dragover",X,Te),ae("dragleave",X,qe),ae("drop",X,De),n(w,M)};m(I,w=>{t(S)==="browser"?w(R):w(Z,!1)})}n(s,p)};m(J,s=>{t(v)||s(Y)})}n(x,j)};m(H,x=>{B()?x(K):x(N,!1)})}var F=_(H,2);F.__change=be,fe(F,x=>o(l,x),()=>t(l)),n(e,a)},Pe=e=>{var a=te(),q=L(a);{var H=N=>{var F=at(),x=_(u(F),2);We(x,{}),n(N,F)},K=N=>{var F=te(),x=L(F);{var j=T=>{var P=rt(),E=_(L(P),2),C=u(E);{let D=he(B);Q(C,{get fullWidth(){return t(D)},onClick:()=>{o(r,"idle")},children:(A,U)=>{var J=V("Try Again");n(A,J)},$$slots:{default:!0}})}n(T,P)},O=T=>{var P=te(),E=L(P);{var C=D=>{var A=st(),U=_(L(A),2),J=u(U);{let Y=he(B);Q(J,{get fullWidth(){return t(Y)},onClick:$,children:(s,p)=>{var I=V("Close");n(s,I)},$$slots:{default:!0}})}n(D,A)};m(E,D=>{t(r)==="success"&&D(C)},!0)}n(T,P)};m(x,T=>{t(r)==="error"?T(j):T(O,!1)},!0)}n(N,F)};m(q,N=>{t(r)==="loading"?N(H):N(K,!1)},!0)}n(e,a)};m(Se,e=>{t(r)==="idle"?e(Le):e(Pe,!1)})}n(b,ve),Me()}ze(["click","change"]);export{lt as default};
