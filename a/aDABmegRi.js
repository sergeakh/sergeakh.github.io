import{p as ee,q as ae,A as re,n as te,u as se,g as s,h as L,o as oe,f as y,i as w,c as p,d as e,j as ne,H as ie,x as A,s as $,k as c,B,E as ce,v as k,l as m,L as O}from"./aDGJydC1A.js";import{b as q,c as le,g as de}from"./aBEGDcNQV.js";import{g as ve,a as fe}from"./a9q_jSmK4.js";import{d as pe}from"./aCpa8lgv9.js";import{I as me}from"./adWMFoi5m.js";var ye=y('<form><!> <div class="b p-1smyw3s"><!></div> <div class="c p-1smyw3s"><!></div></form>'),ue=y('<p class="d p-1smyw3s">Adding the access key</p>'),ge=y('<p class="d p-1smyw3s">Confirming</p>'),he=y('<p class="d e p-1smyw3s">Something went wrong</p> <div class="c p-1smyw3s"><!></div>',1),_e=y('<p class="d p-1smyw3s">Confirm this operation with another key</p> <div class="c p-1smyw3s"><!></div>',1),we=y('<div class="a p-1smyw3s"><!></div>');function Pe(F,J){ee(J,!0);const{blockDialog:M}=ae(),{getAccount:U}=re(),{popDialogPage:z}=te();let a=L("idle"),C="",x=null,P=L("");se(()=>{M(s(a)==="confirmingAccessKey"||s(a)==="addingAccessKey")}),oe(()=>()=>{M(!1)});const j=async r=>{r.preventDefault(),c(a,"addingAccessKey");try{C=await ve();const t=await fe(),o=U();if(!o||!o.encryptedClientKey)throw new Error("No account found");const l=await pe({encryptedClientKey:q(o.encryptedClientKey),serverKey:q(t)});x=await le({challenge:C,clientKey:l}),c(a,"confirmAccessKey")}catch{c(a,"error");return}},G=async()=>{c(a,"confirmingAccessKey");try{const r=await de({challenge:C});if(!x)throw new Error("No credential data found");if(!(await fetch("/api/addCredential",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({challenge:C,name:s(P)||`key ${Math.floor(Math.random()*1e3)}`,newCredential:x,confirmCredential:r.credentialData})})).ok)throw new Error("Failed to add access key");z()}catch{c(a,"error");return}};var H=we(),Q=p(H);{var R=r=>{var t=ye(),o=p(t);ie(o,{children:(i,u)=>{var g=A("Enter a name for a key");e(i,g)}});var l=$(o,2),b=p(l);me(b,{placeholder:"key name",get value(){return s(P)},set value(i){c(P,i,!0)}});var n=$(l,2),d=p(n);B(d,{onClick:j,children:(i,u)=>{var g=A("Add key");e(i,g)},$$slots:{default:!0}}),ce("submit",t,j),e(r,t)},V=r=>{var t=k(),o=m(t);{var l=n=>{O(n,{children:(d,i)=>{var u=ue();e(d,u)},$$slots:{default:!0}})},b=n=>{var d=k(),i=m(d);{var u=v=>{O(v,{children:(K,I)=>{var D=ge();e(K,D)},$$slots:{default:!0}})},g=v=>{var K=k(),I=m(K);{var D=f=>{var h=he(),E=$(m(h),2),N=p(E);B(N,{onClick:()=>{c(a,"idle")},children:(_,S)=>{var T=A("Try Again");e(_,T)},$$slots:{default:!0}}),e(f,h)},W=f=>{var h=k(),E=m(h);{var N=_=>{var S=_e(),T=$(m(S),2),X=p(T);B(X,{onClick:G,children:(Y,Ce)=>{var Z=A("Confirm");e(Y,Z)},$$slots:{default:!0}}),e(_,S)};w(E,_=>{s(a)==="confirmAccessKey"&&_(N)},!0)}e(f,h)};w(I,f=>{s(a)==="error"?f(D):f(W,!1)},!0)}e(v,K)};w(i,v=>{s(a)==="confirmingAccessKey"?v(u):v(g,!1)},!0)}e(n,d)};w(o,n=>{s(a)==="addingAccessKey"?n(l):n(b,!1)},!0)}e(r,t)};w(Q,r=>{s(a)==="idle"?r(R):r(V,!1)})}e(F,H),ne()}export{Pe as default};
