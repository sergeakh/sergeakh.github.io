import{p as Q,Z as te,G as ne,o as $,n as ee,g as e,y as B,h as oe,_ as ie,$ as se,a0 as ae,u as z,j as K,f as re,r as G,m as W,c as U,S as q,s as j,t as ce,d as J,q as le,a1 as de,a2 as ue,l as Z,J as me,K as fe}from"./wczWkhft.js";function he(X,n){Q(n,!0);const{getIsKeyboardVisible:H}=te();let a=ne(n,"dialog",7);const b=B(H),L=3,x=50,O=5,i=.6,g=.3,c=.35,C=.95;let v=0,_=0,y=0,M=!1,p=!1,u=0,m=0,w=0;const f=()=>{v=0,_=0,M=!1,p=!1,u=0,m=0,w=0,y=0,l!==null&&(cancelAnimationFrame(l),l=null),T=null};let l=null,T=null;const A=o=>{a()&&(n.sidebarState!=="opened"&&n.sidebarState!=="closed"||(v=o.touches[0].clientX,_=o.touches[0].clientY,y=performance.now(),M=!0,p=!1))},P=o=>n.sidebarState==="closed"&&o>0||n.sidebarState==="closeSwiping"&&o>0||n.sidebarState==="opened"&&o<0||n.sidebarState==="openSwiping"&&o<0,N=()=>{if(a()){if(a().style.setProperty("--transition-timing","0s"),!a().open&&n.sidebarState==="closed")try{a().showModal(),a().offsetWidth}catch{return}n.onSwipe();try{const o=window.getComputedStyle(a()),s=o.transform||o.webkitTransform||"";if(m=a().offsetWidth,n.sidebarState==="closeSwiping"||n.sidebarState==="closed"?u=-m:(n.sidebarState==="openSwiping"||n.sidebarState==="opened")&&(u=0),s&&s!=="none")try{u=new DOMMatrix(s).m41}catch{}p=!0}catch{f()}}},Y=()=>{if(!a())return;const o=-(m*.27),s=-m;let r=0;const d=window.getComputedStyle(a()),E=d.transform||d.webkitTransform||"";if(E&&E!=="none")try{r=new DOMMatrix(E).m41}catch{r=0}const V=.25*Math.min(1,Math.max(0,(r-s)/(o-s)));a().style.setProperty("--backdrop-bg",`rgba(0, 0, 0, ${V})`)},F=()=>{if(l=null,!T||!M||!a()||e(b))return;const{x:o,y:s}=T;T=null;const r=o-v,d=s-_,E=Math.abs(r)>Math.abs(d),D=Math.abs(r)>L;if(!p)if(E&&D&&P(r))try{N()}catch{f();return}else return;if(!P(r))return;a().style.setProperty("--transition-timing","0s");let S=u+r*C;const V=-m,k=-(m*.27);S=Math.max(V,Math.min(k,S)),a().style.transform=`translate3d(${S}px, 0, 0)`,w=(S-u)/m*100,Y()},t=o=>{if(!M)return;const s=o.touches[0].clientX,r=o.touches[0].clientY;T={x:s,y:r},l===null&&(l=requestAnimationFrame(F)),p&&Math.abs(s-v)>Math.abs(r-_)&&o.preventDefault()},h=o=>{const s=Math.abs(o);if(s>=i)return O;if(s>=g){const r=(s-g)/(i-g);return x-r*(x-O)}else return x},R=(o,s)=>{if(Math.abs(o)>=i)return c*.5;const d=Math.abs(w)/100;return s?c*Math.max(.5,1-d):c*Math.max(.5,d)},I=o=>{if(l!==null&&(cancelAnimationFrame(l),l=null),T=null,!M||!a()){f();return}if(!p){f();return}let s=0;if(o?.changedTouches?.[0]){const S=o.changedTouches[0].clientX,k=performance.now()-y;k>0&&(s=(S-v)/k)}const r=h(s);let d=null;n.sidebarState==="closeSwiping"?d=Math.abs(w)>r||s>g?"open":"close":n.sidebarState==="openSwiping"&&(d=Math.abs(w)>r||s<-g?"close":"open");const E=n.sidebarState==="closeSwiping"&&d==="open"||n.sidebarState==="openSwiping"&&d==="close",D=R(s,E);a().style.setProperty("--transition-timing",`${D}s`),a().offsetWidth,a().style.transform="",d==="open"?n.onOpen():d==="close"&&n.onClose(),a()?.style.removeProperty("--backdrop-bg"),f()};$(()=>(document.addEventListener("touchstart",A,{passive:!0}),document.addEventListener("touchmove",t,{passive:!1}),document.addEventListener("touchend",I,{passive:!0}),document.addEventListener("touchcancel",I,{passive:!0}),()=>{document.removeEventListener("touchstart",A),document.removeEventListener("touchmove",t),document.removeEventListener("touchend",I),document.removeEventListener("touchcancel",I),l!==null&&cancelAnimationFrame(l)})),ee()}var ge=re('<dialog><div class="dialogInner svelte-1nov8pn"><!></div></dialog> <!> <!>',1);function be(X,n){Q(n,!0);const{getStackPages:H}=oe(),{getSidebarState:a,handleComputeState:b}=ie();let L=350;const x=se(),{isScrolling:O}=ae();let i=K(null),g=K(null),c=B(a);z(()=>{H().length>0&&b({type:"close"})});const C=()=>{n.blocked||b({type:"close"})},v=()=>{n.blocked||b({type:"open"})},_=()=>{b({type:"opened"})},y=()=>{b({type:"closed"})},M=()=>{b({type:"swipe"})},p=t=>{t.preventDefault(),C()};$(()=>(e(i)?.addEventListener("close",y),e(i)?.addEventListener("cancel",p),()=>{e(i)?.removeEventListener("close",y),e(i)?.removeEventListener("cancel",p)}));const u=()=>{e(i)?.style.removeProperty("--transition-timing"),e(i)?.style.removeProperty("transform"),e(i)?.style.removeProperty("--backdrop-bg")},m=B(O);z(()=>{if(e(c),!!e(i))switch(e(c).type){case"closeSwiping":{const t=setTimeout(()=>{C()},3e3);return()=>{clearTimeout(t)}}case"openSwiping":{const t=setTimeout(()=>{v()},3e3);return()=>{clearTimeout(t)}}case"opening":{e(i).open||e(i).showModal(),e(i).getBoundingClientRect();const t=setTimeout(()=>{u()},L+1),h=()=>{clearTimeout(t),u()};return e(i)?.addEventListener("transitionend",h,{once:!0}),_(),()=>{clearTimeout(t),e(i)?.removeEventListener("transitionend",h)}}case"closing":{const t=setTimeout(()=>{e(c).type==="closing"&&y()},L+1),h=()=>{clearTimeout(t),y()};return e(i)?.addEventListener("transitionend",h,{once:!0}),()=>{clearTimeout(t),e(i)?.removeEventListener("transitionend",h)}}case"closed":e(i)?.close(),u();break;case"opened":u();break}});var w=ge(),f=G(w),l=U(f),T=U(l);{var A=t=>{var h=le(),R=G(h);de(R,()=>n.children),J(t,h)};W(T,t=>{e(c).type!=="closed"&&t(A)})}q(l,t=>Z(g,t),()=>e(g)),q(f,t=>Z(i,t),()=>e(i));var P=j(f,2);{var N=t=>{ue(t,{get dialog(){return e(i)},get dialogInner(){return e(g)},onClose:C})};W(P,t=>{e(c).type==="opened"&&!n.blocked&&t(N)})}var Y=j(P,2);{var F=t=>{he(t,{onClose:C,onOpen:v,onSwipe:M,get sidebarState(){return e(c).type},get dialog(){return e(i)}})};W(Y,t=>{(!e(m)&&e(c).type==="closed"||e(c).type==="opened"||e(c).type==="openSwiping"||e(c).type==="closeSwiping")&&!n.blocked&&t(F)})}ce(()=>me(f,1,fe([{open:e(c).type==="opened",hidden:n.blocked,isAnimationOn:x.working&&(!x.isSwiping||!n.blocked)}]),"svelte-1nov8pn")),J(X,w),ee()}export{be as default};
