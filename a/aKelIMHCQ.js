import{R as Le,p as Ae,q as Ie,D as Fe,n as Ne,h as J,r as We,Q as Me,u as ze,g as t,o as be,f as _,i as y,c as n,d as a,j as Be,k as s,l as f,s as i,S as he,v as le,B as W,x as M,t as He,J as Oe,K as qe,E as oe,L as Je,w as Re,y as we,a as ye,I as je}from"./aDXCLHlg5.js";import{N as ke}from"./aCbSA9v8v.js";import"./aC_4Y42DO.js";const ce=(j,d,p,T=new Set,h={},r=Date.now())=>{for(let m=0;m<j.children.length;m++){const v=j.children[m];if(v.tagName==="DT"){const z=v.querySelector(":scope > A"),b=v.querySelector(":scope > H3");if(z){const l=z.getAttribute("href"),w=Number(z.getAttribute("add_date"))*1e3||r+m,k=z.textContent||"unknown";if(!l)return p;const A=d.find(D=>D.toLowerCase()==="bookmarks bar")?d.filter(D=>D.toLowerCase()!=="bookmarks bar"):["other"];if(h[l])h[l].data.tags=[...new Set([...h[l].data.tags,...A])];else{const D={id:Le(),data:{type:"note",url:l,name:k,text:"",tags:A.length>0?A:[],updatedAt:w,createdAt:w}};h[D.data.url]=D,p.push(D)}}else if(b){const l=b.textContent?.trim();if(l&&b.nextElementSibling?.tagName==="DL"){const w=[...d];w.push(l);const k=b.nextElementSibling;T.has(k)||(T.add(k),ce(k,w,p,T,h,r+m))}}}else v.tagName!=="DL"&&v.children.length>0&&(T.has(v)||(T.add(v),ce(v,[...d],p,T,h,r+m)))}return p},Ke=async j=>{const d=await j.text(),h=new DOMParser().parseFromString(d,"text/html").querySelector("DL");return h?ce(h,[],[]):[]},Qe=async(j,d)=>{const p=j.target;!p.files||p.files.length===0||await d(p.files[0])};var Ue=_(`<div class="top svelte-1gjle5b"><p class="message svelte-1gjle5b">Select a file to import your data</p> <p>(browser bookmarks or a this app's file)</p></div> <div class="mobileBottom svelte-1gjle5b"><div class="buttonContainer svelte-1gjle5b"><!></div></div>`,1),Ge=_('<p class="message svelte-1gjle5b">Select a file to import your data</p> <div class="desktopContainer svelte-1gjle5b"><div class="dropzoneButtonContainer svelte-1gjle5b"><!></div> <div role="button" tabindex="-1"><div tabindex="-1" class="dropzone-content svelte-1gjle5b"><p class="svelte-1gjle5b">Drag and drop your file here</p> <p class="svelte-1gjle5b">or</p></div></div></div>',1),Ve=_('<!> <input type="file" accept=".json, .html" style="display: none;"/>',1),Xe=_('<div class="top svelte-1gjle5b"><p class="message svelte-1gjle5b">Loading...</p> <!></div>'),Ye=_('<div class="top svelte-1gjle5b"><p class="message error svelte-1gjle5b">Something went wrong</p></div> <div class="buttonContainer svelte-1gjle5b"><!></div>',1),Ze=(j,d)=>s(d,!t(d)),et=_('<div class="tagsContainer svelte-1gjle5b"><p class="message message__tags svelte-1gjle5b">Additional tags:</p> <!></div>'),tt=_('<div class="buttonContainer svelte-1gjle5b"><!> <!></div>'),at=_('<div class="top svelte-1gjle5b"><p class="message svelte-1gjle5b">File loaded successfully</p></div> <div class="mobileBottom svelte-1gjle5b"><div class="settings svelte-1gjle5b"><button class="link svelte-1gjle5b"><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper><span>Settings</span></button></div> <!> <!></div>',1),st=(j,d)=>s(d,!t(d)),rt=_('<p class="message message__tags svelte-1gjle5b">Additional tags:</p> <div class="wrapNoteFormTags"><!></div>',1),lt=_('<div class="buttonContainer svelte-1gjle5b"><!> <!></div>'),ot=_('<p class="message svelte-1gjle5b">File loaded successfully</p> <div class="settings svelte-1gjle5b"><button class="link svelte-1gjle5b"><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper><span>Settings</span></button></div> <!> <!>',1),nt=_('<div class="top svelte-1gjle5b"><p class="message success svelte-1gjle5b">Notes imported successfully!</p></div> <div class="buttonContainer svelte-1gjle5b"><!></div>',1),it=_('<div class="block svelte-1gjle5b"><!></div>');function gt(j,d){Ae(d,!0);const{blockDialog:p}=Ie(),{importNotes:T}=Fe(),{clearStackPages:h}=Ne();let r=J("idle"),m=J(null),v=J(!1),z=J(null),b=J(We([])),l=J(!1),w=[],k=J(!1);const{checkMobileSize:A}=Me(),D=()=>{h()};ze(()=>{p(t(r)==="loading")}),be(()=>(t(m)&&t(m).addEventListener("cancel",e=>{e.preventDefault(),e.stopImmediatePropagation(),e.stopPropagation()}),()=>{p(!1)}));const xe=async e=>{const o=await e.text(),B=JSON.parse(o),R=[];if(!B.notes)throw new Error("Invalid import file format");for(const K of Object.values(B.notes))K&&R.push(K);return R},ge=async e=>{s(r,"loading");try{if(e.name.endsWith(".json"))w=await xe(e);else if(e.name.endsWith(".html"))w=await Ke(e);else throw new Error("Unsupported file format. Please upload a JSON or HTML file.");await new Promise(o=>setTimeout(o,500)),s(r,"success-loaded")}catch(o){console.error("Error processing file:",o),s(r,"error")}},pe=()=>{t(m)?.click()},Ce=e=>{e.preventDefault(),e.stopPropagation(),s(v,!0)},Te=e=>{e.preventDefault(),e.stopPropagation(),s(v,!1)},De=e=>{e.preventDefault(),e.stopPropagation(),s(v,!0)},Se=async e=>{if(e.preventDefault(),e.stopPropagation(),s(v,!1),!e.dataTransfer?.files||e.dataTransfer.files.length===0)return;const o=e.dataTransfer.files[0];if(o.type!=="application/json"&&o.type!=="text/html"){s(r,"error");return}await ge(o)},ue=e=>{s(b,e,!0)},fe=async()=>{s(r,"loading");try{await T(w.map(e=>{let o=e.data.draft?{...e.data.draft,tags:Array.from(new Set([...e.data.draft.tags||[],...t(b)]))}:void 0;return{...e,data:{...e.data,tags:Array.from(new Set([...e.data.tags||[],...t(b)])),draft:o}}})),await new Promise(e=>setTimeout(e,500))}catch{s(r,"error");return}s(r,"success")},_e=e=>{e.key==="Escape"&&(document.activeElement instanceof HTMLInputElement&&document.activeElement.type==="text"||document.activeElement instanceof HTMLTextAreaElement)&&(t(l)&&s(l,!1),document.activeElement.blur(),e.preventDefault(),e.stopPropagation())};be(()=>(document.addEventListener("keydown",_e),()=>document.removeEventListener("keydown",_e)));var me=it(),Pe=n(me);{var $e=e=>{var o=Ve(),B=f(o);{var R=c=>{var P=Ue(),Z=i(f(P),2),Q=n(Z),x=n(Q);W(x,{fullWidth:!0,onClick:pe,children:(g,I)=>{var U=M("Select File");a(g,U)},$$slots:{default:!0}}),a(c,P)},K=c=>{var P=Ge(),Z=i(f(P),2),Q=n(Z),x=n(Q);W(x,{onClick:pe,children:(I,U)=>{var ee=M("Select File");a(I,ee)},$$slots:{default:!0}});var g=i(Q,2);he(g,I=>s(z,I),()=>t(z)),He(()=>Oe(g,1,qe(["dropzone",{active:t(v)}]),"svelte-1gjle5b")),oe("dragenter",g,Ce),oe("dragover",g,De),oe("dragleave",g,Te),oe("drop",g,Se),a(c,P)};y(B,c=>{A()?c(R):c(K,!1)})}var S=i(B,2);S.__change=[Qe,ge],he(S,c=>s(m,c),()=>t(m)),a(e,o)},Ee=e=>{var o=le(),B=f(o);{var R=S=>{var c=Xe(),P=i(n(c),2);Je(P,{}),a(S,c)},K=S=>{var c=le(),P=f(c);{var Z=x=>{var g=Ye(),I=i(f(g),2),U=n(I);{let ee=we(A);W(U,{get fullWidth(){return t(ee)},onClick:()=>{s(r,"idle")},children:(F,G)=>{var te=M("Try Again");a(F,te)},$$slots:{default:!0}})}a(x,g)},Q=x=>{var g=le(),I=f(g);{var U=F=>{var G=le(),te=f(G);{var ne=$=>{var H=at(),V=i(f(H),2),O=n(V),q=n(O);q.__click=[Ze,k];var X=n(q);ye(X,()=>({"--rotate":"30deg","--size":"20px"})),je(X.lastChild,{name:"settings"});var Y=i(O,2);{var ie=u=>{var C=et(),N=i(n(C),2);ke(N,{get selectedTags(){return t(b)},onChangeTags:ue,get shownTagInput(){return t(l)},set shownTagInput(L){s(l,L,!0)}}),a(u,C)};y(Y,u=>{t(k)&&u(ie)})}var de=i(Y,2);{var E=u=>{var C=tt(),N=n(C);W(N,{withoutMinWidth:!0,fullWidth:!0,type:"secondary",onClick:()=>{s(r,"idle"),w=[],s(b,[],!0)},children:(se,re)=>{var ve=M("Cancel");a(se,ve)},$$slots:{default:!0}});var L=i(N,2);W(L,{fullWidth:!0,withoutMinWidth:!0,onClick:fe,children:(se,re)=>{var ve=M("Add notes");a(se,ve)},$$slots:{default:!0}}),a(u,C)};y(de,u=>{t(l)||u(E)})}a($,H)},ae=$=>{var H=ot(),V=i(f(H),2),O=n(V);O.__click=[st,k];var q=n(O);ye(q,()=>({"--rotate":"30deg","--size":"20px"})),je(q.lastChild,{name:"settings"});var X=i(V,2);{var Y=E=>{var u=rt(),C=i(f(u),2),N=n(C);ke(N,{get selectedTags(){return t(b)},onChangeTags:ue,get shownTagInput(){return t(l)},set shownTagInput(L){s(l,L,!0)}}),a(E,u)};y(X,E=>{t(k)&&E(Y)})}var ie=i(X,2);{var de=E=>{var u=lt(),C=n(u);W(C,{type:"secondary",fullWidth:!0,onClick:()=>{s(r,"idle"),w=[],s(b,[],!0)},children:(L,se)=>{var re=M("Cancel");a(L,re)},$$slots:{default:!0}});var N=i(C,2);W(N,{fullWidth:!0,onClick:fe,children:(L,se)=>{var re=M("Add notes");a(L,re)},$$slots:{default:!0}}),a(E,u)};y(ie,E=>{t(l)||E(de)})}a($,H)};y(te,$=>{A()?$(ne):$(ae,!1)})}a(F,G)},ee=F=>{var G=le(),te=f(G);{var ne=ae=>{var $=nt(),H=i(f($),2),V=n(H);{let O=we(A);W(V,{get fullWidth(){return t(O)},onClick:D,children:(q,X)=>{var Y=M("Close");a(q,Y)},$$slots:{default:!0}})}a(ae,$)};y(te,ae=>{t(r)==="success"&&ae(ne)},!0)}a(F,G)};y(I,F=>{t(r)==="success-loaded"?F(U):F(ee,!1)},!0)}a(x,g)};y(P,x=>{t(r)==="error"?x(Z):x(Q,!1)},!0)}a(S,c)};y(B,S=>{t(r)==="loading"?S(R):S(K,!1)},!0)}a(e,o)};y(Pe,e=>{t(r)==="idle"?e($e):e(Ee,!1)})}a(j,me),Be()}Re(["change","click"]);export{gt as default};
