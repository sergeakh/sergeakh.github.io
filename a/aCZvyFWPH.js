import{O as ht,p as Et,v as Pt,J as At,u as It,b as W,w as pt,K as $t,x as Ft,g as e,o as ft,a as r,f as k,j as g,c as v,i as s,m as Nt,n as C,s as m,Q as ut,y as et,d as gt,I as mt,L as Mt,r as Wt,N as wt,B as V,z as Y,A as _t,t as zt,k as Bt,l as Ht,G as at}from"./a012cnrGi.js";const st=(x,d,w,o=new Set,l={},y=Date.now())=>{for(let n=0;n<x.children.length;n++){const u=x.children[n];if(u.tagName==="DT"){const L=u.querySelector(":scope > A"),z=u.querySelector(":scope > H3");if(L){const p=L.getAttribute("href"),c=Number(L.getAttribute("add_date"))*1e3||y+n,b=L.textContent||"unknown";if(!p)return w;const B=d.find(I=>I.toLowerCase()==="bookmarks bar")?d.filter(I=>I.toLowerCase()!=="bookmarks bar"):["other"];if(l[p])l[p].data.tags=[...new Set([...l[p].data.tags,...B])];else{const I={id:ht(),data:{link:{url:p,title:b},text:"",tags:B.length>0?B:[],updatedAt:c,createdAt:c,history:[]}};l[p]=I,w.push(I)}}else if(z){const p=z.textContent?.trim();if(p&&z.nextElementSibling?.tagName==="DL"){const c=[...d];c.push(p);const b=z.nextElementSibling;o.has(b)||(o.add(b),st(b,c,w,o,l,y+n))}}}else u.tagName!=="DL"&&u.children.length>0&&(o.has(u)||(o.add(u),st(u,[...d],w,o,l,y+n)))}return w},Ot=async x=>{const d=await x.text(),l=new DOMParser().parseFromString(d,"text/html").querySelector("DL");return l?st(l,[],[]):[]},Jt=()=>browser;function Gt(x){const d=[];return kt(x,[],d),d}function kt(x,d,w){for(const o of x){if(!o.url){const l=[...d,o.title].filter(Boolean);o.children&&kt(o.children,l,w);continue}w.push({id:ht(),data:{link:{url:o.url,title:o.title||"unknown"},text:"",tags:d.length>0?[...d]:[],updatedAt:o.dateAdded||Date.now(),createdAt:o.dateAdded||Date.now(),history:[]}})}}const Kt=async()=>{const d=await Jt().bookmarks.getTree();return Gt(d).map(o=>(o.data.tags=o.data.tags.map(l=>{const y=l.trim();return y.toLocaleLowerCase()==="other bookmarks"?"other":y}).filter(l=>!(l===""||l.toLocaleLowerCase()==="bookmarks bar")),o))};var Qt=k("<p>(browser bookmarks or a this app's file)</p>"),Rt=k('<div class="g p-wkijq6"><p class="h i p-wkijq6">Additional tags:</p> <!></div>'),Ut=k('<div class="j p-wkijq6"><!></div>'),Xt=k('<div class="b p-wkijq6"><!></div> <div class="d p-wkijq6"><div class="e p-wkijq6"><button class="f p-wkijq6"><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper><span>Settings</span></button></div> <!> <!></div>',1),Vt=k("<p>(browser bookmarks or a this app's file)</p>"),Yt=k('<p class="h i p-wkijq6">Additional tags:</p> <div class="n p-wkijq6"><!></div>',1),Zt=k('<div class="o p-wkijq6"><!></div> <div role="button" tabindex="-1"><div tabindex="-1" class="p p-wkijq6"><p class="p-wkijq6">Drag and drop your file here</p> <p class="p-wkijq6">or</p></div></div>',1),te=k('<div class="k p-wkijq6"><div class="l p-wkijq6"><!> <div class="e p-wkijq6"><button class="f m p-wkijq6"><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper><span>Settings</span></button></div> <!></div> <!></div>'),ee=k('<!> <!> <input type="file" accept=".txt, .html" style="display: none;"/>',1),ae=k('<div class="b p-wkijq6"><p class="h q p-wkijq6">Loading...</p> <!></div>'),re=k('<div class="b p-wkijq6"><p class="h r p-wkijq6">Something went wrong</p></div> <div class="s p-wkijq6"><!></div>',1),se=k('<div class="b p-wkijq6"><p class="h t p-wkijq6">Success!</p></div> <div class="s p-wkijq6"><!></div>',1),oe=k('<div class="a p-wkijq6"><!></div>');function le(x,d){Et(d,!0);const{blockDialog:w}=Pt(),{importNotes:o}=At(),{clearDialogPages:l}=It();let y=W(pt("file")),n=W("idle"),u=W(null),L=W(!1),z=W(null),p=W(pt([])),c=W(!1),b=W(!1);const{checkMobileSize:B}=$t(),I=()=>{l()};Ft(()=>{w(e(n)==="loading")}),ft(()=>(e(u)&&e(u).addEventListener("cancel",t=>{r(n,"idle"),t.preventDefault(),t.stopImmediatePropagation(),t.stopPropagation()}),()=>{w(!1)}));const bt=async t=>{const a=await t.text(),j=JSON.parse(a),H=[];if(!j.notes)throw new Error("Invalid import file format");for(const X of Object.values(j.notes))X&&H.push(X);return H},ot=async t=>{r(n,"loading");let a=[];try{if(t.name.endsWith(".txt"))a=await bt(t);else if(t.name.endsWith(".html"))a=await Ot(t);else throw new Error("Unsupported file format. Please upload a TXT or HTML file.");await lt(a),r(n,"success")}catch{r(n,"error")}},xt=async t=>{const a=t.target;!a.files||a.files.length===0||await ot(a.files[0])},nt=()=>{e(u)?.click()},yt=t=>{t.preventDefault(),t.stopPropagation(),r(L,!0)},jt=t=>{t.preventDefault(),t.stopPropagation(),r(L,!1)},qt=t=>{t.preventDefault(),t.stopPropagation(),r(L,!0)},Tt=async t=>{if(t.preventDefault(),t.stopPropagation(),r(L,!1),!t.dataTransfer?.files||t.dataTransfer.files.length===0)return;const a=t.dataTransfer.files[0];if(a.type!=="application/json"&&a.type!=="text/html"){r(n,"error");return}await ot(a)},it=t=>{r(p,t,!0)},lt=async t=>{await o(t.map(a=>({...a,data:{...a.data,tags:Array.from(new Set([...a.data.tags||[],...e(p)])),history:(a.data.history||[]).map(j=>({...j,tags:Array.from(new Set([...j.tags||[],...e(p)]))}))}}))),await new Promise(a=>setTimeout(a,500))},dt=t=>{t.key==="Escape"&&(document.activeElement instanceof HTMLInputElement&&document.activeElement.type==="text"||document.activeElement instanceof HTMLTextAreaElement)&&(e(c)&&r(c,!1),document.activeElement.blur(),t.preventDefault(),t.stopPropagation())},ct=async()=>{r(n,"loading");let t=[];try{t=await Kt(),await lt(t),r(n,"success")}catch{r(n,"error")}};ft(()=>(document.addEventListener("keydown",dt),()=>document.removeEventListener("keydown",dt)));var vt=oe(),Dt=v(vt);{var Lt=t=>{var a=ee(),j=C(a);g(j,_=>{});var H=m(j,2);{var X=_=>{var O=Xt(),J=C(O),q=v(J);{var E=i=>{var h=Qt();s(i,h)};g(q,i=>{e(y)==="file"&&i(E)})}var N=m(J,2),P=v(N),T=v(P);T.__click=()=>{r(b,!e(b)),r(c,!1)};var A=v(T);gt(A,()=>({"--rotate":"30deg","--size":"20px"})),mt(A.lastChild,{name:"settings"});var G=m(P,2);{var K=i=>{var h=Rt(),Q=m(v(h),2);wt(Q,{get selectedTags(){return e(p)},onChangeTags:it,get shownTagInput(){return e(c)},set shownTagInput(R){r(c,R,!0)}}),s(i,h)};g(G,i=>{e(b)&&i(K)})}var Z=m(G,2);{var f=i=>{var h=Ut(),Q=v(h);{var R=D=>{V(D,{fullWidth:!0,onClick:ct,children:(U,tt)=>{var S=Y("From browser");s(U,S)},$$slots:{default:!0}})},M=D=>{V(D,{fullWidth:!0,onClick:nt,children:(U,tt)=>{var S=Y("Select file");s(U,S)},$$slots:{default:!0}})};g(Q,D=>{e(y)==="browser"?D(R):D(M,!1)})}s(i,h)};g(Z,i=>{e(c)||i(f)})}s(_,O)},$=_=>{var O=te(),J=v(O),q=v(J);{var E=f=>{var i=Vt();s(f,i)};g(q,f=>{e(y)==="file"&&f(E)})}var N=m(q,2),P=v(N);P.__click=()=>{r(b,!e(b)),r(c,!1)};var T=v(P);gt(T,()=>({"--rotate":"30deg","--size":"20px"})),mt(T.lastChild,{name:"settings"});var A=m(N,2);{var G=f=>{var i=Yt(),h=m(C(i),2),Q=v(h);wt(Q,{get selectedTags(){return e(p)},onChangeTags:it,get shownTagInput(){return e(c)},set shownTagInput(R){r(c,R,!0)}}),s(f,i)};g(A,f=>{e(b)&&f(G)})}var K=m(J,2);{var Z=f=>{var i=et(),h=C(i);{var Q=M=>{V(M,{fullWidth:!0,onClick:ct,children:(D,U)=>{var tt=Y("From browser");s(D,tt)},$$slots:{default:!0}})},R=M=>{var D=Zt(),U=C(D),tt=v(U);V(tt,{onClick:nt,children:(rt,ne)=>{var Ct=Y("Select File");s(rt,Ct)},$$slots:{default:!0}});var S=m(U,2);ut(S,rt=>r(z,rt),()=>e(z)),zt(()=>Bt(S,1,Ht({u:!0,v:e(L)}),"p-wkijq6")),at("dragenter",S,yt),at("dragover",S,qt),at("dragleave",S,jt),at("drop",S,Tt),s(M,D)};g(h,M=>{e(y)==="browser"?M(Q):M(R,!1)})}s(f,i)};g(K,f=>{e(c)||f(Z)})}s(_,O)};g(H,_=>{B()?_(X):_($,!1)})}var F=m(H,2);F.__change=xt,ut(F,_=>r(u,_),()=>e(u)),s(t,a)},St=t=>{var a=et(),j=C(a);{var H=$=>{var F=ae(),_=m(v(F),2);Mt(_,{}),s($,F)},X=$=>{var F=et(),_=C(F);{var O=q=>{var E=re(),N=m(C(E),2),P=v(N);{let T=_t(B);V(P,{get fullWidth(){return e(T)},onClick:()=>{r(n,"idle")},children:(A,G)=>{var K=Y("Try Again");s(A,K)},$$slots:{default:!0}})}s(q,E)},J=q=>{var E=et(),N=C(E);{var P=T=>{var A=se(),G=m(C(A),2),K=v(G);{let Z=_t(B);V(K,{get fullWidth(){return e(Z)},onClick:I,children:(f,i)=>{var h=Y("Close");s(f,h)},$$slots:{default:!0}})}s(T,A)};g(N,T=>{e(n)==="success"&&T(P)},!0)}s(q,E)};g(_,q=>{e(n)==="error"?q(O):q(J,!1)},!0)}s($,F)};g(j,$=>{e(n)==="loading"?$(H):$(X,!1)},!0)}s(t,a)};g(Dt,t=>{e(n)==="idle"?t(Lt):t(St,!1)})}s(x,vt),Nt()}Wt(["click","change"]);export{le as default};
