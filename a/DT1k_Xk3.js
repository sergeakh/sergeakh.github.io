import{Q as xe,p as De,i as Te,C as Ce,z as Se,j as W,k as Ee,R as Le,u as Pe,g as t,o as pe,f as y,m as x,c as p,d as a,n as $e,l as s,q as K,r as j,s as f,B as Q,w as U,S as ne,t as Ae,J as Ie,K as Fe,D as X,L as Ne,v as ze,y as ie}from"./CIhqqm6N.js";import{N as Me}from"./DdyZLl37.js";import"./Bd6Vds6r.js";const de=(D,u,c,T=new Set,_={},r=Date.now())=>{for(let i=0;i<D.children.length;i++){const d=D.children[i];if(d.tagName==="DT"){const $=d.querySelector(":scope > A"),E=d.querySelector(":scope > H3");if($){const n=$.getAttribute("href"),v=Number($.getAttribute("add_date"))*1e3||r+i,w=$.textContent||"unknown";if(!n)return c;const O=u.find(C=>C.toLowerCase()==="bookmarks bar")?u.filter(C=>C.toLowerCase()!=="bookmarks bar"):["other"];if(_[n])_[n].data.tags=[...new Set([..._[n].data.tags,...O])];else{const C={id:xe(),data:{type:"note",url:n,name:w,text:"",tags:O.length>0?O:[],updatedAt:v,createdAt:v}};_[C.data.url]=C,c.push(C)}}else if(E){const n=E.textContent?.trim();if(n&&E.nextElementSibling?.tagName==="DL"){const v=[...u];v.push(n);const w=E.nextElementSibling;T.has(w)||(T.add(w),de(w,v,c,T,_,r+i))}}}else d.tagName!=="DL"&&d.children.length>0&&(T.has(d)||(T.add(d),de(d,[...u],c,T,_,r+i)))}return c},Be=async D=>{const u=await D.text(),_=new DOMParser().parseFromString(u,"text/html").querySelector("DL");return _?de(_,[],[]):[]},fe=async(D,u)=>{const c=D.target;!c.files||c.files.length===0||await u(c.files[0])};var He=y(`<div class="top svelte-1gjle5b"><p class="message svelte-1gjle5b">Select a file to import your data</p> <p>(browser bookmarks or a this app's file)</p></div> <div class="mobileBottom svelte-1gjle5b"><!></div> <input type="file" accept=".json, .html" style="display: none;"/>`,1),We=y('<p class="message svelte-1gjle5b">Select a file to import your data</p> <div class="desktopContainer svelte-1gjle5b"><div class="dropzoneButtonContainer svelte-1gjle5b"><!></div> <div role="button" tabindex="-1"><div tabindex="-1" class="dropzone-content svelte-1gjle5b"><p class="svelte-1gjle5b">Drag and drop your file here</p> <p class="svelte-1gjle5b">or</p></div> <input type="file" accept=".json, .html" style="display: none;"/></div></div>',1),Oe=y('<div class="top svelte-1gjle5b"><p class="message svelte-1gjle5b">Loading...</p> <!></div>'),qe=y('<div class="top svelte-1gjle5b"><p class="message error svelte-1gjle5b">Something went wrong</p></div> <div class="buttonContainer svelte-1gjle5b"><!></div>',1),Je=(D,u)=>{s(u,!0)},Re=y('<p class="message message__tags svelte-1gjle5b">You can add additional tags to loaded notes</p> <div class="addTagsButtonContainer svelte-1gjle5b"><button class="addTagsButton svelte-1gjle5b">add tags</button></div>',1),Ke=y('<p class="message message__tags svelte-1gjle5b">Additional tags:</p>'),Qe=y('<div class="tagsContainer svelte-1gjle5b"><!> <!></div>'),Ue=y('<div class="buttonContainer svelte-1gjle5b"><!></div>'),Ye=y('<div class="top svelte-1gjle5b"><p class="message success svelte-1gjle5b">File loaded!</p> <!></div> <div class="bottom svelte-1gjle5b"><!> <!></div>',1),Ge=y('<div class="top svelte-1gjle5b"><p class="message success svelte-1gjle5b">Notes imported successfully!</p></div> <div class="buttonContainer svelte-1gjle5b"><!></div>',1),Ve=y('<div class="block svelte-1gjle5b"><!></div>');function tt(D,u){De(u,!0);const{blockDialog:c}=Te(),{importNotes:T}=Ce(),{closeDialogStack:_}=Se();let r=W("idle"),i=W(null),d=W(!1),$=W(null),E=[],n=W(Ee([])),v=W(!1);const{checkMobileSize:w}=Le(),O=()=>{_()};Pe(()=>{c(t(r)==="loading")}),pe(()=>(t(i)&&t(i).addEventListener("cancel",e=>{e.preventDefault(),e.stopImmediatePropagation(),e.stopPropagation()}),()=>{c(!1)}));const C=async e=>{const l=await e.text(),A=JSON.parse(l);if(!A.notes)throw new Error("Invalid import file format");for(const I of Object.values(A.notes))I&&E.push(I)},Z=async e=>{s(r,"loading");try{if(e.name.endsWith(".json"))await C(e);else if(e.name.endsWith(".html")){const l=await Be(e);E.push(...l)}else throw new Error("Unsupported file format. Please upload a JSON or HTML file.");await new Promise(l=>setTimeout(l,500)),s(r,"success-loading-file")}catch{s(r,"error")}},ve=()=>{t(i)?.click()},ue=e=>{e.preventDefault(),e.stopPropagation(),s(d,!0)},me=e=>{e.preventDefault(),e.stopPropagation(),s(d,!1)},_e=e=>{e.preventDefault(),e.stopPropagation(),s(d,!0)},be=async e=>{if(e.preventDefault(),e.stopPropagation(),s(d,!1),!e.dataTransfer?.files||e.dataTransfer.files.length===0)return;const l=e.dataTransfer.files[0];if(l.type!=="application/json"&&l.type!=="text/html"){s(r,"error");return}await Z(l)},he=e=>{s(n,e,!0)},je=async()=>{s(r,"loading");try{await T(E.map(e=>({...e,data:{...e.data,tags:Array.from(new Set([...e.data.tags||[],...t(n)]))}}))),await new Promise(e=>setTimeout(e,500)),s(r,"success")}catch{s(r,"error")}},ce=e=>{e.key==="Escape"&&(document.activeElement instanceof HTMLInputElement&&document.activeElement.type==="text"||document.activeElement instanceof HTMLTextAreaElement)&&(t(v)&&s(v,!1),document.activeElement.blur(),e.preventDefault(),e.stopPropagation())};pe(()=>(document.addEventListener("keydown",ce),()=>document.removeEventListener("keydown",ce)));var ge=Ve(),ye=p(ge);{var we=e=>{var l=K(),A=j(l);{var I=g=>{var b=He(),L=f(j(b),2),F=p(L);Q(F,{fullWidth:!0,onClick:ve,children:(o,S)=>{var h=U("Select File");a(o,h)},$$slots:{default:!0}});var N=f(L,2);N.__change=[fe,Z],ne(N,o=>s(i,o),()=>t(i)),a(g,b)},ee=g=>{var b=We(),L=f(j(b),2),F=p(L),N=p(F);Q(N,{onClick:ve,children:(h,Y)=>{var q=U("Select File");a(h,q)},$$slots:{default:!0}});var o=f(F,2),S=f(p(o),2);S.__change=[fe,Z],ne(S,h=>s(i,h),()=>t(i)),ne(o,h=>s($,h),()=>t($)),Ae(()=>Ie(o,1,Fe(["dropzone",{active:t(d)}]),"svelte-1gjle5b")),X("dragenter",o,ue),X("dragover",o,_e),X("dragleave",o,me),X("drop",o,be),a(g,b)};x(A,g=>{w()?g(I):g(ee,!1)})}a(e,l)},ke=e=>{var l=K(),A=j(l);{var I=g=>{var b=Oe(),L=f(p(b),2);Ne(L,{}),a(g,b)},ee=g=>{var b=K(),L=j(b);{var F=o=>{var S=qe(),h=f(j(S),2),Y=p(h);{let q=ie(w);Q(Y,{get fullWidth(){return t(q)},onClick:()=>{s(r,"idle")},children:(P,z)=>{var M=U("Try Again");a(P,M)},$$slots:{default:!0}})}a(o,S)},N=o=>{var S=K(),h=j(S);{var Y=P=>{var z=Ye(),M=j(z),te=f(p(M),2);{var J=m=>{var k=Re(),B=f(j(k),2),R=p(B);R.__click=[Je,v],a(m,k)};x(te,m=>{t(n).length===0&&!t(v)&&m(J)})}var G=f(M,2),V=p(G);{var ae=m=>{var k=Qe(),B=p(k);{var R=H=>{var le=Ke();a(H,le)};x(B,H=>{t(n).length>0&&H(R)})}var oe=f(B,2);Me(oe,{get selectedTags(){return t(n)},onChangeTags:he,get shownTagInput(){return t(v)},set shownTagInput(H){s(v,H,!0)}}),a(m,k)};x(V,m=>{(t(n).length>0||t(v))&&m(ae)})}var se=f(V,2);{var re=m=>{var k=Ue(),B=p(k);{let R=ie(w);Q(B,{get fullWidth(){return t(R)},onClick:je,children:(oe,H)=>{var le=U("Add notes");a(oe,le)},$$slots:{default:!0}})}a(m,k)};x(se,m=>{t(v)||m(re)})}a(P,z)},q=P=>{var z=K(),M=j(z);{var te=J=>{var G=Ge(),V=f(j(G),2),ae=p(V);{let se=ie(w);Q(ae,{get fullWidth(){return t(se)},onClick:O,children:(re,m)=>{var k=U("Close");a(re,k)},$$slots:{default:!0}})}a(J,G)};x(M,J=>{t(r)==="success"&&J(te)},!0)}a(P,z)};x(h,P=>{t(r)==="success-loading-file"?P(Y):P(q,!1)},!0)}a(o,S)};x(L,o=>{t(r)==="error"?o(F):o(N,!1)},!0)}a(g,b)};x(A,g=>{t(r)==="loading"?g(I):g(ee,!1)},!0)}a(e,l)};x(ye,e=>{t(r)==="idle"?e(we):e(ke,!1)})}a(D,ge),$e()}ze(["change","click"]);export{tt as default};
