import{R as re,p as oe,i as ne,C as le,z as ie,S as ce,u as de,g as c,j as z,o as ve,f as k,m as I,c as y,d as s,n as pe,s as j,r as D,q as B,B as A,w as M,T as J,l as d,t as fe,K as ge,M as ue,D as N,L as me,v as _e}from"./DMKohntk.js";const R=(x,u,r,m=new Set,v={})=>{for(const t of x.children)if(t.tagName==="DT"){const p=t.querySelector(":scope > A"),_=t.querySelector(":scope > H3");if(p){const f=p.getAttribute("href"),S=p.textContent||"unknown";if(!f)return r;const h=u.find(b=>b.toLowerCase()==="bookmarks bar")?u.filter(b=>b.toLowerCase()!=="bookmarks bar"):["other"];if(v[f])v[f].data.tags=[...new Set([...v[f].data.tags,...h])];else{const b={id:re(),data:{url:f,name:S,text:"",tags:h.length>0?h:[],updatedAt:Date.now(),createdAt:Date.now()}};v[b.data.url]=b,r.push(b)}}else if(_){const f=_.textContent?.trim();if(f&&_.nextElementSibling?.tagName==="DL"){const S=[...u];S.push(f);const h=_.nextElementSibling;m.has(h)||(m.add(h),R(h,S,r,m,v))}}}else t.tagName!=="DL"&&t.children.length>0&&(m.has(t)||(m.add(t),R(t,[...u],r,m,v)));return r},he=async x=>{const u=await x.text(),v=new DOMParser().parseFromString(u,"text/html").querySelector("DL");return v?R(v,[],[]):[]},U=async(x,u)=>{const r=x.target;!r.files||r.files.length===0||await u(r.files[0])};var be=k('<div class="mobileContainer svelte-1gjle5b"><!></div> <input type="file" accept=".json, .html" style="display: none;"/>',1),we=k('<div class="desktopContainer svelte-1gjle5b"><div class="desktopButtonContainer svelte-1gjle5b"><!></div> <div role="button" tabindex="-1"><div tabindex="-1" class="dropzone-content svelte-1gjle5b"><p class="svelte-1gjle5b">Drag and drop your file here</p> <p class="svelte-1gjle5b">or</p></div> <input type="file" accept=".json, .html" style="display: none;"/></div></div>'),De=k('<p class="message svelte-1gjle5b">Select a file to import your data</p> <!>',1),xe=k('<p class="message svelte-1gjle5b">Importing data...</p> <!>',1),ye=k('<p class="message success svelte-1gjle5b">Data imported successfully!</p> <div class="buttonContainer svelte-1gjle5b"><!></div>',1),je=k('<p class="message error svelte-1gjle5b">Something went wrong</p> <div class="buttonContainer svelte-1gjle5b"><!></div>',1),ke=k('<div class="content svelte-1gjle5b"><!></div>');function Pe(x,u){oe(u,!0);const{blockDialog:r}=ne(),{importNotes:m}=le(),{closeDialogStack:v}=ie();let t=z("idle"),p=z(null),_=z(!1),f=z(null);const{checkMobileSize:S}=ce(),h=()=>{v()};de(()=>{r(c(t)==="loading")}),ve(()=>(c(p)&&c(p).addEventListener("cancel",e=>{e.preventDefault(),e.stopImmediatePropagation(),e.stopPropagation()}),()=>{r(!1)}));const b=async e=>{const a=await e.text(),C=JSON.parse(a),P=[];if(!C.notes)throw new Error("Invalid import file format");for(const L of Object.values(C.notes))L&&P.push(L);await m(P)},O=async e=>{d(t,"loading");try{if(e.name.endsWith(".json"))await b(e);else if(e.name.endsWith(".html"))await m(await he(e));else throw new Error("Unsupported file format. Please upload a JSON or HTML file.");await new Promise(a=>setTimeout(a,500)),d(t,"success")}catch{d(t,"error")}},W=()=>{c(p)?.click()},G=e=>{e.preventDefault(),e.stopPropagation(),d(_,!0)},Q=e=>{e.preventDefault(),e.stopPropagation(),d(_,!1)},V=e=>{e.preventDefault(),e.stopPropagation(),d(_,!0)},X=async e=>{if(e.preventDefault(),e.stopPropagation(),d(_,!1),!e.dataTransfer?.files||e.dataTransfer.files.length===0)return;const a=e.dataTransfer.files[0];if(a.type!=="application/json"&&a.type!=="text/html"){d(t,"error");return}await O(a)};var K=ke(),Y=y(K);{var Z=e=>{var a=De(),C=j(D(a),2);{var P=o=>{var g=be(),w=D(g),F=y(w);A(F,{onClick:W,children:(n,i)=>{var T=M("Select File");s(n,T)},$$slots:{default:!0}});var l=j(w,2);l.__change=[U,O],J(l,n=>d(p,n),()=>c(p)),s(o,g)},L=o=>{var g=we(),w=y(g),F=y(w);A(F,{onClick:W,children:(i,T)=>{var $=M("Select File");s(i,$)},$$slots:{default:!0}});var l=j(w,2),n=j(y(l),2);n.__change=[U,O],J(n,i=>d(p,i),()=>c(p)),J(l,i=>d(f,i),()=>c(f)),fe(()=>ge(l,1,ue(["dropzone",{active:c(_)}]),"svelte-1gjle5b")),N("dragenter",l,G),N("dragover",l,V),N("dragleave",l,Q),N("drop",l,X),s(o,g)};I(C,o=>{S()?o(P):o(L,!1)})}s(e,a)},ee=e=>{var a=B(),C=D(a);{var P=o=>{var g=xe(),w=j(D(g),2);me(w,{}),s(o,g)},L=o=>{var g=B(),w=D(g);{var F=n=>{var i=ye(),T=j(D(i),2),$=y(T);A($,{onClick:h,children:(E,q)=>{var H=M("close");s(E,H)},$$slots:{default:!0}}),s(n,i)},l=n=>{var i=B(),T=D(i);{var $=E=>{var q=je(),H=j(D(q),2),te=y(H);A(te,{onClick:()=>{d(t,"idle")},children:(ae,Se)=>{var se=M("Try Again");s(ae,se)},$$slots:{default:!0}}),s(E,q)};I(T,E=>{c(t)==="error"&&E($)},!0)}s(n,i)};I(w,n=>{c(t)==="success"?n(F):n(l,!1)},!0)}s(o,g)};I(C,o=>{c(t)==="loading"?o(P):o(L,!1)},!0)}s(e,a)};I(Y,e=>{c(t)==="idle"?e(Z):e(ee,!1)})}s(x,K),pe()}_e(["change"]);export{Pe as default};
