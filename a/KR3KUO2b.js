import{Q as re,p as oe,i as ne,C as le,z as ie,R as ce,u as de,g as v,j as M,o as ve,f as C,m as N,c as k,d as o,n as pe,s as S,r as w,q as R,B as O,w as q,S as W,l as p,t as fe,J as ge,K as ue,D as H,L as me,v as _e}from"./B8Oe_0yK.js";const K=(x,u,n,m=new Set,f={},t=Date.now())=>{for(let a=0;a<x.children.length;a++){const s=x.children[a];if(s.tagName==="DT"){const y=s.querySelector(":scope > A"),P=s.querySelector(":scope > H3");if(y){const _=y.getAttribute("href"),j=Number(y.getAttribute("add_date"))*1e3||t+a,h=y.textContent||"unknown";if(!_)return n;const L=u.find(b=>b.toLowerCase()==="bookmarks bar")?u.filter(b=>b.toLowerCase()!=="bookmarks bar"):["other"];if(f[_])f[_].data.tags=[...new Set([...f[_].data.tags,...L])];else{const b={id:re(),data:{type:"note",url:_,name:h,text:"",tags:L.length>0?L:[],updatedAt:j,createdAt:j}};f[b.data.url]=b,n.push(b)}}else if(P){const _=P.textContent?.trim();if(_&&P.nextElementSibling?.tagName==="DL"){const j=[...u];j.push(_);const h=P.nextElementSibling;m.has(h)||(m.add(h),K(h,j,n,m,f,t+a))}}}else s.tagName!=="DL"&&s.children.length>0&&(m.has(s)||(m.add(s),K(s,[...u],n,m,f,t+a)))}return n},he=async x=>{const u=await x.text(),f=new DOMParser().parseFromString(u,"text/html").querySelector("DL");return f?K(f,[],[]):[]},U=async(x,u)=>{const n=x.target;!n.files||n.files.length===0||await u(n.files[0])};var be=C('<div class="mobileContainer svelte-1gjle5b"><!></div> <input type="file" accept=".json, .html" style="display: none;"/>',1),De=C('<div class="desktopContainer svelte-1gjle5b"><div class="desktopButtonContainer svelte-1gjle5b"><!></div> <div role="button" tabindex="-1"><div tabindex="-1" class="dropzone-content svelte-1gjle5b"><p class="svelte-1gjle5b">Drag and drop your file here</p> <p class="svelte-1gjle5b">or</p></div> <input type="file" accept=".json, .html" style="display: none;"/></div></div>'),xe=C('<p class="message svelte-1gjle5b">Select a file to import your data</p> <!>',1),we=C('<p class="message svelte-1gjle5b">Importing data...</p> <!>',1),ye=C('<p class="message success svelte-1gjle5b">Data imported successfully!</p> <div class="buttonContainer svelte-1gjle5b"><!></div>',1),je=C('<p class="message error svelte-1gjle5b">Something went wrong</p> <div class="buttonContainer svelte-1gjle5b"><!></div>',1),ke=C('<div class="content svelte-1gjle5b"><!></div>');function Pe(x,u){oe(u,!0);const{blockDialog:n}=ne(),{importNotes:m}=le(),{closeDialogStack:f}=ie();let t=M("idle"),a=M(null),s=M(!1),y=M(null);const{checkMobileSize:P}=ce(),_=()=>{f()};de(()=>{n(v(t)==="loading")}),ve(()=>(v(a)&&v(a).addEventListener("cancel",e=>{e.preventDefault(),e.stopImmediatePropagation(),e.stopPropagation()}),()=>{n(!1)}));const j=async e=>{const r=await e.text(),T=JSON.parse(r),F=[];if(!T.notes)throw new Error("Invalid import file format");for(const $ of Object.values(T.notes))$&&F.push($);await m(F)},h=async e=>{p(t,"loading");try{if(e.name.endsWith(".json"))await j(e);else if(e.name.endsWith(".html"))await m(await he(e));else throw new Error("Unsupported file format. Please upload a JSON or HTML file.");await new Promise(r=>setTimeout(r,500)),p(t,"success")}catch{p(t,"error")}},L=()=>{v(a)?.click()},b=e=>{e.preventDefault(),e.stopPropagation(),p(s,!0)},G=e=>{e.preventDefault(),e.stopPropagation(),p(s,!1)},V=e=>{e.preventDefault(),e.stopPropagation(),p(s,!0)},X=async e=>{if(e.preventDefault(),e.stopPropagation(),p(s,!1),!e.dataTransfer?.files||e.dataTransfer.files.length===0)return;const r=e.dataTransfer.files[0];if(r.type!=="application/json"&&r.type!=="text/html"){p(t,"error");return}await h(r)};var Q=ke(),Y=k(Q);{var Z=e=>{var r=xe(),T=S(w(r),2);{var F=l=>{var g=be(),D=w(g),E=k(D);O(E,{onClick:L,children:(i,d)=>{var A=q("Select File");o(i,A)},$$slots:{default:!0}});var c=S(D,2);c.__change=[U,h],W(c,i=>p(a,i),()=>v(a)),o(l,g)},$=l=>{var g=De(),D=k(g),E=k(D);O(E,{onClick:L,children:(d,A)=>{var I=q("Select File");o(d,I)},$$slots:{default:!0}});var c=S(D,2),i=S(k(c),2);i.__change=[U,h],W(i,d=>p(a,d),()=>v(a)),W(c,d=>p(y,d),()=>v(y)),fe(()=>ge(c,1,ue(["dropzone",{active:v(s)}]),"svelte-1gjle5b")),H("dragenter",c,b),H("dragover",c,V),H("dragleave",c,G),H("drop",c,X),o(l,g)};N(T,l=>{P()?l(F):l($,!1)})}o(e,r)},ee=e=>{var r=R(),T=w(r);{var F=l=>{var g=we(),D=S(w(g),2);me(D,{}),o(l,g)},$=l=>{var g=R(),D=w(g);{var E=i=>{var d=ye(),A=S(w(d),2),I=k(A);O(I,{onClick:_,children:(z,J)=>{var B=q("close");o(z,B)},$$slots:{default:!0}}),o(i,d)},c=i=>{var d=R(),A=w(d);{var I=z=>{var J=je(),B=S(w(J),2),te=k(B);O(te,{onClick:()=>{p(t,"idle")},children:(ae,Se)=>{var se=q("Try Again");o(ae,se)},$$slots:{default:!0}}),o(z,J)};N(A,z=>{v(t)==="error"&&z(I)},!0)}o(i,d)};N(D,i=>{v(t)==="success"?i(E):i(c,!1)},!0)}o(l,g)};N(T,l=>{v(t)==="loading"?l(F):l($,!1)},!0)}o(e,r)};N(Y,e=>{v(t)==="idle"?e(Z):e(ee,!1)})}o(x,Q),pe()}_e(["change"]);export{Pe as default};
