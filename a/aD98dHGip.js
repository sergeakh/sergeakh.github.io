import{R as we,p as Ae,v as Ie,J as $e,u as Ne,b as z,w as pe,K as Fe,x as Me,g as t,o as fe,a as o,f as b,j as g,c as m,i as n,m as We,n as P,s as _,S as ue,y as te,d as me,I as ge,L as ze,r as Be,N as _e,B as Q,z as V,A as he,t as qe,k as He,l as je,G as ae}from"./aBBgiPFjy.js";const se=(y,d,f,i=new Set,c={},L=Date.now())=>{for(let r=0;r<y.children.length;r++){const l=y.children[r];if(l.tagName==="DT"){const h=l.querySelector(":scope > A"),B=l.querySelector(":scope > H3");if(h){const u=h.getAttribute("href"),v=Number(h.getAttribute("add_date"))*1e3||L+r,x=h.textContent||"unknown";if(!u)return f;const q=d.find(N=>N.toLowerCase()==="bookmarks bar")?d.filter(N=>N.toLowerCase()!=="bookmarks bar"):["other"];if(c[u])c[u].data.tags=[...new Set([...c[u].data.tags,...q])];else{const N={id:we(),data:{link:{url:u,title:x},text:"",tags:q.length>0?q:[],updatedAt:v,createdAt:v,history:[]}};c[u]=N,f.push(N)}}else if(B){const u=B.textContent?.trim();if(u&&B.nextElementSibling?.tagName==="DL"){const v=[...d];v.push(u);const x=B.nextElementSibling;i.has(x)||(i.add(x),se(x,v,f,i,c,L+r))}}}else l.tagName!=="DL"&&l.children.length>0&&(i.has(l)||(i.add(l),se(l,[...d],f,i,c,L+r)))}return f},Oe=async y=>{const d=await y.text(),c=new DOMParser().parseFromString(d,"text/html").querySelector("DL");return c?se(c,[],[]):[]},Je=()=>chrome;function Re(y){const d=[];return ke(y,[],d),d}function ke(y,d,f){for(const i of y){if(!i.url){const c=[...d,i.title].filter(Boolean);i.children&&ke(i.children,c,f);continue}f.push({id:we(),data:{link:{url:i.url,title:i.title||"unknown"},text:"",tags:d.length>0?[...d]:[],updatedAt:i.dateAdded||Date.now(),createdAt:i.dateAdded||Date.now(),history:[]}})}}const Ge=async()=>new Promise((y,d)=>{const f=Je();f.permissions.request({permissions:["bookmarks"]},async i=>{if(i)try{const c=await f.bookmarks.getTree(),L=Re(c).map(r=>(r.data.tags=r.data.tags.map(l=>{const h=l.trim();return h.toLocaleLowerCase()==="other bookmarks"?"other":h}).filter(l=>!(l===""||l.toLocaleLowerCase()==="bookmarks bar")),r));y(L)}catch(c){d(c)}else d(new Error("Permission denied for bookmarks"))})});var Ke=b(`<div class="b c p-171m3dc"><p>(browser bookmarks or a this app's file)</p></div>`),Ue=b('<div class="h p-171m3dc"><p class="i j p-171m3dc">Additional tags:</p> <!></div>'),Xe=b('<div class="k p-171m3dc"><!></div>'),Qe=b('<!> <div class="e p-171m3dc"><div class="f p-171m3dc"><button class="g p-171m3dc"><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper><span>Settings</span></button></div> <!> <!></div>',1),Ve=b("<p>(browser bookmarks or a this app's file)</p>"),Ye=b('<p class="i j p-171m3dc">Additional tags:</p> <div class="o p-171m3dc"><!></div>',1),Ze=b('<div class="p p-171m3dc"><!></div> <div role="button" tabindex="-1"><div tabindex="-1" class="q p-171m3dc"><p class="p-171m3dc">Drag and drop your file here</p> <p class="p-171m3dc">or</p></div></div>',1),et=b('<div class="l p-171m3dc"><div class="m p-171m3dc"><!> <div class="f p-171m3dc"><button class="g n p-171m3dc"><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper><span>Settings</span></button></div> <!></div> <!></div>'),tt=b('<!> <!> <input type="file" accept=".txt, .html" style="display: none;"/>',1),at=b('<div class="b c p-171m3dc"><p class="i r p-171m3dc">Loading...</p> <!></div>'),rt=b('<div class="b c p-171m3dc"><p class="i s p-171m3dc">Something went wrong</p></div> <div class="t p-171m3dc"><!></div>',1),st=b('<div class="b c p-171m3dc"><p class="i u p-171m3dc">Success!</p></div> <div class="t p-171m3dc"><!></div>',1),ot=b('<div class="a p-171m3dc"><!></div>');function lt(y,d){Ae(d,!0);const{blockDialog:f}=Ie(),{importNotes:i}=$e(),{clearDialogPages:c}=Ne();let L=z(pe("file")),r=z("idle"),l=z(null),h=z(!1),B=z(null),u=z(pe([])),v=z(!1),x=z(!1);const{checkMobileSize:q}=Fe(),N=()=>{c()};Me(()=>{f(t(r)==="loading")}),fe(()=>(t(l)&&t(l).addEventListener("cancel",e=>{o(r,"idle"),e.preventDefault(),e.stopImmediatePropagation(),e.stopPropagation()}),()=>{f(!1)}));const be=async e=>{const a=await e.text(),T=JSON.parse(a),H=[];if(!T.notes)throw new Error("Invalid import file format");for(const K of Object.values(T.notes))K&&H.push(K);return H},oe=async e=>{o(r,"loading");let a=[];try{if(e.name.endsWith(".txt"))a=await be(e);else if(e.name.endsWith(".html"))a=await Oe(e);else throw new Error("Unsupported file format. Please upload a TXT or HTML file.");await le(a),o(r,"success")}catch(T){console.error("Error processing file:",T),o(r,"error")}},ye=async e=>{const a=e.target;!a.files||a.files.length===0||await oe(a.files[0])},ne=()=>{t(l)?.click()},xe=e=>{e.preventDefault(),e.stopPropagation(),o(h,!0)},Te=e=>{e.preventDefault(),e.stopPropagation(),o(h,!1)},De=e=>{e.preventDefault(),e.stopPropagation(),o(h,!0)},Se=async e=>{if(e.preventDefault(),e.stopPropagation(),o(h,!1),!e.dataTransfer?.files||e.dataTransfer.files.length===0)return;const a=e.dataTransfer.files[0];if(a.type!=="application/json"&&a.type!=="text/html"){o(r,"error");return}await oe(a)},ie=e=>{o(u,e,!0)},le=async e=>{await i(e.map(a=>({...a,data:{...a.data,tags:Array.from(new Set([...a.data.tags||[],...t(u)])),history:(a.data.history||[]).map(T=>({...T,tags:Array.from(new Set([...T.tags||[],...t(u)]))}))}}))),await new Promise(a=>setTimeout(a,500))},de=e=>{e.key==="Escape"&&(document.activeElement instanceof HTMLInputElement&&document.activeElement.type==="text"||document.activeElement instanceof HTMLTextAreaElement)&&(t(v)&&o(v,!1),document.activeElement.blur(),e.preventDefault(),e.stopPropagation())},ce=async()=>{o(r,"loading");let e=[];try{e=await Ge(),await le(e),o(r,"success")}catch(a){console.error("Error importing bookmarks from browser:",a),o(r,"error")}};fe(()=>(document.addEventListener("keydown",de),()=>document.removeEventListener("keydown",de)));var ve=ot(),Le=m(ve);{var Pe=e=>{var a=tt(),T=P(a);g(T,w=>{});var H=_(T,2);{var K=w=>{var j=Qe(),O=P(j);{var D=s=>{var p=Ke();n(s,p)};g(O,s=>{t(L)==="file"&&s(D)})}var E=_(O,2),C=m(E),A=m(C);A.__click=()=>{o(x,!t(x)),o(v,!1)};var S=m(A);me(S,()=>({"--rotate":"30deg","--size":"20px"})),ge(S.lastChild,{name:"settings"});var I=_(C,2);{var U=s=>{var p=Ue(),$=_(m(p),2);_e($,{get selectedTags(){return t(u)},onChangeTags:ie,get shownTagInput(){return t(v)},set shownTagInput(R){o(v,R,!0)}}),n(s,p)};g(I,s=>{t(x)&&s(U)})}var J=_(I,2);{var Y=s=>{var p=Xe(),$=m(p);{var R=k=>{Q(k,{fullWidth:!0,onClick:ce,children:(W,ee)=>{var G=V("Import");n(W,G)},$$slots:{default:!0}})},Z=k=>{Q(k,{fullWidth:!0,onClick:ne,children:(W,ee)=>{var G=V("Select file");n(W,G)},$$slots:{default:!0}})};g($,k=>{t(L)==="browser"?k(R):k(Z,!1)})}n(s,p)};g(J,s=>{t(v)||s(Y)})}n(w,j)},F=w=>{var j=et(),O=m(j),D=m(O);{var E=s=>{var p=Ve();n(s,p)};g(D,s=>{t(L)==="file"&&s(E)})}var C=_(D,2),A=m(C);A.__click=()=>{o(x,!t(x)),o(v,!1)};var S=m(A);me(S,()=>({"--rotate":"30deg","--size":"20px"})),ge(S.lastChild,{name:"settings"});var I=_(C,2);{var U=s=>{var p=Ye(),$=_(P(p),2),R=m($);_e(R,{get selectedTags(){return t(u)},onChangeTags:ie,get shownTagInput(){return t(v)},set shownTagInput(Z){o(v,Z,!0)}}),n(s,p)};g(I,s=>{t(x)&&s(U)})}var J=_(O,2);{var Y=s=>{var p=te(),$=P(p);{var R=k=>{Q(k,{fullWidth:!0,onClick:ce,children:(W,ee)=>{var G=V("Import");n(W,G)},$$slots:{default:!0}})},Z=k=>{var W=Ze(),ee=P(W),G=m(ee);Q(G,{onClick:ne,children:(re,nt)=>{var Ce=V("Select File");n(re,Ce)},$$slots:{default:!0}});var X=_(ee,2);ue(X,re=>o(B,re),()=>t(B)),qe(()=>He(X,1,je({v:!0,w:t(h)}),"p-171m3dc")),ae("dragenter",X,xe),ae("dragover",X,De),ae("dragleave",X,Te),ae("drop",X,Se),n(k,W)};g($,k=>{t(L)==="browser"?k(R):k(Z,!1)})}n(s,p)};g(J,s=>{t(v)||s(Y)})}n(w,j)};g(H,w=>{q()?w(K):w(F,!1)})}var M=_(H,2);M.__change=ye,ue(M,w=>o(l,w),()=>t(l)),n(e,a)},Ee=e=>{var a=te(),T=P(a);{var H=F=>{var M=at(),w=_(m(M),2);ze(w,{}),n(F,M)},K=F=>{var M=te(),w=P(M);{var j=D=>{var E=rt(),C=_(P(E),2),A=m(C);{let S=he(q);Q(A,{get fullWidth(){return t(S)},onClick:()=>{o(r,"idle")},children:(I,U)=>{var J=V("Try Again");n(I,J)},$$slots:{default:!0}})}n(D,E)},O=D=>{var E=te(),C=P(E);{var A=S=>{var I=st(),U=_(P(I),2),J=m(U);{let Y=he(q);Q(J,{get fullWidth(){return t(Y)},onClick:N,children:(s,p)=>{var $=V("Close");n(s,$)},$$slots:{default:!0}})}n(S,I)};g(C,S=>{t(r)==="success"&&S(A)},!0)}n(D,E)};g(w,D=>{t(r)==="error"?D(j):D(O,!1)},!0)}n(F,M)};g(T,F=>{t(r)==="loading"?F(H):F(K,!1)},!0)}n(e,a)};g(Le,e=>{t(r)==="idle"?e(Pe):e(Ee,!1)})}n(y,ve),We()}Be(["click","change"]);export{lt as default};
