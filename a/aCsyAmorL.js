import{p as H,C as I,D as L,v as O,w as z,a as b,x as F,y as J,g as o,o as M,f as y,i as x,b as h,e as c,h as N,s as g,u as A,ab as R,L as W,z as q,j as G,H as Q,A as K,d as V,B as X}from"./aBhExeEdR.js";import{g as Y}from"./a9q_jSmK4.js";import{g as Z,e as ee,b as ae,a as te}from"./agMDNaL23.js";var a=(t=>(t[t.Signin=0]="Signin",t[t.SigninError=1]="SigninError",t))(a||{}),re=y('<div class="b p-mcehu"><!></div>'),ne=y('<div class="b p-mcehu"><!> <!></div>'),se=y('<div class="a p-mcehu"><!></div>');function le(t,E){H(E,!0);const m=I(),S=L(),B=O(),D=A(()=>m.get()),{blockDialog:_}=z();let T=A(()=>S.getAccount()),w=b(""),r=b(F(a.Signin));const C=async()=>{g(r,a.Signin,!0),await new Promise(e=>setTimeout(e,2e3));try{const e=await Y(),{credentialData:n,clientKey:l}=await Z({challenge:e}),d=await fetch("/api/signin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(d.status!==200){g(r,a.SigninError,!0);return}const s=await d.json();if(!s.serverKey){g(r,a.SigninError,!0);return}const u=s.serverKey,v=o(T)===void 0,{encryptedClientKey:f}=await ee({clientKey:l,serverKey:new Uint8Array(ae(u))});if(R(),await S.initCloudAccount({encryptedClientKey:te(f)}),_(!1),v)B.clear();else{let i=o(D).get("retPath")||"";i&&g(w,i,!0),m.replace(o(w)||"")}}catch{g(r,a.SigninError,!0)}};J(()=>{_(o(r)===a.Signin)}),M(()=>{C()});var P=se(),$=h(P);{var U=e=>{var n=re(),l=h(n);W(l,{}),c(e,n)},j=e=>{var n=q(),l=G(n);{var d=s=>{var u=ne(),v=h(u);Q(v,{children:(i,k)=>{var p=K("something went wrong");c(i,p)}});var f=V(v,2);X(f,{onClick:()=>C(),fullWidth:!0,children:(i,k)=>{var p=K("try again");c(i,p)},$$slots:{default:!0}}),c(s,u)};x(l,s=>{o(r)===a.SigninError&&s(d)},!0)}c(e,n)};x($,e=>{o(r)===a.Signin?e(U):e(j,!1)})}c(t,P),N()}export{le as default};
