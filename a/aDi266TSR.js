import{p as ye,M as xe,u as be,v as Ae,N as Oe,b as D,w as Le,x as Ce,g as e,o as le,f as x,j as y,c as o,i as c,m as we,a as i,n as L,s as u,d as $e,I as Re,y as ee,z as P,O as Se,B as te,A as ae,L as He,r as Ie}from"./aDxdVuYxT.js";import{S as je,a as q}from"./aD_KeUx8W.js";const Me=H=>{const _=Math.floor(Date.now()/1e3),v={};H.forEach(t=>{if(!t)return;const l=t.data.tags||["Imported"];if(l.length===0){v.ROOT||(v.ROOT=[]),v.ROOT.push(t);return}l.forEach(a=>{v[a]||(v[a]=[]),v[a].push(t)})});let h=`<!DOCTYPE NETSCAPE-Note-file-1>
<!-- This is an automatically generated file.
 It will be read and overwritten.
 DO NOT EDIT! -->
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8">
<TITLE>Bookmarks</TITLE>
<H1>Bookmarks</H1>
<DL><p>
<DT><H3 ADD_DATE="${_}" LAST_MODIFIED="${_}" PERSONAL_TOOLBAR_FOLDER="true">Bookmarks bar</H3>
<DL><p>`;return Object.keys(v).forEach(t=>{t!=="ROOT"&&t!=="other"&&(h+=`
    <DT><H3 ADD_DATE="${_}" LAST_MODIFIED="${_}">${t}</H3>
    <DL><p>`,v[t].forEach(l=>{if(!l.data.link)return;const a=l.data.link.title.replace(/"/g,"&quot;");h+=`
        <DT><A HREF="${l.data.link.url}" ADD_DATE="${Math.floor(l.data.createdAt/1e3)||_}">${a}</A>`}),h+=`
    </DL><p>`)}),v.ROOT&&v.ROOT.forEach(t=>{if(!t.data.link)return;const l=t.data.link.title.replace(/"/g,"&quot;");h+=`
    <DT><A HREF="${t.data.link.url}" ADD_DATE="${Math.floor(t.data.createdAt/1e3)||_}">${l}</A>`}),h+=`
</DL><p>`,v.other&&v.other.forEach(t=>{if(!t.data.link)return;const l=t.data.link.title.replace(/"/g,"&quot;");h+=`
    <DT><A HREF="${t.data.link.url}" ADD_DATE="${Math.floor(t.data.createdAt/1e3)||_}">${l}</A>`}),h+="</DL><p>",h},Be=async(H,_="")=>{const v=`${_}.json`,h=JSON.stringify({notes:H}),t=new Blob([h],{type:"application/json"}),l=URL.createObjectURL(t),a=document.createElement("a");a.href=l,a.download=v,document.body.appendChild(a),a.click(),setTimeout(()=>{document.body.removeChild(a),URL.revokeObjectURL(l)},0)};var Pe=x('<div class="g p-10n6f3r"><p class="h p-10n6f3r">Exclude history</p> <div class="i p-10n6f3r"><!></div></div>'),Fe=x('<div class="g p-10n6f3r"><p class="h p-10n6f3r">Exclude other tags</p> <div class="i p-10n6f3r"><!></div></div>'),Ue=x('<div class="g p-10n6f3r"><p class="h p-10n6f3r">Exclude bin</p> <div class="i p-10n6f3r"><!></div></div> <div class="g p-10n6f3r"><p class="h p-10n6f3r">Exclude archive</p> <div class="i p-10n6f3r"><!></div></div> <!> <!> <p class="j k p-10n6f3r">Filter tags:</p> <!>',1),Ne=x('<div class="l p-10n6f3r"><!></div>'),ze=x('<div class="b p-10n6f3r"><div class="c p-10n6f3r"><!> <p class="d p-10n6f3r"><!></p></div></div> <div><div class="e p-10n6f3r"><button class="f p-10n6f3r"><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper><span>Settings</span></button></div> <!> <!></div>',1),qe=x('<div class="b p-10n6f3r"><p class="j p-10n6f3r">Exporting data...</p> <!></div>'),We=x('<div class="b p-10n6f3r"><p class="j m p-10n6f3r">Something went wrong</p></div> <div class="l p-10n6f3r"><!></div>',1),Ge=x('<div class="b p-10n6f3r"><p class="j p-10n6f3r">Data exported successfully!</p></div> <div class="l p-10n6f3r"><!></div>',1),Je=x('<div class="a p-10n6f3r"><!></div>');function Ye(H,_){ye(_,!0);const{getGetNotes:v}=xe(),{clearDialogPages:h}=be(),{blockDialog:t}=Ae(),{checkMobileSize:l}=Oe();let a=D("idle"),I=D("sync"),T=D(Le([])),C=D(!1),W=D(!1),F=D(!1),U=D(!1),G=D(!1),J=D(!1);const ie=()=>{h()};Ce(()=>{t(e(a)==="loading")}),le(()=>()=>{t(!1)});const de=()=>{i(W,!e(W)),i(U,!1),i(F,!1),i(C,!1),i(T,[],!0)},ce=async()=>{i(a,"loading"),setTimeout(async()=>{let f=(v()()||[]).filter(s=>s.data).filter(s=>e(T).length===0?!0:e(T).every(d=>s.data.tags.includes(d)));if(e(U)&&(f=f.map(s=>{const d={...s};return d.data={...d.data,history:[]},d})),e(G)&&(f=f.filter(s=>!s.data.deletedAt)),e(J)&&(f=f.filter(s=>!s.data.archivedAt)),e(F)&&(f=f.map(s=>{const d={...s};return d.data={...d.data,tags:d.data.tags.filter(g=>e(T).includes(g)),history:d.data.history.map(g=>({...g,tags:g.tags.filter(p=>e(T).includes(p))}))},d})),e(I)==="sync")await Be(f,[...e(T),"notes"].join("_")).finally(async()=>{await new Promise(s=>setTimeout(s,500)),i(a,"success")});else try{const s=Me(f),d=new Blob([s],{type:"text/html"}),g=URL.createObjectURL(d),p=document.createElement("a");p.href=g,p.download=`${[...e(T),"bookmarks"].join("_")}bookmarks_${new Date().toLocaleDateString().replace(/\//g,"_")}.html`,document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(g),i(a,"success")}catch{i(a,"error")}},0)},ve=r=>{i(T,r,!0)},re=r=>{r.key==="Escape"&&(document.activeElement instanceof HTMLInputElement&&document.activeElement.type==="text"||document.activeElement instanceof HTMLTextAreaElement)&&(e(C)&&i(C,!1),document.activeElement.blur(),r.preventDefault(),r.stopPropagation())},fe=r=>{i(F,r,!0)},pe=r=>{i(U,r,!0)},ue=r=>{i(G,r,!0)},he=r=>{i(J,r,!0)};le(()=>(document.addEventListener("keydown",re),()=>document.removeEventListener("keydown",re)));var se=Je(),ge=o(se);{var _e=r=>{var f=ze(),s=L(f),d=o(s),g=o(d);je(g,{items:[{title:"Sync",value:"sync"},{title:"Bookmarks",value:"bookmarks"}],get value(){return e(I)},onChange:n=>{i(I,n,!0)}});var p=u(g,2),A=o(p);{var j=n=>{var m=P("App format for sync or backup");c(n,m)},Q=n=>{var m=P("Browser bookmarks format (exports only bookmarks, not notes)");c(n,m)};y(A,n=>{e(I)==="sync"?n(j):n(Q,!1)})}var V=u(s,2),k=o(V),b=o(k);b.__click=de;var w=o(b);$e(w,()=>({"--rotate":"30deg","--size":"20px"})),Re(w.lastChild,{name:"settings"});var $=u(k,2);{var O=n=>{var m=Ue(),S=L(m),z=u(o(S),2),M=o(z);q(M,{get checked(){return e(G)},onChange:ue});var Y=u(S,2),K=u(o(Y),2),Te=o(K);q(Te,{get checked(){return e(J)},onChange:he});var ne=u(Y,2);{var ke=E=>{var B=Pe(),X=u(o(B),2),Z=o(X);q(Z,{get checked(){return e(U)},onChange:pe}),c(E,B)};y(ne,E=>{e(I)==="sync"&&E(ke)})}var oe=u(ne,2);{var Ee=E=>{var B=Fe(),X=u(o(B),2),Z=o(X);q(Z,{get checked(){return e(F)},onChange:fe}),c(E,B)};y(oe,E=>{e(T).length>0&&E(Ee)})}var De=u(oe,4);Se(De,{mode:"exit",get selectedTags(){return e(T)},onChangeTags:ve,get shownTagInput(){return e(C)},set shownTagInput(E){i(C,E,!0)}}),c(n,m)};y($,n=>{e(W)&&n(O)})}var R=u($,2);{var N=n=>{var m=Ne(),S=o(m);{let z=ae(l);te(S,{get fullWidth(){return e(z)},onClick:ce,children:(M,Y)=>{var K=P("Export");c(M,K)},$$slots:{default:!0}})}c(n,m)};y(R,n=>{e(C)||n(N)})}c(r,f)},me=r=>{var f=ee(),s=L(f);{var d=p=>{var A=qe(),j=u(o(A),2);He(j,{}),c(p,A)},g=p=>{var A=ee(),j=L(A);{var Q=k=>{var b=We(),w=u(L(b),2),$=o(w);{let O=ae(l);te($,{get fullWidth(){return e(O)},onClick:()=>{i(a,"idle")},children:(R,N)=>{var n=P("Try Again");c(R,n)},$$slots:{default:!0}})}c(k,b)},V=k=>{var b=ee(),w=L(b);{var $=O=>{var R=Ge(),N=u(L(R),2),n=o(N);{let m=ae(l);te(n,{get fullWidth(){return e(m)},onClick:ie,children:(S,z)=>{var M=P("Close");c(S,M)},$$slots:{default:!0}})}c(O,R)};y(w,O=>{e(a)==="success"&&O($)},!0)}c(k,b)};y(j,k=>{e(a)==="error"?k(Q):k(V,!1)},!0)}c(p,A)};y(s,p=>{e(a)==="loading"?p(d):p(g,!1)},!0)}c(r,f)};y(ge,r=>{e(a)==="idle"?r(_e):r(me,!1)})}c(H,se),we()}Ie(["click"]);export{Ye as default};
