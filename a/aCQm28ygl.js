import{p as q,z,A as F,n as J,q as M,h as P,r as N,u as R,g as d,o as W,f as m,i as w,c as h,d as s,j as G,k as v,y as A,a0 as Q,H as b,x as y,s as K,L as V,v as X,l as Y,B as Z}from"./aBL-CVDHR.js";import{g as ee,b as re,a as te}from"./aBEGDcNQV.js";import{g as ae}from"./a9q_jSmK4.js";import{e as ne}from"./aCpa8lgv9.js";var r=(a=>(a[a.Signin=0]="Signin",a[a.SigninError=1]="SigninError",a))(r||{}),ie=m('<div class="b p-mcehu"><!> <!></div>'),se=m('<div class="b p-mcehu"><!> <!></div>'),oe=m('<div class="a p-mcehu"><!></div>');function ue(a,E){q(E,!0);const{getAppLocation:$,replace:B}=z(),{initCloudAccount:D,getAccount:T}=F(),{clearDialogPages:k}=J(),U=A(()=>$().searchParams),{blockDialog:_}=M();let j=A(T),S=P(""),n=P(N(r.Signin));const C=async()=>{v(n,r.Signin,!0),await new Promise(e=>setTimeout(e,2e3));try{const e=await ae(),{credentialData:i,clientKey:o}=await ee({challenge:e}),c=await fetch("/api/signin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(c.status!==200){v(n,r.SigninError,!0);return}const t=await c.json();if(!t.serverKey){v(n,r.SigninError,!0);return}const u=t.serverKey,l=d(j)===void 0,{encryptedClientKey:p}=await ne({clientKey:o,serverKey:new Uint8Array(re(u))});if(Q(),await D({encryptedClientKey:te(p)}),_(!1),l)k();else{let g=d(U).get("retPath")||"";g&&v(S,g,!0),B(d(S)||"/")}}catch{v(n,r.SigninError,!0)}};R(()=>{_(d(n)===r.Signin)}),W(()=>{C()});var x=oe(),H=h(x);{var L=e=>{var i=ie(),o=h(i);b(o,{children:(t,u)=>{var l=y("signin");s(t,l)}});var c=K(o,2);V(c,{}),s(e,i)},I=e=>{var i=X(),o=Y(i);{var c=t=>{var u=se(),l=h(u);b(l,{children:(g,O)=>{var f=y("error signin");s(g,f)}});var p=K(l,2);Z(p,{onClick:()=>C(),fullWidth:!0,children:(g,O)=>{var f=y("try again");s(g,f)},$$slots:{default:!0}}),s(t,u)};w(o,t=>{d(n)===r.SigninError&&t(c)},!0)}s(e,i)};w(H,e=>{d(n)===r.Signin?e(L):e(I,!1)})}s(a,x),G()}export{ue as default};
