import{R as re,p as oe,i as ne,C as le,z as ie,S as ce,u as de,g as v,j as M,o as ve,f as k,m as A,c as y,d as s,n as pe,s as j,r as D,q as J,B as N,w as O,T as W,l as p,t as fe,K as ge,M as ue,D as q,L as me,v as _e}from"./D8xBwbrB.js";const R=(x,m,r,_=new Set,f={})=>{const o=Date.now();for(let n=0;n<x.children.length;n++){const t=x.children[n];if(t.tagName==="DT"){const S=t.querySelector(":scope > A"),C=t.querySelector(":scope > H3");if(S){const h=S.getAttribute("href"),P=S.textContent||"unknown";if(!h)return r;const g=m.find(b=>b.toLowerCase()==="bookmarks bar")?m.filter(b=>b.toLowerCase()!=="bookmarks bar"):["other"];if(f[h])f[h].data.tags=[...new Set([...f[h].data.tags,...g])];else{const b={id:re(),data:{url:h,name:P,text:"",tags:g.length>0?g:[],updatedAt:o+n,createdAt:o+n}};f[b.data.url]=b,r.push(b)}}else if(C){const h=C.textContent?.trim();if(h&&C.nextElementSibling?.tagName==="DL"){const P=[...m];P.push(h);const g=C.nextElementSibling;_.has(g)||(_.add(g),R(g,P,r,_,f))}}}else t.tagName!=="DL"&&t.children.length>0&&(_.has(t)||(_.add(t),R(t,[...m],r,_,f)))}return r},he=async x=>{const m=await x.text(),f=new DOMParser().parseFromString(m,"text/html").querySelector("DL");return f?R(f,[],[]):[]},U=async(x,m)=>{const r=x.target;!r.files||r.files.length===0||await m(r.files[0])};var be=k('<div class="mobileContainer svelte-1gjle5b"><!></div> <input type="file" accept=".json, .html" style="display: none;"/>',1),we=k('<div class="desktopContainer svelte-1gjle5b"><div class="desktopButtonContainer svelte-1gjle5b"><!></div> <div role="button" tabindex="-1"><div tabindex="-1" class="dropzone-content svelte-1gjle5b"><p class="svelte-1gjle5b">Drag and drop your file here</p> <p class="svelte-1gjle5b">or</p></div> <input type="file" accept=".json, .html" style="display: none;"/></div></div>'),xe=k('<p class="message svelte-1gjle5b">Select a file to import your data</p> <!>',1),De=k('<p class="message svelte-1gjle5b">Importing data...</p> <!>',1),ye=k('<p class="message success svelte-1gjle5b">Data imported successfully!</p> <div class="buttonContainer svelte-1gjle5b"><!></div>',1),je=k('<p class="message error svelte-1gjle5b">Something went wrong</p> <div class="buttonContainer svelte-1gjle5b"><!></div>',1),ke=k('<div class="content svelte-1gjle5b"><!></div>');function Pe(x,m){oe(m,!0);const{blockDialog:r}=ne(),{importNotes:_}=le(),{closeDialogStack:f}=ie();let o=M("idle"),n=M(null),t=M(!1),S=M(null);const{checkMobileSize:C}=ce(),h=()=>{f()};de(()=>{r(v(o)==="loading")}),ve(()=>(v(n)&&v(n).addEventListener("cancel",e=>{e.preventDefault(),e.stopImmediatePropagation(),e.stopPropagation()}),()=>{r(!1)}));const P=async e=>{const a=await e.text(),L=JSON.parse(a),T=[];if(!L.notes)throw new Error("Invalid import file format");for(const F of Object.values(L.notes))F&&T.push(F);await _(T)},g=async e=>{p(o,"loading");try{if(e.name.endsWith(".json"))await P(e);else if(e.name.endsWith(".html"))await _(await he(e));else throw new Error("Unsupported file format. Please upload a JSON or HTML file.");await new Promise(a=>setTimeout(a,500)),p(o,"success")}catch{p(o,"error")}},b=()=>{v(n)?.click()},G=e=>{e.preventDefault(),e.stopPropagation(),p(t,!0)},Q=e=>{e.preventDefault(),e.stopPropagation(),p(t,!1)},V=e=>{e.preventDefault(),e.stopPropagation(),p(t,!0)},X=async e=>{if(e.preventDefault(),e.stopPropagation(),p(t,!1),!e.dataTransfer?.files||e.dataTransfer.files.length===0)return;const a=e.dataTransfer.files[0];if(a.type!=="application/json"&&a.type!=="text/html"){p(o,"error");return}await g(a)};var K=ke(),Y=y(K);{var Z=e=>{var a=xe(),L=j(D(a),2);{var T=l=>{var u=be(),w=D(u),E=y(w);N(E,{onClick:b,children:(i,d)=>{var $=O("Select File");s(i,$)},$$slots:{default:!0}});var c=j(w,2);c.__change=[U,g],W(c,i=>p(n,i),()=>v(n)),s(l,u)},F=l=>{var u=we(),w=y(u),E=y(w);N(E,{onClick:b,children:(d,$)=>{var I=O("Select File");s(d,I)},$$slots:{default:!0}});var c=j(w,2),i=j(y(c),2);i.__change=[U,g],W(i,d=>p(n,d),()=>v(n)),W(c,d=>p(S,d),()=>v(S)),fe(()=>ge(c,1,ue(["dropzone",{active:v(t)}]),"svelte-1gjle5b")),q("dragenter",c,G),q("dragover",c,V),q("dragleave",c,Q),q("drop",c,X),s(l,u)};A(L,l=>{C()?l(T):l(F,!1)})}s(e,a)},ee=e=>{var a=J(),L=D(a);{var T=l=>{var u=De(),w=j(D(u),2);me(w,{}),s(l,u)},F=l=>{var u=J(),w=D(u);{var E=i=>{var d=ye(),$=j(D(d),2),I=y($);N(I,{onClick:h,children:(z,H)=>{var B=O("close");s(z,B)},$$slots:{default:!0}}),s(i,d)},c=i=>{var d=J(),$=D(d);{var I=z=>{var H=je(),B=j(D(H),2),te=y(B);N(te,{onClick:()=>{p(o,"idle")},children:(ae,Se)=>{var se=O("Try Again");s(ae,se)},$$slots:{default:!0}}),s(z,H)};A($,z=>{v(o)==="error"&&z(I)},!0)}s(i,d)};A(w,i=>{v(o)==="success"?i(E):i(c,!1)},!0)}s(l,u)};A(L,l=>{v(o)==="loading"?l(T):l(F,!1)},!0)}s(e,a)};A(Y,e=>{v(o)==="idle"?e(Z):e(ee,!1)})}s(x,K),pe()}_e(["change"]);export{Pe as default};
