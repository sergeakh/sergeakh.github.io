import{p as Le,J as Oe,u as we,v as $e,K as Re,b as k,w as Se,x as He,g as e,o as de,f as y,j as x,c as o,i as v,m as Ie,a as i,n as O,s as f,d as je,I as Be,y as te,z as F,N as Me,B as ae,A as re,L as Pe,r as Fe}from"./aDVJRJgX9.js";import{S as Ne,a as N}from"./aBZ6OdFsc.js";const Ue=I=>{const _=Math.floor(Date.now()/1e3),p={};I.forEach(t=>{if(!t)return;const d=t.data.tags||["Imported"];if(d.length===0){p.ROOT||(p.ROOT=[]),p.ROOT.push(t);return}d.forEach(s=>{p[s]||(p[s]=[]),p[s].push(t)})});let h=`<!DOCTYPE NETSCAPE-Note-file-1>
<!-- This is an automatically generated file.
 It will be read and overwritten.
 DO NOT EDIT! -->
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8">
<TITLE>Bookmarks</TITLE>
<H1>Bookmarks</H1>
<DL><p>
<DT><H3 ADD_DATE="${_}" LAST_MODIFIED="${_}" PERSONAL_TOOLBAR_FOLDER="true">Bookmarks bar</H3>
<DL><p>`;return Object.keys(p).forEach(t=>{t!=="ROOT"&&t!=="other"&&(h+=`
    <DT><H3 ADD_DATE="${_}" LAST_MODIFIED="${_}">${t}</H3>
    <DL><p>`,p[t].forEach(d=>{if(!d.data.link)return;const s=d.data.link.title.replace(/"/g,"&quot;");h+=`
        <DT><A HREF="${d.data.link.url}" ADD_DATE="${Math.floor(d.data.createdAt/1e3)||_}">${s}</A>`}),h+=`
    </DL><p>`)}),p.ROOT&&p.ROOT.forEach(t=>{if(!t.data.link)return;const d=t.data.link.title.replace(/"/g,"&quot;");h+=`
    <DT><A HREF="${t.data.link.url}" ADD_DATE="${Math.floor(t.data.createdAt/1e3)||_}">${d}</A>`}),h+=`
</DL><p>`,p.other&&p.other.forEach(t=>{if(!t.data.link)return;const d=t.data.link.title.replace(/"/g,"&quot;");h+=`
    <DT><A HREF="${t.data.link.url}" ADD_DATE="${Math.floor(t.data.createdAt/1e3)||_}">${d}</A>`}),h+="</DL><p>",h},ze=async(I,_="")=>{const p=`${_}.json`,h=JSON.stringify({notes:I}),t=new Blob([h],{type:"application/json"}),d=URL.createObjectURL(t),s=document.createElement("a");s.href=d,s.download=p,document.body.appendChild(s),s.click(),setTimeout(()=>{document.body.removeChild(s),URL.revokeObjectURL(d)},0)};var qe=y('<div class="g p-10n6f3r"><p class="h p-10n6f3r">Exclude history</p> <div class="i p-10n6f3r"><!></div></div>'),We=y('<div class="g p-10n6f3r"><p class="h p-10n6f3r">Exclude other tags</p> <div class="i p-10n6f3r"><!></div></div>'),Je=y('<div class="g p-10n6f3r"><p class="h p-10n6f3r">Exclude bin</p> <div class="i p-10n6f3r"><!></div></div> <div class="g p-10n6f3r"><p class="h p-10n6f3r">Exclude archive</p> <div class="i p-10n6f3r"><!></div></div> <!> <div class="g p-10n6f3r"><p class="h p-10n6f3r">Exclude tags</p> <div class="i p-10n6f3r"><!></div></div> <!> <p class="j k p-10n6f3r">Filter tags:</p> <!>',1),Ge=y('<div class="l p-10n6f3r"><!></div>'),Ke=y('<div class="b p-10n6f3r"><div class="c p-10n6f3r"><!> <p class="d p-10n6f3r"><!></p></div></div> <div><div class="e p-10n6f3r"><button class="f p-10n6f3r"><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper><span>Settings</span></button></div> <!> <!></div>',1),Qe=y('<div class="b p-10n6f3r"><p class="j p-10n6f3r">Exporting data...</p> <!></div>'),Ve=y('<div class="b p-10n6f3r"><p class="j m p-10n6f3r">Something went wrong</p></div> <div class="l p-10n6f3r"><!></div>',1),Ye=y('<div class="b p-10n6f3r"><p class="j p-10n6f3r">Data exported successfully!</p></div> <div class="l p-10n6f3r"><!></div>',1),Xe=y('<div class="a p-10n6f3r"><!></div>');function tt(I,_){Le(_,!0);const{getGetNotes:p}=Oe(),{clearDialogPages:h}=we(),{blockDialog:t}=$e(),{checkMobileSize:d}=Re();let s=k("idle"),j=k("sync"),T=k(Se([])),w=k(!1),J=k(!1),A=k(!1),U=k(!1),z=k(!1),G=k(!1),K=k(!1);const ce=()=>{h()};He(()=>{t(e(s)==="loading")}),de(()=>()=>{t(!1)});const ve=()=>{i(J,!e(J)),i(z,!1),i(U,!1),i(w,!1),i(T,[],!0)},fe=async()=>{i(s,"loading"),setTimeout(async()=>{let c=(p()()||[]).filter(r=>r.data).filter(r=>e(T).length===0?!0:e(T).every(n=>r.data.tags.includes(n)));if(e(z)&&(c=c.map(r=>{const n={...r};return n.data={...n.data,history:[]},n})),e(G)&&(c=c.filter(r=>!r.data.deletedAt)),e(K)&&(c=c.filter(r=>!r.data.archivedAt)),e(A)&&(c=c.map(r=>{const n={...r};return n.data={...n.data,tags:[],history:n.data.history.map(g=>({...g,tags:[]}))},n})),e(U)&&e(A)===!1&&(c=c.map(r=>{const n={...r};return n.data={...n.data,tags:n.data.tags.filter(g=>e(T).includes(g)),history:n.data.history.map(g=>({...g,tags:g.tags.filter(u=>e(T).includes(u))}))},n})),e(j)==="sync")await ze(c,[...e(A)?[]:e(T),"notes"].join("_")).finally(async()=>{await new Promise(r=>setTimeout(r,500)),i(s,"success")});else try{const r=Ue(c),n=new Blob([r],{type:"text/html"}),g=URL.createObjectURL(n),u=document.createElement("a");u.href=g,u.download=`${[...e(A)?[]:e(T),"bookmarks"].join("_")}bookmarks_${new Date().toLocaleDateString().replace(/\//g,"_")}.html`,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(g),i(s,"success")}catch{i(s,"error")}},0)},pe=a=>{i(T,a,!0)},se=a=>{a.key==="Escape"&&(document.activeElement instanceof HTMLInputElement&&document.activeElement.type==="text"||document.activeElement instanceof HTMLTextAreaElement)&&(e(w)&&i(w,!1),document.activeElement.blur(),a.preventDefault(),a.stopPropagation())},ue=a=>{i(U,a,!0)},ge=a=>{i(z,a,!0)},he=a=>{i(G,a,!0)},_e=a=>{i(K,a,!0)},me=a=>{i(A,a,!0)};de(()=>(document.addEventListener("keydown",se),()=>document.removeEventListener("keydown",se)));var ne=Xe(),Te=o(ne);{var ke=a=>{var c=Ke(),r=O(c),n=o(r),g=o(n);Ne(g,{items:[{title:"Sync",value:"sync"},{title:"Bookmarks",value:"bookmarks"}],get value(){return e(j)},onChange:l=>{i(j,l,!0)}});var u=f(g,2),C=o(u);{var B=l=>{var m=F("App format for sync or backup");v(l,m)},Q=l=>{var m=F("Browser bookmarks format (exports only bookmarks, not notes)");v(l,m)};x(C,l=>{e(j)==="sync"?l(B):l(Q,!1)})}var V=f(r,2),E=o(V),b=o(E);b.__click=ve;var $=o(b);je($,()=>({"--rotate":"30deg","--size":"20px"})),Be($.lastChild,{name:"settings"});var R=f(E,2);{var L=l=>{var m=Je(),H=O(m),W=f(o(H),2),M=o(W);N(M,{get checked(){return e(G)},onChange:he});var Y=f(H,2),X=f(o(Y),2),De=o(X);N(De,{get checked(){return e(K)},onChange:_e});var oe=f(Y,2);{var xe=D=>{var P=qe(),Z=f(o(P),2),ee=o(Z);N(ee,{get checked(){return e(z)},onChange:ge}),v(D,P)};x(oe,D=>{e(j)==="sync"&&D(xe)})}var le=f(oe,2),ye=f(o(le),2),be=o(ye);N(be,{get checked(){return e(A)},onChange:me});var ie=f(le,2);{var Ae=D=>{var P=We(),Z=f(o(P),2),ee=o(Z);N(ee,{get checked(){return e(U)},onChange:ue}),v(D,P)};x(ie,D=>{e(T).length>0&&!e(A)&&D(Ae)})}var Ce=f(ie,4);Me(Ce,{mode:"exit",get selectedTags(){return e(T)},onChangeTags:pe,get shownTagInput(){return e(w)},set shownTagInput(D){i(w,D,!0)}}),v(l,m)};x(R,l=>{e(J)&&l(L)})}var S=f(R,2);{var q=l=>{var m=Ge(),H=o(m);{let W=re(d);ae(H,{get fullWidth(){return e(W)},onClick:fe,children:(M,Y)=>{var X=F("Export");v(M,X)},$$slots:{default:!0}})}v(l,m)};x(S,l=>{e(w)||l(q)})}v(a,c)},Ee=a=>{var c=te(),r=O(c);{var n=u=>{var C=Qe(),B=f(o(C),2);Pe(B,{}),v(u,C)},g=u=>{var C=te(),B=O(C);{var Q=E=>{var b=Ve(),$=f(O(b),2),R=o($);{let L=re(d);ae(R,{get fullWidth(){return e(L)},onClick:()=>{i(s,"idle")},children:(S,q)=>{var l=F("Try Again");v(S,l)},$$slots:{default:!0}})}v(E,b)},V=E=>{var b=te(),$=O(b);{var R=L=>{var S=Ye(),q=f(O(S),2),l=o(q);{let m=re(d);ae(l,{get fullWidth(){return e(m)},onClick:ce,children:(H,W)=>{var M=F("Close");v(H,M)},$$slots:{default:!0}})}v(L,S)};x($,L=>{e(s)==="success"&&L(R)},!0)}v(E,b)};x(B,E=>{e(s)==="error"?E(Q):E(V,!1)},!0)}v(u,C)};x(r,u=>{e(s)==="loading"?u(n):u(g,!1)},!0)}v(a,c)};x(Te,a=>{e(s)==="idle"?a(ke):a(Ee,!1)})}v(I,ne),Ie()}Fe(["click"]);export{tt as default};
