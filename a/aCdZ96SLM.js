import{p as W,M as X,C as Y,o as C,N as o,f as v,i as f,g as t,a as R,b as d,d as g,u as F,e as i,h as Z,s as m,O as $,Q as ee,j as h,B as ae,A as se,z as A,L as te,t as re,k as oe}from"./aBhExeEdR.js";import{S as x}from"./a3HMLpT7s.js";var ne=v('<div class="b p-7f8x00"><p class="c p-7f8x00">Local AI tags</p> <div class="d"><!></div></div>'),ie=v('<div class="b p-7f8x00"><p class="c p-7f8x00">Use page data for improving ai tags</p> <div class="d"><!></div></div>'),le=v("<p>Local llm model is not downloaded. Download to enable tag generation. (model size 1.5â€“2.4 GB)</p> <!>",1),de=v("<!> <p> </p>",1),ge=v("<p>Local LLM is unavailable on this platform.</p>"),pe=v('<div class="a p-7f8x00"><!> <!> <!> <div class="b p-7f8x00"><p class="c p-7f8x00">Change icon for saved pages</p> <div class="d"><!></div></div></div>');function ue(B,O){W(O,!0);const a=X(),S=Y();let E=F(()=>a.getLlmTagsEnabled());const z=e=>{a.setLlmTagsEnabled(e),T()};let r=R("unknown"),L=R(0);const G=ee(e=>{m(L,e,!0)},100,{trailing:!0}),T=async()=>{if(typeof LanguageModel>"u"){m(r,"unavailable");return}m(r,await $().availability({expectedInputs:[{type:"text",languages:["en"]}],expectedOutputs:[{type:"text",languages:["en"]}]}),!0),t(r)==="downloading"&&w()},w=async()=>{m(r,"downloading");try{await $().create({expectedInputs:[{type:"text",languages:["en"]}],expectedOutputs:[{type:"text",languages:["en"]}],monitor(e){e.addEventListener("downloadprogress",s=>{if(s.loaded===1){m(r,"available");return}else G(Math.floor(s.loaded*100))})}})}catch{return}},D=e=>{a.setPageDataForTagsEnabled(e),e!==!1&&o().permissions.contains({permissions:["scripting"],origins:["<all_urls>"]},s=>{s?a.setPageDataForTagsEnabled(!0):(a.setPageDataForTagsEnabled(!1),a.getViewMode()==="popup"?o().runtime.sendMessage({type:"requestPermissions",data:{name:"pageDataForTags",permissions:["scripting"],origins:["<all_urls>"],retpath:S.get().toString()}}):o().permissions.request({permissions:["scripting"],origins:["<all_urls>"]},n=>{n?a.setPageDataForTagsEnabled(!0):a.setPageDataForTagsEnabled(!1)}))})},y=e=>{a.setIconForSavedPagesEnabled(e),e!==!1&&o().permissions.contains({permissions:["tabs"],origins:["<all_urls>"]},s=>{s?a.setIconForSavedPagesEnabled(!0):(a.setIconForSavedPagesEnabled(!1),a.getViewMode()==="popup"?o().runtime.sendMessage({type:"requestPermissions",data:{name:"iconForSavedPages",permissions:["tabs"],origins:["<all_urls>"],retpath:S.get().toString()}}):o().permissions.request({permissions:["tabs"],origins:["<all_urls>"]},n=>{n?a.setIconForSavedPagesEnabled(!0):a.setIconForSavedPagesEnabled(!1)}))})};C(()=>{o().permissions.contains({permissions:["tabs"],origins:["<all_urls>"]},e=>{e||a.setIconForSavedPagesEnabled(!1)}),o().storage.local.get("permissionsRequested_iconForSavedPages",e=>{e.permissionsRequested_iconForSavedPages&&y(!0),o().storage.local.remove("permissionsRequested_iconForSavedPages")}),o().permissions.contains({permissions:["scripting"],origins:["<all_urls>"]},e=>{e||a.setPageDataForTagsEnabled(!1)}),o().storage.local.get("permissionsRequested_pageDataForTags",e=>{e.permissionsRequested_pageDataForTags&&D(!0),o().storage.local.remove("permissionsRequested_pageDataForTags")})}),C(()=>{T()});var M=pe(),I=d(M);{var j=e=>{var s=ne(),n=g(d(s),2),p=d(n);x(p,{get checked(){return t(E)},onChange:z}),i(e,s)};f(I,e=>{t(r)!=="unavailable"&&t(r)!=="unknown"&&e(j)})}var k=g(I,2);{var N=e=>{var s=ie(),n=g(d(s),2),p=d(n);{let _=F(()=>a.getPageDataForTagsEnabled());x(p,{get checked(){return t(_)},onChange:D})}i(e,s)};f(k,e=>{t(r)!=="unavailable"&&t(r)!=="unknown"&&t(E)&&e(N)})}var q=g(k,2);{var Q=e=>{var s=le(),n=g(h(s),2);ae(n,{onClick:w,children:(p,_)=>{var l=se("Download");i(p,l)},$$slots:{default:!0}}),i(e,s)},U=e=>{var s=A(),n=h(s);{var p=l=>{var c=de(),b=h(c);te(b,{});var P=g(b,2),u=d(P);re(()=>oe(u,`downloading llm... ${t(L)??""}%`)),i(l,c)},_=l=>{var c=A(),b=h(c);{var P=u=>{var V=ge();i(u,V)};f(b,u=>{t(r)==="unavailable"&&u(P)},!0)}i(l,c)};f(n,l=>{t(r)==="downloading"?l(p):l(_,!1)},!0)}i(e,s)};f(q,e=>{t(r)==="downloadable"?e(Q):e(U,!1)})}var H=g(q,2),J=g(d(H),2),K=d(J);{let e=F(()=>a.getIconForSavedPagesEnabled());x(K,{get checked(){return t(e)},onChange:y})}i(B,M),Z()}export{ue as default};
