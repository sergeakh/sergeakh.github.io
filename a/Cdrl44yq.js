import{Q as xe,p as De,i as Te,C as Se,h as Ce,j as H,k as Pe,R as Ee,u as Le,g as t,o as pe,f as y,m as x,c as p,d as a,n as $e,l as s,q as K,r as j,s as f,B as Q,w as U,S as ne,t as Ie,J as Ae,K as Fe,D as X,L as Ne,v as Me,y as ie}from"./Dp1GyMqO.js";import{N as ze}from"./CHXXXb0v.js";import"./EEzvZiDp.js";const de=(D,u,c,T=new Set,_={},r=Date.now())=>{for(let i=0;i<D.children.length;i++){const d=D.children[i];if(d.tagName==="DT"){const $=d.querySelector(":scope > A"),P=d.querySelector(":scope > H3");if($){const n=$.getAttribute("href"),v=Number($.getAttribute("add_date"))*1e3||r+i,w=$.textContent||"unknown";if(!n)return c;const O=u.find(S=>S.toLowerCase()==="bookmarks bar")?u.filter(S=>S.toLowerCase()!=="bookmarks bar"):["other"];if(_[n])_[n].data.tags=[...new Set([..._[n].data.tags,...O])];else{const S={id:xe(),data:{type:"note",url:n,name:w,text:"",tags:O.length>0?O:[],updatedAt:v,createdAt:v}};_[S.data.url]=S,c.push(S)}}else if(P){const n=P.textContent?.trim();if(n&&P.nextElementSibling?.tagName==="DL"){const v=[...u];v.push(n);const w=P.nextElementSibling;T.has(w)||(T.add(w),de(w,v,c,T,_,r+i))}}}else d.tagName!=="DL"&&d.children.length>0&&(T.has(d)||(T.add(d),de(d,[...u],c,T,_,r+i)))}return c},Be=async D=>{const u=await D.text(),_=new DOMParser().parseFromString(u,"text/html").querySelector("DL");return _?de(_,[],[]):[]},fe=async(D,u)=>{const c=D.target;!c.files||c.files.length===0||await u(c.files[0])};var We=y(`<div class="top svelte-1gjle5b"><p class="message svelte-1gjle5b">Select a file to import your data</p> <p>(browser bookmarks or a this app's file)</p></div> <div class="mobileBottom svelte-1gjle5b"><!></div> <input type="file" accept=".json, .html" style="display: none;"/>`,1),He=y('<p class="message svelte-1gjle5b">Select a file to import your data</p> <div class="desktopContainer svelte-1gjle5b"><div class="dropzoneButtonContainer svelte-1gjle5b"><!></div> <div role="button" tabindex="-1"><div tabindex="-1" class="dropzone-content svelte-1gjle5b"><p class="svelte-1gjle5b">Drag and drop your file here</p> <p class="svelte-1gjle5b">or</p></div> <input type="file" accept=".json, .html" style="display: none;"/></div></div>',1),Oe=y('<div class="top svelte-1gjle5b"><p class="message svelte-1gjle5b">Loading...</p> <!></div>'),qe=y('<div class="top svelte-1gjle5b"><p class="message error svelte-1gjle5b">Something went wrong</p></div> <div class="buttonContainer svelte-1gjle5b"><!></div>',1),Je=(D,u)=>{s(u,!0)},Re=y('<p class="message message__tags svelte-1gjle5b">You can add additional tags to loaded notes</p> <div class="addTagsButtonContainer svelte-1gjle5b"><button class="addTagsButton svelte-1gjle5b">add tags</button></div>',1),Ke=y('<p class="message message__tags svelte-1gjle5b">Additional tags:</p>'),Qe=y('<div class="tagsContainer svelte-1gjle5b"><!> <!></div>'),Ue=y('<div class="buttonContainer svelte-1gjle5b"><!></div>'),Ye=y('<div class="top svelte-1gjle5b"><p class="message success svelte-1gjle5b">File loaded!</p> <!></div> <div class="bottom svelte-1gjle5b"><!> <!></div>',1),Ge=y('<div class="top svelte-1gjle5b"><p class="message success svelte-1gjle5b">Notes imported successfully!</p></div> <div class="buttonContainer svelte-1gjle5b"><!></div>',1),Ve=y('<div class="block svelte-1gjle5b"><!></div>');function tt(D,u){De(u,!0);const{blockDialog:c}=Te(),{importNotes:T}=Se(),{clearStackPages:_}=Ce();let r=H("idle"),i=H(null),d=H(!1),$=H(null),P=[],n=H(Pe([])),v=H(!1);const{checkMobileSize:w}=Ee(),O=()=>{_()};Le(()=>{c(t(r)==="loading")}),pe(()=>(t(i)&&t(i).addEventListener("cancel",e=>{e.preventDefault(),e.stopImmediatePropagation(),e.stopPropagation()}),()=>{c(!1)}));const S=async e=>{const l=await e.text(),I=JSON.parse(l);if(!I.notes)throw new Error("Invalid import file format");for(const A of Object.values(I.notes))A&&P.push(A)},Z=async e=>{s(r,"loading");try{if(e.name.endsWith(".json"))await S(e);else if(e.name.endsWith(".html")){const l=await Be(e);P.push(...l)}else throw new Error("Unsupported file format. Please upload a JSON or HTML file.");await new Promise(l=>setTimeout(l,500)),s(r,"success-loading-file")}catch{s(r,"error")}},ve=()=>{t(i)?.click()},ue=e=>{e.preventDefault(),e.stopPropagation(),s(d,!0)},me=e=>{e.preventDefault(),e.stopPropagation(),s(d,!1)},_e=e=>{e.preventDefault(),e.stopPropagation(),s(d,!0)},be=async e=>{if(e.preventDefault(),e.stopPropagation(),s(d,!1),!e.dataTransfer?.files||e.dataTransfer.files.length===0)return;const l=e.dataTransfer.files[0];if(l.type!=="application/json"&&l.type!=="text/html"){s(r,"error");return}await Z(l)},he=e=>{s(n,e,!0)},je=async()=>{s(r,"loading");try{await T(P.map(e=>({...e,data:{...e.data,tags:Array.from(new Set([...e.data.tags||[],...t(n)]))}}))),await new Promise(e=>setTimeout(e,500)),s(r,"success")}catch{s(r,"error")}},ce=e=>{e.key==="Escape"&&(document.activeElement instanceof HTMLInputElement&&document.activeElement.type==="text"||document.activeElement instanceof HTMLTextAreaElement)&&(t(v)&&s(v,!1),document.activeElement.blur(),e.preventDefault(),e.stopPropagation())};pe(()=>(document.addEventListener("keydown",ce),()=>document.removeEventListener("keydown",ce)));var ge=Ve(),ye=p(ge);{var we=e=>{var l=K(),I=j(l);{var A=g=>{var b=We(),E=f(j(b),2),F=p(E);Q(F,{fullWidth:!0,onClick:ve,children:(o,C)=>{var h=U("Select File");a(o,h)},$$slots:{default:!0}});var N=f(E,2);N.__change=[fe,Z],ne(N,o=>s(i,o),()=>t(i)),a(g,b)},ee=g=>{var b=He(),E=f(j(b),2),F=p(E),N=p(F);Q(N,{onClick:ve,children:(h,Y)=>{var q=U("Select File");a(h,q)},$$slots:{default:!0}});var o=f(F,2),C=f(p(o),2);C.__change=[fe,Z],ne(C,h=>s(i,h),()=>t(i)),ne(o,h=>s($,h),()=>t($)),Ie(()=>Ae(o,1,Fe(["dropzone",{active:t(d)}]),"svelte-1gjle5b")),X("dragenter",o,ue),X("dragover",o,_e),X("dragleave",o,me),X("drop",o,be),a(g,b)};x(I,g=>{w()?g(A):g(ee,!1)})}a(e,l)},ke=e=>{var l=K(),I=j(l);{var A=g=>{var b=Oe(),E=f(p(b),2);Ne(E,{}),a(g,b)},ee=g=>{var b=K(),E=j(b);{var F=o=>{var C=qe(),h=f(j(C),2),Y=p(h);{let q=ie(w);Q(Y,{get fullWidth(){return t(q)},onClick:()=>{s(r,"idle")},children:(L,M)=>{var z=U("Try Again");a(L,z)},$$slots:{default:!0}})}a(o,C)},N=o=>{var C=K(),h=j(C);{var Y=L=>{var M=Ye(),z=j(M),te=f(p(z),2);{var J=m=>{var k=Re(),B=f(j(k),2),R=p(B);R.__click=[Je,v],a(m,k)};x(te,m=>{t(n).length===0&&!t(v)&&m(J)})}var G=f(z,2),V=p(G);{var ae=m=>{var k=Qe(),B=p(k);{var R=W=>{var le=Ke();a(W,le)};x(B,W=>{t(n).length>0&&W(R)})}var oe=f(B,2);ze(oe,{get selectedTags(){return t(n)},onChangeTags:he,get shownTagInput(){return t(v)},set shownTagInput(W){s(v,W,!0)}}),a(m,k)};x(V,m=>{(t(n).length>0||t(v))&&m(ae)})}var se=f(V,2);{var re=m=>{var k=Ue(),B=p(k);{let R=ie(w);Q(B,{get fullWidth(){return t(R)},onClick:je,children:(oe,W)=>{var le=U("Add notes");a(oe,le)},$$slots:{default:!0}})}a(m,k)};x(se,m=>{t(v)||m(re)})}a(L,M)},q=L=>{var M=K(),z=j(M);{var te=J=>{var G=Ge(),V=f(j(G),2),ae=p(V);{let se=ie(w);Q(ae,{get fullWidth(){return t(se)},onClick:O,children:(re,m)=>{var k=U("Close");a(re,k)},$$slots:{default:!0}})}a(J,G)};x(z,J=>{t(r)==="success"&&J(te)},!0)}a(L,M)};x(h,L=>{t(r)==="success-loading-file"?L(Y):L(q,!1)},!0)}a(o,C)};x(E,o=>{t(r)==="error"?o(F):o(N,!1)},!0)}a(g,b)};x(I,g=>{t(r)==="loading"?g(A):g(ee,!1)},!0)}a(e,l)};x(ye,e=>{t(r)==="idle"?e(we):e(ke,!1)})}a(D,ge),$e()}Me(["change","click"]);export{tt as default};
