import{R as Le,p as Ie,i as Ae,D as Fe,h as Ne,j as J,k as We,Q as Me,u as ze,g as a,o as be,f as _,m as j,c as o,d as t,n as Be,l as s,r as f,s as n,T as he,q as le,B as W,w as M,t as He,J as Oe,K as qe,E as oe,L as Je,v as Re,y as we,a as je,I as ye}from"./dPep4g6Y.js";import{N as ke}from"./BCaAILhC.js";import"./B_WuSI3X.js";const ce=(y,i,p,T=new Set,b={},r=Date.now())=>{for(let m=0;m<y.children.length;m++){const v=y.children[m];if(v.tagName==="DT"){const z=v.querySelector(":scope > A"),h=v.querySelector(":scope > H3");if(z){const l=z.getAttribute("href"),w=Number(z.getAttribute("add_date"))*1e3||r+m,k=z.textContent||"unknown";if(!l)return p;const I=i.find(D=>D.toLowerCase()==="bookmarks bar")?i.filter(D=>D.toLowerCase()!=="bookmarks bar"):["other"];if(b[l])b[l].data.tags=[...new Set([...b[l].data.tags,...I])];else{const D={id:Le(),data:{type:"note",url:l,name:k,text:"",tags:I.length>0?I:[],updatedAt:w,createdAt:w}};b[D.data.url]=D,p.push(D)}}else if(h){const l=h.textContent?.trim();if(l&&h.nextElementSibling?.tagName==="DL"){const w=[...i];w.push(l);const k=h.nextElementSibling;T.has(k)||(T.add(k),ce(k,w,p,T,b,r+m))}}}else v.tagName!=="DL"&&v.children.length>0&&(T.has(v)||(T.add(v),ce(v,[...i],p,T,b,r+m)))}return p},Ke=async y=>{const i=await y.text(),b=new DOMParser().parseFromString(i,"text/html").querySelector("DL");return b?ce(b,[],[]):[]},Qe=async(y,i)=>{const p=y.target;!p.files||p.files.length===0||await i(p.files[0])};var Ue=_(`<div class="top svelte-1gjle5b"><p class="message svelte-1gjle5b">Select a file to import your data</p> <p>(browser bookmarks or a this app's file)</p></div> <div class="mobileBottom svelte-1gjle5b"><div class="buttonContainer svelte-1gjle5b"><!></div></div>`,1),Ge=_('<p class="message svelte-1gjle5b">Select a file to import your data</p> <div class="desktopContainer svelte-1gjle5b"><div class="dropzoneButtonContainer svelte-1gjle5b"><!></div> <div role="button" tabindex="-1"><div tabindex="-1" class="dropzone-content svelte-1gjle5b"><p class="svelte-1gjle5b">Drag and drop your file here</p> <p class="svelte-1gjle5b">or</p></div></div></div>',1),Ve=_('<!> <input type="file" accept=".json, .html" style="display: none;"/>',1),Xe=_('<div class="top svelte-1gjle5b"><p class="message svelte-1gjle5b">Loading...</p> <!></div>'),Ye=_('<div class="top svelte-1gjle5b"><p class="message error svelte-1gjle5b">Something went wrong</p></div> <div class="buttonContainer svelte-1gjle5b"><!></div>',1),Ze=(y,i)=>s(i,!a(i)),et=_('<div class="tagsContainer svelte-1gjle5b"><p class="message message__tags svelte-1gjle5b">Additional tags:</p> <!></div>'),tt=_('<div class="buttonContainer svelte-1gjle5b"><!> <!></div>'),at=_('<div class="top svelte-1gjle5b"><p class="message svelte-1gjle5b">File loaded successfully</p></div> <div class="mobileBottom svelte-1gjle5b"><div class="settings svelte-1gjle5b"><button class="link svelte-1gjle5b"><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper><span>Settings</span></button></div> <!> <!></div>',1),st=(y,i)=>s(i,!a(i)),rt=_('<p class="message message__tags svelte-1gjle5b">Additional tags:</p> <div class="wrapNoteFormTags"><!></div>',1),lt=_('<div class="buttonContainer svelte-1gjle5b"><!> <!></div>'),ot=_('<p class="message svelte-1gjle5b">File loaded successfully</p> <div class="settings svelte-1gjle5b"><button class="link svelte-1gjle5b"><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper><span>Settings</span></button></div> <!> <!>',1),nt=_('<div class="top svelte-1gjle5b"><p class="message success svelte-1gjle5b">Notes imported successfully!</p></div> <div class="buttonContainer svelte-1gjle5b"><!></div>',1),it=_('<div class="block svelte-1gjle5b"><!></div>');function gt(y,i){Ie(i,!0);const{blockDialog:p}=Ae(),{importNotes:T}=Fe(),{clearStackPages:b}=Ne();let r=J("idle"),m=J(null),v=J(!1),z=J(null),h=J(We([])),l=J(!1),w=[],k=J(!1);const{checkMobileSize:I}=Me(),D=()=>{b()};ze(()=>{p(a(r)==="loading")}),be(()=>(a(m)&&a(m).addEventListener("cancel",e=>{e.preventDefault(),e.stopImmediatePropagation(),e.stopPropagation()}),()=>{p(!1)}));const xe=async e=>{const d=await e.text(),B=JSON.parse(d),R=[];if(!B.notes)throw new Error("Invalid import file format");for(const K of Object.values(B.notes))K&&R.push(K);return R},ge=async e=>{s(r,"loading");try{if(e.name.endsWith(".json"))w=await xe(e);else if(e.name.endsWith(".html"))w=await Ke(e);else throw new Error("Unsupported file format. Please upload a JSON or HTML file.");await new Promise(d=>setTimeout(d,500)),s(r,"success-loaded")}catch(d){console.error("Error processing file:",d),s(r,"error")}},pe=()=>{a(m)?.click()},Ce=e=>{e.preventDefault(),e.stopPropagation(),s(v,!0)},Te=e=>{e.preventDefault(),e.stopPropagation(),s(v,!1)},De=e=>{e.preventDefault(),e.stopPropagation(),s(v,!0)},Pe=async e=>{if(e.preventDefault(),e.stopPropagation(),s(v,!1),!e.dataTransfer?.files||e.dataTransfer.files.length===0)return;const d=e.dataTransfer.files[0];if(d.type!=="application/json"&&d.type!=="text/html"){s(r,"error");return}await ge(d)},ue=e=>{s(h,e,!0)},fe=async()=>{s(r,"loading"),await T(w.map(e=>({...e,data:{...e.data,tags:Array.from(new Set([...e.data.tags||[],...a(h)]))}}))),await new Promise(e=>setTimeout(e,500)),s(r,"success")},_e=e=>{e.key==="Escape"&&(document.activeElement instanceof HTMLInputElement&&document.activeElement.type==="text"||document.activeElement instanceof HTMLTextAreaElement)&&(a(l)&&s(l,!1),document.activeElement.blur(),e.preventDefault(),e.stopPropagation())};be(()=>(document.addEventListener("keydown",_e),()=>document.removeEventListener("keydown",_e)));var me=it(),Se=o(me);{var $e=e=>{var d=Ve(),B=f(d);{var R=c=>{var S=Ue(),Z=n(f(S),2),Q=o(Z),x=o(Q);W(x,{fullWidth:!0,onClick:pe,children:(g,A)=>{var U=M("Select File");t(g,U)},$$slots:{default:!0}}),t(c,S)},K=c=>{var S=Ge(),Z=n(f(S),2),Q=o(Z),x=o(Q);W(x,{onClick:pe,children:(A,U)=>{var ee=M("Select File");t(A,ee)},$$slots:{default:!0}});var g=n(Q,2);he(g,A=>s(z,A),()=>a(z)),He(()=>Oe(g,1,qe(["dropzone",{active:a(v)}]),"svelte-1gjle5b")),oe("dragenter",g,Ce),oe("dragover",g,De),oe("dragleave",g,Te),oe("drop",g,Pe),t(c,S)};j(B,c=>{I()?c(R):c(K,!1)})}var P=n(B,2);P.__change=[Qe,ge],he(P,c=>s(m,c),()=>a(m)),t(e,d)},Ee=e=>{var d=le(),B=f(d);{var R=P=>{var c=Xe(),S=n(o(c),2);Je(S,{}),t(P,c)},K=P=>{var c=le(),S=f(c);{var Z=x=>{var g=Ye(),A=n(f(g),2),U=o(A);{let ee=we(I);W(U,{get fullWidth(){return a(ee)},onClick:()=>{s(r,"idle")},children:(F,G)=>{var te=M("Try Again");t(F,te)},$$slots:{default:!0}})}t(x,g)},Q=x=>{var g=le(),A=f(g);{var U=F=>{var G=le(),te=f(G);{var ne=$=>{var H=at(),V=n(f(H),2),O=o(V),q=o(O);q.__click=[Ze,k];var X=o(q);je(X,()=>({"--rotate":"30deg","--size":"20px"})),ye(X.lastChild,{name:"settings"});var Y=n(O,2);{var ie=u=>{var C=et(),N=n(o(C),2);ke(N,{get selectedTags(){return a(h)},onChangeTags:ue,get shownTagInput(){return a(l)},set shownTagInput(L){s(l,L,!0)}}),t(u,C)};j(Y,u=>{a(k)&&u(ie)})}var de=n(Y,2);{var E=u=>{var C=tt(),N=o(C);W(N,{withoutMinWidth:!0,fullWidth:!0,type:"secondary",onClick:()=>{s(r,"idle"),w=[],s(h,[],!0)},children:(se,re)=>{var ve=M("Cancel");t(se,ve)},$$slots:{default:!0}});var L=n(N,2);W(L,{fullWidth:!0,withoutMinWidth:!0,onClick:fe,children:(se,re)=>{var ve=M("Add notes");t(se,ve)},$$slots:{default:!0}}),t(u,C)};j(de,u=>{a(l)||u(E)})}t($,H)},ae=$=>{var H=ot(),V=n(f(H),2),O=o(V);O.__click=[st,k];var q=o(O);je(q,()=>({"--rotate":"30deg","--size":"20px"})),ye(q.lastChild,{name:"settings"});var X=n(V,2);{var Y=E=>{var u=rt(),C=n(f(u),2),N=o(C);ke(N,{get selectedTags(){return a(h)},onChangeTags:ue,get shownTagInput(){return a(l)},set shownTagInput(L){s(l,L,!0)}}),t(E,u)};j(X,E=>{a(k)&&E(Y)})}var ie=n(X,2);{var de=E=>{var u=lt(),C=o(u);W(C,{type:"secondary",fullWidth:!0,onClick:()=>{s(r,"idle"),w=[],s(h,[],!0)},children:(L,se)=>{var re=M("Cancel");t(L,re)},$$slots:{default:!0}});var N=n(C,2);W(N,{fullWidth:!0,onClick:fe,children:(L,se)=>{var re=M("Add notes");t(L,re)},$$slots:{default:!0}}),t(E,u)};j(ie,E=>{a(l)||E(de)})}t($,H)};j(te,$=>{I()?$(ne):$(ae,!1)})}t(F,G)},ee=F=>{var G=le(),te=f(G);{var ne=ae=>{var $=nt(),H=n(f($),2),V=o(H);{let O=we(I);W(V,{get fullWidth(){return a(O)},onClick:D,children:(q,X)=>{var Y=M("Close");t(q,Y)},$$slots:{default:!0}})}t(ae,$)};j(te,ae=>{a(r)==="success"&&ae(ne)},!0)}t(F,G)};j(A,F=>{a(r)==="success-loaded"?F(U):F(ee,!1)},!0)}t(x,g)};j(S,x=>{a(r)==="error"?x(Z):x(Q,!1)},!0)}t(P,c)};j(B,P=>{a(r)==="loading"?P(R):P(K,!1)},!0)}t(e,d)};j(Se,e=>{a(r)==="idle"?e($e):e(Ee,!1)})}t(y,me),Be()}Re(["change","click"]);export{gt as default};
