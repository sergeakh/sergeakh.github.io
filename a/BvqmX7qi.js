import{p as Y,G as Z,j as b,k as $,u as _t,g as t,f as x,m as M,c as i,T as H,l as o,d as c,n as tt,s as w,r as pt,v as et,D as gt,Q as mt,o as ht,y as E,J as wt,K as bt,t as q,M as O,E as xt,B as V,w as X,x as kt}from"./DHUnNjYr.js";import{N as Dt}from"./DqjE3dbA.js";import{I as It}from"./BvdpVJUB.js";var Nt=(u,a,r,f)=>{o(a,r.url,!0),f(!1)},yt=(u,a,r,f,I)=>{if(t(a)&&t(r)){o(a,"");return}f.onChangeUrl(t(a)),I(!1)},Ut=x('<div class="wrapper svelte-w8w68w"><!> <div class="containerButtons svelte-w8w68w"><button class="svelte-w8w68w">Cancel</button> <button class="svelte-w8w68w">Done</button></div></div>'),Ct=(u,a)=>{a(!0)},Tt=(u,a,r)=>{o(a,""),r.onDeleteUrl()},Et=x('<button class="button svelte-w8w68w">Edit link</button> <button class="button svelte-w8w68w">Delete link</button>',1),Bt=(u,a)=>{a(!0)},Mt=x('<button class="button svelte-w8w68w">Add link</button>'),At=x('<div class="wrapperButtons svelte-w8w68w"><!></div>'),Lt=x("<div><!></div>");function St(u,a){Y(a,!0);let r=Z(a,"shownUrlInput",15),f=b(""),I=b(null),A=b(null),k=b($(a.url));const S=n=>{o(f,""),o(k,n.target.value||"",!0);try{new URL(t(k))}catch{o(f,"Invalid URL")}};_t(()=>{r()&&t(I)?.focus()});var g=Lt(),s=i(g);{var v=n=>{var d=Ut(),D=i(d);It(D,{get value(){return t(k)},get error(){return t(f)},onInput:S,placeholder:"url",get ref(){return t(I)},set ref(p){o(I,p,!0)}});var m=w(D,2),U=i(m);U.__click=[Nt,k,a,r];var _=w(U,2);_.__click=[yt,k,f,a,r],c(n,d)},N=n=>{var d=At(),D=i(d);{var m=_=>{var p=Et(),L=pt(p);L.__click=[Ct,r];var W=w(L,2);W.__click=[Tt,k,a],c(_,p)},U=_=>{var p=Mt();p.__click=[Bt,r],c(_,p)};M(D,_=>{a.url?_(m):_(U,!1)})}c(n,d)};M(s,n=>{r()?n(v):n(N,!1)})}H(g,n=>o(A,n),()=>t(A)),c(u,g),tt()}et(["click"]);const Wt=(u,a,r)=>{t(a)&&(t(a).style.height="auto",t(a).style.height=t(a).scrollHeight+"px"),r({text:u.target.value.trim()})},Rt=(u,a)=>{a({name:u.target.value.trim()})};var Ft=x("<span> </span>"),Pt=x('<div class="dateInfo svelte-t8fgpr"><!></div>'),Ht=x('<div class="submitButtons svelte-t8fgpr"><!> <!></div>'),zt=x('<div class="form svelte-t8fgpr"><div class="scrollWrapper"><div class="formFields"><!> <form><input class="inputName svelte-t8fgpr" placeholder="Name"/></form> <textarea class="textarea svelte-t8fgpr" placeholder="Note"></textarea></div></div> <div><!> <div class="formTagsWrapper svelte-t8fgpr"><!></div> <!></div></div>');function Kt(u,a){Y(a,!0);const{getNoteById:r,deleteNoteDraft:f,saveNoteDraft:I,putNoteDraft:A}=gt(),{checkMobileSize:k}=mt();let S=Z(a,"mode",3,"add"),g=b($(a.noteId||r()?.id||"")),s=E(()=>r(t(g))?.data||null),v=E(()=>t(s)?.draft||null),N=b(null),n=b(!1),d=b(!1),D=b(null);const m=async({name:e,url:y,text:C,tags:B})=>{let l=B?.map(h=>h.trim())||t(v)?.tags||t(s)?.tags||[];l.length===0?l=["inbox"]:l.length>1&&l.includes("inbox")&&(l=l.filter(h=>h!=="inbox"));const T={name:e??t(v)?.name??t(s)?.name??"",url:y??t(v)?.url??t(s)?.url??"",text:C??t(v)?.text??t(s)?.text??"",tags:l,createdAt:t(v)?.createdAt||Date.now(),updatedAt:Date.now()};o(g,await A(t(g),T)||"",!0)},U=e=>{e.preventDefault(),I(t(g)),a.onSubmit()},_=e=>{e.preventDefault(),t(N)&&t(N).focus()},p=e=>{e.key==="Escape"&&(document.activeElement instanceof HTMLInputElement&&document.activeElement.type==="text"||document.activeElement instanceof HTMLTextAreaElement)&&(t(n)&&(o(n,!1),e.preventDefault(),e.stopPropagation()),t(d)&&(o(d,!1),e.preventDefault(),e.stopPropagation()))};ht(()=>(k()||t(D)?.focus(),document.addEventListener("keydown",p),()=>document.removeEventListener("keydown",p)));const L=e=>{m({url:e})},W=()=>{m({url:""})},at=e=>{m({tags:e})},rt=()=>{f(t(g))};let nt=E(()=>t(v)?.name??t(s)?.name??""),lt=E(()=>t(v)?.url??t(s)?.url??""),ot=E(()=>t(v)?.text??t(s)?.text??""),st=E(()=>(t(v)?.tags??t(s)?.tags??[]).filter(e=>e!=="inbox"));var z=zt(),j=i(z),it=i(j),G=i(it);St(G,{get url(){return t(lt)},onChangeUrl:L,onDeleteUrl:W,get shownUrlInput(){return t(d)},set shownUrlInput(e){o(d,e,!0)}});var R=w(G,2),F=i(R);F.__input=[Rt,m],H(F,e=>o(D,e),()=>t(D));var P=w(R,2);P.__input=[Wt,N,m],H(P,e=>o(N,e),()=>t(N));var J=w(j,2);wt(J,1,bt(["bottom","bottomSpace"]),"svelte-t8fgpr");var K=i(J);{var ut=e=>{var y=Pt(),C=i(y);{var B=l=>{var T=Ft(),h=i(T);q(ft=>kt(h,`updated: ${ft??""}`),[()=>new Date(t(s).updatedAt).toLocaleString()]),c(l,T)};M(C,l=>{t(s)?.updatedAt&&l(B)})}c(e,y)};M(K,e=>{S()==="edit"&&e(ut)})}var Q=w(K,2),vt=i(Q);Dt(vt,{get selectedTags(){return t(st)},onChangeTags:at,get shownTagInput(){return t(n)},set shownTagInput(e){o(n,e,!0)}});var dt=w(Q,2);{var ct=e=>{var y=Ht(),C=i(y);V(C,{fullWidth:!0,withoutMinWidth:!0,onClick:rt,type:"secondary",typeButton:"button",children:(l,T)=>{var h=X("cancel");c(l,h)},$$slots:{default:!0}});var B=w(C,2);V(B,{fullWidth:!0,withoutMinWidth:!0,onClick:U,typeButton:"submit",children:(l,T)=>{var h=X("save");c(l,h)},$$slots:{default:!0}}),c(e,y)};M(dt,e=>{!t(n)&&!t(d)&&t(v)&&e(ct)})}q(()=>{O(F,t(nt)),O(P,t(ot))}),xt("submit",R,_),c(u,z),tt()}et(["input"]);export{Kt as N};
