import{p as tt,C as bt,J as S,u as ut,g as t,j as _,l as r,o as dt,f as y,e as lt,W as z,c as u,s as w,m as U,y as P,T as Q,d as b,n as et,q as kt,r as vt,D as ct,v as at,k as O,E as Tt,K as xt,M as Ct,X as st,B as it,w as ot,t as pt,x as yt}from"./DtQJC0dW.js";import{I as ft}from"./B6mHuETC.js";var It=(k,e,s,g)=>{t(e)!==""&&s(t(e)),g(!1),r(e,"")},Dt=y('<form class="formNewTag svelte-1dwadiy"><div class="inputWrapper svelte-1dwadiy"><!></div> <button type="button" class="buttonDone svelte-1dwadiy">Done</button></form>'),Nt=y('<div class="block"><div class="tags svelte-1dwadiy"><!> <!> <!> <!></div> <!></div>');function Ut(k,e){tt(e,!0);const{isInitedNotes:s,getGetNotes:g}=bt();let m=_(null),l=_(""),h=_(null);const W=P(s);let d=S(e,"shownTagInput",15);const E=a=>{e.selectedTags.includes(a)||(r(l,""),e.onChangeTags([...e.selectedTags,a]),t(m)?.focus())},D=a=>{const o=e.selectedTags.filter(x=>x!==a);o.length===0?e.onChangeTags([]):e.onChangeTags(o)};let I=P(()=>t(W)?[...(g()()||[]).reduce((a,o)=>(o?.data.tags.forEach(x=>{a.has(x)||a.add(x)}),a),new Set)]:[]),i=P(()=>t(W)?t(I).filter(a=>!e.selectedTags.some(o=>a===o)&&a!=="inbox"):[]),c=P(()=>t(i).find(a=>a.toLowerCase()===t(l).toLowerCase())||e.selectedTags.includes(t(l))),C=P(()=>t(i).filter(a=>t(l)===""?!0:a.toLowerCase().indexOf(t(l).toLowerCase())===0).slice(0,t(c)||t(l)===""?3:2));const p=a=>{a.preventDefault(),t(l)!==""?(E(t(l)),r(l,"")):d(!1)};ut(()=>{t(m)&&d()&&t(m).focus(),d()||r(l,"")});const T=a=>{a.target&&t(h)&&!t(h).contains(a.target)&&(d(!1),r(l,""))};dt(()=>(document.addEventListener("click",T,{capture:!0}),()=>{document.removeEventListener("click",T,{capture:!0})}));var f=Nt(),v=u(f),B=u(v);lt(B,16,()=>e.selectedTags,a=>a,(a,o)=>{z(a,{get title(){return o},onClick:()=>D(o),type:"button",style:"selected"})});var A=w(B,2);{var j=a=>{var o=kt(),x=vt(o);lt(x,16,()=>t(C),N=>N,(N,L)=>{z(N,{get title(){return L},onClick:()=>E(L)})}),b(a,o)};U(A,a=>{t(l)!==""&&a(j)})}var q=w(A,2);{var V=a=>{z(a,{get title(){return t(l)},onClick:()=>{E(t(l)),r(l,"")}})};U(q,a=>{!t(c)&&t(l)!==""&&a(V)})}var Y=w(q,2);{var Z=a=>{z(a,{title:"add tag",onClick:()=>d(!0)})};U(Y,a=>{d()||a(Z)})}var G=w(v,2);{var J=a=>{var o=Dt(),x=u(o),N=u(x);ft(N,{placeholder:"tag",get ref(){return t(m)},set ref(F){r(m,F,!0)},get value(){return t(l)},set value(F){r(l,F,!0)}});var L=w(x,2);L.__click=[It,l,E,d],ct("submit",o,p),b(a,o)};U(G,a=>{d()&&a(J)})}Q(f,a=>r(h,a),()=>t(h)),b(k,f),et()}at(["click"]);var Et=(k,e,s,g)=>{r(e,s.url,!0),g(!1)},Lt=(k,e,s,g,m)=>{if(t(e)&&t(s)){r(e,"");return}g.onChangeUrl(t(e)),m(!1)},St=y('<div class="wrapper svelte-w8w68w"><!> <div class="containerButtons svelte-w8w68w"><button class="svelte-w8w68w">Cancel</button> <button class="svelte-w8w68w">Done</button></div></div>'),Wt=(k,e)=>{e(!0)},Bt=(k,e,s)=>{r(e,""),s.onDeleteUrl()},Rt=y('<button class="button svelte-w8w68w">Edit link</button> <button class="button svelte-w8w68w">Delete link</button>',1),Mt=(k,e)=>{e(!0)},At=y('<button class="button svelte-w8w68w">Add link</button>'),Ft=y('<div class="wrapperButtons svelte-w8w68w"><!></div>'),Ht=y("<div><!></div>");function Pt(k,e){tt(e,!0);let s=S(e,"shownUrlInput",15),g=_(""),m=_(null),l=_(null),h=_(O(e.url));const W=i=>{r(g,""),r(h,i.target.value||"",!0);try{new URL(t(h))}catch{r(g,"Invalid URL")}};ut(()=>{s()&&t(m)?.focus()});var d=Ht(),E=u(d);{var D=i=>{var c=St(),C=u(c);ft(C,{get value(){return t(h)},get error(){return t(g)},onInput:W,placeholder:"url",get ref(){return t(m)},set ref(v){r(m,v,!0)}});var p=w(C,2),T=u(p);T.__click=[Et,h,e,s];var f=w(T,2);f.__click=[Lt,h,g,e,s],b(i,c)},I=i=>{var c=Ft(),C=u(c);{var p=f=>{var v=Rt(),B=vt(v);B.__click=[Wt,s];var A=w(B,2);A.__click=[Bt,h,e],b(f,v)},T=f=>{var v=At();v.__click=[Mt,s],b(f,v)};U(C,f=>{e.url?f(p):f(T,!1)})}b(i,c)};U(E,i=>{s()?i(D):i(I,!1)})}Q(d,i=>r(l,i),()=>t(l)),b(k,d),et()}at(["click"]);const Ot=(k,e,s)=>{t(e)&&(t(e).style.height="auto",t(e).style.height=t(e).scrollHeight+"px"),s()},jt=(k,e)=>{e()};var qt=y("<span> </span>"),Gt=y('<div class="dateInfo svelte-t8fgpr"><!></div>'),Jt=y('<div class="submitButtons svelte-t8fgpr"><!> <!></div>'),Kt=y('<div class="form svelte-t8fgpr"><div class="scrollWrapper"><div class="formFields"><!> <form><input class="inputName svelte-t8fgpr" placeholder="Name"/></form> <textarea class="textarea svelte-t8fgpr" placeholder="Note"></textarea></div></div> <div><!> <div class="formTagsWrapper svelte-t8fgpr"><!></div> <!></div></div>');function Qt(k,e){tt(e,!0);const{deleteDraft:s,putDraft:g}=Tt();let m=S(e,"initialName",3,""),l=S(e,"initialUrl",3,""),h=S(e,"initialText",3,""),W=S(e,"initialTags",19,()=>[]),d=S(e,"noteId",3,""),E=S(e,"mode",3,"add"),D=_(O(e.draft?.data.name||m())),I=_(O(e.draft?.data.url||l())),i=_(O(e.draft?.data.text||h())),c=_(O((e.draft?.data.tags||W()).filter(n=>n!=="inbox"))),C=_(null),p=_(!1),T=_(!1),f=_(null);const v=()=>{const n={id:d(),data:{name:t(D),url:t(I),text:t(i),tags:t(c).map(R=>R.trim())}};g(n)},B=n=>{n.preventDefault(),s(d()),e.onSubmit({name:t(D).trim().slice(0,256)||"unkwown",url:t(I).trim().slice(0,2048),text:t(i).trim().slice(0,2048),tags:t(c).length>0?t(c):["inbox"]})},A=n=>{n.preventDefault(),t(C)&&t(C).focus()},j=n=>{n.key==="Escape"&&(document.activeElement instanceof HTMLInputElement&&document.activeElement.type==="text"||document.activeElement instanceof HTMLTextAreaElement)&&(t(p)&&r(p,!1),t(T)&&r(T,!1),document.activeElement.blur(),n.preventDefault(),n.stopPropagation())};dt(()=>(document.addEventListener("keydown",j),()=>document.removeEventListener("keydown",j)));const q=n=>{r(I,n,!0),v()},V=()=>{r(I,""),v()},Y=n=>{r(c,n,!0),v()},Z=()=>{s(d()),r(D,m()),r(I,l()),r(i,h()),r(c,W().filter(n=>n!=="inbox"),!0)};var G=Kt(),J=u(G),a=u(J),o=u(a);Pt(o,{get url(){return t(I)},onChangeUrl:q,onDeleteUrl:V,get shownUrlInput(){return t(T)},set shownUrlInput(n){r(T,n,!0)}});var x=w(o,2),N=u(x);N.__input=[jt,v],Q(N,n=>r(f,n),()=>t(f));var L=w(x,2);L.__input=[Ot,C,v],Q(L,n=>r(C,n),()=>t(C));var F=w(J,2);xt(F,1,Ct(["bottom","bottomSpace"]),"svelte-t8fgpr");var nt=u(F);{var _t=n=>{var R=Gt(),K=u(R);{var $=M=>{var X=qt(),H=u(X);pt(wt=>yt(H,`updated: ${wt??""}`),[()=>new Date(e.updatedAt).toLocaleString()]),b(M,X)};U(K,M=>{e.updatedAt&&M($)})}b(n,R)};U(nt,n=>{E()==="edit"&&n(_t)})}var rt=w(nt,2),gt=u(rt);Ut(gt,{get selectedTags(){return t(c)},onChangeTags:Y,get shownTagInput(){return t(p)},set shownTagInput(n){r(p,n,!0)}});var mt=w(rt,2);{var ht=n=>{var R=Jt(),K=u(R);it(K,{fullWidth:!0,withoutMinWidth:!0,onClick:Z,type:"secondary",typeButton:"button",children:(M,X)=>{var H=ot("cancel");b(M,H)},$$slots:{default:!0}});var $=w(K,2);it($,{fullWidth:!0,withoutMinWidth:!0,onClick:B,typeButton:"submit",children:(M,X)=>{var H=ot("save");b(M,H)},$$slots:{default:!0}}),b(n,R)};U(mt,n=>{!t(p)&&!t(T)&&e.draft&&n(ht)})}ct("submit",x,A),st(N,()=>t(D),n=>r(D,n)),st(L,()=>t(i),n=>r(i,n)),b(k,G),et()}at(["input"]);export{Qt as N};
