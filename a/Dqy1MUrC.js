import{p as Y,G as Z,j as h,k as $,u as ft,g as t,f as w,m as L,c as u,S as P,l as s,d as c,n as tt,s as g,r as _t,v as et,C as pt,o as mt,y as E,J as gt,K as ht,t as O,M as Q,D as wt,B as V,w as X,x as bt}from"./CIhqqm6N.js";import{N as xt}from"./DdyZLl37.js";import{I as kt}from"./Bd6Vds6r.js";var Dt=(i,e,r,f)=>{s(e,r.url,!0),f(!1)},It=(i,e,r,f,k)=>{if(t(e)&&t(r)){s(e,"");return}f.onChangeUrl(t(e)),k(!1)},Nt=w('<div class="wrapper svelte-w8w68w"><!> <div class="containerButtons svelte-w8w68w"><button class="svelte-w8w68w">Cancel</button> <button class="svelte-w8w68w">Done</button></div></div>'),yt=(i,e)=>{e(!0)},Ut=(i,e,r)=>{s(e,""),r.onDeleteUrl()},Ct=w('<button class="button svelte-w8w68w">Edit link</button> <button class="button svelte-w8w68w">Delete link</button>',1),Tt=(i,e)=>{e(!0)},Et=w('<button class="button svelte-w8w68w">Add link</button>'),Bt=w('<div class="wrapperButtons svelte-w8w68w"><!></div>'),At=w("<div><!></div>");function Lt(i,e){Y(e,!0);let r=Z(e,"shownUrlInput",15),f=h(""),k=h(null),M=h(null),b=h($(e.url));const D=n=>{s(f,""),s(b,n.target.value||"",!0);try{new URL(t(b))}catch{s(f,"Invalid URL")}};ft(()=>{r()&&t(k)?.focus()});var l=At(),v=u(l);{var I=n=>{var x=Nt(),_=u(x);kt(_,{get value(){return t(b)},get error(){return t(f)},onInput:D,placeholder:"url",get ref(){return t(k)},set ref(p){s(k,p,!0)}});var B=g(_,2),U=u(B);U.__click=[Dt,b,e,r];var d=g(U,2);d.__click=[It,b,f,e,r],c(n,x)},N=n=>{var x=Bt(),_=u(x);{var B=d=>{var p=Ct(),S=_t(p);S.__click=[yt,r];var W=g(S,2);W.__click=[Ut,b,e],c(d,p)},U=d=>{var p=Et();p.__click=[Tt,r],c(d,p)};L(_,d=>{e.url?d(B):d(U,!1)})}c(n,x)};L(v,n=>{r()?n(I):n(N,!1)})}P(l,n=>s(M,n),()=>t(M)),c(i,l),tt()}et(["click"]);const Mt=(i,e,r)=>{t(e)&&(t(e).style.height="auto",t(e).style.height=t(e).scrollHeight+"px"),r({text:i.target.value.trim()})},St=(i,e)=>{e({name:i.target.value.trim()})};var Wt=w("<span> </span>"),Rt=w('<div class="dateInfo svelte-t8fgpr"><!></div>'),Ft=w('<div class="submitButtons svelte-t8fgpr"><!> <!></div>'),Ht=w('<div class="form svelte-t8fgpr"><div class="scrollWrapper"><div class="formFields"><!> <form><input class="inputName svelte-t8fgpr" placeholder="Name"/></form> <textarea class="textarea svelte-t8fgpr" placeholder="Note"></textarea></div></div> <div><!> <div class="formTagsWrapper svelte-t8fgpr"><!></div> <!></div></div>');function Jt(i,e){Y(e,!0);const{getNoteById:r,deleteNoteDraft:f,saveNoteDraft:k,putNoteDraft:M}=pt();let b=Z(e,"mode",3,"add"),D=h($(e.noteId||r()?.id||"")),l=E(()=>r(t(D))?.data||null),v=E(()=>t(l)?.draft||null),I=h(null),N=h(!1),n=h(!1),x=h(null);const _=async({name:a,url:y,text:C,tags:A})=>{let o=A?.map(m=>m.trim())||t(v)?.tags||t(l)?.tags||[];o.length===0?o=["inbox"]:o.length>1&&o.includes("inbox")&&(o=o.filter(m=>m!=="inbox"));const T={name:a??t(v)?.name??t(l)?.name??"",url:y??t(v)?.url??t(l)?.url??"",text:C??t(v)?.text??t(l)?.text??"",tags:o,createdAt:t(v)?.createdAt||Date.now(),updatedAt:Date.now()};s(D,await M(t(D),T)||"",!0)},B=a=>{a.preventDefault(),k(t(D)),e.onSubmit()},U=a=>{a.preventDefault(),t(I)&&t(I).focus()},d=a=>{a.key==="Escape"&&(document.activeElement instanceof HTMLInputElement&&document.activeElement.type==="text"||document.activeElement instanceof HTMLTextAreaElement)&&(t(N)&&s(N,!1),t(n)&&s(n,!1),document.activeElement.blur(),a.preventDefault(),a.stopPropagation())};mt(()=>(document.addEventListener("keydown",d),()=>document.removeEventListener("keydown",d)));const p=a=>{_({url:a})},S=()=>{_({url:""})},W=a=>{_({tags:a})},at=()=>{f(t(D))};let rt=E(()=>t(v)?.name??t(l)?.name??""),nt=E(()=>t(v)?.url??t(l)?.url??""),lt=E(()=>t(v)?.text??t(l)?.text??""),ot=E(()=>(t(v)?.tags??t(l)?.tags??[]).filter(a=>a!=="inbox"));var j=Ht(),G=u(j),st=u(G),J=u(st);Lt(J,{get url(){return t(nt)},onChangeUrl:p,onDeleteUrl:S,get shownUrlInput(){return t(n)},set shownUrlInput(a){s(n,a,!0)}});var R=g(J,2),F=u(R);F.__input=[St,_],P(F,a=>s(x,a),()=>t(x));var H=g(R,2);H.__input=[Mt,I,_],P(H,a=>s(I,a),()=>t(I));var K=g(G,2);gt(K,1,ht(["bottom","bottomSpace"]),"svelte-t8fgpr");var q=u(K);{var ut=a=>{var y=Rt(),C=u(y);{var A=o=>{var T=Wt(),m=u(T);O(ct=>bt(m,`updated: ${ct??""}`),[()=>new Date(t(l).updatedAt).toLocaleString()]),c(o,T)};L(C,o=>{t(l)?.updatedAt&&o(A)})}c(a,y)};L(q,a=>{b()==="edit"&&a(ut)})}var z=g(q,2),it=u(z);xt(it,{get selectedTags(){return t(ot)},onChangeTags:W,get shownTagInput(){return t(N)},set shownTagInput(a){s(N,a,!0)}});var vt=g(z,2);{var dt=a=>{var y=Ft(),C=u(y);V(C,{fullWidth:!0,withoutMinWidth:!0,onClick:at,type:"secondary",typeButton:"button",children:(o,T)=>{var m=X("cancel");c(o,m)},$$slots:{default:!0}});var A=g(C,2);V(A,{fullWidth:!0,withoutMinWidth:!0,onClick:B,typeButton:"submit",children:(o,T)=>{var m=X("save");c(o,m)},$$slots:{default:!0}}),c(a,y)};L(vt,a=>{!t(N)&&!t(n)&&t(v)&&a(dt)})}O(()=>{Q(F,t(rt)),Q(H,t(lt))}),wt("submit",R,U),c(i,j),tt()}et(["input"]);export{Jt as N};
