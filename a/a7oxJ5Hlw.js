import{p as O,J as b,X as L,C as M,b as d,w as j,x as A,g as t,A as B,o as m,y as E,n as F,j as G,i as V,m as X,a}from"./aDVJRJgX9.js";import{s as p,N as q}from"./aBachEBfv.js";function K(N,x){O(x,!0);const{isInitedNotes:y,createNote:h,updateNote:k,deleteNote:I,getNoteById:S}=b(),{getViewMode:z}=L(),{setSearchParam:w,deleteSearchParam:g}=M();let f=d("loading"),i=d("idle"),n=d(""),r=d(void 0),s=d(""),o=d(j([]));const v=()=>{{const e=JSON.parse(localStorage.getItem("new-note-draft")||"{}");localStorage.removeItem("new-note-draft");const l=e.link?.url||"",_=e.link?.title||"";a(s,e.text||"",!0),a(o,e.tags||[],!0),a(r,{url:l||"",title:_||""},!0),a(f,"finish")}},c=B(()=>y()&&t(f)==="finish"),C=async()=>{if(t(r)||t(s)||t(o).length>0){if(t(n)){const e=S(t(n));if(!e?.data)return;if((e.data.link?.url!==t(r)?.url||e.data.link?.title!==t(r)?.title||e.data.text!==t(s)||JSON.stringify(e.data.tags)!==JSON.stringify(t(o)))&&t(i)==="idle"){a(i,"loading");try{await k(t(n),{link:p(t(r)),text:t(s),tags:t(o).slice()})}finally{a(i,"idle")}}}else if(t(i)==="idle"){a(i,"loading");try{a(n,await h({link:p(t(r)),text:t(s),tags:t(o).slice()}),!0),w("noteId",t(n))}catch{}finally{a(i,"idle")}}}else if(t(n)&&t(i)==="idle"){a(i,"loading");try{await I(t(n)),a(n,""),g("noteId")}finally{a(i,"idle")}}};A(()=>{t(c)&&t(i)!=="loading"&&C()}),m(()=>{v()}),m(()=>()=>{t(n)&&g("noteId")});var u=E(),J=F(u);{var P=e=>{q(e,{mode:"add",get link(){return t(r)},set link(l){a(r,l,!0)},get text(){return t(s)},set text(l){a(s,l,!0)},get tags(){return t(o)},set tags(l){a(o,l,!0)}})};G(J,e=>{t(c)&&e(P)})}V(N,u),X()}export{K as default};
