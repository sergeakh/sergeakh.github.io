import{p as tt,C as ht,J as U,u as ot,g as t,j as m,l as r,o as $,f as y,e as lt,W as X,c as u,s as h,m as N,y as H,T as et,d as w,n as at,q as wt,r as dt,D as ut,v as nt,k as O,E as bt,K as kt,M as Tt,X as Ct,B as st,w as it,t as xt,x as pt}from"./C2_kz5eG.js";import{I as vt}from"./COPqNz9R.js";var yt=(b,e,i,f)=>{t(e)!==""&&i(t(e)),f(!1),r(e,"")},Dt=y('<form class="formNewTag svelte-1dwadiy"><div class="inputWrapper svelte-1dwadiy"><!></div> <button type="button" class="buttonDone svelte-1dwadiy">Done</button></form>'),It=y('<div class="block"><div class="tags svelte-1dwadiy"><!> <!> <!> <!></div> <!></div>');function Et(b,e){tt(e,!0);const{isReadyNotes:i,getGetNotes:f}=ht();let _=m(null),l=m(""),g=m(null);const L=H(i);let v=U(e,"shownTagInput",15);const I=a=>{e.selectedTags.includes(a)||(r(l,""),e.onChangeTags([...e.selectedTags,a]),t(_)?.focus())},E=a=>{const s=e.selectedTags.filter(k=>k!==a);s.length===0?e.onChangeTags([]):e.onChangeTags(s)};let D=H(()=>t(L)?[...(f()()||[]).reduce((a,s)=>(s?.data.tags.forEach(k=>{a.has(k)||a.add(k)}),a),new Set)]:[]),d=H(()=>t(L)?t(D).filter(a=>!e.selectedTags.some(s=>a===s)&&a!=="inbox"):[]),c=H(()=>t(d).find(a=>a.toLowerCase()===t(l).toLowerCase())||e.selectedTags.includes(t(l))),T=H(()=>t(d).filter(a=>t(l)===""?!0:a.toLowerCase().indexOf(t(l).toLowerCase())===0).slice(0,t(c)||t(l)===""?3:2));const x=a=>{a.preventDefault(),t(l)!==""?(I(t(l)),r(l,"")):v(!1)};ot(()=>{t(_)&&v()&&t(_).focus(),v()||r(l,"")});const p=a=>{a.target&&t(g)&&!t(g).contains(a.target)&&(v(!1),r(l,""))};$(()=>(document.addEventListener("click",p,{capture:!0}),()=>{document.removeEventListener("click",p,{capture:!0})}));var o=It(),C=u(o),S=u(C);lt(S,16,()=>e.selectedTags,a=>a,(a,s)=>{X(a,{get title(){return s},onClick:()=>E(s),type:"button",style:"selected"})});var R=h(S,2);{var z=a=>{var s=wt(),k=dt(s);lt(k,16,()=>t(T),W=>W,(W,B)=>{X(W,{get title(){return B},onClick:()=>I(B)})}),w(a,s)};N(R,a=>{t(l)!==""&&a(z)})}var j=h(R,2);{var Q=a=>{X(a,{get title(){return t(l)},onClick:()=>{I(t(l)),r(l,"")}})};N(j,a=>{!t(c)&&t(l)!==""&&a(Q)})}var V=h(j,2);{var q=a=>{X(a,{title:"add tag",onClick:()=>v(!0)})};N(V,a=>{v()||a(q)})}var G=h(C,2);{var Y=a=>{var s=Dt(),k=u(s),W=u(k);vt(W,{placeholder:"tag",get ref(){return t(_)},set ref(F){r(_,F,!0)},get value(){return t(l)},set value(F){r(l,F,!0)}});var B=h(k,2);B.__click=[yt,l,I,v],ut("submit",s,x),w(a,s)};N(G,a=>{v()&&a(Y)})}et(o,a=>r(g,a),()=>t(g)),w(b,o),at()}nt(["click"]);var Nt=(b,e,i,f)=>{r(e,i.url,!0),f(!1)},Ut=(b,e,i,f,_)=>{if(t(e)&&t(i)){r(e,"");return}f.onChangeUrl(t(e)),_(!1)},Lt=y('<div class="wrapper svelte-w8w68w"><!> <div class="containerButtons svelte-w8w68w"><button class="svelte-w8w68w">Cancel</button> <button class="svelte-w8w68w">Done</button></div></div>'),St=(b,e)=>{e(!0)},Rt=(b,e,i)=>{r(e,""),i.onDeleteUrl()},Wt=y('<button class="button svelte-w8w68w">Edit link</button> <button class="button svelte-w8w68w">Delete link</button>',1),Bt=(b,e)=>{e(!0)},Mt=y('<button class="button svelte-w8w68w">Add link</button>'),At=y('<div class="wrapperButtons svelte-w8w68w"><!></div>'),Ft=y("<div><!></div>");function Pt(b,e){tt(e,!0);let i=U(e,"shownUrlInput",15),f=m(""),_=m(null),l=m(null),g=m(O(e.url));const L=d=>{r(f,""),r(g,d.target.value||"",!0);try{new URL(t(g))}catch{r(f,"Invalid URL")}};ot(()=>{i()&&t(_)?.focus()});var v=Ft(),I=u(v);{var E=d=>{var c=Lt(),T=u(c);vt(T,{get value(){return t(g)},get error(){return t(f)},onInput:L,placeholder:"url",get ref(){return t(_)},set ref(C){r(_,C,!0)}});var x=h(T,2),p=u(x);p.__click=[Nt,g,e,i];var o=h(p,2);o.__click=[Ut,g,f,e,i],w(d,c)},D=d=>{var c=At(),T=u(c);{var x=o=>{var C=Wt(),S=dt(C);S.__click=[St,i];var R=h(S,2);R.__click=[Rt,g,e],w(o,C)},p=o=>{var C=Mt();C.__click=[Bt,i],w(o,C)};N(T,o=>{e.url?o(x):o(p,!1)})}w(d,c)};N(I,d=>{i()?d(E):d(D,!1)})}et(v,d=>r(l,d),()=>t(l)),w(b,v),at()}nt(["click"]);const Ht=(b,e)=>{e()},Ot=(b,e)=>{e()};var jt=y("<span> </span>"),qt=y('<div class="dateInfo svelte-t8fgpr"><!></div>'),Gt=y('<div class="submitButtons svelte-t8fgpr"><!> <!></div>'),Jt=y('<div class="form svelte-t8fgpr"><div class="scrollWrapper"><div class="formFields"><!> <form><input class="inputName svelte-t8fgpr" placeholder="Name"/></form> <div class="textarea svelte-t8fgpr" contenteditable="true"></div></div></div> <div><!> <div class="formTagsWrapper svelte-t8fgpr"><!></div> <!></div></div>');function zt(b,e){tt(e,!0);const{deleteDraft:i,putDraft:f}=bt();let _=U(e,"initialName",3,""),l=U(e,"initialUrl",3,""),g=U(e,"initialText",3,""),L=U(e,"initialTags",19,()=>[]),v=U(e,"noteId",3,""),I=U(e,"mode",3,"add"),E=m(O(e.draft?.data.name||_())),D=m(O(e.draft?.data.url||l())),d=m(O(e.draft?.data.text||g())),c=m(O((e.draft?.data.tags||L()).filter(n=>n!=="inbox"))),T=m(!1),x=m(!1),p=m(null);const o=()=>{const n={id:v(),data:{name:t(E),url:t(D),text:t(d),tags:t(c).map(M=>M.trim())}};f(n)},C=n=>{n.preventDefault(),i(v()),e.onSubmit({name:t(E).trim().slice(0,256)||"unkwown",url:t(D).trim().slice(0,2048),text:t(d).trim().slice(0,2048),tags:t(c).length>0?t(c):["inbox"]})},S=n=>{n.preventDefault()},R=n=>{n.key==="Escape"&&(document.activeElement instanceof HTMLInputElement&&document.activeElement.type==="text"||document.activeElement instanceof HTMLTextAreaElement)&&(t(T)&&r(T,!1),t(x)&&r(x,!1),document.activeElement.blur(),n.preventDefault(),n.stopPropagation())};$(()=>(document.addEventListener("keydown",R),()=>document.removeEventListener("keydown",R)));const z=n=>{r(D,n,!0),o()},j=()=>{r(D,""),o()},Q=n=>{r(c,n,!0),o()},V=()=>{i(v()),r(E,_()),r(D,l()),r(d,g()),r(c,L(),!0)};$(()=>{I()==="add"&&t(p)?.focus()});var q=Jt(),G=u(q),Y=u(G),a=u(Y);Pt(a,{get url(){return t(D)},onChangeUrl:z,onDeleteUrl:j,get shownUrlInput(){return t(x)},set shownUrlInput(n){r(x,n,!0)}});var s=h(a,2),k=u(s);k.__input=[Ot,o],et(k,n=>r(p,n),()=>t(p));var W=h(s,2);W.__input=[Ht,o];var B=h(G,2);kt(B,1,Tt(["bottom","bottomSpace"]),"svelte-t8fgpr");var F=u(B);{var ct=n=>{var M=qt(),J=u(M);{var Z=A=>{var K=jt(),P=u(K);xt(mt=>pt(P,`updated: ${mt??""}`),[()=>new Date(e.updatedAt).toLocaleString()]),w(A,K)};N(J,A=>{e.updatedAt&&A(Z)})}w(n,M)};N(F,n=>{I()==="edit"&&n(ct)})}var rt=h(F,2),ft=u(rt);Et(ft,{get selectedTags(){return t(c)},onChangeTags:Q,get shownTagInput(){return t(T)},set shownTagInput(n){r(T,n,!0)}});var _t=h(rt,2);{var gt=n=>{var M=Gt(),J=u(M);st(J,{fullWidth:!0,withoutMinWidth:!0,onClick:V,type:"secondary",typeButton:"button",children:(A,K)=>{var P=it("cancel");w(A,P)},$$slots:{default:!0}});var Z=h(J,2);st(Z,{fullWidth:!0,withoutMinWidth:!0,onClick:C,typeButton:"submit",children:(A,K)=>{var P=it("save");w(A,P)},$$slots:{default:!0}}),w(n,M)};N(_t,n=>{!t(T)&&!t(x)&&e.draft&&n(gt)})}ut("submit",s,S),Ct(k,()=>t(E),n=>r(E,n)),w(b,q),at()}nt(["input"]);export{zt as N};
