import{p as q,z,A as F,n as J,q as M,h as P,r as N,u as R,g as d,o as W,f as m,i as b,c as h,d as s,j as G,k as u,y as w,U as Q,H as A,x as y,s as K,L as V,v as X,l as Y,B as Z}from"./aC8NhpE_b.js";import{g as ee,b as te,a as re}from"./abA9hIFUQ.js";import{g as ne}from"./a9q_jSmK4.js";import{e as ae}from"./aCpa8lgv9.js";var t=(n=>(n[n.Signin=0]="Signin",n[n.SigninError=1]="SigninError",n))(t||{}),ie=m('<div class="container svelte-bhmjvc"><!> <!></div>'),se=m('<div class="container svelte-bhmjvc"><!> <!></div>'),oe=m('<div class="block svelte-bhmjvc"><!></div>');function ve(n,E){q(E,!0);const{getAppLocation:$,replace:j}=z(),{initCloudAccount:B,getAccount:D}=F(),{clearDialogPages:k}=J(),T=w(()=>$().searchParams),{blockDialog:_}=M();let U=w(D),S=P(""),a=P(N(t.Signin));const C=async()=>{u(a,t.Signin,!0),await new Promise(e=>setTimeout(e,2e3));try{const e=await ne(),{credentialData:i,clientKey:o}=await ee({challenge:e}),c=await fetch("/api/signin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(c.status!==200){u(a,t.SigninError,!0);return}const r=await c.json();if(!r.serverKey){u(a,t.SigninError,!0);return}const v=r.serverKey,l=d(U)===void 0,{encryptedClientKey:f}=await ae({clientKey:o,serverKey:new Uint8Array(te(v))});if(Q(),await B({encryptedClientKey:re(f)}),_(!1),l)k();else{let g=d(T).get("retPath")||"";g&&u(S,g,!0),j(d(S)||"/")}}catch(e){console.error("Error during sign-in:",e),u(a,t.SigninError,!0)}};R(()=>{_(d(a)===t.Signin)}),W(()=>{C()});var x=oe(),H=h(x);{var L=e=>{var i=ie(),o=h(i);A(o,{children:(r,v)=>{var l=y("signin");s(r,l)}});var c=K(o,2);V(c,{}),s(e,i)},I=e=>{var i=X(),o=Y(i);{var c=r=>{var v=se(),l=h(v);A(l,{children:(g,O)=>{var p=y("error signin");s(g,p)}});var f=K(l,2);Z(f,{onClick:()=>C(),fullWidth:!0,children:(g,O)=>{var p=y("try again");s(g,p)},$$slots:{default:!0}}),s(r,v)};b(o,r=>{d(a)===t.SigninError&&r(c)},!0)}s(e,i)};b(H,e=>{d(a)===t.Signin?e(L):e(I,!1)})}s(n,x),G()}export{ve as default};
