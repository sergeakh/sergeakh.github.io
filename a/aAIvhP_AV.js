import{p as O,u as R,D as z,C as J,b as w,w as M,v as N,x as V,g as s,o as W,f as m,j as P,c as h,i as o,m as q,a as d,A as x,a7 as F,L as G,y as I,n as Q,H as X,z as b,s as Y,B as Z}from"./aCUxRrVeH.js";import{e as ee}from"./aCpa8lgv9.js";import{c as ae,b as te,a as re}from"./aBEGDcNQV.js";import{g as ne}from"./a9q_jSmK4.js";var t=(r=>(r[r.Signup=0]="Signup",r[r.SignupError=1]="SignupError",r))(t||{}),se=m('<div class="b p-mcehu"><!></div>'),oe=m('<div class="b p-mcehu"><!> <!></div>'),ie=m('<div class="a p-mcehu"><!></div>');function ge(r,A){O(A,!0);const{clearDialogPages:U}=R(),{getAccount:B,initCloudAccount:D}=z(),{getSearchParams:K,replaceSearchParams:E}=J();let $=x(K),T=x(B),y=w(""),n=w(M(t.Signup));const{blockDialog:S}=N(),_=async()=>{d(n,t.Signup,!0);try{const e=await ne(),a=crypto.getRandomValues(new Uint8Array(32)),i=await ae({challenge:e,clientKey:a}),l=await fetch("/api/signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(l.status!==200){d(n,t.SignupError,!0);return}const c=await l.json(),u=s(T)===void 0,{encryptedClientKey:p}=await ee({clientKey:a,serverKey:new Uint8Array(te(c.serverKey))});if(F(),await D({encryptedClientKey:re(p)}),S(!1),u)U();else{let g=s($).get("retPath")||"";g&&d(y,g,!0),E(s(y)||"")}}catch{d(n,t.SignupError,!0)}};V(()=>{S(s(n)===t.Signup)}),W(()=>{_()});var C=ie(),j=h(C);{var k=e=>{var a=se(),i=h(a);G(i,{}),o(e,a)},H=e=>{var a=I(),i=Q(a);{var l=c=>{var u=oe(),p=h(u);X(p,{children:(v,L)=>{var f=b("something went wrong");o(v,f)}});var g=Y(p,2);Z(g,{onClick:()=>_(),fullWidth:!0,children:(v,L)=>{var f=b("try again");o(v,f)},$$slots:{default:!0}}),o(c,u)};P(i,c=>{s(n)===t.SignupError&&c(l)},!0)}o(e,a)};P(j,e=>{s(n)===t.Signup?e(k):e(H,!1)})}o(r,C),q()}export{ge as default};
