import{p as I,h as J,A as M,z as N,j as _,k as V,i as W,u as F,g as e,y as A,o as G,f as S,m as w,c as m,d as l,n as Q,l as d,T as X,s as x,r as h,L as Y,q as Z,B as ee,x as te}from"./Bfj6ItVn.js";import{e as ae}from"./Cpa8lgv9.js";import{c as re,b as ne,a as se}from"./BEGDcNQV.js";import{g as oe}from"./9q_jSmK4.js";var t=(n=>(n[n.Signup=0]="Signup",n[n.SignupError=1]="SignupError",n))(t||{}),ie=S('<p class="message svelte-apkzbu">signup</p> <!>',1),le=S('<p class="message svelte-apkzbu">error signup</p> <div class="buttonContainer svelte-apkzbu"><div class="buttonContainerItem svelte-apkzbu"><!></div></div>',1),ue=S('<div class="content svelte-apkzbu"><!></div>');function ve(n,P){I(P,!0);const{updateStackPages:U}=J(),{getAccount:B,initCloudAccount:z}=M(),{getAppHistory:K,back:D,closeDialogStack:E,deleteSearchParam:T}=N();let j=A(K),f=A(B),k=_(""),s=_(V(t.Signup));const{blockDialog:u,unBlockBackDialog:v}=W(),b=async()=>{d(s,t.Signup,!0);try{const a=await oe(),r=crypto.getRandomValues(new Uint8Array(32)),o=await re({challenge:a,clientKey:r}),c=await fetch("/api/signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(c.status!==200){d(s,t.SignupError,!0);return}const i=await c.json(),p=e(f)===void 0,{encryptedClientKey:y}=await ae({clientKey:r,serverKey:new Uint8Array(ne(i.serverKey))});if(X(),await z({encryptedClientKey:se(y)}),p)u(!1),E();else{u(!1);let g=new URLSearchParams(e(j).search).get("retPath")||"";g&&(d(k,g,!0),T("retPath")),D({to:e(k)}),U()}}catch{d(s,t.SignupError,!0)}};F(()=>{e(f)===null&&u(e(s)===t.Signup),v(e(s)!==t.Signup)}),G(()=>(e(f)===void 0&&(u(!0),v(!1)),b(),()=>{v(!1)}));var C=ue(),H=m(C);{var L=a=>{var r=ie(),o=x(h(r),2);Y(o,{}),l(a,r)},R=a=>{var r=Z(),o=h(r);{var c=i=>{var p=le(),y=x(h(p),2),g=m(y),$=m(g);ee($,{onClick:()=>b(),fullWidth:!0,children:(O,ce)=>{var q=te("try again");l(O,q)},$$slots:{default:!0}}),l(i,p)};w(o,i=>{e(s)===t.SignupError&&i(c)},!0)}l(a,r)};w(H,a=>{e(s)===t.Signup?a(L):a(R,!1)})}l(n,C),Q()}export{ve as default};
