import{p as He,J as Be,u as Ne,v as Pe,K as je,b as _,w as Fe,x as Me,g as e,o as ce,f as y,j as D,c as n,i as v,m as Ue,a as d,n as w,s as c,d as ze,I as qe,y as ae,z as F,N as We,B as re,A as se,L as Je,r as Ge}from"./akcz8jFBP.js";import{S as Ke,a as B}from"./aCRJj0X9w.js";const Qe=J=>{const E=Math.floor(Date.now()/1e3),h={};J.forEach(o=>{if(!o)return;const p=o.data.tags||["Imported"];if(p.length===0){h.ROOT||(h.ROOT=[]),h.ROOT.push(o);return}p.forEach(u=>{h[u]||(h[u]=[]),h[u].push(o)})});let m=`<!DOCTYPE NETSCAPE-Note-file-1>
<!-- This is an automatically generated file.
 It will be read and overwritten.
 DO NOT EDIT! -->
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8">
<TITLE>Bookmarks</TITLE>
<H1>Bookmarks</H1>
<DL><p>
<DT><H3 ADD_DATE="${E}" LAST_MODIFIED="${E}" PERSONAL_TOOLBAR_FOLDER="true">Bookmarks bar</H3>
<DL><p>`;return Object.keys(h).forEach(o=>{o!=="ROOT"&&o!=="other"&&(m+=`
    <DT><H3 ADD_DATE="${E}" LAST_MODIFIED="${E}">${o}</H3>
    <DL><p>`,h[o].forEach(p=>{if(!p.data.link)return;const u=p.data.link.title.replace(/"/g,"&quot;");m+=`
        <DT><A HREF="${p.data.link.url}" ADD_DATE="${Math.floor(p.data.createdAt/1e3)||E}">${u}</A>`}),m+=`
    </DL><p>`)}),h.ROOT&&h.ROOT.forEach(o=>{if(!o.data.link)return;const p=o.data.link.title.replace(/"/g,"&quot;");m+=`
    <DT><A HREF="${o.data.link.url}" ADD_DATE="${Math.floor(o.data.createdAt/1e3)||E}">${p}</A>`}),m+=`
</DL><p>`,h.other&&h.other.forEach(o=>{if(!o.data.link)return;const p=o.data.link.title.replace(/"/g,"&quot;");m+=`
    <DT><A HREF="${o.data.link.url}" ADD_DATE="${Math.floor(o.data.createdAt/1e3)||E}">${p}</A>`}),m+="</DL><p>",m};var Ve=y('<div class="g p-10n6f3r"><p class="h p-10n6f3r">Exclude history</p> <div class="i p-10n6f3r"><!></div></div> <div class="g p-10n6f3r"><p class="h p-10n6f3r">Exclude notes</p> <div class="i p-10n6f3r"><!></div></div>',1),Ye=y('<div class="g p-10n6f3r"><p class="h p-10n6f3r">Exclude other tags</p> <div class="i p-10n6f3r"><!></div></div>'),Xe=y('<div class="g p-10n6f3r"><p class="h p-10n6f3r">Exclude bin</p> <div class="i p-10n6f3r"><!></div></div> <div class="g p-10n6f3r"><p class="h p-10n6f3r">Exclude archive</p> <div class="i p-10n6f3r"><!></div></div> <!> <div class="g p-10n6f3r"><p class="h p-10n6f3r">Exclude tags</p> <div class="i p-10n6f3r"><!></div></div> <!> <p class="j k p-10n6f3r">Filter tags:</p> <!>',1),Ze=y('<div class="l p-10n6f3r"><!></div>'),et=y('<div class="b p-10n6f3r"><div class="c p-10n6f3r"><!> <p class="d p-10n6f3r"><!></p></div></div> <div><div class="e p-10n6f3r"><button class="f p-10n6f3r"><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper><span>Settings</span></button></div> <!> <!></div>',1),tt=y('<div class="b p-10n6f3r"><p class="j p-10n6f3r">Exporting...</p> <!></div>'),at=y('<div class="b p-10n6f3r"><p class="j m p-10n6f3r">Something went wrong</p></div> <div class="l p-10n6f3r"><!></div>',1),rt=y('<div class="b p-10n6f3r"><p class="j p-10n6f3r">Success!</p></div> <div class="l p-10n6f3r"><!></div>',1),st=y('<div class="a p-10n6f3r"><!></div>');function lt(J,E){He(E,!0);const{getGetNotes:h}=Be(),{clearDialogPages:m}=Ne(),{blockDialog:o}=Pe(),{checkMobileSize:p}=je();let u=_("idle"),L=_("sync"),T=_(Fe([])),$=_(!1),G=_(!1),A=_(!1),M=_(!1),U=_(!1),K=_(!1),Q=_(!1),V=_(!1);const ve=()=>{m()};Me(()=>{o(e(u)==="loading")}),ce(()=>()=>{o(!1)});const fe=()=>{d(G,!e(G)),d(U,!1),d(M,!1),d($,!1),d(T,[],!0)},pe=async()=>{d(u,"loading"),await new Promise(r=>setTimeout(r,0));let s=(h()()||[]).filter(r=>r.data).filter(r=>e(T).length===0?!0:e(T).every(t=>r.data.tags.includes(t)));if(e(U)&&(s=s.map(r=>{const t={...r};return t.data={...t.data,history:[]},t})),e(K)&&(s=s.filter(r=>!r.data.deletedAt)),e(Q)&&(s=s.filter(r=>!r.data.archivedAt)),e(A)&&(s=s.map(r=>{const t={...r};return t.data={...t.data,tags:[],history:t.data.history.map(l=>({...l,tags:[]}))},t})),e(V)&&(s=s.map(r=>{const t={...r};return t.data={...t.data,tags:[],text:"",history:t.data.history.map(l=>({...l,text:"",tags:[]}))},t})),e(M)&&e(A)===!1&&(s=s.map(r=>{const t={...r};return t.data={...t.data,tags:t.data.tags.filter(l=>e(T).includes(l)),history:t.data.history.map(l=>({...l,tags:l.tags.filter(f=>e(T).includes(f))}))},t})),e(L)==="sync"){const r=`${[...e(A)?[]:e(T),"notes"].join("_")}.json`,t=JSON.stringify({filteredNotes:s}),l=new Blob([t],{type:"application/json"});return{filename:r,blob:l}}else{const r=`${[...e(A)?[]:e(T),"bookmarks"].join("_")}_${new Date().toLocaleDateString().replace(/\//g,"_")}.html`,t=Qe(s),l=new Blob([t],{type:"text/html"});return{filename:r,blob:l}}},ue=async()=>{try{const{filename:a,blob:s}=await pe(),r=new File([s],a,{type:e(L)==="sync"?"text/plain":"text/html"}),t=()=>{const l=URL.createObjectURL(s),f=document.createElement("a");f.href=l,f.download=a,document.body.appendChild(f),f.click(),setTimeout(()=>{document.body.removeChild(f),URL.revokeObjectURL(l)},0)};if(navigator.canShare({files:[r]}))try{await navigator.share({files:[r]})}catch{t()}else t();await new Promise(l=>setTimeout(l,0)),d(u,"success")}catch{d(u,"error")}},he=a=>{d(T,a,!0)},ne=a=>{a.key==="Escape"&&(document.activeElement instanceof HTMLInputElement&&document.activeElement.type==="text"||document.activeElement instanceof HTMLTextAreaElement)&&(e($)&&d($,!1),document.activeElement.blur(),a.preventDefault(),a.stopPropagation())},ge=a=>{d(M,a,!0)},_e=a=>{d(U,a,!0)},me=a=>{d(K,a,!0)},Te=a=>{d(Q,a,!0)},Ee=a=>{d(A,a,!0)},ke=a=>{d(V,a,!0)};ce(()=>(document.addEventListener("keydown",ne),()=>document.removeEventListener("keydown",ne)));var oe=st(),xe=n(oe);{var De=a=>{var s=et(),r=w(s),t=n(r),l=n(t);Ke(l,{items:[{title:"Sync",value:"sync"},{title:"Bookmarks",value:"bookmarks"}],get value(){return e(L)},onChange:i=>{d(L,i,!0)}});var f=c(l,2),C=n(f);{var N=i=>{var g=F("App format for sync or backup");v(i,g)},Y=i=>{var g=F("Browser bookmarks format (exports only bookmarks, not notes)");v(i,g)};D(C,i=>{e(L)==="sync"?i(N):i(Y,!1)})}var X=c(r,2),k=n(X),b=n(k);b.__click=fe;var S=n(b);ze(S,()=>({"--rotate":"30deg","--size":"20px"})),qe(S.lastChild,{name:"settings"});var I=c(k,2);{var O=i=>{var g=Xe(),H=w(g),q=c(n(H),2),P=n(q);B(P,{get checked(){return e(K)},onChange:me});var Z=c(H,2),ee=c(n(Z),2),be=n(ee);B(be,{get checked(){return e(Q)},onChange:Te});var le=c(Z,2);{var we=x=>{var j=Ve(),W=w(j),te=c(n(W),2),$e=n(te);B($e,{get checked(){return e(U)},onChange:_e});var Se=c(W,2),Ie=c(n(Se),2),Re=n(Ie);B(Re,{get checked(){return e(V)},onChange:ke}),v(x,j)};D(le,x=>{e(L)==="sync"&&x(we)})}var ie=c(le,2),Ae=c(n(ie),2),Ce=n(Ae);B(Ce,{get checked(){return e(A)},onChange:Ee});var de=c(ie,2);{var Oe=x=>{var j=Ye(),W=c(n(j),2),te=n(W);B(te,{get checked(){return e(M)},onChange:ge}),v(x,j)};D(de,x=>{e(T).length>0&&!e(A)&&x(Oe)})}var Le=c(de,4);We(Le,{mode:"exit",get selectedTags(){return e(T)},onChangeTags:he,get shownTagInput(){return e($)},set shownTagInput(x){d($,x,!0)}}),v(i,g)};D(I,i=>{e(G)&&i(O)})}var R=c(I,2);{var z=i=>{var g=Ze(),H=n(g);{let q=se(p);re(H,{get fullWidth(){return e(q)},onClick:ue,children:(P,Z)=>{var ee=F("Export");v(P,ee)},$$slots:{default:!0}})}v(i,g)};D(R,i=>{e($)||i(z)})}v(a,s)},ye=a=>{var s=ae(),r=w(s);{var t=f=>{var C=tt(),N=c(n(C),2);Je(N,{}),v(f,C)},l=f=>{var C=ae(),N=w(C);{var Y=k=>{var b=at(),S=c(w(b),2),I=n(S);{let O=se(p);re(I,{get fullWidth(){return e(O)},onClick:()=>{d(u,"idle")},children:(R,z)=>{var i=F("Try Again");v(R,i)},$$slots:{default:!0}})}v(k,b)},X=k=>{var b=ae(),S=w(b);{var I=O=>{var R=rt(),z=c(w(R),2),i=n(z);{let g=se(p);re(i,{get fullWidth(){return e(g)},onClick:ve,children:(H,q)=>{var P=F("Close");v(H,P)},$$slots:{default:!0}})}v(O,R)};D(S,O=>{e(u)==="success"&&O(I)},!0)}v(k,b)};D(N,k=>{e(u)==="error"?k(Y):k(X,!1)},!0)}v(f,C)};D(r,f=>{e(u)==="loading"?f(t):f(l,!1)},!0)}v(a,s)};D(xe,a=>{e(u)==="idle"?a(De):a(ye,!1)})}v(J,oe),Ue()}Ge(["click"]);export{lt as default};
