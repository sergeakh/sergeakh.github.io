import{p as J,D as K,G as P,u as Q,g as t,j as b,l as i,o as U,f as M,e as G,W as v,c as m,s as c,m as T,y as I,T as V,d as y,n as Y,q as Z,r as p,E as $,X as ee,v as te}from"./Br2UU7vL.js";import{I as ae}from"./RdnXtMIu.js";var se=(x,a,_,h)=>{t(a)!==""&&_(t(a)),h(!1),i(a,"")},ne=M('<form class="formNewTag svelte-1dwadiy"><div class="inputWrapper svelte-1dwadiy"><!></div> <button type="button" class="buttonDone svelte-1dwadiy">Done</button></form>'),re=M('<div class="block"><div class="tags svelte-1dwadiy"><!> <!> <!> <!></div> <!></div>');function oe(x,a){J(a,!0);const{isInitedNotes:_,getGetMapTags:h,getGetNotes:R}=K();let d=b(null),s=b(""),u=b(null);const O=I(_);let r=P(a,"shownTagInput",15);const W=()=>t(O)?a.mode==="exit"?ee(new Set(a.selectedTags),R()()||[]):[...h()().keys()]:[];let C=I(()=>W().filter(e=>a.selectedTags.some(n=>e===n)||e==="inbox"?!1:t(s)===""||e.toLowerCase().indexOf(t(s).toLowerCase())===0));const f=e=>{if(!a.selectedTags.includes(e)){if(a.mode!=="exit"||t(C).includes(e)){a.onChangeTags([...a.selectedTags,e]),i(s,"");return}t(d)?.focus()}},j=e=>{const n=a.selectedTags.filter(o=>o!==e);n.length===0?a.onChangeTags([]):a.onChangeTags(n)},q=e=>{e.preventDefault(),t(s)!==""?f(t(s)):r(!1)};Q(()=>{t(d)&&r()&&t(d).focus(),r()||i(s,"")});const L=e=>{e.target&&t(u)&&!t(u).contains(e.target)&&(r(!1),i(s,""))};U(()=>(document.addEventListener("click",L,{capture:!0}),()=>{document.removeEventListener("click",L,{capture:!0})}));var k=re(),N=m(k),D=m(N);G(D,16,()=>a.selectedTags,e=>e,(e,n)=>{v(e,{get title(){return n},onClick:()=>j(n),type:"button",style:"selected"})});var S=c(D,2);{var F=e=>{var n=Z(),o=p(n);G(o,16,()=>t(C).filter(l=>l.toLowerCase()!==t(s).toLowerCase()).slice(0,Math.max(3,3-a.selectedTags.length)),l=>l,(l,g)=>{v(l,{get title(){return g},onClick:()=>f(g)})}),y(e,n)};T(S,e=>{(t(s)!==""||a.selectedTags.length>0&&r()&&a.mode==="exit")&&e(F)})}var E=c(S,2);{var X=e=>{v(e,{get title(){return t(s)},onClick:()=>{f(t(s)),i(s,"")}})};T(E,e=>{t(s)!==""&&(a.mode!=="exit"||t(C).find(n=>n.toLowerCase()===t(s).toLowerCase()))&&e(X)})}var z=c(E,2);{var A=e=>{v(e,{onClick:()=>r(!0)})};T(z,e=>{r()||e(A)})}var B=c(N,2);{var H=e=>{var n=ne(),o=m(n),l=m(o);ae(l,{placeholder:"tag",get ref(){return t(d)},set ref(w){i(d,w,!0)},get value(){return t(s)},set value(w){i(s,w,!0)}});var g=c(o,2);g.__click=[se,s,f,r],$("submit",n,q),y(e,n)};T(B,e=>{r()&&e(H)})}V(k,e=>i(u,e),()=>t(u)),y(x,k),Y()}te(["click"]);export{oe as N};
