import{p as Oe,J as Le,u as Se,v as Ie,K as Re,b as T,w as Fe,x as He,g as e,o as ue,f as k,j as E,c as o,i as d,m as Pe,a as i,n as w,s as c,d as Be,I as je,y as ie,z as P,N as Me,B as Y,A as X,L as Ne,r as Ue}from"./aDLYMDcbf.js";import{S as We,a as z}from"./aEmlw34_I.js";const ze=Z=>{const x=Math.floor(Date.now()/1e3),u={};Z.forEach(n=>{if(!n)return;const p=n.data.tags||["Imported"];if(p.length===0){u.ROOT||(u.ROOT=[]),u.ROOT.push(n);return}p.forEach(v=>{u[v]||(u[v]=[]),u[v].push(n)})});let g=`<!DOCTYPE NETSCAPE-Note-file-1>
<!-- This is an automatically generated file.
 It will be read and overwritten.
 DO NOT EDIT! -->
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8">
<TITLE>Bookmarks</TITLE>
<H1>Bookmarks</H1>
<DL><p>
<DT><H3 ADD_DATE="${x}" LAST_MODIFIED="${x}" PERSONAL_TOOLBAR_FOLDER="true">Bookmarks bar</H3>
<DL><p>`;return Object.keys(u).forEach(n=>{n!=="ROOT"&&n!=="other"&&(g+=`
    <DT><H3 ADD_DATE="${x}" LAST_MODIFIED="${x}">${n}</H3>
    <DL><p>`,u[n].forEach(p=>{if(!p.data.link)return;const v=p.data.link.title.replace(/"/g,"&quot;");g+=`
        <DT><A HREF="${p.data.link.url}" ADD_DATE="${Math.floor(p.data.createdAt/1e3)||x}">${v}</A>`}),g+=`
    </DL><p>`)}),u.ROOT&&u.ROOT.forEach(n=>{if(!n.data.link)return;const p=n.data.link.title.replace(/"/g,"&quot;");g+=`
    <DT><A HREF="${n.data.link.url}" ADD_DATE="${Math.floor(n.data.createdAt/1e3)||x}">${p}</A>`}),g+=`
</DL><p>`,u.other&&u.other.forEach(n=>{if(!n.data.link)return;const p=n.data.link.title.replace(/"/g,"&quot;");g+=`
    <DT><A HREF="${n.data.link.url}" ADD_DATE="${Math.floor(n.data.createdAt/1e3)||x}">${p}</A>`}),g+="</DL><p>",g};var qe=k('<div class="g p-10n6f3r"><p class="h p-10n6f3r">Exclude history</p> <div class="i p-10n6f3r"><!></div></div>'),Je=k('<div class="g p-10n6f3r"><p class="h p-10n6f3r">Exclude other tags</p> <div class="i p-10n6f3r"><!></div></div>'),Ge=k('<div class="g p-10n6f3r"><p class="h p-10n6f3r">Exclude bin</p> <div class="i p-10n6f3r"><!></div></div> <div class="g p-10n6f3r"><p class="h p-10n6f3r">Exclude archive</p> <div class="i p-10n6f3r"><!></div></div> <!> <div class="g p-10n6f3r"><p class="h p-10n6f3r">Exclude tags</p> <div class="i p-10n6f3r"><!></div></div> <!> <p class="j k p-10n6f3r">Filter tags:</p> <!>',1),Ke=k('<div class="l p-10n6f3r"><!></div>'),Qe=k('<!> <div class="l p-10n6f3r"><!></div>',1),Ve=k('<div class="b p-10n6f3r"><div class="c p-10n6f3r"><!> <p class="d p-10n6f3r"><!></p></div></div> <div><div class="e p-10n6f3r"><button class="f p-10n6f3r"><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper><span>Settings</span></button></div> <!> <!></div>',1),Ye=k('<div class="b p-10n6f3r"><p class="j p-10n6f3r">Exporting data...</p> <!></div>'),Xe=k('<div class="b p-10n6f3r"><p class="j m p-10n6f3r">Something went wrong</p></div> <div class="l p-10n6f3r"><!></div>',1),Ze=k('<div class="b p-10n6f3r"><p class="j p-10n6f3r">Data exported successfully!</p></div> <div class="l p-10n6f3r"><!></div>',1),et=k('<div class="a p-10n6f3r"><!></div>');function rt(Z,x){Oe(x,!0);const{getGetNotes:u}=Le(),{clearDialogPages:g}=Se(),{blockDialog:n}=Ie(),{checkMobileSize:p}=Re();let v=T("idle"),B=T("sync"),_=T(Fe([])),S=T(!1),ee=T(!1),A=T(!1),q=T(!1),J=T(!1),te=T(!1),ae=T(!1);const he=()=>{g()};He(()=>{n(e(v)==="loading")}),ue(()=>()=>{n(!1)});const ge=()=>{i(ee,!e(ee)),i(J,!1),i(q,!1),i(S,!1),i(_,[],!0)},de=async()=>{i(v,"loading"),await new Promise(r=>setTimeout(r,0));let s=(u()()||[]).filter(r=>r.data).filter(r=>e(_).length===0?!0:e(_).every(t=>r.data.tags.includes(t)));if(e(J)&&(s=s.map(r=>{const t={...r};return t.data={...t.data,history:[]},t})),e(te)&&(s=s.filter(r=>!r.data.deletedAt)),e(ae)&&(s=s.filter(r=>!r.data.archivedAt)),e(A)&&(s=s.map(r=>{const t={...r};return t.data={...t.data,tags:[],history:t.data.history.map(f=>({...f,tags:[]}))},t})),e(q)&&e(A)===!1&&(s=s.map(r=>{const t={...r};return t.data={...t.data,tags:t.data.tags.filter(f=>e(_).includes(f)),history:t.data.history.map(f=>({...f,tags:f.tags.filter(m=>e(_).includes(m))}))},t})),e(B)==="sync"){const r=`${[...e(A)?[]:e(_),"notes"].join("_")}.json`,t=JSON.stringify({filteredNotes:s}),f=new Blob([t],{type:"application/json"});return{filename:r,blob:f}}else{const r=`${[...e(A)?[]:e(_),"bookmarks"].join("_")}bookmarks_${new Date().toLocaleDateString().replace(/\//g,"_")}.html`,t=ze(s),f=new Blob([t],{type:"text/html"});return{filename:r,blob:f}}},_e=async()=>{try{const{filename:a,blob:s}=await de(),r=URL.createObjectURL(s),t=document.createElement("a");t.href=r,t.download=a,document.body.appendChild(t),t.click(),setTimeout(()=>{document.body.removeChild(t),URL.revokeObjectURL(r)},0),await new Promise(f=>setTimeout(f,500)),i(v,"success")}catch{i(v,"error")}},me=async()=>{try{const{filename:a,blob:s}=await de(),r=new File([s],a,{type:s.type});await navigator.share({files:[r],title:a.endsWith("html")?"Exported Bookmarks":"Exported Notes"}),await new Promise(t=>setTimeout(t,0)),i(v,"success")}catch{i(v,"error")}},Te=a=>{i(_,a,!0)},ce=a=>{a.key==="Escape"&&(document.activeElement instanceof HTMLInputElement&&document.activeElement.type==="text"||document.activeElement instanceof HTMLTextAreaElement)&&(e(S)&&i(S,!1),document.activeElement.blur(),a.preventDefault(),a.stopPropagation())},Ee=a=>{i(q,a,!0)},ke=a=>{i(J,a,!0)},xe=a=>{i(te,a,!0)},De=a=>{i(ae,a,!0)},ye=a=>{i(A,a,!0)};ue(()=>(document.addEventListener("keydown",ce),()=>document.removeEventListener("keydown",ce)));var ve=et(),be=o(ve);{var we=a=>{var s=Ve(),r=w(s),t=o(r),f=o(t);We(f,{items:[{title:"Sync",value:"sync"},{title:"Bookmarks",value:"bookmarks"}],get value(){return e(B)},onChange:l=>{i(B,l,!0)}});var m=c(f,2),$=o(m);{var j=l=>{var h=P("App format for sync or backup");d(l,h)},re=l=>{var h=P("Browser bookmarks format (exports only bookmarks, not notes)");d(l,h)};E($,l=>{e(B)==="sync"?l(j):l(re,!1)})}var se=c(r,2),D=o(se),b=o(D);b.__click=ge;var I=o(b);Be(I,()=>({"--rotate":"30deg","--size":"20px"})),je(I.lastChild,{name:"settings"});var R=c(D,2);{var C=l=>{var h=Ge(),O=w(h),K=c(o(O),2),M=o(K);z(M,{get checked(){return e(te)},onChange:xe});var Q=c(O,2),L=c(o(Q),2),H=o(L);z(H,{get checked(){return e(ae)},onChange:De});var N=c(Q,2);{var U=y=>{var W=qe(),oe=c(o(W),2),le=o(oe);z(le,{get checked(){return e(J)},onChange:ke}),d(y,W)};E(N,y=>{e(B)==="sync"&&y(U)})}var V=c(N,2),fe=c(o(V),2),ne=o(fe);z(ne,{get checked(){return e(A)},onChange:ye});var pe=c(V,2);{var $e=y=>{var W=Je(),oe=c(o(W),2),le=o(oe);z(le,{get checked(){return e(q)},onChange:Ee}),d(y,W)};E(pe,y=>{e(_).length>0&&!e(A)&&y($e)})}var Ce=c(pe,4);Me(Ce,{mode:"exit",get selectedTags(){return e(_)},onChangeTags:Te,get shownTagInput(){return e(S)},set shownTagInput(y){i(S,y,!0)}}),d(l,h)};E(R,l=>{e(ee)&&l(C)})}var F=c(R,2);{var G=l=>{var h=Qe(),O=w(h);{var K=L=>{var H=Ke(),N=o(H);{let U=X(p);Y(N,{get fullWidth(){return e(U)},onClick:me,children:(V,fe)=>{var ne=P("Share file");d(V,ne)},$$slots:{default:!0}})}d(L,H)};E(O,L=>{navigator.canShare({files:[new File([],"dummy")]})&&L(K)})}var M=c(O,2),Q=o(M);{let L=X(p);Y(Q,{get fullWidth(){return e(L)},onClick:_e,children:(H,N)=>{var U=P("Export file");d(H,U)},$$slots:{default:!0}})}d(l,h)};E(F,l=>{e(S)||l(G)})}d(a,s)},Ae=a=>{var s=ie(),r=w(s);{var t=m=>{var $=Ye(),j=c(o($),2);Ne(j,{}),d(m,$)},f=m=>{var $=ie(),j=w($);{var re=D=>{var b=Xe(),I=c(w(b),2),R=o(I);{let C=X(p);Y(R,{get fullWidth(){return e(C)},onClick:()=>{i(v,"idle")},children:(F,G)=>{var l=P("Try Again");d(F,l)},$$slots:{default:!0}})}d(D,b)},se=D=>{var b=ie(),I=w(b);{var R=C=>{var F=Ze(),G=c(w(F),2),l=o(G);{let h=X(p);Y(l,{get fullWidth(){return e(h)},onClick:he,children:(O,K)=>{var M=P("Close");d(O,M)},$$slots:{default:!0}})}d(C,F)};E(I,C=>{e(v)==="success"&&C(R)},!0)}d(D,b)};E(j,D=>{e(v)==="error"?D(re):D(se,!1)},!0)}d(m,$)};E(r,m=>{e(v)==="loading"?m(t):m(f,!1)},!0)}d(a,s)};E(be,a=>{e(v)==="idle"?a(we):a(Ae,!1)})}d(Z,ve),Pe()}Ue(["click"]);export{rt as default};
