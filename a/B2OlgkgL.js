import{p as Z,C as ut,G as $,u as dt,g as t,j as T,l as s,o as vt,f as D,e as rt,U as K,c as v,s as m,m as B,y,S as z,d as h,n as tt,q as kt,r as ct,D as ft,v as et,k as _t,J as xt,K as Tt,t as lt,M as st,B as ot,w as it,x as Ct}from"./DXPk5Q1Y.js";import{I as gt}from"./PUKOro7m.js";var yt=(c,e,o,g)=>{t(e)!==""&&o(t(e)),g(!1),s(e,"")},Dt=D('<form class="formNewTag svelte-1dwadiy"><div class="inputWrapper svelte-1dwadiy"><!></div> <button type="button" class="buttonDone svelte-1dwadiy">Done</button></form>'),Nt=D('<div class="block"><div class="tags svelte-1dwadiy"><!> <!> <!> <!></div> <!></div>');function It(c,e){Z(e,!0);const{isInitedNotes:o,getGetNotes:g}=ut();let w=T(null),r=T(""),p=T(null);const N=y(o);let l=$(e,"shownTagInput",15);const d=a=>{e.selectedTags.includes(a)||(s(r,""),e.onChangeTags([...e.selectedTags,a]),t(w)?.focus())},I=a=>{const u=e.selectedTags.filter(b=>b!==a);u.length===0?e.onChangeTags([]):e.onChangeTags(u)};let U=y(()=>t(N)?[...(g()()||[]).reduce((a,u)=>(u?.data?.tags.forEach(b=>{a.has(b)||a.add(b)}),a),new Set)]:[]),i=y(()=>t(N)?t(U).filter(a=>!e.selectedTags.some(u=>a===u)&&a!=="inbox"):[]),C=y(()=>t(i).find(a=>a.toLowerCase()===t(r).toLowerCase())||e.selectedTags.includes(t(r))),k=y(()=>t(i).filter(a=>t(r)===""?!0:a.toLowerCase().indexOf(t(r).toLowerCase())===0).slice(0,t(C)||t(r)===""?3:2));const R=a=>{a.preventDefault(),t(r)!==""?(d(t(r)),s(r,"")):l(!1)};dt(()=>{t(w)&&l()&&t(w).focus(),l()||s(r,"")});const E=a=>{a.target&&t(p)&&!t(p).contains(a.target)&&(l(!1),s(r,""))};vt(()=>(document.addEventListener("click",E,{capture:!0}),()=>{document.removeEventListener("click",E,{capture:!0})}));var f=Nt(),x=v(f),W=v(x);rt(W,16,()=>e.selectedTags,a=>a,(a,u)=>{K(a,{get title(){return u},onClick:()=>I(u),type:"button",style:"selected"})});var F=m(W,2);{var Q=a=>{var u=kt(),b=ct(u);rt(b,16,()=>t(k),L=>L,(L,A)=>{K(L,{get title(){return A},onClick:()=>d(A)})}),h(a,u)};B(F,a=>{t(r)!==""&&a(Q)})}var j=m(F,2);{var V=a=>{K(a,{get title(){return t(r)},onClick:()=>{d(t(r)),s(r,"")}})};B(j,a=>{!t(C)&&t(r)!==""&&a(V)})}var X=m(j,2);{var Y=a=>{K(a,{title:"add tag",onClick:()=>l(!0)})};B(X,a=>{l()||a(Y)})}var q=m(x,2);{var J=a=>{var u=Dt(),b=v(u),L=v(b);gt(L,{placeholder:"tag",get ref(){return t(w)},set ref(H){s(w,H,!0)},get value(){return t(r)},set value(H){s(r,H,!0)}});var A=m(b,2);A.__click=[yt,r,d,l],ft("submit",u,R),h(a,u)};B(q,a=>{l()&&a(J)})}z(f,a=>s(p,a),()=>t(p)),h(c,f),tt()}et(["click"]);var Ut=(c,e,o,g)=>{s(e,o.url,!0),g(!1)},Et=(c,e,o,g,w)=>{if(t(e)&&t(o)){s(e,"");return}g.onChangeUrl(t(e)),w(!1)},Lt=D('<div class="wrapper svelte-w8w68w"><!> <div class="containerButtons svelte-w8w68w"><button class="svelte-w8w68w">Cancel</button> <button class="svelte-w8w68w">Done</button></div></div>'),St=(c,e)=>{e(!0)},Bt=(c,e,o)=>{s(e,""),o.onDeleteUrl()},At=D('<button class="button svelte-w8w68w">Edit link</button> <button class="button svelte-w8w68w">Delete link</button>',1),Rt=(c,e)=>{e(!0)},Wt=D('<button class="button svelte-w8w68w">Add link</button>'),Mt=D('<div class="wrapperButtons svelte-w8w68w"><!></div>'),Ft=D("<div><!></div>");function Ht(c,e){Z(e,!0);let o=$(e,"shownUrlInput",15),g=T(""),w=T(null),r=T(null),p=T(_t(e.url));const N=i=>{s(g,""),s(p,i.target.value||"",!0);try{new URL(t(p))}catch{s(g,"Invalid URL")}};dt(()=>{o()&&t(w)?.focus()});var l=Ft(),d=v(l);{var I=i=>{var C=Lt(),k=v(C);gt(k,{get value(){return t(p)},get error(){return t(g)},onInput:N,placeholder:"url",get ref(){return t(w)},set ref(x){s(w,x,!0)}});var R=m(k,2),E=v(R);E.__click=[Ut,p,e,o];var f=m(E,2);f.__click=[Et,p,g,e,o],h(i,C)},U=i=>{var C=Mt(),k=v(C);{var R=f=>{var x=At(),W=ct(x);W.__click=[St,o];var F=m(W,2);F.__click=[Bt,p,e],h(f,x)},E=f=>{var x=Wt();x.__click=[Rt,o],h(f,x)};B(k,f=>{e.url?f(R):f(E,!1)})}h(i,C)};B(d,i=>{o()?i(I):i(U,!1)})}z(l,i=>s(r,i),()=>t(r)),h(c,l),tt()}et(["click"]);const Pt=(c,e,o)=>{t(e)&&(t(e).style.height="auto",t(e).style.height=t(e).scrollHeight+"px"),o({text:c.target.value.trim()})},Gt=(c,e)=>{e({name:c.target.value.trim()})};var Ot=D("<span> </span>"),jt=D('<div class="dateInfo svelte-t8fgpr"><!></div>'),qt=D('<div class="submitButtons svelte-t8fgpr"><!> <!></div>'),Jt=D('<div class="form svelte-t8fgpr"><div class="scrollWrapper"><div class="formFields"><!> <form><input class="inputName svelte-t8fgpr" placeholder="Name"/></form> <textarea class="textarea svelte-t8fgpr" placeholder="Note"></textarea></div></div> <div><!> <div class="formTagsWrapper svelte-t8fgpr"><!></div> <!></div></div>');function Qt(c,e){Z(e,!0);const{getNoteById:o,deleteNoteDraft:g,saveNoteDraft:w,putNoteDraft:r}=ut();let p=$(e,"mode",3,"add"),N=T(_t(e.noteId||o()?.id||"")),l=y(()=>o(t(N))?.data||null),d=y(()=>t(l)?.draft||null),I=T(null),U=T(!1),i=T(!1),C=T(null);const k=async({name:n,url:M,text:P,tags:O})=>{let _=O?.map(S=>S.trim())||t(d)?.tags||t(l)?.tags||[];_.length===0?_=["inbox"]:_.length>1&&_.includes("inbox")&&(_=_.filter(S=>S!=="inbox"));const G={name:n??t(d)?.name??t(l)?.name??"",url:M??t(d)?.url??t(l)?.url??"",text:P??t(d)?.text??t(l)?.text??"",tags:_,createdAt:t(d)?.createdAt||Date.now(),updatedAt:Date.now()};s(N,await r(t(N),G)||"",!0)},R=n=>{n.preventDefault(),w(t(N)),e.onSubmit()},E=n=>{n.preventDefault(),t(I)&&t(I).focus()},f=n=>{n.key==="Escape"&&(document.activeElement instanceof HTMLInputElement&&document.activeElement.type==="text"||document.activeElement instanceof HTMLTextAreaElement)&&(t(U)&&s(U,!1),t(i)&&s(i,!1),document.activeElement.blur(),n.preventDefault(),n.stopPropagation())};vt(()=>(document.addEventListener("keydown",f),()=>document.removeEventListener("keydown",f)));const x=n=>{k({url:n})},W=()=>{k({url:""})},F=n=>{k({tags:n})},Q=()=>{g(t(N))};let j=y(()=>t(d)?.name??t(l)?.name??""),V=y(()=>t(d)?.url??t(l)?.url??""),X=y(()=>t(d)?.text??t(l)?.text??""),Y=y(()=>(t(d)?.tags??t(l)?.tags??[]).filter(n=>n!=="inbox"));var q=Jt(),J=v(q),a=v(J),u=v(a);Ht(u,{get url(){return t(V)},onChangeUrl:x,onDeleteUrl:W,get shownUrlInput(){return t(i)},set shownUrlInput(n){s(i,n,!0)}});var b=m(u,2),L=v(b);L.__input=[Gt,k],z(L,n=>s(C,n),()=>t(C));var A=m(b,2);A.__input=[Pt,I,k],z(A,n=>s(I,n),()=>t(I));var H=m(J,2);xt(H,1,Tt(["bottom","bottomSpace"]),"svelte-t8fgpr");var at=v(H);{var mt=n=>{var M=jt(),P=v(M);{var O=_=>{var G=Ot(),S=v(G);lt(bt=>Ct(S,`updated: ${bt??""}`),[()=>new Date(t(l).updatedAt).toLocaleString()]),h(_,G)};B(P,_=>{t(l)?.updatedAt&&_(O)})}h(n,M)};B(at,n=>{p()==="edit"&&n(mt)})}var nt=m(at,2),ht=v(nt);It(ht,{get selectedTags(){return t(Y)},onChangeTags:F,get shownTagInput(){return t(U)},set shownTagInput(n){s(U,n,!0)}});var wt=m(nt,2);{var pt=n=>{var M=qt(),P=v(M);ot(P,{fullWidth:!0,withoutMinWidth:!0,onClick:Q,type:"secondary",typeButton:"button",children:(_,G)=>{var S=it("cancel");h(_,S)},$$slots:{default:!0}});var O=m(P,2);ot(O,{fullWidth:!0,withoutMinWidth:!0,onClick:R,typeButton:"submit",children:(_,G)=>{var S=it("save");h(_,S)},$$slots:{default:!0}}),h(n,M)};B(wt,n=>{!t(U)&&!t(i)&&t(d)&&n(pt)})}lt(()=>{st(L,t(j)),st(A,t(X))}),ft("submit",b,E),h(c,q),tt()}et(["input"]);export{Qt as N};
