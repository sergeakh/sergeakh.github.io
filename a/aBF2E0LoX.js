import{p as K,J as M,u as Q,C as T,b as u,w as W,x as _,g as t,A as h,_ as C,a,$ as X,y as J,n as O,j as w,i as m,m as Y,a0 as I,f as Z,s as tt,c as et,B as at,z as nt,a1 as it}from"./aWqHuYvs5.js";var rt=Z('<div class="a p-1hq9a8m"><p class="p-1hq9a8m">Note not found</p> <!></div>');function lt(P,A){K(A,!0);const{getNoteById:f,isInitedNotes:$,saveNote:b,updateNote:B,revertNote:D,pinNote:q}=M(),{clearDialogPages:V}=Q(),{getHref:j}=T();let s=u("idle"),i=u(""),g=u(void 0),r=u(void 0),l=u(""),o=u(W([])),c=u(!1),v=u(0);const N=h($);_(()=>{t(N)&&(t(c),C(()=>{f(t(i))?.data.pinned!==t(c)&&q(t(i),t(c))}))}),_(()=>{if(!t(N))return;const e=new URLSearchParams(A.params).get("id");!e||e===t(i)||C(()=>{a(i,e,!0);const n=f(t(i));n?.data&&(a(r,n.data.link?X(n.data.link):void 0,!0),a(l,n.data.text,!0),a(o,n.data.tags.slice(),!0),a(c,!!n.data.pinned,!0),a(v,n.data.updatedAt,!0))})});const z=async()=>{if(t(g)){const e=f(t(i));if(!e?.data)return;const n=e.data.history?.find?.(x=>x.id===t(g));if(!n){a(g,void 0);return}if(n.link?.url===t(r)?.url&&n.link?.title===t(r)?.title&&n.text===t(l)&&JSON.stringify(n.tags)===JSON.stringify(t(o))){if(t(s)==="idle"){a(s,"loading");try{await D(t(i),t(g)),a(g,void 0),a(v,n.updatedAt,!0)}finally{a(s,"idle")}}}else if((e.data.link?.url!==t(r)?.url||e.data.link?.title!==t(r)?.title||e.data.text!==t(l)||JSON.stringify(e.data.tags)!==JSON.stringify(t(o)))&&t(s)==="idle"){a(s,"loading");try{await B(t(i),{link:I(t(r)),text:t(l),tags:t(o).slice()})}finally{a(s,"idle")}}}else{const e=f(t(i));if(!e?.data)return;if((e.data.link?.url!==t(r)?.url||e.data.link?.title!==t(r)?.title||e.data.text!==t(l)||JSON.stringify(e.data.tags)!==JSON.stringify(t(o)))&&t(s)==="idle"){a(s,"loading");try{a(v,0),a(g,await b(t(i),{link:I(t(r)),text:t(l),tags:t(o).slice()}),!0)}finally{a(s,"idle")}}}};_(()=>{t(N)&&t(s)!=="loading"&&z()});const F=e=>{e.preventDefault(),V()};var S=J(),H=O(S);{var L=e=>{var n=J(),x=O(n);{var R=p=>{var y=rt(),k=tt(et(y),2);{let d=h(()=>j(""));at(k,{element:"a",get href(){return t(d)},onClick:F,children:(E,st)=>{var G=nt("close");m(E,G)},$$slots:{default:!0}})}m(p,y)},U=p=>{{let y=h(()=>f(t(i))?.data.deletedAt),k=h(()=>f(t(i))?.data.archivedAt);it(p,{get noteId(){return t(i)},mode:"edit",get updatedAt(){return t(v)},get deletedAt(){return t(y)},get archivedAt(){return t(k)},get link(){return t(r)},set link(d){a(r,d,!0)},get text(){return t(l)},set text(d){a(l,d,!0)},get tags(){return t(o)},set tags(d){a(o,d,!0)},get pinned(){return t(c)},set pinned(d){a(c,d,!0)}})}};w(x,p=>{!t(i)||!f(t(i))?p(R):p(U,!1)})}m(e,n)};w(H,e=>{t(N)&&e(L)})}m(P,S),Y()}export{lt as default};
