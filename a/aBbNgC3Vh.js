import{p as L,C as O,D as z,u as F,v as J,b as C,w as M,x as N,g as o,o as R,f as m,j as P,c as p,i as c,m as W,a as g,A as x,a9 as q,L as G,y as Q,n as V,H as X,z as b,s as Y,B as Z}from"./aDb0K7ahq.js";import{g as ee,b as ae,a as re}from"./abA9hIFUQ.js";import{g as te}from"./a9q_jSmK4.js";import{e as ne}from"./aCpa8lgv9.js";var a=(r=>(r[r.Signin=0]="Signin",r[r.SigninError=1]="SigninError",r))(a||{}),ie=m('<div class="b p-mcehu"><!></div>'),se=m('<div class="b p-mcehu"><!> <!></div>'),oe=m('<div class="a p-mcehu"><!></div>');function de(r,A){L(A,!0);const{getSearchParams:K,replaceSearchParams:D}=O(),{initCloudAccount:E,getAccount:B}=z(),{clearDialogPages:T}=F(),$=x(K),{blockDialog:y}=J();let U=x(B),S=C(""),t=C(M(a.Signin));const _=async()=>{g(t,a.Signin,!0),await new Promise(e=>setTimeout(e,2e3));try{const e=await te(),{credentialData:n,clientKey:l}=await ee({challenge:e}),u=await fetch("/api/signin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(u.status!==200){g(t,a.SigninError,!0);return}const i=await u.json();if(!i.serverKey){g(t,a.SigninError,!0);return}const d=i.serverKey,v=o(U)===void 0,{encryptedClientKey:f}=await ne({clientKey:l,serverKey:new Uint8Array(ae(d))});if(q(),await E({encryptedClientKey:re(f)}),y(!1),v)T();else{let s=o($).get("retPath")||"";s&&g(S,s,!0),D(o(S)||"")}}catch(e){console.error("Error during sign-in:",e),g(t,a.SigninError,!0)}};N(()=>{y(o(t)===a.Signin)}),R(()=>{_()});var w=oe(),j=p(w);{var k=e=>{var n=ie(),l=p(n);G(l,{}),c(e,n)},H=e=>{var n=Q(),l=V(n);{var u=i=>{var d=se(),v=p(d);X(v,{children:(s,I)=>{var h=b("something went wrong");c(s,h)}});var f=Y(v,2);Z(f,{onClick:()=>_(),fullWidth:!0,children:(s,I)=>{var h=b("try again");c(s,h)},$$slots:{default:!0}}),c(i,d)};P(l,i=>{o(t)===a.SigninError&&i(u)},!0)}c(e,n)};P(j,e=>{o(t)===a.Signin?e(k):e(H,!1)})}c(r,w),W()}export{de as default};
