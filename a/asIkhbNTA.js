import{p as X,D as Y,J as Z,u as $,g as t,h as y,k as c,o as ee,f as j,e as G,$ as h,x as T,t as L,m as N,d,c as g,s as f,i as x,y as O,R as te,j as se,v as ae,l as re,a as ne,I as le,V as ie,E as oe,a0 as de,w as ce}from"./aDG-zfldL.js";import{I as ue}from"./amiNdj6FM.js";var fe=j('<div><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper> <!></div>'),ve=(P,s,C,k)=>{t(s)!==""&&C(t(s)),k(!1),c(s,"")},ge=j('<form class="c p-r3if1j"><div class="d p-r3if1j"><!></div> <button type="button" class="e p-r3if1j">Done</button></form>'),_e=j('<div class="a"><div class="b p-r3if1j"><!> <!> <!> <!></div> <!></div>');function Te(P,s){X(s,!0);const{isInitedNotes:C,getGetMapTags:k,getGetNotes:V}=Y();let v=y(null),r=y(""),_=y(null);const z=O(C);let o=Z(s,"shownTagInput",15);const F=()=>t(z)?s.mode==="exit"?de(new Set(s.selectedTags),V()()||[]):[...k()().keys()]:[];let b=O(()=>F().filter(e=>s.selectedTags.some(a=>e===a)||e==="inbox"?!1:t(r)===""||e.toLowerCase().indexOf(t(r).toLowerCase())===0));const m=e=>{if(!s.selectedTags.includes(e)){if(s.mode!=="exit"||t(b).includes(e)){e!=="inbox"&&s.onChangeTags([...s.selectedTags,e]),c(r,"");return}t(v)?.focus()}},H=e=>{const a=s.selectedTags.filter(i=>i!==e);a.length===0?s.onChangeTags([]):s.onChangeTags(a)},J=e=>{e.preventDefault(),t(r)!==""?m(t(r)):o(!1)};$(()=>{t(v)&&o()&&t(v).focus(),o()||c(r,"")});const I=e=>{e.target&&t(_)&&!t(_).contains(e.target)&&(o(!1),c(r,""))};ee(()=>(document.addEventListener("click",I,{capture:!0}),()=>{document.removeEventListener("click",I,{capture:!0})}));var w=_e(),R=g(w),S=g(R);G(S,16,()=>s.selectedTags,e=>e,(e,a)=>{h(e,{onClick:()=>H(a),type:"button",style:"selected",children:(i,n)=>{var l=T();L(()=>N(l,a)),d(i,l)},$$slots:{default:!0}})});var D=f(S,2);{var q=e=>{var a=ae(),i=re(a);G(i,16,()=>t(b).filter(n=>n.toLowerCase()!==t(r).toLowerCase()).slice(0,Math.max(3,3-s.selectedTags.length)),n=>n,(n,l)=>{h(n,{onClick:()=>m(l),children:(u,M)=>{var p=T();L(()=>N(p,l)),d(u,p)},$$slots:{default:!0}})}),d(e,a)};x(D,e=>{(t(r)!==""||s.selectedTags.length>0&&o()&&s.mode==="exit")&&e(q)})}var E=f(D,2);{var A=e=>{h(e,{onClick:()=>{m(t(r)),c(r,"")},children:(a,i)=>{var n=T();L(()=>N(n,t(r))),d(a,n)},$$slots:{default:!0}})};x(E,e=>{t(r)!==""&&(s.mode!=="exit"||t(b).find(a=>a.toLowerCase()===t(r).toLowerCase()))&&e(A)})}var B=f(E,2);{var K=e=>{h(e,{mode:"empty",onClick:()=>o(!0),children:(a,i)=>{var n=fe(),l=g(n);ne(l,()=>({"--size":"12px"})),le(l.lastChild,{name:"plus"});var u=f(l,2);ie(u,{children:(M,p)=>{var W=T("add tag");d(M,W)}}),d(a,n)},$$slots:{default:!0}})};x(B,e=>{o()||e(K)})}var Q=f(R,2);{var U=e=>{var a=ge(),i=g(a),n=g(i);ue(n,{placeholder:"tag",get ref(){return t(v)},set ref(u){c(v,u,!0)},get value(){return t(r)},set value(u){c(r,u,!0)}});var l=f(i,2);l.__click=[ve,r,m,o],oe("submit",a,J),d(e,a)};x(Q,e=>{o()&&e(U)})}te(w,e=>c(_,e),()=>t(_)),d(P,w),se()}ce(["click"]);export{Te as N};
