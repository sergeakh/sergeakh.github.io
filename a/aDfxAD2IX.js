import{p as de,u as fe,v as pe,b as J,w as ge,x as M,g as a,o as _e,a as n,f as l,j as v,c as i,i as s,m as ye,L as N,y as O,n as h,r as ue,H as he,z as D,s as d,e as me,d as Ae,I as Y,t as Ke,q as be,V as Ce,B as G,A as Q,P as R}from"./aDjwQjFDy.js";import{g as ke}from"./a9q_jSmK4.js";import{g as we}from"./abA9hIFUQ.js";var xe=l('<p class="b p-tavvfa">Loading access keys</p>'),Pe=l('<p class="b p-tavvfa">Confirming</p>'),De=l('<button class="f p-tavvfa"><!> <!></button>'),$e=l('<li class="p-tavvfa"><div class="c p-tavvfa"><div><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper></div> <div class="d p-tavvfa"> </div></div> <div class="e p-tavvfa"><!></div></li>'),He=l('<p class="b g p-tavvfa">Error deleting access key</p>'),Se=l('<div class="h p-tavvfa"><!></div>'),Te=l('<p class="b p-tavvfa">You have reached the maximum number of access keys.</p>'),je=l('<!> <ul class="p-tavvfa"></ul> <!> <!>',1),Ee=l('<p class="b g p-tavvfa">Something went wrong</p> <div class="h p-tavvfa"><!></div>',1),Le=l('<div class="a p-tavvfa"><!></div>');function Ie(U,z){de(z,!0);const{createHandleClickDialogPage:W,createDialogPageHref:X}=fe(),{blockDialog:B}=pe();let t=J("loadingAccessKeys"),m=J(ge([]));M(()=>{B(a(t)==="loadingAccessKeys"||a(t)==="confirmingDeleteAccessKey")}),_e(()=>()=>{B(!1)}),M(()=>{if(!z.hidden&&a(t)==="successAccessKeys"||a(t)==="loadingAccessKeys"){const o=new AbortController;return(async()=>{try{const c=await fetch("/api/credentials",{method:"POST",signal:o.signal});if(!c.ok)throw new Error("Failed to fetch access keys");const f=await c.json();n(m,f.credentials||[],!0),n(t,"successAccessKeys")}catch{n(t,"errorAccessKeys")}})(),()=>{o.abort()}}});const Z=async o=>{n(t,"confirmingDeleteAccessKey");try{const c=await ke(),f=await we({challenge:c});if(!(await fetch("/api/deleteCredential",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({challenge:c,id:o,confirmCredential:f.credentialData})})).ok)throw new Error("Failed to add access key");n(t,"loadingAccessKeys")}catch{n(t,"errorDeleteAccessKey");return}};var F=Le(),ee=i(F);{var ae=o=>{N(o,{children:(c,f)=>{var A=xe();s(c,A)},$$slots:{default:!0}})},se=o=>{var c=O(),f=h(c);{var A=p=>{N(p,{children:(K,I)=>{var $=Pe();s(K,$)},$$slots:{default:!0}})},te=p=>{var K=O(),I=h(K);{var $=g=>{var u=je(),b=h(u);he(b,{children:(e,r)=>{var y=D("Access Keys");s(e,y)}});var C=d(b,2);me(C,21,()=>a(m),e=>e.id,(e,r)=>{var y=$e(),w=i(y),x=i(w),P=i(x);Ae(P,()=>({"--size":"20px"})),Y(P.lastChild,{name:"key"});var V=d(x,2),j=i(V),oe=d(w,2),ce=i(oe);{var le=E=>{var L=De();L.__click=()=>Z(a(r).id);var q=i(L);Y(q,{name:"close"});var ie=d(q,2);Ce(ie,{children:(ne,Oe)=>{var ve=D("delete access key");s(ne,ve)}}),s(E,L)};v(ce,E=>{a(m).length>1&&E(le)})}Ke(()=>be(j,a(r).name)),s(e,y)});var _=d(C,2);{var k=e=>{var r=He();s(e,r)};v(_,e=>{a(t)==="errorDeleteAccessKey"&&e(k)})}var H=d(_,2);{var S=e=>{var r=Se(),y=i(r);{let w=Q(()=>X(R.ConfirmAccessKey)),x=Q(()=>W(R.ConfirmAccessKey));G(y,{element:"a",get href(){return a(w)},get onClick(){return a(x)},children:(P,V)=>{var j=D("Add access key");s(P,j)},$$slots:{default:!0}})}s(e,r)},T=e=>{var r=Te();s(e,r)};v(H,e=>{a(m).length<5?e(S):e(T,!1)})}s(g,u)},re=g=>{var u=O(),b=h(u);{var C=_=>{var k=Ee(),H=d(h(k),2),S=i(H);G(S,{onClick:()=>{n(t,"loadingAccessKeys")},children:(T,e)=>{var r=D("Try Again");s(T,r)},$$slots:{default:!0}}),s(_,k)};v(b,_=>{a(t)==="errorAccessKeys"&&_(C)},!0)}s(g,u)};v(I,g=>{a(t)==="successAccessKeys"||a(t)==="errorDeleteAccessKey"?g($):g(re,!1)},!0)}s(p,K)};v(f,p=>{a(t)==="confirmingDeleteAccessKey"?p(A):p(te,!1)},!0)}s(o,c)};v(ee,o=>{a(t)==="loadingAccessKeys"?o(ae):o(se,!1)})}s(U,F),ye()}ue(["click"]);export{Ie as default};
