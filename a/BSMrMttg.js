import{p as Y,G as Z,h as w,r as $,u as _t,g as t,f as b,i as M,c as s,S as H,k as l,d,j as tt,s as h,l as pt,w as et,D as gt,Q as mt,o as ht,y as E,J as wt,K as bt,t as q,M as O,E as xt,B as V,x as X,m as kt}from"./D2ag99TI.js";import{N as Dt}from"./DGmmffOe.js";import{I as It}from"./B4en0-hp.js";var Nt=(u,e,r,c)=>{l(e,r.url,!0),c(!1)},yt=(u,e,r,c,D)=>{if(t(e)&&t(r)){l(e,"");return}c.onChangeUrl(t(e)),D(!1)},Ut=b('<div class="wrapper svelte-w8w68w"><!> <div class="containerButtons svelte-w8w68w"><button class="svelte-w8w68w">Cancel</button> <button class="svelte-w8w68w">Done</button></div></div>'),Ct=(u,e)=>{e(!0)},Tt=(u,e,r)=>{l(e,""),r.onDeleteUrl()},Et=b('<button class="button svelte-w8w68w">Edit link</button> <button class="button svelte-w8w68w">Delete link</button>',1),Bt=(u,e)=>{e(!0)},Mt=b('<button class="button svelte-w8w68w">Add link</button>'),St=b('<div class="wrapperButtons svelte-w8w68w"><!></div>'),At=b("<div><!></div>");function Lt(u,e){Y(e,!0);let r=Z(e,"shownUrlInput",15),c=w(""),D=w(null),S=w(null),x=w($(e.url));const L=n=>{l(c,""),l(x,n.target.value||"",!0);try{new URL(t(x))}catch{l(c,"Invalid URL")}};_t(()=>{r()&&t(D)?.focus()});var p=At(),o=s(p);{var i=n=>{var v=Ut(),k=s(v);It(k,{get value(){return t(x)},get error(){return t(c)},onInput:L,placeholder:"url",get ref(){return t(D)},set ref(_){l(D,_,!0)}});var g=h(k,2),U=s(g);U.__click=[Nt,x,e,r];var f=h(U,2);f.__click=[yt,x,c,e,r],d(n,v)},I=n=>{var v=St(),k=s(v);{var g=f=>{var _=Et(),A=pt(_);A.__click=[Ct,r];var W=h(A,2);W.__click=[Tt,x,e],d(f,_)},U=f=>{var _=Mt();_.__click=[Bt,r],d(f,_)};M(k,f=>{e.url?f(g):f(U,!1)})}d(n,v)};M(o,n=>{r()?n(i):n(I,!1)})}H(p,n=>l(S,n),()=>t(S)),d(u,p),tt()}et(["click"]);const Wt=(u,e,r)=>{t(e)&&(t(e).style.height="auto",t(e).style.height=t(e).scrollHeight+"px"),r({text:u.target.value.trim()})},Rt=(u,e)=>{e({name:u.target.value.trim()})};var Ft=b("<span> </span>"),Pt=b('<div class="dateInfo svelte-t8fgpr"><!></div>'),Ht=b('<div class="submitButtons svelte-t8fgpr"><!> <!></div>'),zt=b('<div class="form svelte-t8fgpr"><div class="scrollWrapper"><div class="formFields"><!> <form><input class="inputName svelte-t8fgpr" placeholder="Name"/></form> <textarea class="textarea svelte-t8fgpr" placeholder="Note"></textarea></div></div> <div><!> <div class="formTagsWrapper svelte-t8fgpr"><!></div> <!></div></div>');function Kt(u,e){Y(e,!0);const{getNoteById:r,deleteNoteDraft:c,saveNoteDraft:D,putNoteDraft:S}=gt(),{checkMobileSize:x}=mt();let L=Z(e,"mode",3,"add"),p=w($(e.noteId||r()?.id||"")),o=E(()=>r(t(p))?.data||null),i=E(()=>t(o)?.draft||null),I=w(null),n=w(!1),v=w(!1),k=w(null);const g=async({name:a,url:N,text:C,tags:B})=>{let m=B?.map(y=>y.trim())||t(i)?.tags||t(o)?.tags||[];const T={name:a??t(i)?.name??t(o)?.name??"",url:N??t(i)?.url??t(o)?.url??"",text:C??t(i)?.text??t(o)?.text??"",tags:m,createdAt:t(i)?.createdAt||Date.now(),updatedAt:Date.now()};l(p,await S(t(p),T)||"",!0)},U=a=>{a.preventDefault(),D(t(p)),e.onSubmit()},f=a=>{a.preventDefault(),t(I)&&t(I).focus()},_=a=>{a.key==="Escape"&&(document.activeElement instanceof HTMLInputElement&&document.activeElement.type==="text"||document.activeElement instanceof HTMLTextAreaElement)&&(t(n)&&(l(n,!1),a.preventDefault(),a.stopPropagation()),t(v)&&(l(v,!1),a.preventDefault(),a.stopPropagation()))};ht(()=>(x()||t(k)?.focus(),document.addEventListener("keydown",_),()=>document.removeEventListener("keydown",_)));const A=a=>{g({url:a})},W=()=>{g({url:""})},at=a=>{g({tags:a})},rt=()=>{c(t(p))};let nt=E(()=>t(i)?.name??t(o)?.name??""),lt=E(()=>t(i)?.url??t(o)?.url??""),ot=E(()=>t(i)?.text??t(o)?.text??""),st=E(()=>t(i)?.tags??t(o)?.tags??[]);var z=zt(),j=s(z),ut=s(j),G=s(ut);Lt(G,{get url(){return t(lt)},onChangeUrl:A,onDeleteUrl:W,get shownUrlInput(){return t(v)},set shownUrlInput(a){l(v,a,!0)}});var R=h(G,2),F=s(R);F.__input=[Rt,g],H(F,a=>l(k,a),()=>t(k));var P=h(R,2);P.__input=[Wt,I,g],H(P,a=>l(I,a),()=>t(I));var J=h(j,2);wt(J,1,bt(["bottom","bottomSpace"]),"svelte-t8fgpr");var K=s(J);{var it=a=>{var N=Pt(),C=s(N);{var B=m=>{var T=Ft(),y=s(T);q(ft=>kt(y,`updated: ${ft??""}`),[()=>new Date(t(o).updatedAt).toLocaleString()]),d(m,T)};M(C,m=>{t(o)?.updatedAt&&m(B)})}d(a,N)};M(K,a=>{L()==="edit"&&a(it)})}var Q=h(K,2),vt=s(Q);Dt(vt,{get selectedTags(){return t(st)},onChangeTags:at,get shownTagInput(){return t(n)},set shownTagInput(a){l(n,a,!0)}});var dt=h(Q,2);{var ct=a=>{var N=Ht(),C=s(N);V(C,{fullWidth:!0,withoutMinWidth:!0,onClick:rt,type:"secondary",typeButton:"button",children:(m,T)=>{var y=X("cancel");d(m,y)},$$slots:{default:!0}});var B=h(C,2);V(B,{fullWidth:!0,withoutMinWidth:!0,onClick:U,typeButton:"submit",children:(m,T)=>{var y=X("save");d(m,y)},$$slots:{default:!0}}),d(a,N)};M(dt,a=>{!t(n)&&!t(v)&&t(i)&&a(ct)})}q(()=>{O(F,t(nt)),O(P,t(ot))}),xt("submit",R,f),d(u,z),tt()}et(["input"]);export{Kt as N};
