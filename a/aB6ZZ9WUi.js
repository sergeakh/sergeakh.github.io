import{p as Ha,J as Na,u as Pa,v as Ba,K as Fa,b as m,w as Ma,x as ja,g as a,o as ca,f as D,j as x,c as o,i as p,m as Ua,a as i,n as A,s as c,d as za,I as qa,y as ta,z as M,N as Wa,B as ra,A as sa,L as Ja,r as Ga}from"./aDoGJRoPx.js";import{S as Ka}from"./aXuuRa1fb.js";import{S as N}from"./a3h9fRklM.js";const Qa=J=>{const T=Math.floor(Date.now()/1e3),h={};J.forEach(n=>{if(!n)return;const f=n.data.tags||["Imported"];if(f.length===0){h.ROOT||(h.ROOT=[]),h.ROOT.push(n);return}f.forEach(u=>{h[u]||(h[u]=[]),h[u].push(n)})});let b=`<!DOCTYPE NETSCAPE-Note-file-1>
<!-- This is an automatically generated file.
 It will be read and overwritten.
 DO NOT EDIT! -->
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8">
<TITLE>Bookmarks</TITLE>
<H1>Bookmarks</H1>
<DL><p>
<DT><H3 ADD_DATE="${T}" LAST_MODIFIED="${T}" PERSONAL_TOOLBAR_FOLDER="true">Bookmarks bar</H3>
<DL><p>`;return Object.keys(h).forEach(n=>{n!=="ROOT"&&n!=="other"&&(b+=`
    <DT><H3 ADD_DATE="${T}" LAST_MODIFIED="${T}">${n}</H3>
    <DL><p>`,h[n].forEach(f=>{if(!f.data.link)return;const u=f.data.link.title.replace(/"/g,"&quot;");b+=`
        <DT><A HREF="${f.data.link.url}" ADD_DATE="${Math.floor(f.data.createdAt/1e3)||T}">${u}</A>`}),b+=`
    </DL><p>`)}),h.ROOT&&h.ROOT.forEach(n=>{if(!n.data.link)return;const f=n.data.link.title.replace(/"/g,"&quot;");b+=`
    <DT><A HREF="${n.data.link.url}" ADD_DATE="${Math.floor(n.data.createdAt/1e3)||T}">${f}</A>`}),b+=`
</DL><p>`,h.other&&h.other.forEach(n=>{if(!n.data.link)return;const f=n.data.link.title.replace(/"/g,"&quot;");b+=`
    <DT><A HREF="${n.data.link.url}" ADD_DATE="${Math.floor(n.data.createdAt/1e3)||T}">${f}</A>`}),b+="</DL><p>",b};var Va=D('<div class="g p-15adabw"><p class="h p-15adabw">Exclude history</p> <div class="i p-15adabw"><!></div></div> <div class="g p-15adabw"><p class="h p-15adabw">Exclude notes</p> <div class="i p-15adabw"><!></div></div>',1),Ya=D('<div class="g p-15adabw"><p class="h p-15adabw">Exclude other tags</p> <div class="i p-15adabw"><!></div></div>'),Xa=D('<div class="g p-15adabw"><p class="h p-15adabw">Exclude bin</p> <div class="i p-15adabw"><!></div></div> <div class="g p-15adabw"><p class="h p-15adabw">Exclude archive</p> <div class="i p-15adabw"><!></div></div> <!> <div class="g p-15adabw"><p class="h p-15adabw">Exclude tags</p> <div class="i p-15adabw"><!></div></div> <!> <p class="j k p-15adabw">Filter tags:</p> <!>',1),Za=D('<div class="l p-15adabw"><!></div>'),ae=D('<div class="b p-15adabw"><div class="c p-15adabw"><!> <p class="d p-15adabw"><!></p></div></div> <div><div class="e p-15adabw"><button class="f p-15adabw"><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper><span>Settings</span></button></div> <!> <!></div>',1),ee=D('<div class="b p-15adabw"><p class="j p-15adabw">Exporting...</p> <!></div>'),te=D('<div class="b p-15adabw"><p class="j m p-15adabw">Something went wrong</p></div> <div class="l p-15adabw"><!></div>',1),re=D('<div class="b p-15adabw"><p class="j p-15adabw">Success!</p></div> <div class="l p-15adabw"><!></div>',1),se=D('<div class="a p-15adabw"><!></div>');function ie(J,T){Ha(T,!0);const{getGetNotes:h}=Na(),{clearDialogPages:b}=Pa(),{blockDialog:n}=Ba(),{checkMobileSize:f}=Fa();let u=m("idle"),C=m("sync"),w=m(Ma([])),$=m(!1),G=m(!1),O=m(!1),j=m(!1),U=m(!1),K=m(!1),Q=m(!1),V=m(!1);const va=()=>{b()};ja(()=>{n(a(u)==="loading")}),ca(()=>()=>{n(!1)});const pa=()=>{i(G,!a(G)),i(U,!1),i(j,!1),i($,!1),i(w,[],!0)},ua=async()=>{i(u,"loading"),await new Promise(r=>setTimeout(r,0));let s=(h()()||[]).filter(r=>r.data).filter(r=>a(w).length===0?!0:a(w).every(e=>r.data.tags.includes(e)));if(a(U)&&(s=s.map(r=>{const e={...r};return e.data={...e.data,history:[]},e})),a(K)&&(s=s.filter(r=>!r.data.deletedAt)),a(Q)&&(s=s.filter(r=>!r.data.archivedAt)),a(O)&&(s=s.map(r=>{const e={...r};return e.data={...e.data,tags:[],history:e.data.history.map(l=>({...l,tags:[]}))},e})),a(V)&&(s=s.map(r=>{const e={...r};return e.data={...e.data,tags:[],text:"",history:e.data.history.map(l=>({...l,text:"",tags:[]}))},e})),a(j)&&a(O)===!1&&(s=s.map(r=>{const e={...r};return e.data={...e.data,tags:e.data.tags.filter(l=>a(w).includes(l)),history:e.data.history.map(l=>({...l,tags:l.tags.filter(v=>a(w).includes(v))}))},e})),a(C)==="sync"){const r=`${[...a(O)?[]:a(w),"notes"].join("_")}.txt`,e=JSON.stringify({notes:s});return{filename:r,data:e}}else{const r=`${[...a(O)?[]:a(w),"bookmarks"].join("_")}_${new Date().toLocaleDateString().replace(/\//g,"_")}.html`,e=Qa(s);return{filename:r,data:e}}},fa=async()=>{try{const{filename:t,data:s}=await ua(),r=new File([s],t,{type:a(C)==="sync"?"text/plain":"text/html"}),e=()=>{const l=new Blob([s],{type:a(C)==="sync"?"text/plain":"text/html"}),v=URL.createObjectURL(l),g=document.createElement("a");g.href=v,g.download=t,document.body.appendChild(g),g.click(),setTimeout(()=>{document.body.removeChild(g),URL.revokeObjectURL(v)},0)};if(navigator.canShare({files:[r]}))try{await navigator.share({files:[r]})}catch(l){const v=l;if(v&&v.name!=="AbortError")e();else if(v&&v.name==="AbortError"){i(u,"idle");return}}else e();await new Promise(l=>setTimeout(l,500)),i(u,"success")}catch(t){console.error("Error sharing file:",t),i(u,"error")}},ha=t=>{i(w,t,!0)},oa=t=>{t.key==="Escape"&&(document.activeElement instanceof HTMLInputElement&&document.activeElement.type==="text"||document.activeElement instanceof HTMLTextAreaElement)&&(a($)&&i($,!1),document.activeElement.blur(),t.preventDefault(),t.stopPropagation())},ga=t=>{i(j,t,!0)},_a=t=>{i(U,t,!0)},ma=t=>{i(K,t,!0)},ba=t=>{i(Q,t,!0)},wa=t=>{i(O,t,!0)},Ta=t=>{i(V,t,!0)};ca(()=>(document.addEventListener("keydown",oa),()=>document.removeEventListener("keydown",oa)));var na=se(),Ea=o(na);{var ka=t=>{var s=ae(),r=A(s),e=o(r),l=o(e);Ka(l,{items:[{title:"Sync",value:"sync"},{title:"Bookmarks",value:"bookmarks"}],get value(){return a(C)},onChange:d=>{i(C,d,!0)}});var v=c(l,2),g=o(v);{var P=d=>{var _=M("App format for sync or backup");p(d,_)},Y=d=>{var _=M("Browser bookmarks format (exports only bookmarks, not notes)");p(d,_)};x(g,d=>{a(C)==="sync"?d(P):d(Y,!1)})}var X=c(r,2),E=o(X),y=o(E);y.__click=pa;var S=o(y);za(S,()=>({"--rotate":"30deg","--size":"20px"})),qa(S.lastChild,{name:"settings"});var I=c(E,2);{var L=d=>{var _=Xa(),H=A(_),q=c(o(H),2),B=o(q);N(B,{get checked(){return a(K)},onChange:ma});var Z=c(H,2),aa=c(o(Z),2),Da=o(aa);N(Da,{get checked(){return a(Q)},onChange:ba});var da=c(Z,2);{var ya=k=>{var F=Va(),W=A(F),ea=c(o(W),2),$a=o(ea);N($a,{get checked(){return a(U)},onChange:_a});var Sa=c(W,2),Ia=c(o(Sa),2),Ra=o(Ia);N(Ra,{get checked(){return a(V)},onChange:Ta}),p(k,F)};x(da,k=>{a(C)==="sync"&&k(ya)})}var ia=c(da,2),Aa=c(o(ia),2),Ca=o(Aa);N(Ca,{get checked(){return a(O)},onChange:wa});var la=c(ia,2);{var Oa=k=>{var F=Ya(),W=c(o(F),2),ea=o(W);N(ea,{get checked(){return a(j)},onChange:ga}),p(k,F)};x(la,k=>{a(w).length>0&&!a(O)&&k(Oa)})}var La=c(la,4);Wa(La,{mode:"exit",get selectedTags(){return a(w)},onChangeTags:ha,get shownTagInput(){return a($)},set shownTagInput(k){i($,k,!0)}}),p(d,_)};x(I,d=>{a(G)&&d(L)})}var R=c(I,2);{var z=d=>{var _=Za(),H=o(_);{let q=sa(f);ra(H,{get fullWidth(){return a(q)},onClick:fa,children:(B,Z)=>{var aa=M("Export");p(B,aa)},$$slots:{default:!0}})}p(d,_)};x(R,d=>{a($)||d(z)})}p(t,s)},xa=t=>{var s=ta(),r=A(s);{var e=v=>{var g=ee(),P=c(o(g),2);Ja(P,{}),p(v,g)},l=v=>{var g=ta(),P=A(g);{var Y=E=>{var y=te(),S=c(A(y),2),I=o(S);{let L=sa(f);ra(I,{get fullWidth(){return a(L)},onClick:()=>{i(u,"idle")},children:(R,z)=>{var d=M("Try Again");p(R,d)},$$slots:{default:!0}})}p(E,y)},X=E=>{var y=ta(),S=A(y);{var I=L=>{var R=re(),z=c(A(R),2),d=o(z);{let _=sa(f);ra(d,{get fullWidth(){return a(_)},onClick:va,children:(H,q)=>{var B=M("Close");p(H,B)},$$slots:{default:!0}})}p(L,R)};x(S,L=>{a(u)==="success"&&L(I)},!0)}p(E,y)};x(P,E=>{a(u)==="error"?E(Y):E(X,!1)},!0)}p(v,g)};x(r,v=>{a(u)==="loading"?v(e):v(l,!1)},!0)}p(t,s)};x(Ea,t=>{a(u)==="idle"?t(ka):t(xa,!1)})}p(J,na),Ua()}Ga(["click"]);export{ie as default};
