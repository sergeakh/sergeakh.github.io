import{p as $,D as q,n as z,h as f,r as E,u as _,g as t,y as G,U as H,k as a,v as S,l as J,i as O,d as v,j as K,f as M,s as Q,c as T,B as W,x as X}from"./aC1xpSvD-.js";import{N as Y}from"./aEpkgGAZ0.js";import"./a9vnhDBJf.js";import"./aDq3vB9Uh.js";var Z=M('<div class="block svelte-1jn65py"><p class="svelte-1jn65py">Note not found</p> <!></div>');function it(k,x){$(x,!0);const{getNoteById:m,isInitedNotes:C,saveNote:w,updateNote:A,revertNote:D}=q(),{clearDialogPages:I}=z();let s=f("idle"),n=f(""),g=f(void 0),d=f(""),l=f(""),o=f(""),u=f(E([])),p=f(0);const y=G(C);_(()=>{t(y)&&H(()=>{const e=new URLSearchParams(x.params).get("id");if(e){a(n,e,!0);const r=m(t(n));r?.data&&(a(d,r.data.url,!0),a(l,r.data.name,!0),a(o,r.data.text,!0),a(u,r.data.tags.slice(),!0),a(p,r.data.updatedAt,!0))}})});const P=async()=>{if(t(g)){const e=m(t(n));if(!e?.data)return;const r=e.data.history?.find?.(N=>N.id===t(g));if(!r){a(g,void 0);return}if(r.url===t(d)&&r.name===t(l)&&r.text===t(o)&&JSON.stringify(r.tags)===JSON.stringify(t(u))){if(t(s)==="idle"){a(s,"loading");try{await D(t(n),t(g)),a(g,void 0),a(p,r.updatedAt,!0)}finally{a(s,"idle")}}}else if((e.data.url!==t(d)||e.data.name!==t(l)||e.data.text!==t(o)||JSON.stringify(e.data.tags)!==JSON.stringify(t(u)))&&t(s)==="idle"){a(s,"loading");try{await A(t(n),{url:t(d),name:t(l),text:t(o),tags:t(u).slice()})}finally{a(s,"idle")}}}else{const e=m(t(n));if(!e?.data)return;if((e.data.url!==t(d)||e.data.name!==t(l)||e.data.text!==t(o)||JSON.stringify(e.data.tags)!==JSON.stringify(t(u)))&&t(s)==="idle"){a(s,"loading");try{a(p,0),a(g,await w(t(n),{url:t(d),name:t(l),text:t(o),tags:t(u).slice()}),!0)}finally{a(s,"idle")}}}};_(()=>{t(y)&&t(s)!=="loading"&&P()});const b=e=>{e.preventDefault(),I()};var h=S(),j=J(h);{var B=e=>{var r=S(),N=J(r);{var U=c=>{var i=Z(),F=Q(T(i),2);W(F,{element:"a",href:"/",onClick:b,children:(L,tt)=>{var R=X("close");v(L,R)},$$slots:{default:!0}}),v(c,i)},V=c=>{Y(c,{mode:"edit",get updatedAt(){return t(p)},get url(){return t(d)},set url(i){a(d,i,!0)},get name(){return t(l)},set name(i){a(l,i,!0)},get text(){return t(o)},set text(i){a(o,i,!0)},get tags(){return t(u)},set tags(i){a(u,i,!0)}})};O(N,c=>{!t(n)||!m(t(n))?c(U):c(V,!1)})}v(e,r)};O(j,e=>{t(y)&&e(B)})}v(k,h),K()}export{it as default};
