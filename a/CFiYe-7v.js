import{p as te,i as re,h as ae,A as se,z as ne,u as oe,g as s,j as L,o as le,f as y,m as h,c as d,d as t,n as ie,s as w,l as i,B as N,x as T,D as ce,q as A,r as f,L as O}from"./BUvhNrTJ.js";import{b as q,c as ve,g as de}from"./BEGDcNQV.js";import{g as fe,a as ye}from"./9q_jSmK4.js";import{d as me}from"./Cpa8lgv9.js";import{I as pe}from"./DMtE5168.js";var ue=y('<form><p class="message error svelte-1wrlvyn">Enter a name for a key</p> <div class="inputContainer svelte-1wrlvyn"><!></div> <div class="buttonContainer svelte-1wrlvyn"><!></div></form>'),ge=y('<p class="message svelte-1wrlvyn">Adding the access key</p>'),he=y('<p class="message svelte-1wrlvyn">Confirming</p>'),Ce=y('<p class="message error svelte-1wrlvyn">Something went wrong</p> <div class="buttonContainer svelte-1wrlvyn"><!></div>',1),_e=y('<p class="message svelte-1wrlvyn">Confirm this operation with another key</p> <div class="buttonContainer svelte-1wrlvyn"><!></div>',1),we=y('<div class="content svelte-1wrlvyn"><!></div>');function Pe(z,F){te(F,!0);const{blockDialog:B}=re(),{popStackPages:H}=ae(),{getAccount:J}=se(),{back:U}=ne();let e=L("idle"),C="",K=null,k=L("");oe(()=>{B(s(e)==="confirmingAccessKey"||s(e)==="addingAccessKey")}),le(()=>()=>{B(!1)});const M=async r=>{r.preventDefault(),i(e,"addingAccessKey");try{C=await fe();const a=await ye(),n=J();if(!n||!n.encryptedClientKey)throw new Error("No account found");const m=await me({encryptedClientKey:q(n.encryptedClientKey),serverKey:q(a)});K=await ve({challenge:C,clientKey:m}),i(e,"confirmAccessKey")}catch{i(e,"error");return}},G=async()=>{i(e,"confirmingAccessKey");try{const r=await de({challenge:C});if(!K)throw new Error("No credential data found");if(!(await fetch("/api/addCredential",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({challenge:C,name:s(k)||`key ${Math.floor(Math.random()*1e3)}`,newCredential:K,confirmCredential:r.credentialData})})).ok)throw new Error("Failed to add access key");H(),U()}catch{i(e,"error");return}};var j=we(),Q=d(j);{var R=r=>{var a=ue(),n=w(d(a),2),m=d(n);pe(m,{placeholder:"key name",get value(){return s(k)},set value(l){i(k,l,!0)}});var $=w(n,2),o=d($);N(o,{onClick:M,children:(l,b)=>{var p=T("Add key");t(l,p)},$$slots:{default:!0}}),ce("submit",a,M),t(r,a)},V=r=>{var a=A(),n=f(a);{var m=o=>{O(o,{children:(l,b)=>{var p=ge();t(l,p)},$$slots:{default:!0}})},$=o=>{var l=A(),b=f(l);{var p=c=>{O(c,{children:(_,I)=>{var x=he();t(_,x)},$$slots:{default:!0}})},W=c=>{var _=A(),I=f(_);{var x=v=>{var u=Ce(),P=w(f(u),2),D=d(P);N(D,{onClick:()=>{i(e,"idle")},children:(g,S)=>{var E=T("Try Again");t(g,E)},$$slots:{default:!0}}),t(v,u)},X=v=>{var u=A(),P=f(u);{var D=g=>{var S=_e(),E=w(f(S),2),Y=d(E);N(Y,{onClick:G,children:(Z,Ae)=>{var ee=T("Confirm");t(Z,ee)},$$slots:{default:!0}}),t(g,S)};h(P,g=>{s(e)==="confirmAccessKey"&&g(D)},!0)}t(v,u)};h(I,v=>{s(e)==="error"?v(x):v(X,!1)},!0)}t(c,_)};h(b,c=>{s(e)==="confirmingAccessKey"?c(p):c(W,!1)},!0)}t(o,l)};h(n,o=>{s(e)==="addingAccessKey"?o(m):o($,!1)},!0)}t(r,a)};h(Q,r=>{s(e)==="idle"?r(R):r(V,!1)})}t(z,j),ie()}export{Pe as default};
